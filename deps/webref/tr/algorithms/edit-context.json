{
  "spec": {
    "title": "EditContext API",
    "url": "https://www.w3.org/TR/edit-context/"
  },
  "algorithms": [
    {
      "html": "<dl>\n                            <dt>Input</dt>\n                            <dd><var>editContext</var></dd>\n                            <dt>Output</dt>\n                            <dd>None</dd>\n                        </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-local-name\">local name</a> is neither a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#valid-shadow-host-name\">valid shadow host name</a> nor \"<code>canvas</code>\", then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw</a> a \"<a data-link-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\"><code>NotSupportedError</code></a>\" <a data-link-type=\"interface\" data-lt=\"DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If <var>editContext</var> is not null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>editContext</var>'s <a href=\"https://www.w3.org/TR/edit-context/#dfn-associated-element\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-associated-element-11\">associated element</a> is equal to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>, then terminate these steps."
            },
            {
              "html": "If <var>editContext</var>'s <a href=\"https://www.w3.org/TR/edit-context/#dfn-associated-element\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-associated-element-12\">associated element</a> is not null, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw</a> a \"<a data-link-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\"><code>NotSupportedError</code></a>\" <a data-link-type=\"interface\" data-lt=\"DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
            },
            {
              "html": "Set <var>editContext</var>'s <a href=\"https://www.w3.org/TR/edit-context/#dfn-associated-element\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-associated-element-13\">associated element</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>."
            }
          ]
        },
        {
          "html": "Let <var>oldEditContext</var> be the value of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s internal [[EditContext]] slot."
        },
        {
          "html": "If <var>oldEditContext</var> is not null, then:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var>oldEditContext</var>'s <a href=\"https://www.w3.org/TR/edit-context/#dfn-associated-element\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-associated-element-14\">associated element</a> is equal to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>."
            },
            {
              "html": "Set <var>oldEditContext</var>'s <a href=\"https://www.w3.org/TR/edit-context/#dfn-associated-element\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-associated-element-15\">associated element</a> to null."
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s internal [[EditContext]] slot to be <var>editContext</var>."
        },
        {
          "html": "If <var>oldEditContext</var> is not null and <var>oldEditContext</var> is <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s\n                                <a href=\"https://dom.spec.whatwg.org/#concept-node-document\">node document</a>'s\n                                <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-active-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-active-editcontext-5\">active EditContext</a>, then run the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-deactivate-an-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-deactivate-an-editcontext-1\">deactivate an EditContext</a>\n                                with <var>oldEditContext</var>."
        }
      ]
    },
    {
      "html": "<dl>\n                    <dt>Input</dt>\n                    <dd><var>element</var>, the <a data-link-type=\"interface\" data-lt=\"HTMLElement\" href=\"https://html.spec.whatwg.org/multipage/dom.html#htmlelement\"><code>HTMLElement</code></a> receiving the input</dd>\n                    <dt>Output</dt>\n                    <dd>None</dd>\n                </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>editContext</var> be <var>element</var>'s\n                        <a href=\"https://dom.spec.whatwg.org/#concept-node-document\">node document</a>'s\n                        <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-active-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-active-editcontext-6\">active EditContext</a>"
        },
        {
          "html": "If <var>editContext</var> is null, return."
        },
        {
          "html": "<p>\n                            Run the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-update-the-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-update-the-editcontext-1\">Update the EditContext</a> given <var>editContext</var> and the\n                            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-edit-context\" class=\"internalDFN\" id=\"ref-for-dfn-text-edit-context-17\">Text Edit Context</a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-state\" class=\"internalDFN\" id=\"ref-for-dfn-text-state-3\">text state</a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text\" class=\"internalDFN\" id=\"ref-for-dfn-text-13\">text</a>, <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-formats\" class=\"internalDFN\" id=\"ref-for-dfn-text-formats-1\">text formats</a>,\n                            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-start\" class=\"internalDFN\" id=\"ref-for-dfn-selection-start-2\">selection start</a>, <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-end\" class=\"internalDFN\" id=\"ref-for-dfn-selection-end-2\">selection end</a>, <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-1\">is composing</a>, <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-start\" class=\"internalDFN\" id=\"ref-for-dfn-composition-start-2\">composition start</a>,\n                            and <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-end\" class=\"internalDFN\" id=\"ref-for-dfn-composition-end-2\">composition end</a>.\n                        </p>"
        }
      ]
    },
    {
      "html": "<dl>\n                    <dt>Input</dt>\n                    <dd><var>editContext</var>, an <a data-link-type=\"idl\" data-lt=\"EditContext\" href=\"https://www.w3.org/TR/edit-context/#dom-editcontext\" class=\"internalDFN\" id=\"ref-for-dom-editcontext-25\"><code>EditContext</code></a></dd>\n                    <dd><var>text</var>, a string</dd>\n                    <dd><var>textFormats</var>, an array of <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-format\" class=\"internalDFN\" id=\"ref-for-dfn-text-format-2\">text format</a>s from the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-input-service\" class=\"internalDFN\" id=\"ref-for-dfn-text-input-service-17\">Text Input Service</a></dd>\n                    <dd><var>selectionStart</var>, the new position for the start of the selection</dd>\n                    <dd><var>selectionEnd</var>, the new position for the end of the selection</dd>\n                    <dd><var>isComposing</var>, a boolean indicating whether composition should be active at the end of the update</dd>\n                    <dd><var>replacementRangeStart</var>, the start position of the current composition (0 if there is no composition)</dd>\n                    <dd><var>replacementRangeEnd</var>, the end position of the current composition (0 if there is no composition)</dd>\n                    <dt>Output</dt>\n                    <dd>None</dd>\n                </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>isComposing</var> is true, <var>text</var> is not empty, and <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-2\">is composing</a> is false.",
          "rationale": "fire",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named <a href=\"https://w3c.github.io/uievents/#event-type-compositionstart\">compositionstart</a> at <var>editContext</var> using <a data-link-type=\"interface\" data-lt=\"CompositionEvent\" href=\"https://www.w3.org/TR/uievents/#compositionevent\"><code>CompositionEvent</code></a>."
            },
            {
              "html": "set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-3\">is composing</a> to true."
            }
          ]
        },
        {
          "html": "If <var>text</var> is empty:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-4\">is composing</a> is false, return."
            },
            {
              "html": "If <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-5\">is composing</a> is true and <var>isComposing</var> is false, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-6\">is composing</a> to false."
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named\n                                    <a href=\"https://w3c.github.io/uievents/#event-type-compositionend\">compositionend</a>\n                                    at <var>editContext</var> using <a data-link-type=\"interface\" data-lt=\"CompositionEvent\" href=\"https://www.w3.org/TR/uievents/#compositionevent\"><code>CompositionEvent</code></a>."
                },
                {
                  "html": "Return."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-7\">is composing</a> is true, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>insertionStart</var> be <var>replacementRangeStart</var>."
            },
            {
              "html": "Let <var>insertionEnd</var> be <var>replacementRangeEnd</var>."
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>insertionStart</var> be <var>selectionStart</var>."
            },
            {
              "html": "Let <var>insertionEnd</var> be <var>selectionEnd</var>."
            }
          ]
        },
        {
          "html": "Replace the substring of <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text\" class=\"internalDFN\" id=\"ref-for-dfn-text-14\">text</a> in the range of <var>insertionStart</var> and <var>insertionEnd</var> with <var>text</var>"
        },
        {
          "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-start\" class=\"internalDFN\" id=\"ref-for-dfn-selection-start-3\">selection start</a> to <var>selectionStart</var>."
        },
        {
          "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-end\" class=\"internalDFN\" id=\"ref-for-dfn-selection-end-3\">selection end</a> to <var>selectionEnd</var>."
        },
        {
          "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-start\" class=\"internalDFN\" id=\"ref-for-dfn-composition-start-3\">composition start</a> to <var>insertionStart</var>."
        },
        {
          "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-end\" class=\"internalDFN\" id=\"ref-for-dfn-composition-end-3\">composition end</a> to <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-start\" class=\"internalDFN\" id=\"ref-for-dfn-composition-start-4\">composition start</a> plus the length of <var>text</var>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-dispatch-text-update-event\" class=\"internalDFN\" id=\"ref-for-dfn-dispatch-text-update-event-1\">Dispatch text update event</a> given <var>editContext</var> and <var>text</var>."
        },
        {
          "html": "If <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-8\">is composing</a> is true, then:",
          "rationale": "dispatch",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-dispatch-text-format-update-event\" class=\"internalDFN\" id=\"ref-for-dfn-dispatch-text-format-update-event-1\">Dispatch text format update event</a> given <var>editContext</var> and <var>textFormats</var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-dispatch-character-bounds-update-event\" class=\"internalDFN\" id=\"ref-for-dfn-dispatch-character-bounds-update-event-1\">Dispatch character bounds update event</a> given <var>editContext</var>."
            },
            {
              "html": "If <var>isComposing</var> is false, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-9\">is composing</a> to false."
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named\n                                    <a href=\"https://w3c.github.io/uievents/#event-type-compositionend\">compositionend</a>\n                                    at <var>editContext</var> using <a data-link-type=\"interface\" data-lt=\"CompositionEvent\" href=\"https://www.w3.org/TR/uievents/#compositionevent\"><code>CompositionEvent</code></a>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "<dl>\n        <dt>Input</dt>\n        <dd><var>document</var>, a <a data-link-type=\"interface\" data-lt=\"Document\" href=\"https://dom.spec.whatwg.org/#document\"><code>Document</code></a></dd>\n        <dt>Output</dt>\n        <dd>None</dd>\n    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>oldActiveEditContext</var> be <var>document</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-active-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-active-editcontext-7\">active EditContext</a>."
        },
        {
          "html": "Let <var>newActiveEditContext</var> be the result of running the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-determine-the-active-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-determine-the-active-editcontext-1\">determine the active EditContext</a> given <var>document</var>."
        },
        {
          "html": "If <var>oldActiveEditContext</var> is not null, then run the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-deactivate-an-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-deactivate-an-editcontext-2\">deactivate an EditContext</a> given <var>oldActiveEditContext</var>."
        },
        {
          "html": "If <var>newActiveEditContext</var> is not null, then:",
          "rationale": "update",
          "steps": [
            {
              "html": "Update the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-edit-context\" class=\"internalDFN\" id=\"ref-for-dfn-text-edit-context-20\">Text Edit Context</a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-state\" class=\"internalDFN\" id=\"ref-for-dfn-text-state-4\">text state</a> to match the values in <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-state\" class=\"internalDFN\" id=\"ref-for-dfn-text-state-5\">text state</a>."
            }
          ]
        },
        {
          "html": "Set the <var>document</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-active-editcontext\" class=\"internalDFN\" id=\"ref-for-dfn-active-editcontext-8\">active EditContext</a> to <var>newActiveEditContext</var>."
        }
      ]
    },
    {
      "html": "<dl>\n                <dt>Input</dt>\n                <dd><var>editContext</var>, an <a data-link-type=\"idl\" data-lt=\"EditContext\" href=\"https://www.w3.org/TR/edit-context/#dom-editcontext\" class=\"internalDFN\" id=\"ref-for-dom-editcontext-26\"><code>EditContext</code></a></dd>\n                <dd><var>text</var>, a string</dd>\n                <dt>Output</dt>\n                <dd>None</dd>\n            </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named \"textupdate\" at <var>editContext</var> using <a data-link-type=\"idl\" data-lt=\"TextUpdateEvent\" href=\"https://www.w3.org/TR/edit-context/#dom-textupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-textupdateevent-3\"><code>TextUpdateEvent</code></a>, with\n            <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textupdateevent-text\" class=\"internalDFN\" id=\"ref-for-dom-textupdateevent-text-1\"><code>text</code></a> initialized to <var>text</var>,\n            <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textupdateevent-selectionstart\" class=\"internalDFN\" id=\"ref-for-dom-textupdateevent-selectionstart-1\"><code>selectionStart</code></a> initialized to |<var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-start\" class=\"internalDFN\" id=\"ref-for-dfn-selection-start-4\">selection start</a>, and\n            <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textupdateevent-selectionend\" class=\"internalDFN\" id=\"ref-for-dom-textupdateevent-selectionend-1\"><code>selectionEnd</code></a> initialized to <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-end\" class=\"internalDFN\" id=\"ref-for-dfn-selection-end-4\">selection end</a>."
        }
      ]
    },
    {
      "html": "<dl>\n            <dt>Input</dt>\n            <dd><var>editContext</var>, an <a data-link-type=\"idl\" data-lt=\"EditContext\" href=\"https://www.w3.org/TR/edit-context/#dom-editcontext\" class=\"internalDFN\" id=\"ref-for-dom-editcontext-27\"><code>EditContext</code></a></dd>\n            <dd><var>textFormats</var>, an array of <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-format\" class=\"internalDFN\" id=\"ref-for-dfn-text-format-3\">text format</a>s from the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-input-service\" class=\"internalDFN\" id=\"ref-for-dfn-text-input-service-19\">Text Input Service</a></dd>\n            <dt>Output</dt>\n            <dd>None</dd>\n        </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>formats</var> be an array of <a data-link-type=\"idl\" data-lt=\"TextFormat\" href=\"https://www.w3.org/TR/edit-context/#dom-textformat\" class=\"internalDFN\" id=\"ref-for-dom-textformat-1\"><code>TextFormat</code></a>, initially empty."
        },
        {
          "html": "For each <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-format\" class=\"internalDFN\" id=\"ref-for-dfn-text-format-4\">text format</a> <var>format</var> in <var>textFormats</var>,",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>textFormat</var> be a new <a data-link-type=\"idl\" data-lt=\"TextFormat\" href=\"https://www.w3.org/TR/edit-context/#dom-textformat\" class=\"internalDFN\" id=\"ref-for-dom-textformat-2\"><code>TextFormat</code></a>. with <var>rangeStart</var>, <var>rangeEnd</var>, <var>underlineStyle</var>, <var>underlineThickness</var>."
            },
            {
              "html": "Set <var>textFormat</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textformat-rangestart\" class=\"internalDFN\" id=\"ref-for-dom-textformat-rangestart-1\"><code>rangeStart</code></a> to <var>format</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-range-start\" class=\"internalDFN\" id=\"ref-for-dfn-range-start-1\">range start</a>."
            },
            {
              "html": "Set <var>textFormat</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textformat-rangeend\" class=\"internalDFN\" id=\"ref-for-dom-textformat-rangeend-1\"><code>rangeEnd</code></a> to <var>format</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-range-end\" class=\"internalDFN\" id=\"ref-for-dfn-range-end-1\">range end</a>."
            },
            {
              "html": "Set <var>textFormat</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textformat-underlinestyle\" class=\"internalDFN\" id=\"ref-for-dom-textformat-underlinestyle-1\"><code>underlineStyle</code></a> to <var>format</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-underline-style\" class=\"internalDFN\" id=\"ref-for-dfn-underline-style-1\">underline style</a>."
            },
            {
              "html": "Set <var>textFormat</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-textformat-underlinethickness\" class=\"internalDFN\" id=\"ref-for-dom-textformat-underlinethickness-1\"><code>underlineThickness</code></a> to <var>format</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-underline-thickness\" class=\"internalDFN\" id=\"ref-for-dfn-underline-thickness-1\">underline thickness</a>."
            },
            {
              "html": "Append <var>textFormat</var> to <var>formats</var>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named \"textformatupdate\" at <var>editContext</var> using <a data-link-type=\"idl\" data-lt=\"TextFormatUpdateEvent\" href=\"https://www.w3.org/TR/edit-context/#dom-textformatupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-textformatupdateevent-3\"><code>TextFormatUpdateEvent</code></a> with\n        the <a data-link-type=\"idl\" data-lt=\"TextFormatUpdateEvent\" href=\"https://www.w3.org/TR/edit-context/#dom-textformatupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-textformatupdateevent-4\"><code>TextFormatUpdateEvent</code></a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text-format-list\" class=\"internalDFN\" id=\"ref-for-dfn-text-format-list-1\">text format list</a> initialized to <var>formats</var>."
        }
      ]
    },
    {
      "html": "<dl>\n        <dt>Input</dt>\n        <dd><var>editContext</var>, an <a data-link-type=\"idl\" data-lt=\"EditContext\" href=\"https://www.w3.org/TR/edit-context/#dom-editcontext\" class=\"internalDFN\" id=\"ref-for-dom-editcontext-28\"><code>EditContext</code></a></dd>\n        <dt>Output</dt>\n        <dd>None</dd>\n    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named \"characterboundsupdate\" at <var>editContext</var> using <a data-link-type=\"idl\" data-lt=\"CharacterBoundsUpdateEvent\" href=\"https://www.w3.org/TR/edit-context/#dom-characterboundsupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-characterboundsupdateevent-6\"><code>CharacterBoundsUpdateEvent</code></a> with\n    <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-characterboundsupdateevent-rangestart\" class=\"internalDFN\" id=\"ref-for-dom-characterboundsupdateevent-rangestart-1\"><code>rangeStart</code></a> initialized to <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-start\" class=\"internalDFN\" id=\"ref-for-dfn-composition-start-5\">composition start</a> and\n    <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/edit-context/#dom-characterboundsupdateevent-rangeend\" class=\"internalDFN\" id=\"ref-for-dom-characterboundsupdateevent-rangeend-1\"><code>rangeEnd</code></a> initialized to <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-composition-end\" class=\"internalDFN\" id=\"ref-for-dfn-composition-end-4\">composition end</a>."
        }
      ]
    },
    {
      "html": "<dl>\n        <dt>Input</dt>\n        <dd><var>editContext</var>, an <a data-link-type=\"idl\" data-lt=\"EditContext\" href=\"https://www.w3.org/TR/edit-context/#dom-editcontext\" class=\"internalDFN\" id=\"ref-for-dom-editcontext-29\"><code>EditContext</code></a></dd>\n        <dt>Output</dt>\n        <dd>None</dd>\n    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Set <var>editContext</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-is-composing\" class=\"internalDFN\" id=\"ref-for-dfn-is-composing-10\">is composing</a> to false."
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named\n            <a href=\"https://w3c.github.io/uievents/#event-type-compositionend\">compositionend</a>\n            at <var>editContext</var> using <a data-link-type=\"interface\" data-lt=\"CompositionEvent\" href=\"https://www.w3.org/TR/uievents/#compositionevent\"><code>CompositionEvent</code></a>."
        }
      ]
    },
    {
      "html": "<dl>\n        <dt>Input</dt>\n        <dd><var>document</var>, a <a data-link-type=\"interface\" data-lt=\"Document\" href=\"https://dom.spec.whatwg.org/#document\"><code>Document</code></a></dd>\n        <dt>Output</dt>\n        <dd>An <a data-link-type=\"idl\" data-lt=\"EditContext\" href=\"https://www.w3.org/TR/edit-context/#dom-editcontext\" class=\"internalDFN\" id=\"ref-for-dom-editcontext-30\"><code>EditContext</code></a>, or null.</dd>\n    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>traversable</var> be <var>document</var>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\">top-level traversable</a>."
        },
        {
          "html": "If <var>traversable</var> is null, return null."
        },
        {
          "html": "Let <var>focused</var> be the <a href=\"https://html.spec.whatwg.org/multipage/interaction.html#dom-anchor\">DOM anchor</a>\n            of the <a href=\"https://html.spec.whatwg.org/multipage/interaction.html#currently-focused-area-of-a-top-level-traversable\">currently focused area of a top-level traversable</a>\n            given <var>traversable</var>."
        },
        {
          "html": "<p>If <var>focused</var> is null or if the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-root\">shadow-including root</a> of <var>focused</var> is not <var>document</var>, return null.</p>"
        },
        {
          "html": "Let <var>editContext</var> be null."
        },
        {
          "html": "While <var>focused</var> is not null and <var>focused</var> is <a href=\"https://w3c.github.io/editing/docs/execCommand/#editable\">editable</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var>editContext</var> to the value of <var>focused</var>'s internal [[EditContext]] slot."
            },
            {
              "html": "Let <var>parent</var> be <var>focused</var>'s <a href=\"https://dom.spec.whatwg.org/#concept-tree-parent\">parent</a>."
            },
            {
              "html": "If <var>parent</var> is null and <var>focused</var>'s <a href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>\n                    is a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-shadow-root\">shadow root</a>, let <var>parent</var> be <var>focused</var>'s\n                    <a href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>'s\n                    <a href=\"https://dom.spec.whatwg.org/#concept-documentfragment-host\">host</a>."
            },
            {
              "html": "Set <var>focused</var> to <var>parent</var>."
            }
          ]
        },
        {
          "html": "Return <var>editContext</var>."
        }
      ]
    },
    {
      "html": "<dl>\n                    <dt>Input</dt>\n                    <dd><var>rangeStart</var>, an unsigned long</dd>\n                    <dd><var>rangeEnd</var>, an unsigned long</dd>\n                    <dd><var>newText</var>, a DOMString</dd>\n                    <dt>Output</dt>\n                    <dd>None</dd>\n                </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Replace the substring of <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-text\" class=\"internalDFN\" id=\"ref-for-dfn-text-16\">text</a> in the range of <var>rangeStart</var> and <var>rangeEnd</var> with <var>newText</var>"
        }
      ]
    },
    {
      "html": "<dl>\n                        <dt>Input</dt>\n                        <dd><var>start</var>, an unsigned long</dd>\n                        <dd><var>end</var>, an unsigned long</dd>\n                        <dt>Output</dt>\n                        <dd>None</dd>\n                    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "set <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-start\" class=\"internalDFN\" id=\"ref-for-dfn-selection-start-6\">selection start</a> to <var>start</var>"
        },
        {
          "html": "set <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-end\" class=\"internalDFN\" id=\"ref-for-dfn-selection-end-6\">selection end</a> to <var>end</var>"
        }
      ]
    },
    {
      "html": "<dl>\n                        <dt>Input</dt>\n                        <dd><var>selectionBounds</var>, a <a data-link-type=\"interface\" data-lt=\"DOMRect\" href=\"https://www.w3.org/TR/geometry-1/#domrect\"><code>DOMRect</code></a></dd>\n                        <dt>Output</dt>\n                        <dd>None</dd>\n                    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "set <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-selection-bounds\" class=\"internalDFN\" id=\"ref-for-dfn-selection-bounds-3\">selection bounds</a> to <var>selectionBounds</var>"
        }
      ]
    },
    {
      "html": "<dl>\n                        <dt>Input</dt>\n                        <dd><var>controlBounds</var>, a <a data-link-type=\"interface\" data-lt=\"DOMRect\" href=\"https://www.w3.org/TR/geometry-1/#domrect\"><code>DOMRect</code></a></dd>\n                        <dt>Output</dt>\n                        <dd>None</dd>\n                    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "set <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-control-bounds\" class=\"internalDFN\" id=\"ref-for-dfn-control-bounds-3\">control bounds</a> to <var>controlBounds</var>"
        }
      ]
    },
    {
      "html": "<dl>\n                        <dt>Input</dt>\n                        <dd><var>rangeStart</var>, an unsigned long</dd>\n                        <dd><var>characterBounds</var>, an array of <a data-link-type=\"interface\" data-lt=\"DOMRect\" href=\"https://www.w3.org/TR/geometry-1/#domrect\"><code>DOMRect</code></a></dd>\n                        <dt>Output</dt>\n                        <dd>None</dd>\n                    </dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "set <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-codepoint-rects-start-index\" class=\"internalDFN\" id=\"ref-for-dfn-codepoint-rects-start-index-2\">codepoint rects start index</a> to <var>rangeStart</var>."
        },
        {
          "html": "set <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/edit-context/#dfn-codepoint-rects\" class=\"internalDFN\" id=\"ref-for-dfn-codepoint-rects-5\">codepoint rects</a> to <var>characterBounds</var>."
        }
      ]
    }
  ]
}