{
  "spec": {
    "title": "CSS Layout API Level 1",
    "url": "https://www.w3.org/TR/css-layout-api-1/"
  },
  "algorithms": [
    {
      "name": "styleMap",
      "href": "https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-stylemap",
      "html": "The <dfn class=\"dfn-paneled idl-code\" data-dfn-for=\"LayoutChild\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-layoutchild-stylemap\"><code>styleMap</code></dfn>, on getting from a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutchild\" id=\"ref-for-layoutchild①③\">LayoutChild</a></code> <var>this</var>, the\nuser agent must perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return <var>this</var>’ <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-typed-om-1/#stylepropertymapreadonly\" id=\"ref-for-stylepropertymapreadonly②\">StylePropertyMapReadOnly</a></code> contained in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-stylemap-slot\" id=\"ref-for-dom-layoutchild-stylemap-slot\">[[styleMap]]</a></code> internal slot.</p>"
        }
      ]
    },
    {
      "name": "layoutNextFragment(constraints, breakToken)",
      "href": "https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-layoutnextfragment",
      "html": "When the <dfn class=\"dfn-paneled idl-code\" data-dfn-for=\"LayoutChild\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-layoutchild-layoutnextfragment\"><code>layoutNextFragment(<var>constraints</var>, <var>breakToken</var>)</code></dfn> method is\ncalled on a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutchild\" id=\"ref-for-layoutchild①④\">LayoutChild</a></code> <var>this</var>, the user agent must perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutfragmentrequest\" id=\"ref-for-layoutfragmentrequest①\">LayoutFragmentRequest</a></code> with internal slot(s):</p>\n      <ul>\n       <li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragmentrequest-layoutchild-slot\" id=\"ref-for-dom-layoutfragmentrequest-layoutchild-slot\">[[layoutChild]]</a></code> set to <var>this</var>.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragmentrequest-layoutconstraints-slot\" id=\"ref-for-dom-layoutfragmentrequest-layoutconstraints-slot\">[[layoutConstraints]]</a></code> set to <var>constraints</var>.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragmentrequest-breaktoken-slot\" id=\"ref-for-dom-layoutfragmentrequest-breaktoken-slot\">[[breakToken]]</a></code> set to <var>breakToken</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "intrinsicSizes()",
      "href": "https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-intrinsicsizes",
      "html": "When the <dfn class=\"dfn-paneled idl-code\" data-dfn-for=\"LayoutChild\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-layoutchild-intrinsicsizes\"><code>intrinsicSizes()</code></dfn> method is called on a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutchild\" id=\"ref-for-layoutchild①⑤\">LayoutChild</a></code> <var>this</var>, the user agent must perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsicsizesrequest\" id=\"ref-for-intrinsicsizesrequest①\">IntrinsicSizesRequest</a></code> with internal slot(s):</p>\n      <ul>\n       <li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizesrequest-layoutchild-slot\" id=\"ref-for-dom-intrinsicsizesrequest-layoutchild-slot\">[[layoutChild]]</a></code> set to <var>this</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "get a layout child",
      "href": "https://www.w3.org/TR/css-layout-api-1/#get-a-layout-child",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-layout-child\">get a layout child</dfn> given <var>workletGlobalScope</var>, <var>name</var>, and <var>box</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Assert that:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>box</var> is currently attached to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#box-tree\" id=\"ref-for-box-tree②\">box tree</a>.</p>\n       </li><li data-md=\"\">\n        <p><var>box</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#containing-block\" id=\"ref-for-containing-block\">containing block</a> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-api-container\" id=\"ref-for-layout-api-container⑥\">layout API container</a>.</p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#containing-block\" id=\"ref-for-containing-block①\">containing block</a>’s <a class=\"css\" data-link-type=\"maybe\" href=\"https://www.w3.org/TR/css-layout-api-1/#valdef-display-layout\" id=\"ref-for-valdef-display-layout①\">layout()</a> function’s first argument is <var>name</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>layoutChildMap</var> be <var>box</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-box-layoutchildmap-slot\" id=\"ref-for-dom-box-layoutchildmap-slot\">[[layoutChildMap]]</a></code>.</p>"
        },
        {
          "html": "If <var>layoutChildMap</var>[<var>workletGlobalScope</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a>, run the following\nsteps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>definition</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition\" id=\"ref-for-get-a-layout-definition\">get a layout definition</a> given <var>name</var>, and <var>workletGlobalScope</var>.</p>\n        <p>Assert that <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition\" id=\"ref-for-get-a-layout-definition①\">get a layout definition</a> succeeded, and <var>definition</var> is not <code>\"invalid\"</code>.</p>"
            },
            {
              "html": "<p>Let <var>childInputProperties</var> be <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-child-input-properties\" id=\"ref-for-layout-definition-child-input-properties\">child input\nproperties</a>.</p>"
            },
            {
              "html": "<p>Let <var>layoutChild</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutchild\" id=\"ref-for-layoutchild①⑦\">LayoutChild</a></code> with internal slot(s):</p>\n        <ul>\n         <li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-box-slot\" id=\"ref-for-dom-layoutchild-box-slot\">[[box]]</a></code> set to <var>box</var>.</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-stylemap-slot\" id=\"ref-for-dom-layoutchild-stylemap-slot①\">[[styleMap]]</a></code> set to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-typed-om-1/#stylepropertymapreadonly\" id=\"ref-for-stylepropertymapreadonly③\">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value②\">computed values</a> for properties listed in <var>childInputProperties</var>.</p>\n        </li></ul>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">Set</a> <var>layoutChildMap</var>[<var>workletGlobalScope</var>] to <var>layoutChild</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-get\" id=\"ref-for-map-get\">get</a> <var>layoutChildMap</var>[<var>workletGlobalScope</var>]</p>"
        }
      ]
    },
    {
      "name": "update a layout child style",
      "href": "https://www.w3.org/TR/css-layout-api-1/#update-a-layout-child-style",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-a-layout-child-style\">update a layout child style</dfn> given <var>box</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Assert that:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>box</var> is currently attached to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#box-tree\" id=\"ref-for-box-tree⑤\">box tree</a>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>If <var>box</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#containing-block\" id=\"ref-for-containing-block②\">containing block</a> is not a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-api-container\" id=\"ref-for-layout-api-container⑦\">layout API container</a>, abort all these\nsteps.</p>"
        },
        {
          "html": "<p>Let <var>layoutChildMap</var> be <var>box</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-box-layoutchildmap-slot\" id=\"ref-for-dom-box-layoutchildmap-slot③\">[[layoutChildMap]]</a></code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>layoutChild</var> in <var>layoutChildMap</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>styleMap</var> be <var>layoutChild</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-stylemap-slot\" id=\"ref-for-dom-layoutchild-stylemap-slot②\">[[styleMap]]</a></code>.</p>"
            },
            {
              "html": "<p>Update <var>styleMap</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-syntax-3/#declaration\" id=\"ref-for-declaration\">declarations</a> based on the <var>box</var>’s new computed style.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create a layout fragment",
      "href": "https://www.w3.org/TR/css-layout-api-1/#create-a-layout-fragment",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-layout-fragment\">create a layout fragment</dfn> given <var>generator</var>, <var>layoutFragmentRequest</var>, and <var>internalFragment</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>targetRealm</var> be <var>generator</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm\" id=\"ref-for-concept-global-object-realm\">Realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>fragment</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutfragment\" id=\"ref-for-layoutfragment①①\">LayoutFragment</a></code> with:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-layoutfragmentrequest-slot\" id=\"ref-for-dom-layoutfragment-layoutfragmentrequest-slot\">[[layoutFragmentRequest]]</a></code> internal slot being <var>layoutFragmentRequest</var>.</p>\n       </li><li data-md=\"\">\n        <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-generator-slot\" id=\"ref-for-dom-layoutfragment-generator-slot\">[[generator]]</a></code> internal slot being <var>generator</var>.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-inlinesize\" id=\"ref-for-dom-layoutfragment-inlinesize③\">inlineSize</a></code> being <var>internalFragment</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#inline-size\" id=\"ref-for-inline-size\">inline size</a> relative to\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#current-layout\" id=\"ref-for-current-layout⑤\">current layout’s</a> writing mode.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-blocksize\" id=\"ref-for-dom-layoutfragment-blocksize③\">blockSize</a></code> being <var>internalFragment</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#block-size\" id=\"ref-for-block-size\">block size</a> relative to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#current-layout\" id=\"ref-for-current-layout⑥\">current layout’s</a> writing mode.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-inlineoffset\" id=\"ref-for-dom-layoutfragment-inlineoffset②\">inlineOffset</a></code> initially set to 0.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-blockoffset\" id=\"ref-for-dom-layoutfragment-blockoffset②\">blockOffset</a></code> initially set to 0.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-breaktoken\" id=\"ref-for-dom-layoutfragment-breaktoken⑤\">breakToken</a></code> being a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#childbreaktoken\" id=\"ref-for-childbreaktoken②\">ChildBreakToken</a></code> representing <var>internalFragment</var>’s internal break token, if any.</p>\n       </li><li data-md=\"\">\n        <p>If <var>internalFragment</var> has a <var>clonedData</var> object stored with it, let <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-data\" id=\"ref-for-dom-layoutfragment-data①\">data</a></code> being the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#structureddeserialize\" id=\"ref-for-structureddeserialize\">StructuredDeserialize</a>(<var>clonedData</var>, <var>targetRealm</var>), otherwise null.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return <var>fragment</var>.</p>"
        }
      ]
    },
    {
      "name": "create an intrinsic sizes object",
      "href": "https://www.w3.org/TR/css-layout-api-1/#create-an-intrinsic-sizes-object",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-an-intrinsic-sizes-object\">create an intrinsic sizes object</dfn> given <var>intrinsicSizesRequest</var>, and <var>internalIntrinsicSizes</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>intrinsicSizes</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsicsizes\" id=\"ref-for-intrinsicsizes②\">IntrinsicSizes</a></code> with:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizes-intrinsicsizesrequest-slot\" id=\"ref-for-dom-intrinsicsizes-intrinsicsizesrequest-slot\">[[intrinsicSizesRequest]]</a></code> internal slot being <var>intrinsicSizesRequest</var>.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizes-mincontentsize\" id=\"ref-for-dom-intrinsicsizes-mincontentsize②\">minContentSize</a></code> being <var>internalIntrinsicSizes</var>’ <b>border box</b> min-content contribution, relative to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#current-layout\" id=\"ref-for-current-layout⑨\">current layout’s</a> writing mode.</p>\n       </li><li data-md=\"\">\n        <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizes-maxcontentsize\" id=\"ref-for-dom-intrinsicsizes-maxcontentsize②\">maxContentSize</a></code> being <var>internalIntrinsicSizes</var>’s <b>border box</b> max-content contribution, relative to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#current-layout\" id=\"ref-for-current-layout①⓪\">current layout’s</a> writing mode.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return <var>intrinsicSizes</var>.</p>"
        }
      ]
    },
    {
      "name": "create a layout constraints object",
      "href": "https://www.w3.org/TR/css-layout-api-1/#create-a-layout-constraints-object",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-layout-constraints-object\">create a layout constraints object</dfn> given <var>sizingMode</var>, box|,\nand <var>internalLayoutConstraints</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>sizingMode</var> is <code>\"block-like\"</code> then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>fixedInlineSize</var> be the result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#inline-size\" id=\"ref-for-inline-size①\">inline size</a> (relative to <var>box</var>’s writing mode) exactly like block containers do.</p>"
            },
            {
              "html": "<p>Let <var>fixedBlockSize</var> be null if <var>box</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#block-size\" id=\"ref-for-block-size①\">block size</a> is <a class=\"css\" data-link-type=\"maybe\" href=\"https://www.w3.org/TR/css-sizing-3/#valdef-width-auto\" id=\"ref-for-valdef-width-auto\">auto</a>, otherwise\nthe result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#block-size\" id=\"ref-for-block-size②\">block size</a> exactly like block\ncontainers do.</p>"
            },
            {
              "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutconstraints\" id=\"ref-for-layoutconstraints⑤\">LayoutConstraints</a></code> object with:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-fixedinlinesize\" id=\"ref-for-dom-layoutconstraints-fixedinlinesize①\">fixedInlineSize</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-availableinlinesize\" id=\"ref-for-dom-layoutconstraints-availableinlinesize①\">availableInlineSize</a></code> set to <var>fixedInlineSize</var>.</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-percentageinlinesize\" id=\"ref-for-dom-layoutconstraints-percentageinlinesize①\">percentageInlineSize</a></code> set to <var>internalLayoutConstraints</var>’\npercentage resolution size in the inline axis (relative to <var>box</var>’s writing mode).</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-fixedblocksize\" id=\"ref-for-dom-layoutconstraints-fixedblocksize①\">fixedBlockSize</a></code> set to <var>fixedBlockSize</var>.</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-availableblocksize\" id=\"ref-for-dom-layoutconstraints-availableblocksize①\">availableBlockSize</a></code> set to <var>fixedBlockSize</var> if not null,\notherwise <var>internalLayoutConstraints</var>’ <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-sizing-3/#available\" id=\"ref-for-available①\">available space</a> in the block axis\n(relative to <var>box</var>’s writing mode).</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-percentageblocksize\" id=\"ref-for-dom-layoutconstraints-percentageblocksize①\">percentageBlockSize</a></code> set to <var>internalLayoutConstraints</var>’\npercentage resolution size in the block axis (relative to <var>box</var>’s writing mode).</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "If <var>sizingMode</var> is <code>\"manual\"</code> then:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutconstraints\" id=\"ref-for-layoutconstraints⑥\">LayoutConstraints</a></code> object with:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-fixedinlinesize\" id=\"ref-for-dom-layoutconstraints-fixedinlinesize②\">fixedInlineSize</a></code>/<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-fixedblocksize\" id=\"ref-for-dom-layoutconstraints-fixedblocksize②\">fixedBlockSize</a></code> set to <var>internalLayoutConstraints</var>’ fixed inline/block size (relative to <var>box</var>’s writing\nmode) imposed by the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#parent-layout\" id=\"ref-for-parent-layout②\">parent layout</a>. Either may be null.</p>\n          \n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-availableinlinesize\" id=\"ref-for-dom-layoutconstraints-availableinlinesize②\">availableInlineSize</a></code>/<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-availableblocksize\" id=\"ref-for-dom-layoutconstraints-availableblocksize②\">availableBlockSize</a></code> set\nto <var>internalLayoutConstraints</var>’ <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-sizing-3/#available\" id=\"ref-for-available②\">available space</a>.</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-percentageinlinesize\" id=\"ref-for-dom-layoutconstraints-percentageinlinesize②\">percentageInlineSize</a></code>/<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-percentageblocksize\" id=\"ref-for-dom-layoutconstraints-percentageblocksize②\">percentageBlockSize</a></code> set to <var>internalLayoutConstraints</var>’ percentage resolution size.</p>\n        </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "name": "invalidate layout functions",
      "href": "https://www.w3.org/TR/css-layout-api-1/#invalidate-layout-functions",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"invalidate-layout-functions\">invalidate layout functions</dfn> given <var>box</var>, the user agent <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layoutFunction</var> be the <a class=\"css\" data-link-type=\"maybe\" href=\"https://www.w3.org/TR/css-layout-api-1/#valdef-display-layout\" id=\"ref-for-valdef-display-layout④\">layout()</a> function of the <a class=\"property\" data-link-type=\"propdesc\" href=\"https://www.w3.org/TR/css-ruby-1/#propdef-display\" id=\"ref-for-propdef-display④\">display</a> property on the computed\nstyle for the <var>box</var> if it exists. If it is a different type of value (e.g. <a class=\"css\" data-link-type=\"maybe\" href=\"https://www.w3.org/TR/css-display-3/#valdef-display-grid\" id=\"ref-for-valdef-display-grid\">grid</a>) then\nabort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be the first argument of the <var>layoutFunction</var>.</p>"
        },
        {
          "html": "<p>Let <var>documentDefinition</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition\" id=\"ref-for-get-a-document-layout-definition\">get a document layout definition</a> given <var>name</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition\" id=\"ref-for-get-a-document-layout-definition①\">get a document layout definition</a> returned failure, or if <var>documentDefinition</var> is <code>\"invalid\"</code>, then abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>inputProperties</var> be <var>documentDefinition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-input-properties\" id=\"ref-for-document-layout-definition-input-properties\">input\nproperties</a>.</p>"
        },
        {
          "html": "<p>Let <var>childInputProperties</var> be <var>documentDefinition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-child-input-properties\" id=\"ref-for-document-layout-definition-child-input-properties\">child input properties</a>.</p>"
        },
        {
          "html": "<p>For each <var>property</var> in <var>inputProperties</var>, if the <var>property</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value③\">computed value</a> has\nchanged, set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-valid-flag\" id=\"ref-for-layout-valid-flag\">layout valid flag</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#box\" id=\"ref-for-box①②\">box</a> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-invalid\" id=\"ref-for-layout-invalid①\">layout-invalid</a>, and\nset the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-valid-flag\" id=\"ref-for-intrinsic-sizes-valid-flag\">intrinsic sizes valid flag</a> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-invalid\" id=\"ref-for-intrinsic-sizes-invalid①\">intrinsic-sizes-invalid</a>.</p>"
        },
        {
          "html": "<p>For each <var>property</var> in <var>childInputProperties</var>, if the <var>property</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value④\">computed value</a> has\nchanged, set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-valid-flag\" id=\"ref-for-layout-valid-flag①\">layout valid flag</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#box\" id=\"ref-for-box①③\">box</a> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-invalid\" id=\"ref-for-layout-invalid②\">layout-invalid</a>, and\nset the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-valid-flag\" id=\"ref-for-intrinsic-sizes-valid-flag①\">intrinsic sizes valid flag</a> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-invalid\" id=\"ref-for-intrinsic-sizes-invalid②\">intrinsic-sizes-invalid</a>.</p>"
        }
      ]
    },
    {
      "name": "registerLayout(name, layoutCtor)",
      "href": "https://www.w3.org/TR/css-layout-api-1/#dom-layoutworkletglobalscope-registerlayout",
      "html": "When the <dfn class=\"dfn-paneled idl-code\" data-dfn-for=\"LayoutWorkletGlobalScope\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-layoutworkletglobalscope-registerlayout\"><code>registerLayout(<var>name</var>, <var>layoutCtor</var>)</code></dfn> method\nis called, the user agent <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <var>name</var> is an empty string, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror\">TypeError</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>layoutDefinitionMap</var> be <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutworkletglobalscope\" id=\"ref-for-layoutworkletglobalscope⑥\">LayoutWorkletGlobalScope</a></code>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definitions\" id=\"ref-for-layout-definitions\">layout definitions</a> map.</p>"
        },
        {
          "html": "<p>If <var>layoutDefinitionMap</var>[<var>name</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a> <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①\">throw</a> a\n\"<a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#invalidmodificationerror\" id=\"ref-for-invalidmodificationerror\">InvalidModificationError</a>\" <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-DOMException\" id=\"ref-for-es-DOMException\">DOMException</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>inputProperties</var> be an empty <code>sequence&lt;DOMString&gt;</code>.</p>"
        },
        {
          "html": "<p>Let <var>inputPropertiesIterable</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p\">Get</a>(<var>layoutCtor</var>, \"inputProperties\").</p>"
        },
        {
          "html": "<p>If <var>inputPropertiesIterable</var> is not undefined, then set <var>inputProperties</var> to the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping\">converting</a> <var>inputPropertiesIterable</var> to a <code>sequence&lt;DOMString&gt;</code>. If an\nexception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw②\">thrown</a>, rethrow the exception and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>childInputProperties</var> be an empty <code>sequence&lt;DOMString&gt;</code>.</p>"
        },
        {
          "html": "<p>Let <var>childInputPropertiesIterable</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p①\">Get</a>(<var>layoutCtor</var>,\n\"childInputProperties\").</p>"
        },
        {
          "html": "<p>If <var>childInputPropertiesIterable</var> is not undefined, then set <var>childInputProperties</var> to the\nresult of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping①\">converting</a> <var>childInputPropertiesIterable</var> to a <code>sequence&lt;DOMString&gt;</code>. If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw③\">thrown</a>, rethrow the exception\nand abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>layoutOptionsValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p②\">Get</a>(<var>layoutCtor</var>, \"layoutOptions\").</p>"
        },
        {
          "html": "<p>Let <var>layoutOptions</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping②\">converting</a> <var>layoutOptionsValue</var> to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dictdef-layoutoptions\" id=\"ref-for-dictdef-layoutoptions②\">LayoutOptions</a></code>. If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw④\">thrown</a>, rethrow the exception and abort all\nthese steps.</p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-isconstructor\" id=\"ref-for-sec-isconstructor\">IsConstructor</a>(<var>layoutCtor</var>) is false, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw⑤\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①\">TypeError</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>prototype</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p③\">Get</a>(<var>layoutCtor</var>, \"prototype\").</p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values\">Type</a>(<var>prototype</var>) is not Object, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw⑥\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror②\">TypeError</a> and\nabort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>intrinsicSizes</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p④\">Get</a>(<var>prototype</var>, <code>\"intrinsicSizes\"</code>).</p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-iscallable\" id=\"ref-for-sec-iscallable\">IsCallable</a>(<var>intrinsicSizes</var>) is false, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw⑦\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror③\">TypeError</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>If <var>intrinsicSizes</var>’s <code>[[FunctionKind]]</code> internal slot is not <code>\"generator\"</code>, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw⑧\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror④\">TypeError</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>layout</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p⑤\">Get</a>(<var>prototype</var>, <code>\"layout\"</code>).</p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-iscallable\" id=\"ref-for-sec-iscallable①\">IsCallable</a>(<var>layout</var>) is false, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw⑨\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑤\">TypeError</a> and\nabort all these steps.</p>"
        },
        {
          "html": "<p>If <var>layout</var>’s <code>[[FunctionKind]]</code> internal slot is not <code>\"generator\"</code>, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①⓪\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑥\">TypeError</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>definition</var> be a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition\" id=\"ref-for-layout-definition\">layout definition</a> with:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-class-constructor\" id=\"ref-for-layout-definition-class-constructor\">class constructor</a> being <var>layoutCtor</var>.</p>\n       </li><li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-layout-generator-function\" id=\"ref-for-layout-definition-layout-generator-function\">layout generator function</a> being <var>layout</var>.</p>\n       </li><li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-intrinsic-sizes-generator-function\" id=\"ref-for-layout-definition-intrinsic-sizes-generator-function\">intrinsic sizes generator function</a> being <var>intrinsicSizes</var>.</p>\n       </li><li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-constructor-valid-flag\" id=\"ref-for-layout-definition-constructor-valid-flag\">constructor valid flag</a> being <b>true</b>.</p>\n       </li><li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-input-properties\" id=\"ref-for-layout-definition-input-properties\">input properties</a> being <var>inputProperties</var>.</p>\n       </li><li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-child-input-properties\" id=\"ref-for-layout-definition-child-input-properties①\">child input properties</a> being <var>childInputProperties</var>.</p>\n       </li><li data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-layout-options\" id=\"ref-for-layout-definition-layout-options\">layout options</a> being <var>layoutOptions</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">Set</a> <var>layoutDefinitionMap</var>[<var>name</var>] to <var>definition</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">Queue a task</a> to run the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>documentLayoutDefinitionMap</var> be the associated <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document②\">document’s</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definitions\" id=\"ref-for-document-layout-definitions\">document layout\ndefinitions</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">map</a>.</p>"
            },
            {
              "html": "<p>Let <var>documentDefinition</var> be a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition\" id=\"ref-for-document-layout-definition\">document layout definition</a> with:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-input-properties\" id=\"ref-for-document-layout-definition-input-properties①\">input properties</a> being <var>inputProperties</var>.</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-child-input-properties\" id=\"ref-for-document-layout-definition-child-input-properties①\">child input properties</a> being <var>childInputProperties</var>.</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-layout-options\" id=\"ref-for-document-layout-definition-layout-options⑦\">layout options</a> being <var>layoutOptions</var>.</p>\n        </li></ul>"
            },
            {
              "html": "If <var>documentLayoutDefinitionMap</var>[<var>name</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>, run the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>existingDocumentDefinition</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-get\" id=\"ref-for-map-get①\">get</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>].</p>"
                },
                {
                  "html": "<p>If <var>existingDocumentDefinition</var> is <code>\"invalid\"</code>, abort all these steps.</p>"
                },
                {
                  "html": "<p>If <var>existingDocumentDefinition</var> and <var>documentDefinition</var> are not equivalent, (that is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-input-properties\" id=\"ref-for-document-layout-definition-input-properties②\">input properties</a>, <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-child-input-properties\" id=\"ref-for-document-layout-definition-child-input-properties②\">child input properties</a>, and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition-layout-options\" id=\"ref-for-document-layout-definition-layout-options⑧\">layout options</a> are different), then:</p>\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">Set</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>] to <code>\"invalid\"</code>.</p>\n          <p>Log an error to the debugging console stating that the same class was registered\nwith different <code>inputProperties</code>, <code>childInputProperties</code>, or <code>layoutOptions</code>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③\">set</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>] to <var>documentDefinition</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "determine the intrinsic sizes",
      "href": "https://www.w3.org/TR/css-layout-api-1/#determine-the-intrinsic-sizes",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-the-intrinsic-sizes\">determine the intrinsic sizes</dfn> of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-api-formatting-context\" id=\"ref-for-layout-api-formatting-context\">layout API formatting\ncontext</a> for a given <var>box</var>, <var>childBoxes</var> it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layoutFunction</var> be the <a class=\"css\" data-link-type=\"maybe\" href=\"https://www.w3.org/TR/css-layout-api-1/#valdef-display-layout\" id=\"ref-for-valdef-display-layout⑤\">layout()</a> for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value⑤\">computed value</a> of <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-display-3/#typedef-display-inside\" id=\"ref-for-typedef-display-inside②\" title=\"Expands to: flex | flow | grid | flow-root | table | ruby\">&lt;display-inside&gt;</a> for <var>box</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-valid-flag\" id=\"ref-for-intrinsic-sizes-valid-flag⑤\">intrinsic sizes valid flag</a> for the <var>layoutFunction</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-valid\" id=\"ref-for-intrinsic-sizes-valid\">intrinsic-sizes-valid</a> the user agent <em>may</em> use the intrinsic sizes from the\nprevious invocation. If so it <em>may</em> abort all these steps and use the previous value\nfor the intrinsic sizes.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-valid-flag\" id=\"ref-for-intrinsic-sizes-valid-flag⑥\">intrinsic sizes valid flag</a> for the <var>layoutFunction</var> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsic-sizes-valid\" id=\"ref-for-intrinsic-sizes-valid①\">intrinsic-sizes-valid</a>.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be the first argument of the <var>layoutFunction</var>.</p>"
        },
        {
          "html": "<p>Let <var>documentDefinition</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition\" id=\"ref-for-get-a-document-layout-definition②\">get a document layout definition</a> given <var>name</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition\" id=\"ref-for-get-a-document-layout-definition③\">get a document layout definition</a> returned failure, or if <var>documentDefinition</var> is <code>\"invalid\"</code>, then let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout\">flow layout</a> and abort all\nthese steps.</p>"
        },
        {
          "html": "<p>Let <var>workletGlobalScope</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutworkletglobalscope\" id=\"ref-for-layoutworkletglobalscope⑦\">LayoutWorkletGlobalScope</a></code> from the list of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/worklets-1/#worklets-workletglobalscopes\" id=\"ref-for-worklets-workletglobalscopes\">worklet’s\nWorkletGlobalScopes</a> from the layout <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/worklets-1/#worklet\" id=\"ref-for-worklet③\">Worklet</a></code>.</p>\n      <p>The user agent <em>must</em> have, and select from at least two <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutworkletglobalscope\" id=\"ref-for-layoutworkletglobalscope⑧\">LayoutWorkletGlobalScope</a></code>s in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/worklets-1/#worklets-workletglobalscopes\" id=\"ref-for-worklets-workletglobalscopes①\">worklet’s WorkletGlobalScopes</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a>,\nunless the user agent is under memory constraints.</p>\n      \n      <p>The user agent <em>may</em> also <a data-link-type=\"dfn\">create a WorkletGlobalScope</a> at this time, given the\nlayout <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/worklets-1/#worklet\" id=\"ref-for-worklet④\">Worklet</a></code>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#invoke-a-intrinsic-sizes-callback\" id=\"ref-for-invoke-a-intrinsic-sizes-callback\">invoke a intrinsic sizes callback</a> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, and <var>workletGlobalScope</var> optionally <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>.</p>"
        }
      ]
    },
    {
      "name": "invoke a intrinsic sizes callback",
      "href": "https://www.w3.org/TR/css-layout-api-1/#invoke-a-intrinsic-sizes-callback",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"invoke-a-intrinsic-sizes-callback\">invoke a intrinsic sizes callback</dfn> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>definition</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition\" id=\"ref-for-get-a-layout-definition②\">get a layout definition</a> given <var>name</var>, and <var>workletGlobalScope</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition\" id=\"ref-for-get-a-layout-definition③\">get a layout definition</a> returned failure, let the <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout①\">flow\nlayout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>layoutInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-class-instance\" id=\"ref-for-get-a-layout-class-instance\">get a layout class instance</a> given <var>box</var>, <var>definition</var>, <var>workletGlobalScope</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-class-instance\" id=\"ref-for-get-a-layout-class-instance①\">get a layout class instance</a> returned failure, let the <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout②\">flow layout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>inputProperties</var> be <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-input-properties\" id=\"ref-for-layout-definition-input-properties①\">input properties</a>.</p>"
        },
        {
          "html": "<p>Let <var>children</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>childBox</var> in <var>childBoxes</var> perform the following substeps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>layoutChild</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-child\" id=\"ref-for-get-a-layout-child\">get a layout child</a> given <var>workletGlobalScope</var>, <var>name</var>, and <var>childBox</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>layoutChild</var> to <var>children</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>edges</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutedgesizes\" id=\"ref-for-layoutedgesizes⑥\">LayoutEdgeSizes</a></code> populated with the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value⑥\">computed value</a> for all the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSS21/box.html#box-dimensions\" id=\"ref-for-box-dimensions①\">box model edges</a> for <var>box</var>.</p>"
        },
        {
          "html": "<p>Let <var>styleMap</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-typed-om-1/#stylepropertymapreadonly\" id=\"ref-for-stylepropertymapreadonly④\">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value⑦\">computed values</a> for properties listed in <var>inputProperties</var> for <var>box</var>.</p>"
        },
        {
          "html": "<p>At this stage the user agent may re-use the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-sizing/#intrinsic-sizes\" id=\"ref-for-intrinsic-sizes①\">intrinsic sizes</a> from a previous invocation\nif <var>children</var>, <var>styleMap</var> are equivalent to that previous invocation. If so let the\nintrinsic sizes the cached intrinsic sizes and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>intrinsicSizesGeneratorFunction</var> be <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-intrinsic-sizes-generator-function\" id=\"ref-for-layout-definition-intrinsic-sizes-generator-function①\">intrinsic sizes generator\nfunction</a>.</p>"
        },
        {
          "html": "<p>Let <var>intrinsicSizesGenerator</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-invoking-callback-functions\" id=\"ref-for-es-invoking-callback-functions\">Invoke</a>(<var>intrinsicSizesGeneratorFunction</var>, <var>layoutInstance</var>, «<var>children</var>, <var>edges</var>, <var>styleMap</var>»).</p>\n      <p>If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①①\">thrown</a> the let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout③\">flow layout</a> and abort\nall these steps.</p>"
        },
        {
          "html": "<p>Let <var>intrinsicSizesValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#run-a-generator\" id=\"ref-for-run-a-generator\">run a generator</a> given <var>intrinsicSizesGenerator</var>, and <code>\"intrinsic-sizes\"</code>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#run-a-generator\" id=\"ref-for-run-a-generator①\">run a generator</a> returned failure, then let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout④\">flow\nlayout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>intrinsicSizes</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping③\">converting</a> <var>intrinsicSizesValue</var> to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dictdef-intrinsicsizesresultoptions\" id=\"ref-for-dictdef-intrinsicsizesresultoptions\">IntrinsicSizesResultOptions</a></code>. If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①②\">thrown</a>, let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout⑤\">flow layout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-sizing/#intrinsic-sizes\" id=\"ref-for-intrinsic-sizes②\">intrinsic sizes</a> of <var>box</var>:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>Let <var>intrinsicSizes</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizesresultoptions-mincontentsize\" id=\"ref-for-dom-intrinsicsizesresultoptions-mincontentsize\">minContentSize</a></code> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-sizing-3/#min-content\" id=\"ref-for-min-content①\">min-content size</a> of <var>box</var>.</p>\n       </li><li data-md=\"\">\n        <p>Let <var>intrinsicSizes</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizesresultoptions-maxcontentsize\" id=\"ref-for-dom-intrinsicsizesresultoptions-maxcontentsize\">maxContentSize</a></code> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-sizing-3/#max-content\" id=\"ref-for-max-content①\">max-content size</a> of <var>box</var>.</p>\n      </li></ul>"
        }
      ]
    },
    {
      "name": "generate a fragment",
      "href": "https://www.w3.org/TR/css-layout-api-1/#generate-a-fragment",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-a-fragment\">generate a fragment</dfn> of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-api-formatting-context\" id=\"ref-for-layout-api-formatting-context①\">layout API formatting\ncontext</a> for a given <var>box</var>, <var>childBoxes</var>, <var>internalLayoutConstraints</var>, and an optional <var>internalBreakToken</var> it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layoutFunction</var> be the <a class=\"css\" data-link-type=\"maybe\" href=\"https://www.w3.org/TR/css-layout-api-1/#valdef-display-layout\" id=\"ref-for-valdef-display-layout⑥\">layout()</a> for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value⑧\">computed value</a> of <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-display-3/#typedef-display-inside\" id=\"ref-for-typedef-display-inside③\" title=\"Expands to: flex | flow | grid | flow-root | table | ruby\">&lt;display-inside&gt;</a> for <var>box</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-valid-flag\" id=\"ref-for-layout-valid-flag⑤\">layout valid flag</a> for the <var>layoutFunction</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-valid\" id=\"ref-for-layout-valid\">layout-valid</a> the user\nagent <em>may</em> use the intrinsic sizes from the previous invocation. If so it <em>may</em> abort all these steps and use the previous value for the intrinsic sizes.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-valid-flag\" id=\"ref-for-layout-valid-flag⑥\">layout valid flag</a> for the <var>layoutFunction</var> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-valid\" id=\"ref-for-layout-valid①\">layout-valid</a>.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be the first argument of the <var>layoutFunction</var>.</p>"
        },
        {
          "html": "<p>Let <var>documentDefinition</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition\" id=\"ref-for-get-a-document-layout-definition④\">get a document layout definition</a> given <var>name</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition\" id=\"ref-for-get-a-document-layout-definition⑤\">get a document layout definition</a> returned failure, or if <var>documentDefinition</var> is <code>\"invalid\"</code>, then let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout⑥\">flow layout</a> and abort all\nthese steps.</p>"
        },
        {
          "html": "<p>Let <var>workletGlobalScope</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutworkletglobalscope\" id=\"ref-for-layoutworkletglobalscope⑨\">LayoutWorkletGlobalScope</a></code> from the list of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/worklets-1/#worklets-workletglobalscopes\" id=\"ref-for-worklets-workletglobalscopes②\">worklet’s\nWorkletGlobalScopes</a> from the layout <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/worklets-1/#worklet\" id=\"ref-for-worklet⑤\">Worklet</a></code>.</p>\n      <p>The user agent <em>must</em> have, and select from at least two <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutworkletglobalscope\" id=\"ref-for-layoutworkletglobalscope①⓪\">LayoutWorkletGlobalScope</a></code>s in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/worklets-1/#worklets-workletglobalscopes\" id=\"ref-for-worklets-workletglobalscopes③\">worklet’s WorkletGlobalScopes</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a>,\nunless the user agent is under memory constraints.</p>\n      \n      <p>The user agent <em>may</em> also <a data-link-type=\"dfn\">create a WorkletGlobalScope</a> at this time, given the\nlayout <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/worklets-1/#worklet\" id=\"ref-for-worklet⑥\">Worklet</a></code>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#invoke-a-layout-callback\" id=\"ref-for-invoke-a-layout-callback\">invoke a layout callback</a> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, <var>internalLayoutConstraints</var>, <var>internalBreakToken</var>, and <var>workletGlobalScope</var> optionally <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in\nparallel</a>.</p>"
        }
      ]
    },
    {
      "name": "invoke a layout callback",
      "href": "https://www.w3.org/TR/css-layout-api-1/#invoke-a-layout-callback",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"invoke-a-layout-callback\">invoke a layout callback</dfn> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, <var>internalLayoutConstraints</var>, <var>internalBreakToken</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>definition</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition\" id=\"ref-for-get-a-layout-definition④\">get a layout definition</a> given <var>name</var>, and <var>workletGlobalScope</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition\" id=\"ref-for-get-a-layout-definition⑤\">get a layout definition</a> returned failure, let the <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout⑦\">flow\nlayout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>layoutInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-class-instance\" id=\"ref-for-get-a-layout-class-instance②\">get a layout class instance</a> given <var>box</var>, <var>definition</var>, <var>workletGlobalScope</var>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-class-instance\" id=\"ref-for-get-a-layout-class-instance③\">get a layout class instance</a> returned failure, let the <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout⑧\">flow layout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>sizingMode</var> be <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-layout-options\" id=\"ref-for-layout-definition-layout-options①\">layout options</a>' <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutoptions-sizing\" id=\"ref-for-dom-layoutoptions-sizing③\">sizing</a></code> property.</p>"
        },
        {
          "html": "<p>Let <var>inputProperties</var> be <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-input-properties\" id=\"ref-for-layout-definition-input-properties②\">input properties</a>.</p>"
        },
        {
          "html": "<p>Let <var>children</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>childBox</var> in <var>childBoxes</var> perform the following substeps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>layoutChild</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#get-a-layout-child\" id=\"ref-for-get-a-layout-child①\">get a layout child</a> given <var>workletGlobalScope</var>, <var>name</var>, and <var>childBox</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> <var>layoutChild</var> to <var>children</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>edges</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutedgesizes\" id=\"ref-for-layoutedgesizes⑦\">LayoutEdgeSizes</a></code> populated with the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value⑨\">computed value</a> for all the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSS21/box.html#box-dimensions\" id=\"ref-for-box-dimensions②\">box model edges</a> for <var>box</var>.</p>"
        },
        {
          "html": "<p>Let <var>layoutConstraints</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#create-a-layout-constraints-object\" id=\"ref-for-create-a-layout-constraints-object\">create a layout constraints object</a> given <var>internalLayoutConstraints</var>, <var>box</var>, and <var>sizingMode</var>.</p>"
        },
        {
          "html": "<p>Let <var>styleMap</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-typed-om-1/#stylepropertymapreadonly\" id=\"ref-for-stylepropertymapreadonly⑤\">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-4/#computed-value\" id=\"ref-for-computed-value①⓪\">computed values</a> for properties listed in <var>inputProperties</var> for <var>box</var>.</p>"
        },
        {
          "html": "<p>Let <var>breakToken</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#breaktoken\" id=\"ref-for-breaktoken②\">BreakToken</a></code> populated with the appropriate information from <var>internalBreakToken</var>.</p>\n      <p>If <var>internalBreakToken</var> is null, let <var>breakToken</var> be null.</p>"
        },
        {
          "html": "<p>At this stage the user agent may re-use a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css3-break/#fragment\" id=\"ref-for-fragment⑤\">fragment</a> from a previous invocation if <var>children</var>, <var>styleMap</var>, <var>layoutConstraints</var>, <var>breakToken</var> are equivalent to that previous\ninvocation. If so let the fragment output be that cached fragment and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>layoutGeneratorFunction</var> be <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-layout-generator-function\" id=\"ref-for-layout-definition-layout-generator-function①\">layout generator function</a>.</p>"
        },
        {
          "html": "<p>Let <var>layoutGenerator</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-invoking-callback-functions\" id=\"ref-for-es-invoking-callback-functions①\">Invoke</a>(<var>layoutGeneratorFunction</var>, <var>layoutInstance</var>, «<var>children</var>, <var>edges</var>, <var>layoutConstraints</var>, <var>styleMap</var>, <var>breakToken</var>»).</p>\n      <p>If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①③\">thrown</a> the let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout⑨\">flow layout</a> and abort\nall these steps.</p>"
        },
        {
          "html": "<p>Let <var>fragmentValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#run-a-generator\" id=\"ref-for-run-a-generator②\">run a generator</a> given <var>layoutGenerator</var>, and <code>\"layout\"</code>.</p>\n      <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#run-a-generator\" id=\"ref-for-run-a-generator③\">run a generator</a> returned failure, then let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout①⓪\">flow\nlayout</a> and abort all these steps.</p>"
        },
        {
          "html": "<p>Let <var>fragment</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping④\">converting</a> <var>fragmentValue</var> to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dictdef-fragmentresultoptions\" id=\"ref-for-dictdef-fragmentresultoptions②\">FragmentResultOptions</a></code>. If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①④\">thrown</a>, let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout①①\">flow layout</a> and abort all these steps.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>childFragment</var> in <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-childfragments\" id=\"ref-for-dom-fragmentresultoptions-childfragments②\">childFragments</a></code>, perform the following stubsteps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>childFragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-generator-slot\" id=\"ref-for-dom-layoutfragment-generator-slot①\">[[generator]]</a></code> internal slot is not equal to <var>layoutGenerator</var>,\nthen let <var>box</var> fallback to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#flow-layout\" id=\"ref-for-flow-layout①②\">flow layout</a> and abort all these steps.</p>"
            }
          ]
        },
        {
          "html": "Then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>inlineSize</var> be <var>layoutConstraints</var>’ <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutconstraints-fixedinlinesize\" id=\"ref-for-dom-layoutconstraints-fixedinlinesize⑧\">fixedInlineSize</a></code>. (This\nvalue must be set if we are using <code>\"block-like\"</code> sizing).</p>"
            },
            {
              "html": "<p>Let <var>blockSize</var> be the result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#block-size\" id=\"ref-for-block-size④\">block size</a> (relative to <var>box</var>’s writing mode) exactly like block containers\ndo, given <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-autoblocksize\" id=\"ref-for-dom-fragmentresultoptions-autoblocksize\">autoBlockSize</a></code> as the \"intrinsic\nheight\".</p>"
            }
          ],
          "additional": [
            {
              "html": "Otherwise (<var>sizingMode</var> is <code>\"manual\"</code>):",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>inlineSize</var> be <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-inlinesize\" id=\"ref-for-dom-fragmentresultoptions-inlinesize\">inlineSize</a></code>.</p>"
                },
                {
                  "html": "<p>Let <var>blockSize</var> be <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-blocksize\" id=\"ref-for-dom-fragmentresultoptions-blocksize\">blockSize</a></code>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css3-break/#fragment\" id=\"ref-for-fragment⑥\">fragment</a> for <var>box</var> with:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#inline-size\" id=\"ref-for-inline-size③\">inline size</a> set to <var>inlineSize</var>.</p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-writing-modes-3/#block-size\" id=\"ref-for-block-size⑤\">block size</a> set to <var>blockSize</var>.</p>\n       </li><li data-md=\"\">\n        <p>The child fragments set to <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-childfragments\" id=\"ref-for-dom-fragmentresultoptions-childfragments③\">childFragments</a></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a>. The ordering <em>is</em> important as this dictates their paint order\n(described in <a href=\"https://www.w3.org/TR/css-layout-api-1/#layout-api-containers\">§2 Layout API Containers</a>). Their position relative to the <b>border\nbox</b> of the <var>fragment</var> should be based off the author specified <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-inlineoffset\" id=\"ref-for-dom-layoutfragment-inlineoffset⑤\">inlineOffset</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragment-blockoffset\" id=\"ref-for-dom-layoutfragment-blockoffset⑤\">blockOffset</a></code>.</p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-break/#fragmentation-break\" id=\"ref-for-fragmentation-break\">fragmentation break</a> information set to <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-breaktoken\" id=\"ref-for-dom-fragmentresultoptions-breaktoken①\">breakToken</a></code>.</p>\n       </li><li data-md=\"\">\n        <p>Let <var>clonedData</var> be the result of invoking <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#structuredserializeforstorage\" id=\"ref-for-structuredserializeforstorage\">StructuredSerializeForStorage</a> on <var>fragment</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-fragmentresultoptions-data\" id=\"ref-for-dom-fragmentresultoptions-data①\">data</a></code>.</p>\n        <p>The user agent must store <var>clonedData</var> with the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css3-break/#fragment\" id=\"ref-for-fragment⑦\">fragment</a>.</p>\n      </li></ul>"
        }
      ]
    },
    {
      "name": "get a document layout definition",
      "href": "https://www.w3.org/TR/css-layout-api-1/#get-a-document-layout-definition",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-document-layout-definition\">get a document layout definition</dfn> given <var>name</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>documentLayoutDefinitionMap</var> be the associated <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document③\">document’s</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definitions\" id=\"ref-for-document-layout-definitions①\">document layout\ndefinitions</a> map.</p>"
        },
        {
          "html": "<p>If <var>documentLayoutDefinitionMap</var>[<var>name</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exist</a>, return failure and\nabort all these steps.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-get\" id=\"ref-for-map-get②\">get</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>].</p>"
        }
      ]
    },
    {
      "name": "get a layout definition",
      "href": "https://www.w3.org/TR/css-layout-api-1/#get-a-layout-definition",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-layout-definition\">get a layout definition</dfn> given <var>name</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layoutDefinitionMap</var> be <var>workletGlobalScope</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definitions\" id=\"ref-for-layout-definitions①\">layout definitions</a> map.</p>"
        },
        {
          "html": "If <var>layoutDefinitionMap</var>[<var>name</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exist</a>, run the following steps:",
          "rationale": "queue",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①\">Queue a task</a> to run the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>documentLayoutDefinitionMap</var> be the associated <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document④\">document’s</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#document-layout-definition\" id=\"ref-for-document-layout-definition①\">document\nlayout definition</a> map.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④\">Set</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>] to <code>\"invalid\"</code>.</p>"
                },
                {
                  "html": "<p>The user agent <em>should</em> log an error to the debugging console stating that a\nclass wasn’t registered in all <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutworkletglobalscope\" id=\"ref-for-layoutworkletglobalscope①①\">LayoutWorkletGlobalScope</a></code>s.</p>"
                }
              ]
            },
            {
              "html": "<p>Return failure, and abort all these steps.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p⑥\">get</a> <var>layoutDefinitionMap</var>[<var>name</var>].</p>"
        }
      ]
    },
    {
      "name": "get a layout class instance",
      "href": "https://www.w3.org/TR/css-layout-api-1/#get-a-layout-class-instance",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-layout-class-instance\">get a layout class instance</dfn> given <var>box</var>, <var>definition</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layoutClassInstanceMap</var> be <var>box</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-class-instances\" id=\"ref-for-layout-class-instances\">layout class instances</a> map.</p>"
        },
        {
          "html": "Let <var>layoutInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p⑦\">get</a> <var>layoutClassInstanceMap</var>[<var>workletGlobalScope</var>]. If <var>layoutInstance</var> is null, run the\nfollowing steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-constructor-valid-flag\" id=\"ref-for-layout-definition-constructor-valid-flag①\">constructor valid flag</a> on <var>definition</var> is false, then return failure and\nabort all these steps.</p>"
            },
            {
              "html": "<p>Let <var>layoutCtor</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-class-constructor\" id=\"ref-for-layout-definition-class-constructor①\">class constructor</a> on <var>definition</var>.</p>"
            },
            {
              "html": "<p>Let <var>layoutInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-construct\" id=\"ref-for-sec-construct\">Construct</a>(<var>layoutCtor</var>).</p>\n        <p>If <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-construct\" id=\"ref-for-sec-construct①\">construct</a> throws an exception, set the <var>definition</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#layout-definition-constructor-valid-flag\" id=\"ref-for-layout-definition-constructor-valid-flag②\">constructor valid\nflag</a> to false, then return failure and abort all these steps.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤\">Set</a> <var>layoutClassInstanceMap</var>[<var>workletGlobalScope</var>] to <var>layoutInstance</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>layoutInstance</var>.</p>"
        }
      ]
    },
    {
      "name": "run a generator",
      "href": "https://www.w3.org/TR/css-layout-api-1/#run-a-generator",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"run-a-generator\">run a generator</dfn> given <var>generator</var>, and <var>generatorType</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>done</var> be a <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#idl-boolean\" id=\"ref-for-idl-boolean\">boolean</a> initialized to <code>false</code>.</p>"
        },
        {
          "html": "<p>Let <var>nextValue</var> be undefined.</p>"
        },
        {
          "html": "Perform the following substeps until <var>done</var> is <code>true</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>nextFunction</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p⑧\">Get</a>(<var>generator</var>, <code>\"next\"</code>).</p>"
            },
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-iscallable\" id=\"ref-for-sec-iscallable②\">IsCallable</a>(<var>nextFunction</var>) is false, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①⑤\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑦\">TypeError</a> and abort all these steps.</p>"
            },
            {
              "html": "<p>Let <var>nextResult</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-invoking-callback-functions\" id=\"ref-for-es-invoking-callback-functions②\">Invoke</a>(<var>nextFunction</var>, <var>generator</var>,\n«<var>nextValue</var>»).</p>\n        <p>If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①⑥\">thrown</a> return failure, and abort all these steps.</p>"
            },
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values①\">Type</a>(<var>nextResult</var>) is not Object, <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①⑦\">throw</a> a <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑧\">TypeError</a> and abort all these steps.</p>"
            },
            {
              "html": "<p>Let <var>requestOrRequests</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p⑨\">Get</a>(nextResult|, <code>\"value\"</code>).</p>"
            },
            {
              "html": "<p>Let <var>done</var> be the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p①⓪\">Get</a>(<var>nextResult</var>, <code>\"done\"</code>).</p>"
            },
            {
              "html": "If the result of <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-getmethod\" id=\"ref-for-sec-getmethod\">GetMethod</a>(<var>requestOrRequests</var>, <code>@@iterable</code>) exists\nthen:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>results</var> to be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">empty</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a>.</p>"
                },
                {
                  "html": "<p>Let <var>requests</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping⑤\">converting</a> <var>requestOrRequests</var> to a <code>sequence&lt;LayoutFragmentRequestOrIntrinsicSizesRequest&gt;</code>.</p>\n          <p>If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①⑧\">thrown</a>, rethrow the exception and abort all these steps.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>request</var> in <var>requests</var> perform the following substeps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#produce-a-generator-result\" id=\"ref-for-produce-a-generator-result\">produce a generator result</a> given <var>request</var>, <var>generator</var>, <var>generatorType</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">Append</a> <var>result</var> to <var>results</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Set <var>nextValue</var> to be <var>results</var>.</p>"
                },
                {
                  "html": "<p>Continue.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>request</var> be the result of <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#es-type-mapping\" id=\"ref-for-es-type-mapping⑥\">converting</a> <var>requestOrRequests</var> to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#typedefdef-layoutfragmentrequestorintrinsicsizesrequest\" id=\"ref-for-typedefdef-layoutfragmentrequestorintrinsicsizesrequest\">LayoutFragmentRequestOrIntrinsicSizesRequest</a></code>.</p>\n        <p>If an exception is <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-throw\" id=\"ref-for-dfn-throw①⑨\">thrown</a>, rethrow the exception and abort all these steps.</p>"
            },
            {
              "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#produce-a-generator-result\" id=\"ref-for-produce-a-generator-result①\">produce a generator result</a> given <var>request</var>, <var>generator</var>, <var>generatorType</var>.</p>\n        <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#produce-a-generator-result\" id=\"ref-for-produce-a-generator-result②\">produce a generator result</a> returns failure, return failure, and abort all\nthese steps.</p>"
            },
            {
              "html": "<p>Set <var>nextValue</var> to be <var>result</var>.</p>"
            },
            {
              "html": "<p>Continue.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of calling <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p①①\">Get</a>(<var>nextResult</var>, <code>\"value\"</code>).</p>"
        }
      ]
    },
    {
      "name": "produce a generator result",
      "href": "https://www.w3.org/TR/css-layout-api-1/#produce-a-generator-result",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"produce-a-generator-result\">produce a generator result</dfn> given <var>request</var>, <var>generator</var>, and <var>generatorType</var>, it <em>must</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>request</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#intrinsicsizesrequest\" id=\"ref-for-intrinsicsizesrequest⑤\">IntrinsicSizesRequest</a></code> then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>layoutChild</var> be the result of looking up the internal slot <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-intrinsicsizesrequest-layoutchild-slot\" id=\"ref-for-dom-intrinsicsizesrequest-layoutchild-slot①\">[[layoutChild]]</a></code> on <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>box</var> be the result of looking up the internal slot <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-box-slot\" id=\"ref-for-dom-layoutchild-box-slot①\">[[box]]</a></code> on <var>layoutChild</var>.</p>"
            },
            {
              "html": "<p>If <var>box</var> is <em>not</em> attached to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#box-tree\" id=\"ref-for-box-tree⑧\">box tree</a>, return failure and abort all\nthese steps.</p>"
            },
            {
              "html": "<p>Let <var>internalIntrinsicSizes</var> be the result of the user agent calculating the <b>border\nbox</b> min/max content contribution of <var>box</var>.</p>"
            },
            {
              "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#create-an-intrinsic-sizes-object\" id=\"ref-for-create-an-intrinsic-sizes-object\">create an intrinsic sizes object</a> given <var>request</var>, and <var>internalIntrinsicSizes</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>request</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#layoutfragmentrequest\" id=\"ref-for-layoutfragmentrequest⑦\">LayoutFragmentRequest</a></code> and <var>generatorType</var> is <code>\"layout\"</code> then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>layoutChild</var> be result of looking up the internal slot <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragmentrequest-layoutchild-slot\" id=\"ref-for-dom-layoutfragmentrequest-layoutchild-slot①\">[[layoutChild]]</a></code> on <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>box</var> be the result of looking up the internal slot <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutchild-box-slot\" id=\"ref-for-dom-layoutchild-box-slot②\">[[box]]</a></code> on <var>layoutChild</var>.</p>"
            },
            {
              "html": "<p>If <var>box</var> is <em>not</em> attached to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-display-3/#box-tree\" id=\"ref-for-box-tree⑨\">box tree</a>, return failure and abort all\nthese steps.</p>"
            },
            {
              "html": "<p>Let <var>childLayoutConstraints</var> be the result of looking up the internal slot <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragmentrequest-layoutconstraints-slot\" id=\"ref-for-dom-layoutfragmentrequest-layoutconstraints-slot①\">[[layoutConstraints]]</a></code> on <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>childBreakToken</var> be the result of looking up the internal slot <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-layout-api-1/#dom-layoutfragmentrequest-breaktoken-slot\" id=\"ref-for-dom-layoutfragmentrequest-breaktoken-slot①\">[[breakToken]]</a></code> on <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>internalFragment</var> be the result of the user agent producing a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css3-break/#fragment\" id=\"ref-for-fragment⑧\">fragment</a> based\non <var>box</var>, <var>childLayoutConstraints</var>, and <var>childBreakToken</var>.</p>"
            },
            {
              "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-layout-api-1/#create-a-layout-fragment\" id=\"ref-for-create-a-layout-fragment\">create a layout fragment</a> given <var>generator</var>, <var>request</var>, and <var>internalFragment</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return failure (neither of the above branches was taken).</p>"
        }
      ]
    }
  ]
}