{
  "spec": {
    "title": "WebXR Device API",
    "url": "https://immersive-web.github.io/webxr/"
  },
  "algorithms": [
    {
      "name": "xr-device-selection",
      "href": "https://immersive-web.github.io/webxr/#select-an-immersive-xr-device",
      "html": "Each time the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-immersive-xr-devices\" id=\"ref-for-list-of-immersive-xr-devices⑤\">list of immersive XR devices</a> changes the user agent should <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"select-an-immersive-xr-device\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">select an immersive XR device</dfn> by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>oldDevice</var> be the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device②\">immersive XR device</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-immersive-xr-devices\" id=\"ref-for-list-of-immersive-xr-devices⑥\">list of immersive XR devices</a> is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a>, set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device③\">immersive XR device</a> to <code>null</code>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-immersive-xr-devices\" id=\"ref-for-list-of-immersive-xr-devices⑦\">list of immersive XR devices</a>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> is one, set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device④\">immersive XR device</a> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-immersive-xr-devices\" id=\"ref-for-list-of-immersive-xr-devices⑧\">list of immersive XR devices</a>[0].</p>"
        },
        {
          "html": "Set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device⑤\">immersive XR device</a> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If there are any active XRSessions and the list of immersive XR devices contains oldDevice:",
                  "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device⑥\">immersive XR device</a> to <var>oldDevice</var>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device⑦\">immersive XR device</a> to a device of the user agent’s choosing.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>The user agent MAY update the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#inline-xr-device\" id=\"ref-for-inline-xr-device⑤\">inline XR device</a> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device⑧\">immersive XR device</a> if appropriate, or the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#default-inline-xr-device\" id=\"ref-for-default-inline-xr-device⑥\">default inline XR device</a> otherwise.</p>"
        },
        {
          "html": "<p>If this is the first time devices have been enumerated or <var>oldDevice</var> equals the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device⑨\">immersive XR device</a>, abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#shut-down-the-session\" id=\"ref-for-shut-down-the-session①\">Shut down</a> any active <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑤\">XRSession</a></code>s.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">Queue a task</a> to set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible\">XR compatible</a> boolean of all <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContextBase\" id=\"ref-for-WebGLRenderingContextBase\">WebGLRenderingContextBase</a></code> instances to <code>false</code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">fire an event</a> named <a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsystem-devicechange\" id=\"ref-for-eventdef-xrsystem-devicechange\">devicechange</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant Global object</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#dom-navigator\" id=\"ref-for-dom-navigator\">navigator</a></code>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-navigator-xr\" id=\"ref-for-dom-navigator-xr①\">xr</a></code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②\">Queue a task</a> to fire appropriate <code>change</code> events on any <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpermissionstatus\" id=\"ref-for-xrpermissionstatus\">XRPermissionStatus</a></code> objects who are affected by the change in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device①⓪\">immersive XR device</a> or <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#inline-xr-device\" id=\"ref-for-inline-xr-device⑥\">inline XR device</a>.</p>"
        }
      ]
    },
    {
      "name": "ensure-device-selected",
      "href": "https://immersive-web.github.io/webxr/#ensure-an-immersive-xr-device-is-selected",
      "html": "The user agent can <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"ensure-an-immersive-xr-device-is-selected\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ensure an immersive XR device is selected</dfn> by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device①①\">immersive XR device</a> is not <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device①②\">immersive XR device</a> and abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#enumerate-immersive-xr-devices\" id=\"ref-for-enumerate-immersive-xr-devices\">Enumerate immersive XR devices</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#select-an-immersive-xr-device\" id=\"ref-for-select-an-immersive-xr-device①\">Select an immersive XR device</a>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device①③\">immersive XR device</a>.</p>"
        }
      ]
    },
    {
      "name": "session-supported",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsystem-issessionsupported",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSystem\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrsystem-issessionsupported\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>isSessionSupported(<var>mode</var>)</code></dfn> method queries if a given <var>mode</var> may be supported by the user agent and device capabilities. \n    <p>When this method is invoked, it MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new Promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsystem\" id=\"ref-for-xrsystem④\">XRSystem</a></code>.</p>"
        },
        {
          "html": "<p>If <var>mode</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessionmode-inline\" id=\"ref-for-dom-xrsessionmode-inline②\">\"inline\"</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">resolve</a> <var>promise</var> with <code>true</code> and return it.</p>"
        },
        {
          "html": "<p>If the requesting document’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin\">origin</a> is not allowed to use the \"xr-spatial-tracking\" <a href=\"https://immersive-web.github.io/webxr/#permissions-policy\">permissions policy</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code> and return it.</p>"
        },
        {
          "html": "Check whether the session <var>mode</var> is supported as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the user agent and system are known to never support mode sessions",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">Resolve</a> <var>promise</var> with <code>false</code>.</p>"
                },
                {
                  "case": "If the user agent and system are known to usually support mode sessions",
                  "html": "<p><var>promise</var> MAY be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">resolved</a> with <code>true</code> provided that all instances of this user agent <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#indistinguishable-by-user-agent-string\" id=\"ref-for-indistinguishable-by-user-agent-string\">indistinguishable by user agent string</a> produce the same result here.</p>"
                },
                {
                  "case": "Otherwise",
                  "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>device</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#ensure-an-immersive-xr-device-is-selected\" id=\"ref-for-ensure-an-immersive-xr-device-is-selected\">ensuring an immersive XR device is selected</a>.</p>"
                    },
                    {
                      "html": "<p>If <var>device</var> is null, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">resolve</a> <var>promise</var> with <code>false</code> and abort these steps.</p>"
                    },
                    {
                      "html": "<p>If <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-supported-modes\" id=\"ref-for-list-of-supported-modes③\">list of supported modes</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain④\">contain</a> <var>mode</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve④\">resolve</a> <var>promise</var> with <code>false</code> and abort these steps.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-request-permission-to-use\" id=\"ref-for-dfn-request-permission-to-use\">request permission to use</a> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-powerful-feature\" id=\"ref-for-dfn-powerful-feature\">powerful feature</a> <a class=\"idl-code\" data-link-type=\"permission\" href=\"https://immersive-web.github.io/webxr/#permissiondef-xr-session-supported\" id=\"ref-for-permissiondef-xr-session-supported\">\"xr-session-supported\"</a> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrsessionsupportedpermissiondescriptor\" id=\"ref-for-dictdef-xrsessionsupportedpermissiondescriptor\">XRSessionSupportedPermissionDescriptor</a></code> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessionsupportedpermissiondescriptor-mode\" id=\"ref-for-dom-xrsessionsupportedpermissiondescriptor-mode\">mode</a></code> equal to <var>mode</var>. If it returns <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied\">\"denied\"</a></code> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task④\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑤\">resolve</a> <var>promise</var> with <code>false</code> and abort these steps. </p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑤\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑥\">resolve</a> <var>promise</var> with <code>true</code>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "request-session",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsystem-requestsession",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSystem\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"requestSession(mode, options)|requestSession(mode)\" id=\"dom-xrsystem-requestsession\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>requestSession(<var>mode</var>, <var>options</var>)</code></dfn> method attempts to initialize an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑦\">XRSession</a></code> for the given <var>mode</var> if possible, entering immersive mode if necessary.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new Promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsystem\" id=\"ref-for-xrsystem⑥\">XRSystem</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>immersive</var> be <code>true</code> if <var>mode</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session\">immersive session</a> mode, and <code>false</code> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>global object</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant Global object</a> for the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsystem\" id=\"ref-for-xrsystem⑦\">XRSystem</a></code> on which this method was invoked.</p>"
        },
        {
          "html": "Check whether the session request is allowed as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If immersive is true:",
                  "html": "",
                  "rationale": "check",
                  "steps": [
                    {
                      "html": "<p>Check if an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session-request-is-allowed\" id=\"ref-for-immersive-session-request-is-allowed\">immersive session request is allowed</a> for the <var>global object</var>, and if not <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code> and return <var>promise</var>.</p>"
                    },
                    {
                      "html": "<p>If <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-immersive-session\" id=\"ref-for-pending-immersive-session\">pending immersive session</a> is <code>true</code> or <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-immersive-session\" id=\"ref-for-active-immersive-session\">active immersive session</a> is not <code>null</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code> and return <var>promise</var>.</p>"
                    },
                    {
                      "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-immersive-session\" id=\"ref-for-pending-immersive-session①\">pending immersive session</a> to <code>true</code>.</p>"
                    }
                  ]
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Check if an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#inline-session-request-is-allowed\" id=\"ref-for-inline-session-request-is-allowed\">inline session request is allowed</a> for the <var>global object</var>, and if not <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror②\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code> and return <var>promise</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>requiredFeatures</var> be <var>options</var>’ <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessioninit-requiredfeatures\" id=\"ref-for-dom-xrsessioninit-requiredfeatures\">requiredFeatures</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>optionalFeatures</var> be <var>options</var>’ <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessioninit-optionalfeatures\" id=\"ref-for-dom-xrsessioninit-optionalfeatures\">optionalFeatures</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>device</var> to the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#obtain-the-current-device\" id=\"ref-for-obtain-the-current-device\">obtaining the current device</a> for <var>mode</var>, <var>requiredFeatures</var>, and <var>optionalFeatures</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑥\">Queue a task</a> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>device</var> is <code>null</code> or <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-supported-modes\" id=\"ref-for-list-of-supported-modes④\">list of supported modes</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑤\">contain</a> <var>mode</var>, run the following steps:",
                  "rationale": "reject",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">Reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code>.</p>"
                    },
                    {
                      "html": "<p>If <var>immersive</var> is <code>true</code>, set <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-immersive-session\" id=\"ref-for-pending-immersive-session②\">pending immersive session</a> to <code>false</code>.</p>"
                    },
                    {
                      "html": "<p>Abort these steps.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>descriptor</var> be an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrpermissiondescriptor\" id=\"ref-for-dictdef-xrpermissiondescriptor\">XRPermissionDescriptor</a></code> initialized with <var>mode</var>, <var>requiredFeatures</var>, and <var>optionalFeatures</var></p>"
                },
                {
                  "html": "<p>Let <var>status</var> be an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpermissionstatus\" id=\"ref-for-xrpermissionstatus①\">XRPermissionStatus</a></code>, initially <code>null</code></p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#request-the-xr-permission\" id=\"ref-for-request-the-xr-permission\">Request the xr permission</a> with <var>descriptor</var> and <var>status</var>.</p>"
                },
                {
                  "html": "If <var>status</var>’ <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state\">state</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied①\">\"denied\"</a></code> run the following steps:",
                  "rationale": "reject",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">Reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
                    },
                    {
                      "html": "<p>If <var>immersive</var> is <code>true</code>, set <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-immersive-session\" id=\"ref-for-pending-immersive-session③\">pending immersive session</a> to <code>false</code>.</p>"
                    },
                    {
                      "html": "<p>Abort these steps.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>granted</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">set</a> obtained from <var>status</var>’ <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissionstatus-granted\" id=\"ref-for-dom-xrpermissionstatus-granted\">granted</a></code>.</p>"
                },
                {
                  "html": "<p>Let <var>session</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑧\">XRSession</a></code> object in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsystem\" id=\"ref-for-xrsystem⑧\">XRSystem</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#initialize-the-session\" id=\"ref-for-initialize-the-session\">Initialize the session</a> with <var>session</var>, <var>mode</var>, <var>granted</var>, and <var>device</var>.</p>"
                },
                {
                  "html": "Potentially set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-immersive-session\" id=\"ref-for-active-immersive-session①\">active immersive session</a> as follows:",
                  "rationale": ".switch",
                  "steps": [
                    {
                      "operation": "switch",
                      "steps": [
                        {
                          "case": "If immersive is true:",
                          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-immersive-session\" id=\"ref-for-active-immersive-session②\">active immersive session</a> to <var>session</var>, and set <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-immersive-session\" id=\"ref-for-pending-immersive-session④\">pending immersive session</a> to <code>false</code>.</p>"
                        },
                        {
                          "case": "Otherwise:",
                          "html": "<p>Append <var>session</var> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-inline-sessions\" id=\"ref-for-list-of-inline-sessions\">list of inline sessions</a>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑦\">Resolve</a> <var>promise</var> with <var>session</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑦\">Queue a task</a> to perform the following steps:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-promise-resolved\" id=\"ref-for-xrsession-promise-resolved\">promise resolved</a> flag to <code>true</code>.</p>"
                    },
                    {
                      "html": "<p>Let <var>sources</var> be any existing input sources attached to <var>session</var>.</p>"
                    },
                    {
                      "html": "If <var>sources</var> is non-empty, perform the following steps:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources\">list of active XR input sources</a> to <var>sources</var>.</p>"
                        },
                        {
                          "html": "<p>Fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-inputsourceschange\" id=\"ref-for-eventdef-xrsession-inputsourceschange①\">inputsourceschange</a></code> on <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-added\" id=\"ref-for-dom-xrinputsourceschangeevent-added\">added</a></code> set to <var>sources</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "device-for-mode",
      "href": "https://immersive-web.github.io/webxr/#obtain-the-current-device",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-the-current-device\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain the current device</dfn> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#enumdef-xrsessionmode\" id=\"ref-for-enumdef-xrsessionmode④\">XRSessionMode</a></code> <var>mode</var>, <var>requiredFeatures</var>, and <var>optionalFeatures</var> the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Choose <var>device</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If mode is an immersive session mode:",
                  "html": "<p>Set <var>device</var> to the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#ensure-an-immersive-xr-device-is-selected\" id=\"ref-for-ensure-an-immersive-xr-device-is-selected①\">ensuring an immersive XR device is selected</a>.</p>"
                },
                {
                  "case": "Else if requiredFeatures or optionalFeatures are not empty:",
                  "html": "<p>Set <var>device</var> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#inline-xr-device\" id=\"ref-for-inline-xr-device⑦\">inline XR device</a>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Set <var>device</var> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#default-inline-xr-device\" id=\"ref-for-default-inline-xr-device⑦\">default inline XR device</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>device</var>.</p>"
        }
      ]
    },
    {
      "name": "initialize-session",
      "href": "https://immersive-web.github.io/webxr/#initialize-the-session",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the session</dfn>, given <var>session</var>, <var>mode</var>, <var>granted</var>, and <var>device</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-mode\" id=\"ref-for-xrsession-mode\">mode</a> to <var>mode</var>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device⑥\">XR device</a> to <var>device</var>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-set-of-granted-features\" id=\"ref-for-xrsession-set-of-granted-features①\">set of granted features</a> to <var>granted</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#initialize-the-render-state\" id=\"ref-for-initialize-the-render-state\">Initialize the render state</a>.</p>"
        },
        {
          "html": "<p>If no other features of the user agent have done so already, perform the necessary platform-specific steps to initialize the device’s tracking and rendering capabilities, including showing any necessary instructions to the user.</p>"
        }
      ]
    },
    {
      "name": "shut-down-session",
      "html": "When an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession②⑨\">XRSession</a></code> <var>session</var> is shut down the following steps are run:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended\">ended</a> value to <code>true</code>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-immersive-session\" id=\"ref-for-active-immersive-session③\">active immersive session</a> is equal to <var>session</var>, set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-immersive-session\" id=\"ref-for-active-immersive-session④\">active immersive session</a> to <code>null</code>.</p>"
        },
        {
          "html": "<p>Remove <var>session</var> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-inline-sessions\" id=\"ref-for-list-of-inline-sessions①\">list of inline sessions</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">Reject</a> any outstanding promises returned by <var>session</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>, except for any promises returned by <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-end\" id=\"ref-for-dom-xrsession-end①\">end()</a></code>.</p>"
        },
        {
          "html": "<p>If no other features of the user agent are actively using them, perform the necessary platform-specific steps to shut down the device’s tracking and rendering capabilities. This MUST include:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>Releasing <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#exclusive-access\" id=\"ref-for-exclusive-access③\">exclusive access</a> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device⑧\">XR device</a> if <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session①③\">immersive session</a>.</p>\n       </li><li data-md=\"\">\n        <p>Deallocating any graphics resources acquired by <var>session</var> for presentation to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device⑨\">XR device</a>.</p>\n       </li><li data-md=\"\">\n        <p>Putting the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device①⓪\">XR device</a> in a state such that a different source may be able to initiate a session with the same device if <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session①④\">immersive session</a>.</p>\n      </li></ul>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑧\">Queue a task</a> that fires an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsessionevent\" id=\"ref-for-xrsessionevent\">XRSessionEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-end\" id=\"ref-for-eventdef-xrsession-end\">end</a></code> on <var>session</var>.</p>"
        }
      ]
    },
    {
      "name": "end-session",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsession-end",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrsession-end\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>end()</code></dfn> method provides a way to manually shut down a session. When invoked, it MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new Promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession③⓪\">XRSession</a></code>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended①\">ended</a> value of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a> is <code>true</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#shut-down-the-session\" id=\"ref-for-shut-down-the-session②\">Shut down</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑨\">Queue a task</a> to perform the following steps:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait until any platform-specific steps related to shutting down the session have completed.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑧\">Resolve</a> <var>promise</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "update-layers-state",
      "href": "https://immersive-web.github.io/webxr/#update-the-pending-layers-state",
      "html": "When the user agent will <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-the-pending-layers-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update the pending layers state</dfn> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession③⑤\">XRSession</a></code> <var>session</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrrenderstateinit\" id=\"ref-for-dictdef-xrrenderstateinit①\">XRRenderStateInit</a></code> <var>newState</var>, it must run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers\">layers</a></code>’s value is not <code>null</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror②\">NotSupportedError</a></code>.</p>"
        }
      ]
    },
    {
      "name": "apply-nominal-frame-rate",
      "href": "https://immersive-web.github.io/webxr/#apply-the-nominal-frame-rate",
      "html": "When the user agent wants to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-the-nominal-frame-rate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply the nominal frame rate</dfn> <var>rate</var> on an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession③⑥\">XRSession</a></code> <var>session</var>, it MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>rate</var> is the same as <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-internal-nominal-framerate\" id=\"ref-for-xrsession-internal-nominal-framerate\">internal nominal framerate</a>, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended②\">ended</a> value is <code>true</code>, abort these steps.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-internal-nominal-framerate\" id=\"ref-for-xrsession-internal-nominal-framerate①\">internal nominal framerate</a> to <var>rate</var>.</p>"
        },
        {
          "html": "<p>Fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsessionevent\" id=\"ref-for-xrsessionevent①\">XRSessionEvent</a></code> event named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-frameratechange\" id=\"ref-for-eventdef-xrsession-frameratechange\">frameratechange</a></code> on <var>session</var>.</p>"
        }
      ]
    },
    {
      "name": "update-frame-rate",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsession-updatetargetframerate",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrsession-updatetargetframerate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>updateTargetFrameRate(<var>rate</var>)</code></dfn> method passes the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#target-frame-rate\" id=\"ref-for-target-frame-rate\">target frame rate</a> <var>rate</var> to the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession③⑦\">XRSession</a></code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new Promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p>If the <var>session</var> has no <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-internal-nominal-framerate\" id=\"ref-for-xrsession-internal-nominal-framerate②\">internal nominal framerate</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended③\">ended</a> value is <code>true</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>If <var>rate</var> is not in <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-supportedframerates\" id=\"ref-for-dom-xrsession-supportedframerates①\">supportedFrameRates</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⓪\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-internal-target-framerate\" id=\"ref-for-xrsession-internal-target-framerate\">internal target framerate</a> to <var>rate</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①⓪\">Queue a task</a> to perform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compositor\" id=\"ref-for-xr-compositor\">XR Compositor</a> MAY use <var>rate</var> to calculate a new <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#display-frame-rate\" id=\"ref-for-display-frame-rate\">display frame rate</a> and/or <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#nominal-frame-rate\" id=\"ref-for-nominal-frame-rate\">nominal frame rate</a>.</p>"
            },
            {
              "html": "<p>Let <var>newrate</var> be the new <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#nominal-frame-rate\" id=\"ref-for-nominal-frame-rate①\">nominal frame rate</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①①\">Queue a task</a> to perform the following steps:",
              "rationale": "apply",
              "steps": [
                {
                  "html": "<p>Await until the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsystem\" id=\"ref-for-xrsystem①①\">XRSystem</a></code>’s actions to update the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#nominal-frame-rate\" id=\"ref-for-nominal-frame-rate②\">nominal frame rate</a> to <var>newrate</var> have taken effect.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#apply-the-nominal-frame-rate\" id=\"ref-for-apply-the-nominal-frame-rate\">Apply the nominal frame rate</a> with <var>newrate</var> and <var>session</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑨\">Resolve</a> <var>promise</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "update-render-state",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsession-updaterenderstate",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"updateRenderState(state)|updateRenderState()|updateRenderState(newState)\" id=\"dom-xrsession-updaterenderstate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>updateRenderState(<var>newState</var>)</code></dfn> method queues an update to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-render-state\" id=\"ref-for-active-render-state①\">active render state</a> to be applied on the next frame. Unset fields of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrrenderstateinit\" id=\"ref-for-dictdef-xrrenderstateinit②\">XRRenderStateInit</a></code> <var>newState</var> passed to this method will not be changed.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended④\">ended</a> value is <code>true</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-baselayer\" id=\"ref-for-dom-xrrenderstateinit-baselayer\">baseLayer</a></code> was created with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession③⑧\">XRSession</a></code> other than <var>session</var>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑥\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstateinit-inlineverticalfieldofview\">inlineVerticalFieldOfView</a></code> is set and <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session①⑤\">immersive session</a>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑦\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If none of <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-depthnear\" id=\"ref-for-dom-xrrenderstateinit-depthnear\">depthNear</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-depthfar\" id=\"ref-for-dom-xrrenderstateinit-depthfar\">depthFar</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstateinit-inlineverticalfieldofview①\">inlineVerticalFieldOfView</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-baselayer\" id=\"ref-for-dom-xrrenderstateinit-baselayer①\">baseLayer</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers①\">layers</a></code> are set, abort these steps.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#update-the-pending-layers-state\" id=\"ref-for-update-the-pending-layers-state\">update the pending layers state</a> with <var>session</var> and <var>newState</var>.</p>"
        },
        {
          "html": "<p>Let <var>activeState</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-render-state\" id=\"ref-for-active-render-state②\">active render state</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state\">pending render state</a> is <code>null</code>, set it to a copy of <var>activeState</var>.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-passthroughfullyobscured\" id=\"ref-for-dom-xrrenderstateinit-passthroughfullyobscured\">passthroughFullyObscured</a></code> value is set, set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state①\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-passthroughfullyobscured\" id=\"ref-for-dom-xrrenderstate-passthroughfullyobscured\">passthroughFullyObscured</a></code> to <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-passthroughfullyobscured\" id=\"ref-for-dom-xrrenderstateinit-passthroughfullyobscured①\">passthroughFullyObscured</a></code>.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-depthnear\" id=\"ref-for-dom-xrrenderstateinit-depthnear①\">depthNear</a></code> value is set, set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state②\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthnear\" id=\"ref-for-dom-xrrenderstate-depthnear\">depthNear</a></code> to <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-depthnear\" id=\"ref-for-dom-xrrenderstateinit-depthnear②\">depthNear</a></code>.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-depthfar\" id=\"ref-for-dom-xrrenderstateinit-depthfar①\">depthFar</a></code> value is set, set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state③\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthfar\" id=\"ref-for-dom-xrrenderstate-depthfar\">depthFar</a></code> to <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-depthfar\" id=\"ref-for-dom-xrrenderstateinit-depthfar②\">depthFar</a></code>.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstateinit-inlineverticalfieldofview②\">inlineVerticalFieldOfView</a></code> is set, set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state④\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview\">inlineVerticalFieldOfView</a></code> to <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstateinit-inlineverticalfieldofview③\">inlineVerticalFieldOfView</a></code>.</p>"
        },
        {
          "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-baselayer\" id=\"ref-for-dom-xrrenderstateinit-baselayer②\">baseLayer</a></code> is set, set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state⑤\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer\">baseLayer</a></code> to <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-baselayer\" id=\"ref-for-dom-xrrenderstateinit-baselayer③\">baseLayer</a></code>.</p>"
        }
      ]
    },
    {
      "name": "apply-pending-render-state",
      "href": "https://immersive-web.github.io/webxr/#apply-the-pending-render-state",
      "html": "When requested, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession③⑨\">XRSession</a></code> <var>session</var> MUST <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-the-pending-render-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply the pending render state</dfn> by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>activeState</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-render-state\" id=\"ref-for-active-render-state③\">active render state</a>.</p>"
        },
        {
          "html": "<p>Let <var>newState</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state⑥\">pending render state</a>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state⑦\">pending render state</a> to <code>null</code>.</p>"
        },
        {
          "html": "<p>Let <var>oldBaseLayer</var> be <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer①\">baseLayer</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>oldLayers</var> be <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/webxrlayers-1/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers\">layers</a></code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①②\">Queue a task</a> to perform the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>activeState</var> to <var>newState</var>.</p>"
            },
            {
              "html": "<p>If <var>oldBaseLayer</var> is not equal to <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer②\">baseLayer</a></code>, <var>oldLayers</var> is not equal to <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/webxrlayers-1/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers①\">layers</a></code>, or the dimensions of any of the layers have changed, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#update-the-viewports\" id=\"ref-for-update-the-viewports\">update the viewports</a> for <var>session</var>.</p>"
            },
            {
              "html": "<p>If <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview①\">inlineVerticalFieldOfView</a></code> is less than <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#minimum-inline-field-of-view\" id=\"ref-for-minimum-inline-field-of-view\">minimum inline field of view</a> set <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview②\">inlineVerticalFieldOfView</a></code> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#minimum-inline-field-of-view\" id=\"ref-for-minimum-inline-field-of-view①\">minimum inline field of view</a>.</p>"
            },
            {
              "html": "<p>If <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview③\">inlineVerticalFieldOfView</a></code> is greater than <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#maximum-inline-field-of-view\" id=\"ref-for-maximum-inline-field-of-view\">maximum inline field of view</a> set <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview④\">inlineVerticalFieldOfView</a></code> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#maximum-inline-field-of-view\" id=\"ref-for-maximum-inline-field-of-view①\">maximum inline field of view</a>.</p>"
            },
            {
              "html": "<p>If <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthnear\" id=\"ref-for-dom-xrrenderstate-depthnear①\">depthNear</a></code> is less than <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#minimum-near-clip-plane\" id=\"ref-for-minimum-near-clip-plane①\">minimum near clip plane</a> set <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthnear\" id=\"ref-for-dom-xrrenderstate-depthnear②\">depthNear</a></code> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#minimum-near-clip-plane\" id=\"ref-for-minimum-near-clip-plane②\">minimum near clip plane</a>.</p>"
            },
            {
              "html": "<p>If <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthfar\" id=\"ref-for-dom-xrrenderstate-depthfar①\">depthFar</a></code> is greater than <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#maximum-far-clip-plane\" id=\"ref-for-maximum-far-clip-plane①\">maximum far clip plane</a> set <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthfar\" id=\"ref-for-dom-xrrenderstate-depthfar②\">depthFar</a></code> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#maximum-far-clip-plane\" id=\"ref-for-maximum-far-clip-plane②\">maximum far clip plane</a>.</p>"
            },
            {
              "html": "<p>Let <var>baseLayer</var> be <var>activeState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer③\">baseLayer</a></code>.</p>"
            },
            {
              "html": "Set <var>activeState</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-composition-enabled\" id=\"ref-for-xrrenderstate-composition-enabled\">composition enabled</a> and <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-output-canvas\" id=\"ref-for-xrrenderstate-output-canvas\">output canvas</a> as follows:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If session’s mode is \"inline\" and baseLayer is an instance of an XRWebGLLayer with composition enabled set to false:",
                      "html": "<p>Set <var>activeState</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-composition-enabled\" id=\"ref-for-xrrenderstate-composition-enabled①\">composition enabled</a> boolean to <code>false</code>.</p>"
                    },
                    {
                      "case": "Otherwise:",
                      "html": "<p>Set <var>activeState</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-composition-enabled\" id=\"ref-for-xrrenderstate-composition-enabled②\">composition enabled</a> boolean to <code>true</code>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "request-reference-space",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsession-requestreferencespace",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrsession-requestreferencespace\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>requestReferenceSpace(<var>type</var>)</code></dfn> method constructs a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace②\">XRReferenceSpace</a></code> of a given <var>type</var>, if possible. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise④\">a new Promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession④⓪\">XRSession</a></code>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#reference-space-is-supported\" id=\"ref-for-reference-space-is-supported\">reference space is supported</a> for <var>type</var> and <var>session</var> is <code>false</code>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①③\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①①\">reject</a> <var>promise</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Set up any platform resources required to track reference spaces of type <var>type</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①④\">Queue a task</a> to run the following steps:</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#create-a-reference-space\" id=\"ref-for-create-a-reference-space\">Create a reference space</a>, <var>referenceSpace</var>, with <var>type</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⓪\">Resolve</a> <var>promise</var> with <var>referenceSpace</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "on-input-source-added",
      "href": "https://immersive-web.github.io/webxr/#xrsession-add-input-source",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"dfn\" data-lt=\"add input source\" data-noexport=\"\" id=\"xrsession-add-input-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">new <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source③\">XR input source</a>s become available</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession④⑥\">XRSession</a></code> <var>session</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-promise-resolved\" id=\"ref-for-xrsession-promise-resolved①\">promise resolved</a> flag is not set, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>added primary sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>added tracked sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a>.</p>"
        },
        {
          "html": "For each new <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source④\">XR input source</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>inputSource</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource②\">XRInputSource</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession④⑦\">XRSession</a></code>, then perform the following step:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If inputSource is a primary input source:",
                      "html": "<p>Add <var>inputSource</var> to <var>added primary sources</var>.</p>"
                    },
                    {
                      "case": "Otherwise:",
                      "html": "<p>Add <var>inputSource</var> to <var>added tracked sources</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①⑤\">Queue a task</a> to perform the following steps:",
          "rationale": "extend",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend\">Extend</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources②\">list of active XR input sources</a> with <var>added primary sources</var>.</p>"
            },
            {
              "html": "<p>If <var>added primary sources</var> is not empty, fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent①\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-inputsourceschange\" id=\"ref-for-eventdef-xrsession-inputsourceschange②\">inputsourceschange</a></code> on <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-added\" id=\"ref-for-dom-xrinputsourceschangeevent-added①\">added</a></code> set to <var>added primary sources</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend①\">Extend</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-tracked-sources\" id=\"ref-for-list-of-active-xr-tracked-sources①\">list of active XR tracked sources</a> with <var>added tracked sources</var>.</p>"
            },
            {
              "html": "<p>If <var>added tracked sources</var> is not empty, fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent②\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-trackedsourceschange\" id=\"ref-for-eventdef-xrsession-trackedsourceschange\">trackedsourceschange</a></code> on <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-added\" id=\"ref-for-dom-xrinputsourceschangeevent-added②\">added</a></code> set to <var>added tracked sources</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "on-input-source-removed",
      "href": "https://immersive-web.github.io/webxr/#xrsession-remove-input-source",
      "html": "When any previously added <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"dfn\" data-lt=\"remove input source\" data-noexport=\"\" id=\"xrsession-remove-input-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source⑤\">XR input source</a>s are no longer available</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession④⑧\">XRSession</a></code> <var>session</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-promise-resolved\" id=\"ref-for-xrsession-promise-resolved②\">promise resolved</a> flag is not set, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>removed primary sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>removed tracked sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪\">list</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source⑥\">XR input source</a> that is no longer available:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>inputSource</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource③\">XRInputSource</a></code> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources③\">list of active XR input sources</a> associated with the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source⑦\">XR input source</a>, then perform the following step:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If inputSource is a primary input source:",
                      "html": "<p>Add <var>inputSource</var> to <var>removed primary sources</var>.</p>"
                    },
                    {
                      "case": "Otherwise:",
                      "html": "<p>Add <var>inputSource</var> to <var>removed tracked sources</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①⑥\">Queue a task</a> to perform the following steps:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">Remove</a> each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource④\">XRInputSource</a></code> in <var>removed primary sources</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources④\">list of active XR input sources</a>.</p>"
            },
            {
              "html": "<p>If <var>removed primary sources</var> is not empty, fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent③\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-inputsourceschange\" id=\"ref-for-eventdef-xrsession-inputsourceschange③\">inputsourceschange</a></code> on <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-removed\" id=\"ref-for-dom-xrinputsourceschangeevent-removed\">removed</a></code> set to <var>removed primary sources</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">Remove</a> each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource⑤\">XRInputSource</a></code> in <var>removed tracked sources</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-tracked-sources\" id=\"ref-for-list-of-active-xr-tracked-sources②\">list of active XR tracked sources</a>.</p>"
            },
            {
              "html": "<p>If <var>removed tracked sources</var> is not empty, fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent④\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-trackedsourceschange\" id=\"ref-for-eventdef-xrsession-trackedsourceschange①\">trackedsourceschange</a></code> on <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-removed\" id=\"ref-for-dom-xrinputsourceschangeevent-removed①\">removed</a></code> set to <var>removed tracked sources</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "on-input-source-change",
      "href": "https://immersive-web.github.io/webxr/#xrsession-change-input-source",
      "html": "When the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"change input source\" id=\"xrsession-change-input-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsource-handedness\" id=\"ref-for-dom-xrinputsource-handedness\">handedness</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsource-targetraymode\" id=\"ref-for-dom-xrinputsource-targetraymode\">targetRayMode</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsource-profiles\" id=\"ref-for-dom-xrinputsource-profiles\">profiles</a></code>, presence of a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsource-gripspace\" id=\"ref-for-dom-xrinputsource-gripspace\">gripSpace</a></code> or the status as a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-input-source\" id=\"ref-for-primary-input-source②\">primary input source</a> or <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#tracked-input-source\" id=\"ref-for-tracked-input-source\">tracked input source</a> for any <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source⑧\">XR input source</a>s change</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession④⑨\">XRSession</a></code> <var>session</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-promise-resolved\" id=\"ref-for-xrsession-promise-resolved③\">promise resolved</a> flag is not set, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>added primary sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>removed primary sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①②\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>added tracked sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①③\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>removed tracked sources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①④\">list</a>.</p>"
        },
        {
          "html": "For each changed <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source⑨\">XR input source</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>oldInputSource</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource⑥\">XRInputSource</a></code> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources⑤\">list of active XR input sources</a> previously associated with the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source①⓪\">XR input source</a>, then perform the following step:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If oldInputSource is a primary input source or its state changed from a primary input source to tracked input source a:",
                      "html": "<p>Add <var>oldInputSource</var> to <var>removed primary sources</var>.</p>"
                    },
                    {
                      "case": "Otherwise:",
                      "html": "<p>Add <var>oldInputSource</var> to <var>removed tracked sources</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>newInputSource</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource⑦\">XRInputSource</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant realm</a> of <var>session</var>, then perform the following step:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If newInputSource is a primary input source or its state changed from a tracked input source to primary input source :",
                      "html": "<p>Add <var>newInputSource</var> to <var>added primary sources</var>.</p>"
                    },
                    {
                      "case": "Otherwise:",
                      "html": "<p>Add <var>newInputSource</var> to <var>added tracked sources</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①⑦\">Queue a task</a> to perform the following steps:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②\">Remove</a> each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource⑧\">XRInputSource</a></code> in <var>removed primary sources</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources⑥\">list of active XR input sources</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend②\">Extend</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources⑦\">list of active XR input sources</a> with <var>added primary sources</var>.</p>"
            },
            {
              "html": "<p>If <var>added primary sources</var> or <var>removed primary sources</var> are not empty, fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent⑤\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-inputsourceschange\" id=\"ref-for-eventdef-xrsession-inputsourceschange④\">inputsourceschange</a></code> on <var>session</var> with<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-added\" id=\"ref-for-dom-xrinputsourceschangeevent-added③\">added</a></code> set to <var>added primary sources</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-removed\" id=\"ref-for-dom-xrinputsourceschangeevent-removed②\">removed</a></code> set to <var>removed primary sources</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove③\">Remove</a> each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource⑨\">XRInputSource</a></code> in <var>removed tracked sources</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-tracked-sources\" id=\"ref-for-list-of-active-xr-tracked-sources③\">list of active XR tracked sources</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend③\">Extend</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources⑧\">list of active XR input sources</a> with <var>added tracked sources</var>.</p>"
            },
            {
              "html": "<p>If <var>added tracked sources</var> or <var>removed tracked sources</var> are not empty, fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceschangeevent\" id=\"ref-for-xrinputsourceschangeevent⑥\">XRInputSourcesChangeEvent</a></code> named <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-trackedsourceschange\" id=\"ref-for-eventdef-xrsession-trackedsourceschange②\">trackedsourceschange</a></code> on <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-added\" id=\"ref-for-dom-xrinputsourceschangeevent-added④\">added</a></code> set to <var>added tracked sources</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceschangeevent-removed\" id=\"ref-for-dom-xrinputsourceschangeevent-removed③\">removed</a></code> set to <var>removed tracked sources</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "initialize-renderstate",
      "href": "https://immersive-web.github.io/webxr/#initialize-the-render-state",
      "html": "When an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate\" id=\"ref-for-xrrenderstate⑨\">XRRenderState</a></code> object is created for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑦④\">XRSession</a></code> <var>session</var>, the user agent MUST <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-render-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the render state</dfn> by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>state</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate\" id=\"ref-for-xrrenderstate①⓪\">XRRenderState</a></code> object in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑧\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthnear\" id=\"ref-for-dom-xrrenderstate-depthnear④\">depthNear</a></code> to <code>0.1</code>.</p>"
        },
        {
          "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-depthfar\" id=\"ref-for-dom-xrrenderstate-depthfar④\">depthFar</a></code> to <code>1000.0</code>.</p>"
        },
        {
          "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-passthroughfullyobscured\" id=\"ref-for-dom-xrrenderstate-passthroughfullyobscured②\">passthroughFullyObscured</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview⑥\">inlineVerticalFieldOfView</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If session is an inline session:",
                  "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview⑦\">inlineVerticalFieldOfView</a></code> to <code>PI * 0.5</code>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-inlineverticalfieldofview\" id=\"ref-for-dom-xrrenderstate-inlineverticalfieldofview⑧\">inlineVerticalFieldOfView</a></code> to <code>null</code>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer⑤\">baseLayer</a></code> to <code>null</code>.</p>"
        }
      ]
    },
    {
      "name": "request-animation-frame",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsession-requestanimationframe",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrsession-requestanimationframe\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>requestAnimationFrame(<var>callback</var>)</code></dfn> method queues up <var>callback</var> for being run the next time the user agent wishes to run an animation frame for the device.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended⑤\">ended</a> value is <code>true</code>, return <code>0</code> and abort these steps.</p>"
        },
        {
          "html": "<p>Increment <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#animation-frame-callback-identifier\" id=\"ref-for-animation-frame-callback-identifier\">animation frame callback identifier</a> by one.</p>"
        },
        {
          "html": "<p>Append <var>callback</var> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-animation-frame-callbacks\" id=\"ref-for-list-of-animation-frame-callbacks\">list of animation frame callbacks</a>, associated with <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#animation-frame-callback-identifier\" id=\"ref-for-animation-frame-callback-identifier①\">animation frame callback identifier</a>’s current value.</p>"
        },
        {
          "html": "<p>Return <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#animation-frame-callback-identifier\" id=\"ref-for-animation-frame-callback-identifier②\">animation frame callback identifier</a>’s current value.</p>"
        }
      ]
    },
    {
      "name": "cancel-animation-frame",
      "href": "https://immersive-web.github.io/webxr/#dom-xrsession-cancelanimationframe",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrsession-cancelanimationframe\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>cancelAnimationFrame(<var>handle</var>)</code></dfn> method cancels an existing animation frame callback given its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#animation-frame-callback-identifier\" id=\"ref-for-animation-frame-callback-identifier③\">animation frame callback identifier</a> <var>handle</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>.</p>"
        },
        {
          "html": "<p>Find the entry in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-animation-frame-callbacks\" id=\"ref-for-list-of-animation-frame-callbacks①\">list of animation frame callbacks</a> or <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-currently-running-animation-frame-callbacks\" id=\"ref-for-list-of-currently-running-animation-frame-callbacks\">list of currently running animation frame callbacks</a> that is associated with the value <var>handle</var>.</p>"
        },
        {
          "html": "<p>If there is such an entry, set its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframerequestcallback-cancelled\" id=\"ref-for-xrframerequestcallback-cancelled\">cancelled</a> boolean to <code>true</code> and remove it from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-animation-frame-callbacks\" id=\"ref-for-list-of-animation-frame-callbacks②\">list of animation frame callbacks</a>.</p>"
        }
      ]
    },
    {
      "name": "check-layers-state",
      "href": "https://immersive-web.github.io/webxr/#check-the-layers-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-the-layers-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check the layers state</dfn> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate②\">renderState</a></code> <var>state</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer⑥\">baseLayer</a></code> is <code>null</code>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>return <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "should-be-rendered",
      "href": "https://immersive-web.github.io/webxr/#should-be-rendered",
      "html": "To determine if a frame <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"should-be-rendered\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">should be rendered</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑦⑨\">XRSession</a></code> <var>session</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#check-the-layers-state\" id=\"ref-for-check-the-layers-state\">check the layers state</a> with <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate③\">renderState</a></code> is <code>false</code>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-mode\" id=\"ref-for-xrsession-mode②\">mode</a> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessionmode-inline\" id=\"ref-for-dom-xrsessionmode-inline①③\">\"inline\"</a></code> and <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate④\">renderState</a></code>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-output-canvas\" id=\"ref-for-xrrenderstate-output-canvas⑧\">output canvas</a> is <code>null</code>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>return <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "run-animation-frames",
      "href": "https://immersive-web.github.io/webxr/#xr-animation-frame",
      "html": "When an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑧⓪\">XRSession</a></code> <var>session</var> receives updated <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#viewer\" id=\"ref-for-viewer⑤\">viewer</a> state for timestamp <var>frameTime</var> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device①⑤\">XR device</a>, it runs an <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xr-animation-frame\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">XR animation frame</dfn>, which MUST run the following steps regardless of if the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-animation-frame-callbacks\" id=\"ref-for-list-of-animation-frame-callbacks③\">list of animation frame callbacks</a> is empty or not:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①⑧\">Queue a task</a> to perform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>now</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/hr-time-3/#dfn-current-high-resolution-time\" id=\"ref-for-dfn-current-high-resolution-time\">current high resolution time</a>.</p>"
            },
            {
              "html": "<p>Let <var>frame</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-animation-frame\" id=\"ref-for-xrsession-animation-frame\">animation frame</a>.</p>"
            },
            {
              "html": "<p>Set <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time\">time</a> to <var>frameTime</var>.</p>"
            },
            {
              "html": "<p>Set <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-predicteddisplaytime\" id=\"ref-for-dom-xrframe-predicteddisplaytime\">predictedDisplayTime</a></code> to <var>frameTime</var>.</p>"
            },
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-mode\" id=\"ref-for-xrsession-mode③\">mode</a> is not <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessionmode-inline\" id=\"ref-for-dom-xrsessionmode-inline①④\">\"inline\"</a></code>, set <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-predicteddisplaytime\" id=\"ref-for-dom-xrframe-predicteddisplaytime①\">predictedDisplayTime</a></code> to the average timestamp the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compositor\" id=\"ref-for-xr-compositor⑤\">XR Compositor</a> is expected to display this <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-animation-frame\" id=\"ref-for-xr-animation-frame①\">XR animation frame</a>.</p>"
            },
            {
              "html": "<p>For each <var>view</var> in <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views②\">list of views</a>, set <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-viewport-modifiable\" id=\"ref-for-view-viewport-modifiable\">viewport modifiable</a> flag to true.</p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-active\" id=\"ref-for-view-active①\">active</a> flag of any <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view⑤\">view</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views③\">list of views</a> has changed since the last <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-animation-frame\" id=\"ref-for-xr-animation-frame②\">XR animation frame</a>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#update-the-viewports\" id=\"ref-for-update-the-viewports①\">update the viewports</a>.</p>"
            },
            {
              "html": "If the frame <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#should-be-rendered\" id=\"ref-for-should-be-rendered\">should be rendered</a> for <var>session</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-currently-running-animation-frame-callbacks\" id=\"ref-for-list-of-currently-running-animation-frame-callbacks①\">list of currently running animation frame callbacks</a> to be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-animation-frame-callbacks\" id=\"ref-for-list-of-animation-frame-callbacks④\">list of animation frame callbacks</a>.</p>"
                },
                {
                  "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-animation-frame-callbacks\" id=\"ref-for-list-of-animation-frame-callbacks⑤\">list of animation frame callbacks</a> to the empty list.</p>"
                },
                {
                  "html": "<p>Set <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active①\">active</a> boolean to <code>true</code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-apply-frame-updates\" id=\"ref-for-xrframe-apply-frame-updates\">Apply frame updates</a> for <var>frame</var>.</p>"
                },
                {
                  "html": "<p>For each <var>entry</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-currently-running-animation-frame-callbacks\" id=\"ref-for-list-of-currently-running-animation-frame-callbacks②\">list of currently running animation frame callbacks</a>, in order:</p>"
                },
                {
                  "html": "<p>If the <var>entry</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframerequestcallback-cancelled\" id=\"ref-for-xrframerequestcallback-cancelled①\">cancelled</a> boolean is <code>true</code>, continue to the next entry.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">Invoke</a> <var>entry</var> with « <var>now</var>, <var>frame</var> » and \"<code>report</code>\".</p>"
                },
                {
                  "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-currently-running-animation-frame-callbacks\" id=\"ref-for-list-of-currently-running-animation-frame-callbacks③\">list of currently running animation frame callbacks</a> to the empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑥\">list</a>.</p>"
                },
                {
                  "html": "<p>Set <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active②\">active</a> boolean to <code>false</code>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state⑧\">pending render state</a> is not <code>null</code>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#apply-the-pending-render-state\" id=\"ref-for-apply-the-pending-render-state\">apply the pending render state</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get-viewer-pose",
      "href": "https://immersive-web.github.io/webxr/#dom-xrframe-getviewerpose",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRFrame\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrframe-getviewerpose\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getViewerPose(<var>referenceSpace</var>)</code></dfn> method provides the pose of the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#viewer\" id=\"ref-for-viewer⑥\">viewer</a> relative to <var>referenceSpace</var> as an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewerpose\" id=\"ref-for-xrviewerpose①\">XRViewerPose</a></code>, at the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe①⓪\">XRFrame</a></code>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time②\">time</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session②\">session</a></code> object.</p>"
        },
        {
          "html": "<p>If <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-animationframe\" id=\"ref-for-xrframe-animationframe①\">animationFrame</a> boolean is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑧\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>pose</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewerpose\" id=\"ref-for-xrviewerpose②\">XRViewerPose</a></code> object in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑨\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#populate-the-pose\" id=\"ref-for-populate-the-pose\">Populate the pose</a> of <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-viewer-reference-space\" id=\"ref-for-xrsession-viewer-reference-space\">viewer reference space</a> in <var>referenceSpace</var> at the time represented by <var>frame</var> into <var>pose</var>, with <code>force emulation</code> set to <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>pose</var> is <code>null</code> return <code>null</code>.</p>"
        },
        {
          "html": "<p>Let <var>xrviews</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑦\">list</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-active\" id=\"ref-for-view-active②\">active</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view⑥\">view</a> <var>view</var> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views④\">list of views</a> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session③\">session</a></code>, perform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>xrview</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrview\" id=\"ref-for-xrview①\">XRView</a></code> object in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⓪\">relevant realm</a> of <var>session</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>xrview</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-underlying-view\" id=\"ref-for-xrview-underlying-view\">underlying view</a> to <var>view</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>xrview</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrview-eye\" id=\"ref-for-dom-xrview-eye\">eye</a></code> to <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-eye\" id=\"ref-for-view-eye\">eye</a>.</p>"
            },
            {
              "html": "<p>Initialize <var>xrview</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-frame\" id=\"ref-for-xrview-frame\">frame</a> to <var>frame</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>xrview</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-session\" id=\"ref-for-xrview-session\">session</a> to <var>session</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>xrview</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-reference-space\" id=\"ref-for-view-reference-space\">reference space</a> to <var>referenceSpace</var>.</p>"
            },
            {
              "html": "<p>Let <var>offset</var> be an <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform\">XRRigidTransform</a></code> object equal to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-geometry-view-offset\" id=\"ref-for-view-geometry-view-offset\">view offset</a> of <var>view</var> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①①\">relevant realm</a> of <var>session</var>.</p>"
            },
            {
              "html": "<p>Set <var>xrview</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewgeometry-transform\" id=\"ref-for-dom-xrviewgeometry-transform\">transform</a></code> property to the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#multiply-transforms\" id=\"ref-for-multiply-transforms\">multiplying</a> the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewerpose\" id=\"ref-for-xrviewerpose③\">XRViewerPose</a></code>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpose-transform\" id=\"ref-for-dom-xrpose-transform\">transform</a></code> by the <var>offset</var> transform in the relevant realm of <var>session</var></p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>xrview</var> to <var>xrviews</var></p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>pose</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewerpose-views\" id=\"ref-for-dom-xrviewerpose-views\">views</a></code> to <var>xrviews</var></p>"
        },
        {
          "html": "<p>Return <var>pose</var>.</p>"
        }
      ]
    },
    {
      "name": "get-pose",
      "href": "https://immersive-web.github.io/webxr/#dom-xrframe-getpose",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRFrame\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrframe-getpose\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getPose(<var>space</var>, <var>baseSpace</var>)</code></dfn> method provides the pose of <var>space</var> relative to <var>baseSpace</var> as an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpose\" id=\"ref-for-xrpose①\">XRPose</a></code>, at the time represented by the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe①①\">XRFrame</a></code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>.</p>"
        },
        {
          "html": "<p>Let <var>pose</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpose\" id=\"ref-for-xrpose②\">XRPose</a></code> object in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①②\">relevant realm</a> of <var>frame</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#populate-the-pose\" id=\"ref-for-populate-the-pose①\">Populate the pose</a> of <var>space</var> in <var>baseSpace</var> at the time represented by <var>frame</var> into <var>pose</var>.</p>"
        },
        {
          "html": "<p>Return <var>pose</var>.</p>"
        }
      ]
    },
    {
      "name": "apply-frame-updates",
      "href": "https://immersive-web.github.io/webxr/#xrframe-apply-frame-updates",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRFrame\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xrframe-apply-frame-updates\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply frame updates</dfn> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe①④\">XRFrame</a></code> <var>frame</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>frame update</var> in <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session④\">session</a></code>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-frame-updates\" id=\"ref-for-xrsession-list-of-frame-updates\">list of frame updates</a>, perform the following steps:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <var>frame update</var> with <var>frame</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "populate-the-pose",
      "href": "https://immersive-web.github.io/webxr/#populate-the-pose",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"populate-the-pose\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">populate the pose</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrspace\" id=\"ref-for-xrspace①④\">XRSpace</a></code> <var>space</var> in an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrspace\" id=\"ref-for-xrspace①⑤\">XRSpace</a></code> <var>baseSpace</var> at the time represented by an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe①⑧\">XRFrame</a></code> <var>frame</var> into an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpose\" id=\"ref-for-xrpose④\">XRPose</a></code> <var>pose</var>, with an optional <var>force emulation</var> flag, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active③\">active</a> boolean is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑨\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session⑤\">session</a></code> object.</p>"
        },
        {
          "html": "<p>If <var>space</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-session\" id=\"ref-for-xrspace-session\">session</a> does not equal <var>session</var>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⓪\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>baseSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-session\" id=\"ref-for-xrspace-session①\">session</a> does not equal <var>session</var>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①①\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Check if <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#poses-may-be-reported\" id=\"ref-for-poses-may-be-reported\">poses may be reported</a> and, if not, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror③\">SecurityError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-visibilitystate\" id=\"ref-for-dom-xrsession-visibilitystate①\">visibilityState</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrvisibilitystate-visible-blurred\" id=\"ref-for-dom-xrvisibilitystate-visible-blurred③\">\"visible-blurred\"</a></code> and <var>space</var> or <var>baseSpace</var> is associated with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource①⓪\">XRInputSource</a></code>, set <var>pose</var> to <code>null</code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>limit</var> be the result of whether <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#poses-must-be-limited\" id=\"ref-for-poses-must-be-limited\">poses must be limited</a> between <var>space</var> and <var>baseSpace</var>.</p>"
        },
        {
          "html": "<p>Let <var>transform</var> be <var>pose</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpose-transform\" id=\"ref-for-dom-xrpose-transform①\">transform</a></code>.</p>"
        },
        {
          "html": "Query the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-device\" id=\"ref-for-xr-device①②\">XR device</a>’s tracking system for <var>space</var>’s pose relative to <var>baseSpace</var> at the <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time③\">time</a>, then perform the following steps:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If limit is false and the tracking system provides a 6DoF pose whose position is actively tracked or statically known for space’s pose relative to baseSpace:",
                  "html": "<p>Set <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation\">orientation</a></code> to the orientation of <var>space</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-effective-origin\" id=\"ref-for-xrspace-effective-origin②\">effective origin</a> in <var>baseSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-coordinate-system\" id=\"ref-for-xrspace-coordinate-system\">coordinate system</a>.</p>"
                },
                {
                  "case": "Else if limit is false and the tracking system provides a 3DoF pose or a 6DoF pose whose position is neither actively tracked nor statically known for space’s pose relative to baseSpace:",
                  "html": "<p>Set <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation①\">orientation</a></code> to the orientation of <var>space</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-effective-origin\" id=\"ref-for-xrspace-effective-origin⑥\">effective origin</a> in <var>baseSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-coordinate-system\" id=\"ref-for-xrspace-coordinate-system④\">coordinate system</a>.</p>"
                },
                {
                  "case": "Else if space’s pose relative to baseSpace has been determined in the past and force emulation is true:",
                  "html": "<p>Set <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position②\">position</a></code> to the last known position of <var>space</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-effective-origin\" id=\"ref-for-xrspace-effective-origin⑧\">effective origin</a> in <var>baseSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-coordinate-system\" id=\"ref-for-xrspace-coordinate-system⑥\">coordinate system</a>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Set <var>pose</var> to <code>null</code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "create-reference-space",
      "href": "https://immersive-web.github.io/webxr/#create-a-reference-space",
      "html": "When an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace①⑨\">XRReferenceSpace</a></code> is requested with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#enumdef-xrreferencespacetype\" id=\"ref-for-enumdef-xrreferencespacetype④\">XRReferenceSpaceType</a></code> <var>type</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑨⑤\">XRSession</a></code> <var>session</var>, the user agent MUST <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-reference-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a reference space</dfn> by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>referenceSpace</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If type is bounded-floor:",
                  "html": "<p>Let <var>referenceSpace</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑦\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrboundedreferencespace\" id=\"ref-for-xrboundedreferencespace①\">XRBoundedReferenceSpace</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①③\">relevant realm</a> of <var>session</var>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Let <var>referenceSpace</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑧\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace②⓪\">XRReferenceSpace</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①④\">relevant realm</a> of <var>session</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>referenceSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type\">type</a> to <var>type</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>referenceSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-session\" id=\"ref-for-xrspace-session②\">session</a> to <var>session</var>.</p>"
        },
        {
          "html": "<p>Return <var>referenceSpace</var>.</p>"
        }
      ]
    },
    {
      "name": "reference-space-supported",
      "href": "https://immersive-web.github.io/webxr/#reference-space-is-supported",
      "html": "To check if a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"reference-space-is-supported\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">reference space is supported</dfn> for a given reference space type <var>type</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession⑨⑥\">XRSession</a></code> <var>session</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>type</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑥\">contained</a> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-set-of-granted-features\" id=\"ref-for-xrsession-set-of-granted-features②\">set of granted features</a>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>If <var>type</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-viewer\" id=\"ref-for-dom-xrreferencespacetype-viewer⑤\">viewer</a></code>, return <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>type</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-local\" id=\"ref-for-dom-xrreferencespacetype-local⑥\">local</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-local-floor\" id=\"ref-for-dom-xrreferencespacetype-local-floor⑤\">local-floor</a></code>, and <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session②④\">immersive session</a>, return <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>type</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-local\" id=\"ref-for-dom-xrreferencespacetype-local⑦\">local</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-local-floor\" id=\"ref-for-dom-xrreferencespacetype-local-floor⑥\">local-floor</a></code>, and the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device①⑧\">XR device</a> supports reporting orientation data, return <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>type</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-bounded-floor\" id=\"ref-for-dom-xrreferencespacetype-bounded-floor⑦\">bounded-floor</a></code> and <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session②⑤\">immersive session</a>, return the result of whether <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#bounded-reference-spaces-are-supported\" id=\"ref-for-bounded-reference-spaces-are-supported\">bounded reference spaces are supported</a> by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device①⑨\">XR device</a>.</p>"
        },
        {
          "html": "<p>If <var>type</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-unbounded\" id=\"ref-for-dom-xrreferencespacetype-unbounded④\">unbounded</a></code>, <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session②⑥\">immersive session</a>, and the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device②⓪\">XR device</a> supports stable tracking near the user over an unlimited distance, return <code>true</code>.</p>"
        },
        {
          "html": "<p>Return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "get-offset-space",
      "href": "https://immersive-web.github.io/webxr/#dom-xrreferencespace-getoffsetreferencespace",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRReferenceSpace\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrreferencespace-getoffsetreferencespace\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getOffsetReferenceSpace(<var>originOffset</var>)</code></dfn> method MUST perform the following steps when invoked:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>base</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace②①\">XRReferenceSpace</a></code> the method was called on.</p>"
        },
        {
          "html": "Initialize <var>offsetSpace</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If base is an instance of XRBoundedReferenceSpace:",
                  "html": "<p>Let <var>offsetSpace</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑨\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrboundedreferencespace\" id=\"ref-for-xrboundedreferencespace③\">XRBoundedReferenceSpace</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑤\">relevant realm</a> of <var>base</var>, and set <var>offsetSpace</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrboundedreferencespace-boundsgeometry\" id=\"ref-for-dom-xrboundedreferencespace-boundsgeometry②\">boundsGeometry</a></code> to <var>base</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrboundedreferencespace-boundsgeometry\" id=\"ref-for-dom-xrboundedreferencespace-boundsgeometry③\">boundsGeometry</a></code>, with each point multiplied by the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-inverse\" id=\"ref-for-dom-xrrigidtransform-inverse\">inverse</a></code> of <var>originOffset</var>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Let <var>offsetSpace</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⓪\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace②②\">XRReferenceSpace</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑥\">relevant realm</a> of <var>base</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>offsetSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type①\">type</a> to <var>base</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type②\">type</a>.</p>"
        },
        {
          "html": "<p>Set <var>offsetSpace</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-origin-offset\" id=\"ref-for-xrspace-origin-offset②\">origin offset</a> to the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#multiply-transforms\" id=\"ref-for-multiply-transforms②\">multiplying</a> <var>base</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-origin-offset\" id=\"ref-for-xrspace-origin-offset③\">origin offset</a> by <var>originOffset</var> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑦\">relevant realm</a> of <var>base</var>.</p>"
        },
        {
          "html": "<p>Return <var>offsetSpace</var>.</p>"
        }
      ]
    },
    {
      "name": "bounded-space-supported",
      "href": "https://immersive-web.github.io/webxr/#bounded-reference-spaces-are-supported",
      "html": "To check if <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"bounded-reference-spaces-are-supported\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">bounded reference spaces are supported</dfn> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device②①\">XR device</a> cannot report boundaries, return false.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device②②\">XR device</a> cannot identify the height of the user’s physical floor, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "obtain-xrviewGeometry-projection",
      "href": "https://immersive-web.github.io/webxr/#xrviewgeometry-obtain-the-projection-matrix",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRViewGeometry\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xrviewgeometry-obtain-the-projection-matrix\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain the projection matrix</dfn> for a given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewgeometry\" id=\"ref-for-xrviewgeometry③\">XRViewGeometry</a></code> <var>view geometry</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>view geometry</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrviewgeometry-internal-projection-matrix\" id=\"ref-for-xrviewgeometry-internal-projection-matrix\">internal projection matrix</a> is not <code>null</code>, perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the operation <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.es/ecma262/#sec-isdetachedbuffer\" id=\"ref-for-sec-isdetachedbuffer\">IsDetachedBuffer</a></code> on <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrviewgeometry-internal-projection-matrix\" id=\"ref-for-xrviewgeometry-internal-projection-matrix①\">internal projection matrix</a> is <code>false</code>, return <var>view geometry</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrviewgeometry-internal-projection-matrix\" id=\"ref-for-xrviewgeometry-internal-projection-matrix②\">internal projection matrix</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>view geometry</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrviewgeometry-internal-projection-matrix\" id=\"ref-for-xrviewgeometry-internal-projection-matrix③\">internal projection matrix</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①①\">new</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#matrix\" id=\"ref-for-matrix①\">matrix</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑧\">relevant realm</a> of <var>view geometry</var> which is equal to <var>view geometry</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-geometry-projection-matrix\" id=\"ref-for-view-geometry-projection-matrix③\">projection matrix</a>.</p>"
        },
        {
          "html": "<p>Return <var>view geometry</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrviewgeometry-internal-projection-matrix\" id=\"ref-for-xrviewgeometry-internal-projection-matrix④\">internal projection matrix</a>.</p>"
        }
      ]
    },
    {
      "name": "request-viewport-scale",
      "href": "https://immersive-web.github.io/webxr/#dom-xrview-requestviewportscale",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRView\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrview-requestviewportscale\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>requestViewportScale(<var>scale</var>)</code></dfn> method requests that the user agent should set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-requested-viewport-scale\" id=\"ref-for-view-requested-viewport-scale①\">requested viewport scale</a> for this viewport to the requested value.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>scale</var> is null or undefined, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>scale</var> is less than or equal to 0.0, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>scale</var> is greater than 1.0, set <var>scale</var> to 1.0.</p>"
        },
        {
          "html": "<p>Let <var>view</var> be <var>xrview</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-underlying-view\" id=\"ref-for-xrview-underlying-view①\">underlying view</a>.</p>"
        },
        {
          "html": "<p>Set the <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-requested-viewport-scale\" id=\"ref-for-view-requested-viewport-scale②\">requested viewport scale</a> value to <var>scale</var>.</p>"
        }
      ]
    },
    {
      "name": "update-the-viewports",
      "href": "https://immersive-web.github.io/webxr/#update-the-viewports",
      "html": "When the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-active\" id=\"ref-for-view-active④\">active</a> flag of any <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view②③\">view</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑤\">list of views</a> changes, one can <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-the-viewports\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update the viewports</dfn> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⓪⓪\">XRSession</a></code> <var>session</var> by performing the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layer</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate⑤\">renderState</a></code>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer⑦\">baseLayer</a></code>.</p>"
        },
        {
          "html": "<p>If <var>layer</var> is <code>null</code> abort these steps.</p>"
        },
        {
          "html": "<p>Set <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-viewport-objects\" id=\"ref-for-list-of-viewport-objects\">list of viewport objects</a> to the empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⓪\">list</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-active\" id=\"ref-for-view-active⑤\">active</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view②④\">view</a> <var>view</var> in <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑥\">list of views</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>viewport</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewport\" id=\"ref-for-xrviewport\">XRViewport</a></code> result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-obtain-a-scaled-viewport\" id=\"ref-for-xrview-obtain-a-scaled-viewport\">obtaining a scaled viewport</a> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-full-sized-viewports\" id=\"ref-for-list-of-full-sized-viewports\">list of full-sized viewports</a> associated with <var>view</var> for <var>session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> <var>viewport</var> to <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-viewport-objects\" id=\"ref-for-list-of-viewport-objects①\">list of viewport objects</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "obtain-scaled-viewport",
      "href": "https://immersive-web.github.io/webxr/#xrview-obtain-a-scaled-viewport",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRView\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xrview-obtain-a-scaled-viewport\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a scaled viewport</dfn> for a given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrview\" id=\"ref-for-xrview⑨\">XRView</a></code> <var>view</var> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⓪①\">XRSession</a></code> <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>glFullSizedViewport</var> be the <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14.4\" id=\"ref-for-5.14.4\">WebGL viewport</a> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-full-sized-viewports\" id=\"ref-for-list-of-full-sized-viewports①\">list of full-sized viewports</a> associated with <var>view</var>.</p>"
        },
        {
          "html": "<p>Let <var>scale</var> be the <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-current-viewport-scale\" id=\"ref-for-view-current-viewport-scale\">current viewport scale</a>.</p>"
        },
        {
          "html": "<p>The user agent MAY choose to clamp <var>scale</var> to apply a minimum viewport scale factor.</p>"
        },
        {
          "html": "<p>Let <var>glViewport</var> be a new <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14.4\" id=\"ref-for-5.14.4①\">WebGL viewport</a>.</p>"
        },
        {
          "html": "<p>Set <var>glViewport</var>’s <code>width</code> to an integer value less than or equal to <var>glFullSizedViewport</var>’s <code>width</code> multiplied by <var>scale</var>.</p>"
        },
        {
          "html": "<p>If <var>glViewport</var>’s <code>width</code> is less than 1, set it to 1.</p>"
        },
        {
          "html": "<p>Set <var>glViewport</var>’s <code>height</code> to an integer value less than or equal to <var>glFullSizedViewport</var>’s <code>height</code> multiplied by <var>scale</var>.</p>"
        },
        {
          "html": "<p>If <var>glViewport</var>’s <code>height</code> is less than 1, set it to 1.</p>"
        },
        {
          "html": "<p>Set <var>glViewport</var>’s <code>x</code> component to an integer value between <var>glFullSizedViewport</var>’s <code>x</code> component (inclusive) and <var>glFullSizedViewport</var>’s <code>x</code> component plus <var>glFullSizedViewport</var>’s <code>width</code> minus <var>glViewport</var>’s <code>width</code> (inclusive).</p>"
        },
        {
          "html": "<p>Set <var>glViewport</var>’s <code>y</code> component to a integer value between <var>glFullSizedViewport</var>’s <code>y</code> component (inclusive) and <var>glFullSizedViewport</var>’s <code>y</code> component plus <var>glFullSizedViewport</var>’s <code>height</code> minus <var>glViewport</var>’s <code>height</code> (inclusive).</p>"
        },
        {
          "html": "<p>Let <var>viewport</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewport\" id=\"ref-for-xrviewport①\">XRViewport</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑨\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-x\" id=\"ref-for-dom-xrviewport-x\">x</a></code> to <var>glViewport</var>’s <code>x</code> component.</p>"
        },
        {
          "html": "<p>Initialize <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-y\" id=\"ref-for-dom-xrviewport-y\">y</a></code> to <var>glViewport</var>’s <code>y</code> component.</p>"
        },
        {
          "html": "<p>Initialize <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-width\" id=\"ref-for-dom-xrviewport-width\">width</a></code> to <var>glViewport</var>’s <code>width</code>.</p>"
        },
        {
          "html": "<p>Initialize <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-height\" id=\"ref-for-dom-xrviewport-height\">height</a></code> to <var>glViewport</var>’s <code>height</code>.</p>"
        },
        {
          "html": "<p>Return <var>viewport</var>.</p>"
        }
      ]
    },
    {
      "name": "normalize",
      "href": "https://immersive-web.github.io/webxr/#normalize",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"normalize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">normalize</dfn> a list of components the UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>length</var> be the square root of the sum of the squares of each component.</p>"
        },
        {
          "html": "<p>If <var>length</var> is <code>0</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①②\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Divide each component by <var>length</var> and set the component.</p>"
        }
      ]
    },
    {
      "name": "construct-rigid-transform",
      "href": "https://immersive-web.github.io/webxr/#dom-xrrigidtransform-xrrigidtransform",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRRigidTransform\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"XRRigidTransform(position, orientation)|constructor(position, orientation)|XRRigidTransform(position)|constructor(position)|XRRigidTransform()|constructor()\" id=\"dom-xrrigidtransform-xrrigidtransform\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>XRRigidTransform(<var>position</var>, <var>orientation</var>)</code></dfn> constructor MUST perform the following steps when invoked:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>transform</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform①⓪\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current\" id=\"ref-for-current\">current realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position⑥\">position</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dompointreadonly\" id=\"ref-for-dompointreadonly⑥\">DOMPointReadOnly</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current\" id=\"ref-for-current①\">current realm</a>.</p>"
        },
        {
          "html": "<p>If <var>position</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-w\" id=\"ref-for-dom-dompointreadonly-w①\">w</a></code> value is not <code>1.0</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If one or more of <var>position</var>’s or <var>orientation</var>’s values is <code>NaN</code> or another non-finite number such as <code>infinity</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Set <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position⑦\">position</a></code>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-x\" id=\"ref-for-dom-dompointreadonly-x\">x</a></code> value to <var>position</var>’s x dictionary member, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-y\" id=\"ref-for-dom-dompointreadonly-y①\">y</a></code> value to <var>position</var>’s y dictionary member, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-z\" id=\"ref-for-dom-dompointreadonly-z\">z</a></code> value to <var>position</var>’s z dictionary member and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-w\" id=\"ref-for-dom-dompointreadonly-w②\">w</a></code> value to <var>position</var>’s w dictionary member.</p>"
        },
        {
          "html": "<p>Let <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation⑥\">orientation</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dompointreadonly\" id=\"ref-for-dompointreadonly⑦\">DOMPointReadOnly</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current\" id=\"ref-for-current②\">current realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation⑦\">orientation</a></code>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-x\" id=\"ref-for-dom-dompointreadonly-x①\">x</a></code> value to <var>orientation</var>’s x dictionary member, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-y\" id=\"ref-for-dom-dompointreadonly-y②\">y</a></code> value to <var>orientation</var>’s y dictionary member, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-z\" id=\"ref-for-dom-dompointreadonly-z①\">z</a></code> value to <var>orientation</var>’s z dictionary member and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-w\" id=\"ref-for-dom-dompointreadonly-w③\">w</a></code> value to <var>orientation</var>’s w dictionary member.</p>"
        },
        {
          "html": "<p>Let <var>transform</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform-internal-matrix\" id=\"ref-for-xrrigidtransform-internal-matrix\">internal matrix</a> be <code>null</code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#normalize\" id=\"ref-for-normalize\">Normalize</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-x\" id=\"ref-for-dom-dompointreadonly-x②\">x</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-y\" id=\"ref-for-dom-dompointreadonly-y③\">y</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-z\" id=\"ref-for-dom-dompointreadonly-z②\">z</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dom-dompointreadonly-w\" id=\"ref-for-dom-dompointreadonly-w④\">w</a></code> components of <var>transform</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation⑧\">orientation</a></code>.</p>"
        },
        {
          "html": "<p>Return <var>transform</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain-xrrigidtransform-matrix",
      "href": "https://immersive-web.github.io/webxr/#xrrigidtransform-obtain-the-matrix",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRRigidTransform\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xrrigidtransform-obtain-the-matrix\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain the matrix</dfn> for a given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform①②\">XRRigidTransform</a></code> <var>transform</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>transform</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform-internal-matrix\" id=\"ref-for-xrrigidtransform-internal-matrix①\">internal matrix</a> is not <code>null</code>, perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the operation <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.es/ecma262/#sec-isdetachedbuffer\" id=\"ref-for-sec-isdetachedbuffer①\">IsDetachedBuffer</a></code> on <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform-internal-matrix\" id=\"ref-for-xrrigidtransform-internal-matrix②\">internal matrix</a> is <code>false</code>, return <var>transform</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform-internal-matrix\" id=\"ref-for-xrrigidtransform-internal-matrix③\">internal matrix</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>translation</var> be a new <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#matrix\" id=\"ref-for-matrix④\">matrix</a> which is a column-vector translation matrix corresponding to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position①②\">position</a></code>. Mathematically, if <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position①③\">position</a></code> is <code>(x, y, z)</code>, this matrix is</p>\n      <p><img alt=\"Mathematical expression for column-vector translation matrix\" height=\"5386\" src=\"https://immersive-web.github.io/webxr/images/translation_matrix.svg\" style=\"height: 6em; width: auto;\" width=\"6733\"></p>"
        },
        {
          "html": "<p>Let <var>rotation</var> be a new <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#matrix\" id=\"ref-for-matrix⑤\">matrix</a> which is a column-vector rotation matrix corresponding to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation①③\">orientation</a></code>. Mathematically, if <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation①④\">orientation</a></code> is the unit quaternion (<code>q<sub>x</sub>, q<sub>y</sub>, q<sub>z</sub>, q<sub>w</sub></code>), this matrix is</p>\n      <p><img alt=\"Mathematical expression for column-vector rotation matrix\" height=\"5817\" src=\"https://immersive-web.github.io/webxr/images/rotation_matrix.svg\" style=\"height: 6em; width: auto\" width=\"24008\"></p>"
        },
        {
          "html": "<p>Set <var>transform</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform-internal-matrix\" id=\"ref-for-xrrigidtransform-internal-matrix④\">internal matrix</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑥\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Float32Array\" id=\"ref-for-idl-Float32Array⑤\">Float32Array</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⓪\">relevant realm</a> of <var>transform</var> set to the result of multiplying <var>translation</var> and <var>rotation</var> with <var>translation</var> on the left (<code>translation * rotation</code>) in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②①\">relevant realm</a> of <var>transform</var>. Mathematically, this matrix is</p>\n      <p><img alt=\"Mathematical expression for matrix of multiplying translation and rotation with translation on the left\" height=\"5817\" src=\"https://immersive-web.github.io/webxr/images/rigid_matrix.svg\" style=\"height: 6em; width: auto\" width=\"24080\"></p>"
        },
        {
          "html": "<p>Return <var>transform</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform-internal-matrix\" id=\"ref-for-xrrigidtransform-internal-matrix⑤\">internal matrix</a>.</p>"
        }
      ]
    },
    {
      "name": "multiply transforms",
      "href": "https://immersive-web.github.io/webxr/#multiply-transforms",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"multiply transforms\" data-noexport=\"\" id=\"multiply-transforms\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">multiply two <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform①⑦\">XRRigidTransform</a></code>s</dfn>, <var>B</var> and <var>A</var> in a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#realm\" id=\"ref-for-realm\">Realm</a> <var>realm</var>, the UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑦\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform①⑧\">XRRigidTransform</a></code> object in <var>realm</var>.</p>"
        },
        {
          "html": "<p>Set <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-matrix\" id=\"ref-for-dom-xrrigidtransform-matrix①\">matrix</a></code> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑧\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Float32Array\" id=\"ref-for-idl-Float32Array⑥\">Float32Array</a></code> in <var>realm</var>, the result of premultiplying <var>B</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-matrix\" id=\"ref-for-dom-xrrigidtransform-matrix②\">matrix</a></code> from the left onto <var>A</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-matrix\" id=\"ref-for-dom-xrrigidtransform-matrix③\">matrix</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation①⑥\">orientation</a></code> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑨\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dompointreadonly\" id=\"ref-for-dompointreadonly⑧\">DOMPointReadOnly</a></code> in <var>realm</var>, the quaternion that describes the rotation indicated by the top left 3x3 sub-matrix of <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-matrix\" id=\"ref-for-dom-xrrigidtransform-matrix④\">matrix</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position①⑤\">position</a></code> to  a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⓪\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geometry-1/#dompointreadonly\" id=\"ref-for-dompointreadonly⑨\">DOMPointReadOnly</a></code> in <var>realm</var>, the vector given by the fourth column of <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-matrix\" id=\"ref-for-dom-xrrigidtransform-matrix⑤\">matrix</a></code>.</p>"
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "on-input-start",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source①⑦\">XR input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⓪⑦\">XRSession</a></code> <var>session</var> begins its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action⑤\">primary action</a> the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②⓪\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②②\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session⑥\">session</a></code> <var>session</var> with <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time④\">time</a> being the time the action occurred.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①⑨\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event\">fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-selectstart\" id=\"ref-for-eventdef-xrsession-selectstart②\">selectstart</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
        }
      ]
    },
    {
      "name": "on-input-end",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source①⑧\">XR input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⓪⑧\">XRSession</a></code> <var>session</var> ends its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action⑥\">primary action</a> the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②①\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②③\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session⑦\">session</a></code> <var>session</var> with <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time⑤\">time</a> being the time the action occurred.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②⓪\">Queue a task</a> to perform the following steps:",
          "rationale": "fire",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event①\">Fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-select\" id=\"ref-for-eventdef-xrsession-select③\">select</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event②\">Fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-selectend\" id=\"ref-for-eventdef-xrsession-selectend②\">selectend</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "on-squeeze-start",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②⓪\">XR input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⓪⑨\">XRSession</a></code> <var>session</var> begins its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-squeeze-action\" id=\"ref-for-primary-squeeze-action④\">primary squeeze action</a> the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②②\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②④\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session⑧\">session</a></code> <var>session</var> with <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time⑥\">time</a> being the time the action occurred.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②①\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event③\">fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-squeezestart\" id=\"ref-for-eventdef-xrsession-squeezestart②\">squeezestart</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
        }
      ]
    },
    {
      "name": "on-squeeze-end",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②①\">XR input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①①⓪\">XRSession</a></code> <var>session</var> ends its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-squeeze-action\" id=\"ref-for-primary-squeeze-action⑤\">primary squeeze action</a> the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②③\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑤\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session⑨\">session</a></code> <var>session</var> with <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time⑦\">time</a> being the time the action occurred.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②②\">Queue a task</a> to perform the following steps:",
          "rationale": "fire",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event④\">Fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-squeeze\" id=\"ref-for-eventdef-xrsession-squeeze②\">squeeze</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event⑤\">Fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-squeezeend\" id=\"ref-for-eventdef-xrsession-squeezeend②\">squeezeend</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "on-input-cancelled",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②③\">XR input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①①①\">XRSession</a></code> <var>session</var> has its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action⑨\">primary action</a> cancelled the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②④\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑥\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session①⓪\">session</a></code> <var>session</var> with <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time⑧\">time</a> being the time the action occurred.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②③\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event⑥\">fire an input source event</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceevent\" id=\"ref-for-xrinputsourceevent\">XRInputSourceEvent</a></code> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-selectend\" id=\"ref-for-eventdef-xrsession-selectend③\">selectend</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
        }
      ]
    },
    {
      "name": "on-squeeze-cancelled",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②④\">XR input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①①②\">XRSession</a></code> <var>session</var> has its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-squeeze-action\" id=\"ref-for-primary-squeeze-action⑧\">primary squeeze action</a> cancelled the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑥\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②⑤\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑦\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session①①\">session</a></code> <var>session</var> with <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-time\" id=\"ref-for-xrframe-time⑨\">time</a> being the time the action occurred.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②④\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event⑦\">fire an input source event</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceevent\" id=\"ref-for-xrinputsourceevent①\">XRInputSourceEvent</a></code> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-squeezeend\" id=\"ref-for-eventdef-xrsession-squeezeend③\">squeezeend</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
        }
      ]
    },
    {
      "name": "on-transient-input-start",
      "html": "When a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-input-sources\" id=\"ref-for-transient-input-sources②\">transient input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①①④\">XRSession</a></code> <var>session</var> begins its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action②\">transient action</a> the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑦\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②⑥\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑧\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session①②\">session</a></code> <var>session</var> for the time the action occurred.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②⑤\">Queue a task</a> to perform the following steps:",
          "rationale": "fire",
          "steps": [
            {
              "html": "<p>Fire any <code>\"pointerdown\"</code> events produced by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②⑥\">XR input source</a>’s action, if necessary.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-add-input-source\" id=\"ref-for-xrsession-add-input-source①\">Add the XR input source</a> to the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources①⓪\">list of active XR input sources</a>.</p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action③\">transient action</a> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action①④\">primary action</a>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event⑧\">fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-selectstart\" id=\"ref-for-eventdef-xrsession-selectstart③\">selectstart</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "on-transient-input-end",
      "html": "When a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-input-sources\" id=\"ref-for-transient-input-sources③\">transient input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①①⑤\">XRSession</a></code> <var>session</var> ends its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action④\">transient action</a> the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑧\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②⑦\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑨\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session①③\">session</a></code> <var>session</var> for the time the action occurred.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②⑥\">Queue a task</a> to perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action⑤\">transient action</a> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action①⑤\">primary action</a>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event⑨\">fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-select\" id=\"ref-for-eventdef-xrsession-select④\">select</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            },
            {
              "html": "<p>Fire any <code>\"click\"</code> events produced by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②⑦\">XR input source</a>’s action, if necessary.</p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action⑥\">transient action</a> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action①⑥\">primary action</a>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event①⓪\">fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-selectend\" id=\"ref-for-eventdef-xrsession-selectend④\">selectend</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-remove-input-source\" id=\"ref-for-xrsession-remove-input-source①\">Remove the XR input source</a> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources①①\">list of active XR input sources</a>.</p>"
            },
            {
              "html": "<p>Fire any <code>\"pointerup\"</code> events produced by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②⑧\">XR input source</a>’s action, if necessary.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "on-transient-input-cancelled",
      "html": "When a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-input-sources\" id=\"ref-for-transient-input-sources④\">transient input source</a> <var>source</var> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①①⑥\">XRSession</a></code> <var>session</var> has its <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action⑦\">transient action</a> cancelled the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frame</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑨\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe②⑧\">XRFrame</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⓪\">relevant realm</a> of <var>session</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session①④\">session</a></code> <var>session</var> for the time the action occurred.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②⑦\">Queue a task</a> to perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#transient-action\" id=\"ref-for-transient-action⑧\">transient action</a> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-action\" id=\"ref-for-primary-action①⑦\">primary action</a>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#fire-an-input-source-event\" id=\"ref-for-fire-an-input-source-event①①\">fire an input source event</a> with name <code class=\"idl\"><a class=\"idl-code\" data-link-type=\"event\" href=\"https://immersive-web.github.io/webxr/#eventdef-xrsession-selectend\" id=\"ref-for-eventdef-xrsession-selectend⑤\">selectend</a></code>, frame <var>frame</var>, and source <var>source</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-remove-input-source\" id=\"ref-for-xrsession-remove-input-source②\">Remove the XR input source</a> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-active-xr-input-sources\" id=\"ref-for-list-of-active-xr-input-sources①②\">list of active XR input sources</a>.</p>"
            },
            {
              "html": "<p>Fire any <code>\"pointerup\"</code> events produced by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-input-source\" id=\"ref-for-xr-input-source②⑨\">XR input source</a>’s action, if necessary.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "construct-webgl-layer",
      "href": "https://immersive-web.github.io/webxr/#dom-xrwebgllayer-xrwebgllayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLLayer\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"XRWebGLLayer(session, context, layerInit)|constructor(session, context, layerInit)|XRWebGLLayer(session, context)|constructor(session, context)\" id=\"dom-xrwebgllayer-xrwebgllayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>XRWebGLLayer(<var>session</var>, <var>context</var>, <var>layerInit</var>)</code></dfn> constructor MUST perform the following steps when invoked:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⓪\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer\" id=\"ref-for-xrwebgllayer①②\">XRWebGLLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③①\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended⑥\">ended</a> value is <code>true</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①③\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①④\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var> is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session②⑦\">immersive session</a> and <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible①\">XR compatible</a> boolean is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑤\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-context\" id=\"ref-for-xrwebgllayer-context①\">context</a> to <var>context</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-session\" id=\"ref-for-xrwebgllayer-session\">session</a> to <var>session</var>.</p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-ignoredepthvalues\" id=\"ref-for-dom-xrwebgllayer-ignoredepthvalues①\">ignoreDepthValues</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If layerInit’s ignoreDepthValues value is false and the XR Compositor will make use of depth values:",
                  "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-ignoredepthvalues\" id=\"ref-for-dom-xrwebgllayer-ignoredepthvalues②\">ignoreDepthValues</a></code> to <code>false</code>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-ignoredepthvalues\" id=\"ref-for-dom-xrwebgllayer-ignoredepthvalues③\">ignoreDepthValues</a></code> to <code>true</code>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-composition-enabled\" id=\"ref-for-xrwebgllayer-composition-enabled①\">composition enabled</a> boolean as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If session is an inline session:",
                  "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-composition-enabled\" id=\"ref-for-xrwebgllayer-composition-enabled②\">composition enabled</a> to <code>false</code>.</p>"
                },
                {
                  "case": "Otherwise:",
                  "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-composition-enabled\" id=\"ref-for-xrwebgllayer-composition-enabled③\">composition enabled</a> boolean to <code>true</code>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<dl class=\"switch\">\n       <dt data-md=\"\">If <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-composition-enabled\" id=\"ref-for-xrwebgllayer-composition-enabled④\">composition enabled</a> boolean is <code>true</code>:\n       </dt><dd data-md=\"\">\n        \n       </dd><dt data-md=\"\">Otherwise:\n       </dt><dd data-md=\"\">\n        \n      </dd></dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If layer’s composition enabled boolean is true:",
                  "html": "",
                  "rationale": "initialize",
                  "steps": [
                    {
                      "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-antialias\" id=\"ref-for-dom-xrwebgllayer-antialias①\">antialias</a></code> to <var>layerInit</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayerinit-antialias\" id=\"ref-for-dom-xrwebgllayerinit-antialias\">antialias</a></code> value.</p>"
                    },
                    {
                      "html": "<p>Let <var>scaleFactor</var> be <var>layerInit</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayerinit-framebufferscalefactor\" id=\"ref-for-dom-xrwebgllayerinit-framebufferscalefactor\">framebufferScaleFactor</a></code>.</p>"
                    },
                    {
                      "html": "<p>The user agent MAY choose to clamp or round <var>scaleFactor</var> as it sees fit here, for example if it wishes to fit the buffer dimensions into a power of two for performance reasons.</p>"
                    },
                    {
                      "html": "<p>Let <var>framebufferSize</var> be the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#recommended-webgl-framebuffer-resolution\" id=\"ref-for-recommended-webgl-framebuffer-resolution\">recommended WebGL framebuffer resolution</a> with width and height separately multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-framebuffer\" id=\"ref-for-dom-xrwebgllayer-framebuffer①\">framebuffer</a></code> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLFramebuffer\" id=\"ref-for-WebGLFramebuffer①\">WebGLFramebuffer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③②\">relevant realm</a> of <var>context</var>, which is an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#opaque-framebuffer\" id=\"ref-for-opaque-framebuffer\">opaque framebuffer</a> with the dimensions <var>framebufferSize</var> created with <var>context</var>, <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#opaque-framebuffer-session\" id=\"ref-for-opaque-framebuffer-session\">session</a> initialized to <var>session</var>, and <var>layerInit</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayerinit-depth\" id=\"ref-for-dom-xrwebgllayerinit-depth\">depth</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayerinit-stencil\" id=\"ref-for-dom-xrwebgllayerinit-stencil\">stencil</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayerinit-alpha\" id=\"ref-for-dom-xrwebgllayerinit-alpha\">alpha</a></code> values.</p>"
                    },
                    {
                      "html": "<p>Allocate and initialize resources compatible with <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device②⑦\">XR device</a>, including GPU accessible memory buffers, as required to support the compositing of <var>layer</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>layer</var>’s resources were unable to be created for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror\">OperationError</a></code> and abort these steps.</p>"
                    }
                  ]
                },
                {
                  "case": "Otherwise:",
                  "html": "",
                  "rationale": "initialize",
                  "steps": [
                    {
                      "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-antialias\" id=\"ref-for-dom-xrwebgllayer-antialias②\">antialias</a></code> to <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-context\" id=\"ref-for-dom-xrwebgllayer-context\">context</a></code>’s <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#actual-context-parameters\" id=\"ref-for-actual-context-parameters\">actual context parameters</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLContextAttributes\" id=\"ref-for-WebGLContextAttributes\">antialias</a></code> value.</p>"
                    },
                    {
                      "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrwebgllayer-framebuffer\" id=\"ref-for-dom-xrwebgllayer-framebuffer②\">framebuffer</a></code> to <code>null</code>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "get-viewport",
      "href": "https://immersive-web.github.io/webxr/#dom-xrwebgllayer-getviewport",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLLayer\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrwebgllayer-getviewport\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getViewport(<var>view</var>)</code></dfn> method, when invoked on an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer\" id=\"ref-for-xrwebgllayer②⑦\">XRWebGLLayer</a></code> <var>layer</var>, MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-session\" id=\"ref-for-xrview-session①\">session</a>.</p>"
        },
        {
          "html": "<p>Let <var>frame</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-animation-frame\" id=\"ref-for-xrsession-animation-frame①\">animation frame</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> is not equal to <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-session\" id=\"ref-for-xrwebgllayer-session①\">session</a>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑥\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active④\">active</a> boolean is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑦\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-frame\" id=\"ref-for-xrview-frame①\">frame</a> is not equal to <var>frame</var>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑧\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-viewport-modifiable\" id=\"ref-for-view-viewport-modifiable①\">viewport modifiable</a> flag is <code>true</code> and <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-requested-viewport-scale\" id=\"ref-for-view-requested-viewport-scale③\">requested viewport scale</a> is not equal to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-current-viewport-scale\" id=\"ref-for-view-current-viewport-scale①\">current viewport scale</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-current-viewport-scale\" id=\"ref-for-view-current-viewport-scale②\">current viewport scale</a> to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-requested-viewport-scale\" id=\"ref-for-view-requested-viewport-scale④\">requested viewport scale</a>.</p>"
            },
            {
              "html": "<p>In the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-viewport-objects\" id=\"ref-for-list-of-viewport-objects②\">list of viewport objects</a>, set the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewport\" id=\"ref-for-xrviewport⑧\">XRViewport</a></code> associated with <var>view</var> to the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewport\" id=\"ref-for-xrviewport⑨\">XRViewport</a></code> result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrview-obtain-a-scaled-viewport\" id=\"ref-for-xrview-obtain-a-scaled-viewport①\">obtaining a scaled viewport</a> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-full-sized-viewports\" id=\"ref-for-list-of-full-sized-viewports③\">list of full-sized viewports</a> associated with <var>view</var> for <var>session</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set the <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-viewport-modifiable\" id=\"ref-for-view-viewport-modifiable②\">viewport modifiable</a> flag to false.</p>"
        },
        {
          "html": "<p>Let <var>viewport</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewport\" id=\"ref-for-xrviewport①⓪\">XRViewport</a></code> from the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-viewport-objects\" id=\"ref-for-list-of-viewport-objects③\">list of viewport objects</a> associated with <var>view</var>.</p>"
        },
        {
          "html": "<p>Return <var>viewport</var>.</p>"
        }
      ]
    },
    {
      "name": "native-webgl-framebuffer-resolution",
      "html": "The <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#native-webgl-framebuffer-resolution\" id=\"ref-for-native-webgl-framebuffer-resolution\">native WebGL framebuffer resolution</a> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①②⑤\">XRSession</a></code> <var>session</var> is determined by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-mode\" id=\"ref-for-xrsession-mode⑤\">mode</a> value is not <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessionmode-inline\" id=\"ref-for-dom-xrsessionmode-inline②⓪\">\"inline\"</a></code>, set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#native-webgl-framebuffer-resolution\" id=\"ref-for-native-webgl-framebuffer-resolution①\">native WebGL framebuffer resolution</a> to the resolution required to have a 1:1 ratio between the pixels of a framebuffer large enough to contain all of the session’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrview\" id=\"ref-for-xrview①⑥\">XRView</a></code>s and the physical screen pixels in the area of the display under the highest magnification and abort these steps. If no method exists to determine the native resolution as described, the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#recommended-webgl-framebuffer-resolution\" id=\"ref-for-recommended-webgl-framebuffer-resolution①\">recommended WebGL framebuffer resolution</a> MAY be used.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-mode\" id=\"ref-for-xrsession-mode⑥\">mode</a> value is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsessionmode-inline\" id=\"ref-for-dom-xrsessionmode-inline②①\">\"inline\"</a></code>, set the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#native-webgl-framebuffer-resolution\" id=\"ref-for-native-webgl-framebuffer-resolution②\">native WebGL framebuffer resolution</a> to the size of the <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate⑥\">renderState</a></code>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-output-canvas\" id=\"ref-for-xrrenderstate-output-canvas⑨\">output canvas</a> in physical display pixels and reevaluate these steps every time the size of the canvas changes or the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate-output-canvas\" id=\"ref-for-xrrenderstate-output-canvas①⓪\">output canvas</a> is changed.</p>"
        }
      ]
    },
    {
      "name": "get-native-framebuffer-scale-factor",
      "href": "https://immersive-web.github.io/webxr/#dom-xrwebgllayer-getnativeframebufferscalefactor",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLLayer\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-xrwebgllayer-getnativeframebufferscalefactor\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getNativeFramebufferScaleFactor(<var>session</var>)</code></dfn> method, when invoked, MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-ended\" id=\"ref-for-xrsession-ended⑦\">ended</a> value is <code>true</code>, return <code>0.0</code> and abort these steps.</p>"
        },
        {
          "html": "<p>Return the value that the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#recommended-webgl-framebuffer-resolution\" id=\"ref-for-recommended-webgl-framebuffer-resolution③\">recommended WebGL framebuffer resolution</a> width and height must each be multiplied by to yield the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#native-webgl-framebuffer-resolution\" id=\"ref-for-native-webgl-framebuffer-resolution④\">native WebGL framebuffer resolution</a>.</p>"
        }
      ]
    },
    {
      "name": "make-xr-compatible",
      "href": "https://immersive-web.github.io/webxr/#dom-webglrenderingcontextbase-makexrcompatible",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"WebGLRenderingContextBase\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-webglrenderingcontextbase-makexrcompatible\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>makeXRCompatible()</code></dfn> method ensures the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContextBase\" id=\"ref-for-WebGLRenderingContextBase⑥\">WebGLRenderingContextBase</a></code> is running on a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#compatible-graphics-adapter\" id=\"ref-for-compatible-graphics-adapter⑤\">compatible graphics adapter</a> for the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-xr-device\" id=\"ref-for-immersive-xr-device③①\">immersive XR device</a>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the requesting document’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin②\">origin</a> is not allowed to use the \"xr-spatial-tracking\" <a href=\"https://immersive-web.github.io/webxr/#permissions-policy\">permissions policy</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①①\">resolve</a> <var>promise</var> and return it. </p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑤\">a new Promise</a> created in the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#realm\" id=\"ref-for-realm①\">Realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContextBase\" id=\"ref-for-WebGLRenderingContextBase⑦\">WebGLRenderingContextBase</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>device</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#ensure-an-immersive-xr-device-is-selected\" id=\"ref-for-ensure-an-immersive-xr-device-is-selected④\">ensuring an immersive XR device is selected</a>.</p>"
            },
            {
              "html": "Set <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible⑦\">XR compatible</a> boolean as follows:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If context’s WebGL context lost flag is set:",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②⑧\">Queue a task</a> to set <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible⑧\">XR compatible</a> boolean to <code>false</code> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①②\">reject</a> <var>promise</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑨\">InvalidStateError</a></code>.</p>"
                    },
                    {
                      "case": "If device is null:",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②⑨\">Queue a task</a> to set <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible⑨\">XR compatible</a> boolean to <code>false</code> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①③\">reject</a> <var>promise</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⓪\">InvalidStateError</a></code>.</p>"
                    },
                    {
                      "case": "If context’s XR compatible boolean is true:",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③⓪\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①②\">resolve</a> <var>promise</var>.</p>"
                    },
                    {
                      "case": "If context was created on a compatible graphics adapter for device:",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③①\">Queue a task</a> to set <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible①①\">XR compatible</a> boolean to <code>true</code> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①③\">resolve</a> <var>promise</var>.</p>"
                    },
                    {
                      "case": "Otherwise:",
                      "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③②\">Queue a task</a> on the <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15\" id=\"ref-for-5.15\">WebGL task source</a> to perform the following steps:",
                      "rationale": "handle",
                      "steps": [
                        {
                          "html": "<p>Force <var>context</var> to be lost.</p>"
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#CONTEXT_LOST\" id=\"ref-for-CONTEXT_LOST\">Handle the context loss</a> as described by the WebGL specification:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>canvas</var> be the <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#context-canvas\" id=\"ref-for-context-canvas\">canvas</a>.</p>"
                            },
                            {
                              "html": "<p>If <var>context</var>’s <a data-link-type=\"dfn\" data-refhint-key=\"7f51fd09\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#webgl-context-lost-flag\" id=\"ref-for-webgl-context-lost-flag①\">webgl context lost flag</a> is set, abort these steps.</p>"
                            },
                            {
                              "html": "<p>Set <var>context</var>’s <a data-link-type=\"dfn\" data-refhint-key=\"7f51fd09\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#webgl-context-lost-flag\" id=\"ref-for-webgl-context-lost-flag②\">webgl context lost flag</a>.</p>"
                            },
                            {
                              "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#webgl-object-invalidated-flag\" id=\"ref-for-webgl-object-invalidated-flag\">invalidated</a> flag of each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLObject\" id=\"ref-for-WebGLObject\">WebGLObject</a></code> instance created by <var>context</var>.</p>"
                            },
                            {
                              "html": "<p>Disable all extensions except \"WEBGL_lose_context\".</p>"
                            },
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③③\">Queue a task</a> on the <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15\" id=\"ref-for-5.15①\">WebGL task source</a> to perform the following steps:",
                              "rationale": "fire",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#fire-a-webgl-context-event\" id=\"ref-for-fire-a-webgl-context-event\">Fire a WebGL context event</a> <var>e</var> named \"webglcontextlost\" at <var>canvas</var>, with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.1\" id=\"ref-for-5.15.1\">statusMessage</a></code> set to \"\".</p>"
                                },
                                {
                                  "html": "<p>If <var>e</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#canceled-flag\" id=\"ref-for-canceled-flag\">canceled flag</a> is not set, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①④\">reject</a> <var>promise</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror\">AbortError</a></code> and abort these steps.</p>"
                                },
                                {
                                  "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑨\">in parallel</a>.",
                                  "rationale": "queue",
                                  "steps": [
                                    {
                                      "html": "<p>Await a restorable drawing buffer on a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#compatible-graphics-adapter\" id=\"ref-for-compatible-graphics-adapter⑦\">compatible graphics adapter</a> for <var>device</var>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③④\">Queue a task</a> on the <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15\" id=\"ref-for-5.15②\">WebGL task source</a> to perform the following steps:",
                                      "rationale": "restore",
                                      "steps": [
                                        {
                                          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#restore-the-drawing-buffer\" id=\"ref-for-restore-the-drawing-buffer\">Restore the context</a> on a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#compatible-graphics-adapter\" id=\"ref-for-compatible-graphics-adapter⑧\">compatible graphics adapter</a> for <var>device</var>.</p>"
                                        },
                                        {
                                          "html": "<p>Set <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible①②\">XR compatible</a> boolean to <code>true</code>.</p>"
                                        },
                                        {
                                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①④\">Resolve</a> <var>promise</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "webgl-context-lost",
      "html": "Additionally, when any WebGL <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#CONTEXT_LOST\" id=\"ref-for-CONTEXT_LOST①\">context is lost</a> run the following steps prior to firing the \"webglcontextlost\" event:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set the context’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-compatible\" id=\"ref-for-xr-compatible①③\">XR compatible</a> boolean to <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "fire-input-source-event",
      "href": "https://immersive-web.github.io/webxr/#fire-an-input-source-event",
      "html": "When the user agent has to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fire-an-input-source-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fire an input source event</dfn> with name <var>name</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe③③\">XRFrame</a></code> <var>frame</var>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsource\" id=\"ref-for-xrinputsource②⑦\">XRInputSource</a></code> <var>source</var> it MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Create an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrinputsourceevent\" id=\"ref-for-xrinputsourceevent③\">XRInputSourceEvent</a></code> <var>event</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-type\" id=\"ref-for-dom-event-type\">type</a></code> <var>name</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceevent-frame\" id=\"ref-for-dom-xrinputsourceevent-frame②\">frame</a></code> <var>frame</var>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrinputsourceevent-inputsource\" id=\"ref-for-dom-xrinputsourceevent-inputsource①\">inputSource</a></code> <var>source</var>.</p>"
        },
        {
          "html": "<p>Set <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active⑤\">active</a> boolean to <code>true</code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-apply-frame-updates\" id=\"ref-for-xrframe-apply-frame-updates①\">Apply frame updates</a> for <var>frame</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-dispatch\" id=\"ref-for-concept-event-dispatch\">Dispatch</a> <var>event</var> on <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session①⑤\">session</a></code></p>"
        },
        {
          "html": "<p>Set <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active⑥\">active</a> boolean to <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "immersive-session-allowed",
      "href": "https://immersive-web.github.io/webxr/#immersive-session-request-is-allowed",
      "html": "To determine if an <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"immersive-session-request-is-allowed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">immersive session request is allowed</dfn> for a given <var>global object</var> the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the request was not made while the <var>global object</var> has <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation③\">transient activation</a> or when <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#launching-a-web-application\" id=\"ref-for-launching-a-web-application\">launching a web application</a>, return <code>false</code></p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#user-intent\" id=\"ref-for-user-intent①①\">user intent</a> to begin an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#immersive-session\" id=\"ref-for-immersive-session③③\">immersive session</a> is not well understood, either via <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#explicit-consent\" id=\"ref-for-explicit-consent⑧\">explicit consent</a> or <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#implicit-consent\" id=\"ref-for-implicit-consent②\">implicit consent</a>, return <code>false</code></p>"
        },
        {
          "html": "<p>Return <code>true</code></p>"
        }
      ]
    },
    {
      "name": "inline-session-allowed",
      "href": "https://immersive-web.github.io/webxr/#inline-session-request-is-allowed",
      "html": "To determine if an <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"inline-session-request-is-allowed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">inline session request is allowed</dfn> for a given <var>global object</var> the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the session request contained any <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#required-features\" id=\"ref-for-required-features②\">required features</a> or <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#optional-features\" id=\"ref-for-optional-features①\">optional features</a> and the request was not made while the <var>global object</var> has <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation④\">transient activation</a> or when <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#launching-a-web-application\" id=\"ref-for-launching-a-web-application①\">launching a web application</a>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>If the <var>global object</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window⑥\">Window</a></code>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>Return <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "poses-allowed",
      "href": "https://immersive-web.github.io/webxr/#poses-may-be-reported",
      "html": "To determine if <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"poses-may-be-reported\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">poses may be reported</dfn> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⑤②\">XRSession</a></code> <var>session</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a> is not the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object\" id=\"ref-for-current-global-object\">current global object</a>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-visibilitystate\" id=\"ref-for-dom-xrsession-visibilitystate②\">visibilityState</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrvisibilitystate-hidden\" id=\"ref-for-dom-xrvisibilitystate-hidden①\">\"hidden\"</a></code>, return <code>false</code>.</p>"
        },
        {
          "html": "Determine if the pose data can be returned as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the pose data is known by the user agent to not expose fingerprintable sensor data",
                  "html": "<p>Return <code>true</code>.</p>"
                },
                {
                  "case": "If data adjustments will be applied to the underlying sensor data to prevent fingerprinting or profiling",
                  "html": "<p>Return <code>true</code>.</p>"
                },
                {
                  "case": "If user intent is well understood, either via explicit consent or implicit consent",
                  "html": "<p>Return <code>true</code>.</p>"
                },
                {
                  "case": "Otherwise",
                  "html": "<p>Return <code>false</code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "poses-limited",
      "href": "https://immersive-web.github.io/webxr/#poses-must-be-limited",
      "html": "To determine if <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"poses-must-be-limited\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">poses must be limited</dfn> between two spaces, <var>space</var> and <var>baseSpace</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If either <var>space</var> or <var>baseSpace</var> are an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrboundedreferencespace\" id=\"ref-for-xrboundedreferencespace①③\">XRBoundedReferenceSpace</a></code> and the other space’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-native-origin\" id=\"ref-for-xrspace-native-origin②①\">native origin</a> falls further outside the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrboundedreferencespace-native-bounds-geometry\" id=\"ref-for-xrboundedreferencespace-native-bounds-geometry⑥\">native bounds geometry</a> than a reasonable distance determined by the user agent, return true.</p>"
        },
        {
          "html": "<p>If either <var>space</var> or <var>baseSpace</var> are an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace③⑦\">XRReferenceSpace</a></code> with a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type③\">type</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-local\" id=\"ref-for-dom-xrreferencespacetype-local①⓪\">\"local\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-local-floor\" id=\"ref-for-dom-xrreferencespacetype-local-floor①⓪\">\"local-floor\"</a></code> and the distance between the spaces' <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-native-origin\" id=\"ref-for-xrspace-native-origin②②\">native origins</a> is greater than a reasonable distance determined by the user agent, return <code>true</code>.</p>"
        },
        {
          "html": "<p>Return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "xr-permission-query-algorithm",
      "html": "To query the \"xr\" permission with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrpermissiondescriptor\" id=\"ref-for-dictdef-xrpermissiondescriptor③\">XRPermissionDescriptor</a></code> <var>descriptor</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpermissionstatus\" id=\"ref-for-xrpermissionstatus②\">XRPermissionStatus</a></code> <var>status</var>, the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state①\">state</a></code> to <var>descriptor</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" id=\"ref-for-dfn-permission-state\">permission state</a>.</p>"
        },
        {
          "html": "<p>If <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state②\">state</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied②\">\"denied\"</a></code>, set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissionstatus-granted\" id=\"ref-for-dom-xrpermissionstatus-granted①\">granted</a></code> to an empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array⑦\">FrozenArray</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#resolve-the-requested-features\" id=\"ref-for-resolve-the-requested-features①\">resolving the requested features</a> given <var>descriptor</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissiondescriptor-requiredfeatures\" id=\"ref-for-dom-xrpermissiondescriptor-requiredfeatures\">requiredFeatures</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissiondescriptor-optionalfeatures\" id=\"ref-for-dom-xrpermissiondescriptor-optionalfeatures\">optionalFeatures</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissiondescriptor-mode\" id=\"ref-for-dom-xrpermissiondescriptor-mode\">mode</a></code>.</p>"
        },
        {
          "html": "If <var>result</var> is <code>null</code>, run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissionstatus-granted\" id=\"ref-for-dom-xrpermissionstatus-granted②\">granted</a></code> to an empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array⑧\">FrozenArray</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state③\">state</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied③\">\"denied\"</a></code>.</p>"
            },
            {
              "html": "<p>Abort these steps.</p>"
            }
          ]
        },
        {
          "html": "<p>Let (<var>consentRequired</var>, <var>consentOptional</var>, <var>granted</var>) be the fields of <var>result</var>.</p>"
        },
        {
          "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissionstatus-granted\" id=\"ref-for-dom-xrpermissionstatus-granted③\">granted</a></code> to <var>granted</var>.</p>"
        },
        {
          "html": "<p>If <var>consentRequired</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is empty</a> and <var>consentOptional</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①\">is empty</a>, set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state④\">state</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\" id=\"ref-for-dom-permissionstate-granted\">\"granted\"</a></code> and abort these steps</p>"
        },
        {
          "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state⑤\">state</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-prompt\" id=\"ref-for-dom-permissionstate-prompt\">\"prompt\"</a></code>.</p>"
        }
      ]
    },
    {
      "name": "xr-permission-request-algorithm",
      "href": "https://immersive-web.github.io/webxr/#request-the-xr-permission",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"request the xr permission\" data-noexport=\"\" id=\"request-the-xr-permission\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">request the \"xr\" permission</dfn> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrpermissiondescriptor\" id=\"ref-for-dictdef-xrpermissiondescriptor④\">XRPermissionDescriptor</a></code> <var>descriptor</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrpermissionstatus\" id=\"ref-for-xrpermissionstatus③\">XRPermissionStatus</a></code> <var>status</var>, the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissionstatus-granted\" id=\"ref-for-dom-xrpermissionstatus-granted④\">granted</a></code> to an empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array⑨\">FrozenArray</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>requiredFeatures</var> be <var>descriptor</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissiondescriptor-requiredfeatures\" id=\"ref-for-dom-xrpermissiondescriptor-requiredfeatures①\">requiredFeatures</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>optionalFeatures</var> be <var>descriptor</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissiondescriptor-optionalfeatures\" id=\"ref-for-dom-xrpermissiondescriptor-optionalfeatures①\">optionalFeatures</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>device</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#obtain-the-current-device\" id=\"ref-for-obtain-the-current-device①\">obtaining the current device</a> for <var>mode</var>, <var>requiredFeatures</var>, and <var>optionalFeatures</var>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#resolve-the-requested-features\" id=\"ref-for-resolve-the-requested-features②\">resolving the requested features</a> given <var>requiredFeatures</var>,<var>optionalFeatures</var>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissiondescriptor-mode\" id=\"ref-for-dom-xrpermissiondescriptor-mode①\">mode</a></code>.</p>"
        },
        {
          "html": "If <var>result</var> is <code>null</code>, run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state⑥\">state</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied④\">\"denied\"</a></code>.</p>"
            },
            {
              "html": "<p>Abort these steps.</p>"
            }
          ]
        },
        {
          "html": "<p>Let (<var>consentRequired</var>, <var>consentOptional</var>, <var>granted</var>) be the fields of <var>result</var>.</p>"
        },
        {
          "html": "<p>The user agent MAY at this point ask the user’s permission for the calling algorithm to use any of the features in <var>consentRequired</var> and <var>consentOptional</var>. The results of these prompts should be included when determining if there is a clear signal of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#user-intent\" id=\"ref-for-user-intent①④\">user intent</a> for enabling these features.</p>"
        },
        {
          "html": "For each <var>feature</var> in <var>consentRequired</var> perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>The user agent MAY at this point ask the user’s permission for the calling algorithm to use <var>feature</var>. The results of these prompts should be included when determining if there is a clear signal of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#user-intent\" id=\"ref-for-user-intent①⑤\">user intent</a> to enable <var>feature</var>.</p>"
            },
            {
              "html": "<p>If a clear signal of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#user-intent\" id=\"ref-for-user-intent①⑥\">user intent</a> to enable <var>feature</var> has not been determined, set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state⑦\">state</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied⑤\">\"denied\"</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If <var>feature</var> is not in <var>granted</var>, append <var>feature</var> to <var>granted</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>feature</var> in <var>consentOptional</var> perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>The user agent MAY at this point ask the user’s permission for the calling algorithm to use <var>feature</var>. The results of these prompts should be included when determining if there is a clear signal of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#user-intent\" id=\"ref-for-user-intent①⑦\">user intent</a> to enable <var>feature</var>.</p>"
            },
            {
              "html": "<p>If a clear signal of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#user-intent\" id=\"ref-for-user-intent①⑧\">user intent</a> to enable <var>feature</var> has not been determined, continue to the next entry.</p>"
            },
            {
              "html": "<p>If <var>feature</var> is not in <var>granted</var>, append <var>feature</var> to <var>granted</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrpermissionstatus-granted\" id=\"ref-for-dom-xrpermissionstatus-granted⑤\">granted</a></code> to <var>granted</var>.</p>"
        },
        {
          "html": "<p>Add all elements of <var>granted</var> to <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-device-set-of-granted-features\" id=\"ref-for-xr-device-set-of-granted-features\">set of granted features</a> for <var>mode</var>.</p>"
        },
        {
          "html": "<p>Set <var>status</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state⑧\">state</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\" id=\"ref-for-dom-permissionstate-granted①\">\"granted\"</a></code>.</p>"
        }
      ]
    },
    {
      "name": "resolve-features",
      "href": "https://immersive-web.github.io/webxr/#resolve-the-requested-features",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"resolve-the-requested-features\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">resolve the requested features</dfn> given <var>requiredFeatures</var> and <var>optionalFeatures</var> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#enumdef-xrsessionmode\" id=\"ref-for-enumdef-xrsessionmode①⑦\">XRSessionMode</a></code> <var>mode</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>consentRequired</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑧\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①④\">DOMString</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>consentOptional</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑨\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①⑤\">DOMString</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>granted</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⓪\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①⑥\">DOMString</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>device</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#obtain-the-current-device\" id=\"ref-for-obtain-the-current-device②\">obtaining the current device</a> for <var>mode</var>, <var>requiredFeatures</var>, and <var>optionalFeatures</var>.</p>"
        },
        {
          "html": "<p>Let <var>previouslyEnabled</var> be <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xr-device-set-of-granted-features\" id=\"ref-for-xr-device-set-of-granted-features①\">set of granted features</a> for <var>mode</var>.</p>"
        },
        {
          "html": "If <var>device</var> is <code>null</code> or <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#list-of-supported-modes\" id=\"ref-for-list-of-supported-modes⑥\">list of supported modes</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑦\">contain</a> <var>mode</var>, run the following steps:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple\">tuple</a> (<var>consentRequired</var>, <var>consentOptional</var>, <var>granted</var>)</p>"
            }
          ]
        },
        {
          "html": "<p>Add every <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#feature-descriptor\" id=\"ref-for-feature-descriptor⑨\">feature descriptor</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#default-features\" id=\"ref-for-default-features①\">default features</a> table associated with <var>mode</var> to <var>granted</var> if it is not already present.</p>"
        },
        {
          "html": "For each <var>feature</var> in <var>requiredFeatures</var> perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <var>feature</var> is <code>null</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a> to the next entry.</p>"
            },
            {
              "html": "<p>If <var>feature</var> is not a valid <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#feature-descriptor\" id=\"ref-for-feature-descriptor①⓪\">feature descriptor</a>, return <code>null</code>.</p>"
            },
            {
              "html": "<p>If <var>feature</var> is already in <var>granted</var>, continue to the next entry.</p>"
            },
            {
              "html": "<p>If the requesting document’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin⑦\">origin</a> is not allowed to use any <a href=\"https://immersive-web.github.io/webxr/#permissions-policy\">permissions policy</a> required by <var>feature</var> as indicated by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#feature-requirements\" id=\"ref-for-feature-requirements①\">feature requirements</a> table, return <code>null</code>.</p>"
            },
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device②⑨\">XR device</a> is not <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#capable-of-supporting\" id=\"ref-for-capable-of-supporting①\">capable of supporting</a> the functionality described by <var>feature</var> or the user agent has otherwise determined to reject the feature, return <code>null</code>.</p>"
            },
            {
              "html": "<p>If the functionality described by <var>feature</var> requires <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#explicit-consent\" id=\"ref-for-explicit-consent①⑥\">explicit consent</a> and <var>feature</var> is not in <var>previouslyEnabled</var>, append it to <var>consentRequired</var>.</p>"
            },
            {
              "html": "<p>Else append <var>feature</var> to <var>granted</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>feature</var> in <var>optionalFeatures</var> perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <var>feature</var> is <code>null</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a> to the next entry.</p>"
            },
            {
              "html": "<p>If <var>feature</var> is not a valid <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#feature-descriptor\" id=\"ref-for-feature-descriptor①①\">feature descriptor</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a> to the next entry.</p>"
            },
            {
              "html": "<p>If <var>feature</var> is already in <var>granted</var>, continue to the next entry.</p>"
            },
            {
              "html": "<p>If the requesting document’s origin is not allowed to use any <a href=\"https://immersive-web.github.io/webxr/#permissions-policy\">permissions policy</a> required by <var>feature</var> as indicated by the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#feature-requirements\" id=\"ref-for-feature-requirements②\">feature requirements</a> table, continue to the next entry.</p>"
            },
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-xr-device\" id=\"ref-for-xrsession-xr-device③⓪\">XR device</a> is not <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#capable-of-supporting\" id=\"ref-for-capable-of-supporting②\">capable of supporting</a> the functionality described by <var>feature</var> or the user agent has otherwise determined to reject the feature, continue to the next entry.</p>"
            },
            {
              "html": "<p>If the functionality described by <var>feature</var> requires <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#explicit-consent\" id=\"ref-for-explicit-consent①⑦\">explicit consent</a> and <var>feature</var> is not in <var>previouslyEnabled</var>, append it to <var>consentOptional</var>.</p>"
            },
            {
              "html": "<p>Else append <var>feature</var> to <var>granted</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①\">tuple</a> <code>(|consentRequired|, |consentOptional|, |granted|)</code></p>"
        }
      ]
    }
  ]
}