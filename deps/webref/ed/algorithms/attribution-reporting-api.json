{
  "spec": {
    "title": "Attribution Reporting",
    "url": "https://wicg.github.io/attribution-reporting-api/"
  },
  "algorithms": [
    {
      "html": "add the step",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the element has an <code><a data-link-type=\"element-sub\" href=\"https://wicg.github.io/attribution-reporting-api/#element-attrdef-img-attributionsrc\" id=\"ref-for-element-attrdef-img-attributionsrc\">attributionsrc</a></code> attribute, set\n<var>request</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#request-attribution-reporting-eligibility\" id=\"ref-for-request-attribution-reporting-eligibility\">Attribution Reporting Eligibility</a> to\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source-or-trigger\" id=\"ref-for-eligibility-event-source-or-trigger①\">event-source-or-trigger</a></code>\".</p>"
        }
      ]
    },
    {
      "html": "add the step",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>Attribution Reporting eligibility</var> be\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source-or-trigger\" id=\"ref-for-eligibility-event-source-or-trigger②\">event-source-or-trigger</a></code>\" if <var>el</var> has an\n<code><a data-link-type=\"element-sub\" href=\"https://wicg.github.io/attribution-reporting-api/#element-attrdef-script-attributionsrc\" id=\"ref-for-element-attrdef-script-attributionsrc\">attributionsrc</a></code> content attribute and\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-unset\" id=\"ref-for-eligibility-unset①\">unset</a></code>\" otherwise.</p>"
        }
      ]
    },
    {
      "html": "add the steps",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>navigationSourceEligible</var> be false.</p>"
        },
        {
          "html": "If <var>subject</var> has an <code>attributionsrc</code> attribute:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>navigationSourceEligible</var> to true.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#make-background-attributionsrc-requests\" id=\"ref-for-make-background-attributionsrc-requests①\">Make background attributionsrc requests</a> with <var>subject</var> and\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-navigation-source\" id=\"ref-for-eligibility-navigation-source\">navigation-source</a></code>\", and <var>referrerPolicy</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "with the steps",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>name</var> is not the empty string:",
          "rationale": "switch",
          "steps": [
            {
              "html": "Switch on <var>name</var>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "\"attributionsrc\"",
                      "html": "Run the following steps:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>tokenizedFeatures</var>[<var>name</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">set</a> <var>tokenizedFeatures</var>[<var>name</var>] to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>originalCaseValue</var> to <var>tokenizedFeatures</var>[<var>name</var>].</p>"
                        }
                      ]
                    },
                    {
                      "case": "Anything else",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">Set</a> <var>tokenizedFeatures</var>[<var>name</var>] to <var>value</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "add the steps",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>navigationSourceEligible</var> be false.</p>"
        },
        {
          "html": "If <var>tokenizedFeatures</var>[\"<code>attributionsrc</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>tokenizedFeatures</var>[\"<code>attributionsrc</code>\"] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a>.</p>"
            },
            {
              "html": "<p>Set <var>navigationSourceEligible</var> to true.</p>"
            },
            {
              "html": "<p>Set <var>attributionSrcUrls</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>value</var> of\n<var>tokenizedFeatures</var>[\"<code>attributionsrc</code>\"]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>value</var> is the empty string, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
                },
                {
                  "html": "<p>Let <var>decodedSrcBytes</var> be the result of\n<a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#string-percent-decode\" id=\"ref-for-string-percent-decode\">percent-decoding</a> <var>value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>decodedSrc</var> be the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode-without-bom\" id=\"ref-for-utf-8-decode-without-bom\">UTF-8 decode without BOM</a> of\n<var>decodedSrcBytes</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url\" id=\"ref-for-parse-a-url\">Parse</a> <var>decodedSrc</var> relative to\nthe <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object\" id=\"ref-for-entry-settings-object\">entry settings object</a>,\nand set <var>urlRecord</var> to the resulting <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL record</a>, if any. If\nparsing failed, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> <var>urlRecord</var> to <var>attributionSrcUrls</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "get an eligibility from AttributionReportingRequestOptions",
      "href": "https://wicg.github.io/attribution-reporting-api/#get-an-eligibility-from-attributionreportingrequestoptions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-an-eligibility-from-attributionreportingrequestoptions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get an eligibility from <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dictdef-attributionreportingrequestoptions\" id=\"ref-for-dictdef-attributionreportingrequestoptions②\">AttributionReportingRequestOptions</a></code></dfn>\ngiven an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dictdef-attributionreportingrequestoptions\" id=\"ref-for-dictdef-attributionreportingrequestoptions③\">AttributionReportingRequestOptions</a></code> <var>options</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>eventSourceEligible</var> be <var>options</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-attributionreportingrequestoptions-eventsourceeligible\" id=\"ref-for-dom-attributionreportingrequestoptions-eventsourceeligible\">eventSourceEligible</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>triggerEligible</var> be <var>options</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-attributionreportingrequestoptions-triggereligible\" id=\"ref-for-dom-attributionreportingrequestoptions-triggereligible\">triggerEligible</a></code>.</p>"
        },
        {
          "html": "If (<var>eventSourceEligible</var>, <var>triggerEligible</var>) is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "(false, false)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-empty\" id=\"ref-for-eligibility-empty\">empty</a></code>\".</p>"
                },
                {
                  "case": "(false, true)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-trigger\" id=\"ref-for-eligibility-trigger\">trigger</a></code>\".</p>"
                },
                {
                  "case": "(true, false)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source\" id=\"ref-for-eligibility-event-source\">event-source</a></code>\".</p>"
                },
                {
                  "case": "(true, true)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source-or-trigger\" id=\"ref-for-eligibility-event-source-or-trigger③\">event-source-or-trigger</a></code>\".</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "obtain a dictionary structured header value",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-dictionary-structured-header-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-dictionary-structured-header-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a dictionary structured header value</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④\">strings</a> <var>keys</var> and\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤\">strings</a> <var>allowedKeys</var>:",
      "rationale": "for",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>key</var> of <var>allowedKeys</var>, optionally <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">append</a> the\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate\">concatenation</a> of « \"<code>not-</code>\", <var>key</var> » to <var>keys</var>.</p>"
        },
        {
          "html": "<p>Optionally, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#shuffle-a-list\" id=\"ref-for-shuffle-a-list\">shuffle</a> <var>keys</var>.</p>"
        },
        {
          "html": "<p>Let <var>entries</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>key</var> of <var>keys</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>value</var> be true.</p>"
            },
            {
              "html": "<p>Optionally, set <var>value</var> to a <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc8941#token\" id=\"ref-for-token\">token</a>\ncorresponding to one of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥\">strings</a> in <var>allowedKeys</var>.</p>"
            },
            {
              "html": "<p>Let <var>params</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map\">map</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>key</var> of <var>allowedKeys</var>, optionally <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">set</a> <var>params</var>[<var>key</var>] to an\narbitrary <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc8941#item\" id=\"ref-for-item\">bare item</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③\">Append</a> a structured dictionary member with the key <var>key</var>, the\nvalue <var>value</var>, and the parameters <var>params</var> to <var>entries</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc8941#dictionary\" id=\"ref-for-dictionary②\">dictionary</a> containing <var>entries</var>.</p>"
        }
      ]
    },
    {
      "name": "set Attribution Reporting headers",
      "href": "https://wicg.github.io/attribution-reporting-api/#set-attribution-reporting-headers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-attribution-reporting-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set Attribution Reporting headers</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-request\" id=\"ref-for-concept-request③\">request</a> <var>request</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>headers</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">header list</a>.</p>"
        },
        {
          "html": "<p>Let <var>eligibility</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#request-attribution-reporting-eligibility\" id=\"ref-for-request-attribution-reporting-eligibility③\">Attribution Reporting eligibility</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete\">Delete</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-reporting-eligible\" id=\"ref-for-attribution-reporting-eligible\">Attribution-Reporting-Eligible</a></code>\" from\n<var>headers</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete①\">Delete</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-reporting-support\" id=\"ref-for-attribution-reporting-support\">Attribution-Reporting-Support</a></code>\" from\n<var>headers</var>.</p>"
        },
        {
          "html": "<p>If <var>eligibility</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-unset\" id=\"ref-for-eligibility-unset③\">unset</a></code>\", return.</p>"
        },
        {
          "html": "<p>Let <var>keys</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤\">list</a>.</p>"
        },
        {
          "html": "If <var>eligibility</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"empty\"",
                  "html": "<p>Do nothing.</p>"
                },
                {
                  "case": "\"event-source\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④\">Append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligible-key-event-source\" id=\"ref-for-eligible-key-event-source\">event-source</a></code>\" to <var>keys</var>.</p>"
                },
                {
                  "case": "\"navigation-source\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤\">Append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligible-key-navigation-source\" id=\"ref-for-eligible-key-navigation-source\">navigation-source</a></code>\" to\n<var>keys</var>.</p>"
                },
                {
                  "case": "\"trigger\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥\">Append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligible-key-trigger\" id=\"ref-for-eligible-key-trigger\">trigger</a></code>\" to <var>keys</var>.</p>"
                },
                {
                  "case": "\"event-source-or-trigger\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑦\">Append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligible-key-event-source\" id=\"ref-for-eligible-key-event-source①\">event-source</a></code>\" and\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligible-key-trigger\" id=\"ref-for-eligible-key-trigger①\">trigger</a></code>\" to <var>keys</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>supportedRegistrars</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-supported-registrars\" id=\"ref-for-get-supported-registrars\">getting supported registrars</a>.</p>"
        },
        {
          "html": "<p>If <var>supportedRegistrars</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is empty</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">clear</a> <var>keys</var>.</p>"
        },
        {
          "html": "<p>Let <var>eligibleDict</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-dictionary-structured-header-value\" id=\"ref-for-obtain-a-dictionary-structured-header-value\">obtaining a dictionary structured header value</a> with\n<var>keys</var> and the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">set</a> containing all the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligible-key\" id=\"ref-for-eligible-key\">eligible keys</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header\" id=\"ref-for-concept-header-list-set-structured-header\">Set a structured field value</a> given\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-reporting-eligible\" id=\"ref-for-attribution-reporting-eligible①\">Attribution-Reporting-Eligible</a></code>\", <var>eligibleDict</var>) in <var>headers</var>.</p>"
        },
        {
          "html": "<p>Let <var>supportDict</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-dictionary-structured-header-value\" id=\"ref-for-obtain-a-dictionary-structured-header-value①\">obtaining a dictionary structured header value</a>\nwith <var>supportedRegistrars</var> and the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">set</a> containing all the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar\" id=\"ref-for-registrar①\">registrars</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header\" id=\"ref-for-concept-header-list-set-structured-header①\">Set a structured field value</a> given\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-reporting-support\" id=\"ref-for-attribution-reporting-support①\">Attribution-Reporting-Support</a></code>\", <var>supportDict</var>) in <var>headers</var>.</p>"
        }
      ]
    },
    {
      "html": "add the step",
      "rationale": "set",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#set-attribution-reporting-headers\" id=\"ref-for-set-attribution-reporting-headers\">Set Attribution Reporting headers</a> with <var>request</var>.</p>"
        }
      ]
    },
    {
      "html": "add the step",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-requestinit-attributionreporting\" id=\"ref-for-dom-requestinit-attributionreporting\">attributionReporting</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>, then set\n<var>request</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#request-attribution-reporting-eligibility\" id=\"ref-for-request-attribution-reporting-eligibility⑥\">Attribution Reporting eligibility</a> to the result of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-an-eligibility-from-attributionreportingrequestoptions\" id=\"ref-for-get-an-eligibility-from-attributionreportingrequestoptions\">get an eligibility from AttributionReportingRequestOptions</a> with it.</p>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-xmlhttprequest-setattributionreporting\" id=\"ref-for-dom-xmlhttprequest-setattributionreporting\">setAttributionReporting(options)</a></code> method must run these\nsteps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a>’s\n<a href=\"https://xhr.spec.whatwg.org/#concept-xmlhttprequest-state\">state</a>\nis not <i>opened</i>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw\">throw</a> an\n\"<code class=\"idl\"><a class=\"idl-code\" data-link-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>’s\n<a href=\"https://xhr.spec.whatwg.org/#send-flag\"><code>send()</code> flag</a> is set,\nthen <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①\">throw</a> an \"<code class=\"idl\"><a class=\"idl-code\" data-link-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>’s <a href=\"https://wicg.github.io/attribution-reporting-api/#xmlhttprequest-eligibility\" id=\"ref-for-xmlhttprequest-eligibility\">Attribution Reporting\neligibility</a> to the result of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-an-eligibility-from-attributionreportingrequestoptions\" id=\"ref-for-get-an-eligibility-from-attributionreportingrequestoptions①\">get an eligibility from AttributionReportingRequestOptions</a> with\n<var>options</var>.</p>"
        }
      ]
    },
    {
      "html": "Add the step:",
      "rationale": "set",
      "steps": [
        {
          "html": "<p>Set <var>req</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#request-attribution-reporting-eligibility\" id=\"ref-for-request-attribution-reporting-eligibility⑦\">Attribution Reporting eligibility</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>’s <a href=\"https://wicg.github.io/attribution-reporting-api/#xmlhttprequest-eligibility\" id=\"ref-for-xmlhttprequest-eligibility①\">Attribution Reporting\neligibility</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#set-attribution-reporting-headers\" id=\"ref-for-set-attribution-reporting-headers①\">Set Attribution Reporting headers</a> with <var>req</var> and <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#node-context-origin\" id=\"ref-for-node-context-origin\">context origin</a>.</p>"
        }
      ]
    },
    {
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#clear-site-data\" id=\"ref-for-clear-site-data\">clear site data</a> with <var>origin</var>.</p>"
        }
      ]
    },
    {
      "name": "clear site data",
      "href": "https://wicg.github.io/attribution-reporting-api/#clear-site-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clear-site-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clear site data</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin\">origin</a> <var>origin</var>:",
      "rationale": "for",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤\">attribution source</a> <var>source</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache\">attribution source cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin\">reporting origin</a> and <var>origin</var> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin\">same origin</a>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">remove</a> <var>source</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache①\">attribution source cache</a>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report\">event-level report</a> <var>report</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache\">event-level report cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin\">reporting origin</a> and <var>origin</var> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">remove</a> <var>report</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache①\">event-level report cache</a>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report\">aggregatable attribution report</a> <var>report</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache\">aggregatable attribution report cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin①\">reporting origin</a> and <var>origin</var> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②\">remove</a> <var>report</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache①\">aggregatable attribution report cache</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "find matching trigger data",
      "href": "https://wicg.github.io/attribution-reporting-api/#find-matching-trigger-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"find-matching-trigger-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find matching trigger data</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥\">attribution source</a>\n<var>source</var> and an unsigned 64-bit integer <var>triggerData</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>set</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-trigger-data\" id=\"ref-for-attribution-source-trigger-data\">trigger data</a>.</p>"
        },
        {
          "html": "If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-trigger-data-matching-mode\" id=\"ref-for-attribution-source-trigger-data-matching-mode\">trigger-data matching mode</a> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"exact\"",
                  "html": "Run the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>set</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> <var>triggerData</var>, return <var>triggerData</var>.</p>"
                    },
                    {
                      "html": "<p>Return an error.</p>"
                    }
                  ]
                },
                {
                  "case": "\"modulus\"",
                  "html": "Run the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>set</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①\">is empty</a>, return an error.</p>"
                    },
                    {
                      "html": "<p>Let <var>index</var> be the remainder when dividing <var>triggerData</var> by <var>set</var>’s\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①\">size</a>.</p>"
                    },
                    {
                      "html": "<p>Return the <var>set</var>[<var>index</var>].</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "parse an optional 64-bit signed integer",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-signed-integer",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-optional-64-bit-signed-integer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an optional 64-bit signed integer</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③\">map</a> <var>map</var>, a\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②②\">string</a> <var>key</var>, and a possibly null 64-bit signed integer <var>default</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[<var>key</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exist</a>, return <var>default</var>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[<var>key</var>] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②③\">string</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be the result of applying the\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-integers\" id=\"ref-for-rules-for-parsing-integers\">rules for parsing integers</a> to <var>map</var>[<var>key</var>].</p>"
        },
        {
          "html": "<p>If <var>value</var> is an error, return an error.</p>"
        },
        {
          "html": "<p>If <var>value</var> cannot be represented by a 64-bit signed integer, return an error.</p>"
        },
        {
          "html": "<p>Return <var>value</var>.</p>"
        }
      ]
    },
    {
      "name": "parse an optional 64-bit unsigned integer",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-optional-64-bit-unsigned-integer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an optional 64-bit unsigned integer</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④\">map</a> <var>map</var>,\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②④\">string</a> <var>key</var>, and a possibly null 64-bit unsigned integer <var>default</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[<var>key</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exist</a>, return <var>default</var>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[<var>key</var>] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑤\">string</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be the result of applying the\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-non-negative-integers\" id=\"ref-for-rules-for-parsing-non-negative-integers\">rules for parsing non-negative integers</a> to <var>map</var>[<var>key</var>].</p>"
        },
        {
          "html": "<p>If <var>value</var> is an error, return an error.</p>"
        },
        {
          "html": "<p>If <var>value</var> cannot be represented by a 64-bit unsigned integer, return an\nerror.</p>"
        },
        {
          "html": "<p>Return <var>value</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize attribution destinations",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-attribution-destinations",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-attribution-destinations\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-destinations\" id=\"ref-for-event-level-report-attribution-destinations①\">attribution destinations</a></dfn> <var>destinations</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>destinations</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②\">empty</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>destinations</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-ascending-order\" id=\"ref-for-list-sort-in-ascending-order\">sorted</a> in\nascending order, with <var>a</var> being less than <var>b</var> if <var>a</var>,\n<a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>,\nis less than <var>b</var>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>"
        },
        {
          "html": "<p>Let <var>destinationStrings</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑥\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> <var>destination</var> in <var>destinations</var>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: <var>destination</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque\">opaque origin</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑧\">Append</a> <var>destination</var> <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a> to <var>destinationStrings</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>destinationStrings</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑨\">size</a> is equal to 1, return <var>destinationStrings</var>[0].</p>"
        },
        {
          "html": "<p>Return <var>destinationStrings</var>.</p>"
        }
      ]
    },
    {
      "name": "check if a scheme is suitable",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-a-scheme-is-suitable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-a-scheme-is-suitable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if a scheme is suitable</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑥\">string</a> <var>scheme</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>scheme</var> is \"<code>http</code>\" or \"<code>https</code>\", return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "check if an origin is suitable",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"check-if-an-origin-is-suitable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an origin is suitable</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②\">origin</a> <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>origin</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin\" id=\"ref-for-potentially-trustworthy-origin\">potentially trustworthy origin</a>, return false.</p>"
        },
        {
          "html": "<p>If <var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme\">scheme</a> is not\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-a-scheme-is-suitable\" id=\"ref-for-check-if-a-scheme-is-suitable\">suitable</a>, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "parse filter values",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-filter-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-filter-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse filter values</dfn> given a <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-map\" id=\"ref-for-filter-map②\">filter map</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>filter</var> → <var>data</var> of <var>value</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>filter</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with\">starts with</a> \"<code>_</code>\", return an error.</p>"
            },
            {
              "html": "<p>If <var>data</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑦\">list</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>set</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⓪\">set</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> <var>d</var> of <var>data</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>d</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑦\">string</a>, return an error.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>d</var> to <var>set</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③\">Set</a> <var>result</var>[<var>filter</var>] to <var>set</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parse filter data",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-filter-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-filter-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse filter data</dfn> given a <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>map</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filter-values\" id=\"ref-for-parse-filter-values\">parse filter values</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>map</var> is an error, return it.</p>"
        },
        {
          "html": "<p>If <var>map</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size③\">size</a> is greater than the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-entries-per-filter-data\" id=\"ref-for-max-entries-per-filter-data\">max entries per filter data</a>,\nreturn an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①\">For each</a> <var>filter</var> → <var>set</var> of <var>map</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>filter</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑤\">length</a> is greater than the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-length-per-filter-string\" id=\"ref-for-max-length-per-filter-string\">max length per filter string</a>,\nreturn an error.</p>"
            },
            {
              "html": "<p>If <var>set</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⓪\">size</a> is greater than the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-values-per-filter-data-entry\" id=\"ref-for-max-values-per-filter-data-entry\">max values per filter data entry</a>, return an error.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨\">For each</a> <var>s</var> of <var>set</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>s</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑥\">length</a> is greater than the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-length-per-filter-string\" id=\"ref-for-max-length-per-filter-string①\">max length per filter string</a>,\nreturn an error.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>map</var>.</p>"
        }
      ]
    },
    {
      "name": "parse filter config",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-filter-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-filter-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse filter config</dfn> given a <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑥\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>lookbackWindow</var> be null.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code>_lookback_window</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var>[\"<code>_lookback_window</code>\"] is not a positive integer, return an error.</p>"
            },
            {
              "html": "<p>Set <var>lookbackWindow</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration⑨\">duration</a> of <var>value</var>[\"<code>_lookback_window</code>\"] seconds.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove\">Remove</a> <var>value</var>[\"<code>_lookback_window</code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>map</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filter-values\" id=\"ref-for-parse-filter-values①\">parse filter values</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>map</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>filter</var> be a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①②\">filter config</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config-map\" id=\"ref-for-filter-config-map\">map</a>\n       </dt><dd data-md=\"\">\n        <p><var>map</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config-lookback-window\" id=\"ref-for-filter-config-lookback-window\">lookback window</a>\n       </dt><dd data-md=\"\">\n        <p><var>lookbackWindow</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>filter</var>.</p>"
        }
      ]
    },
    {
      "name": "parse filters",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-filters",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-filters\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse filters</dfn> given a <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>filtersList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑧\">list</a>.</p>"
        },
        {
          "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑦\">map</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>filterConfig</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filter-config\" id=\"ref-for-parse-filter-config\">parse filter config</a> with <var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>filterConfig</var> is an error, return it.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑨\">Append</a> <var>filterConfig</var> to <var>filtersList</var>.</p>"
            },
            {
              "html": "<p>Return <var>filtersList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑨\">list</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⓪\">For each</a> <var>data</var> of <var>value</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>filterConfig</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filter-config\" id=\"ref-for-parse-filter-config①\">parse filter config</a> with <var>data</var>.</p>"
            },
            {
              "html": "<p>If <var>filterConfig</var> is an error, return it.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⓪\">Append</a> <var>filterConfig</var> to <var>filtersList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>filtersList</var>.</p>"
        }
      ]
    },
    {
      "name": "parse a filter pair",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-a-filter-pair\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse a filter pair</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑧\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>positive</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①③\">filter configs</a>, initially empty.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-filters\" id=\"ref-for-trigger-registration-json-key-filters\">filters</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>, set <var>positive</var> to the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filters\" id=\"ref-for-parse-filters\">parse filters</a> with <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-filters\" id=\"ref-for-trigger-registration-json-key-filters①\">filters</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>positive</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>negative</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①④\">filter configs</a>, initially empty.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-not_filters\" id=\"ref-for-trigger-registration-json-key-not_filters\">not_filters</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a>, set <var>negative</var> to the result of\nrunning <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filters\" id=\"ref-for-parse-filters①\">parse filters</a> with <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-not_filters\" id=\"ref-for-trigger-registration-json-key-not_filters①\">not_filters</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>negative</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple⑥\">tuple</a> (<var>positive</var>, <var>negative</var>).</p>"
        }
      ]
    },
    {
      "name": "parse an aggregation coordinator",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-coordinator",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-aggregation-coordinator\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an aggregation coordinator</dfn> given <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑧\">string</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">URL parser</a> on <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>url</var> is failure or null, return an error.</p>"
        },
        {
          "html": "<p>If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a> is not an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregation-coordinator\" id=\"ref-for-aggregation-coordinator④\">aggregation coordinator</a>, return an error.</p>"
        },
        {
          "html": "<p>Return <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①\">origin</a>.</p>"
        }
      ]
    },
    {
      "name": "parse aggregatable debug reporting data",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-debug-reporting-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregatable-debug-reporting-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregatable debug reporting data</dfn> given a <var>dataList</var>, a\npositive integer <var>maxValue</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②①\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#debug-data-type\" id=\"ref-for-debug-data-type⑥\">debug data types</a>\n<var>supportedTypes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: <var>maxValue</var> is less than or equal to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source\">allowed aggregatable budget per source</a>.</p>"
        },
        {
          "html": "<p>If <var>dataList</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③②\">list</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>debugDataMap</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑨\">map</a>.</p>"
        },
        {
          "html": "<p>Let <var>unknownTypes</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②②\">set</a>.</p>"
        },
        {
          "html": "<p>Let <var>unspecifiedContribution</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①①\">For each</a> <var>data</var> of <var>dataList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>data</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⓪\">map</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-key_piece\" id=\"ref-for-aggregatable-debug-reporting-json-key-key_piece\">key_piece</a></code>\"]\ndoes not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exist</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-key_piece\" id=\"ref-for-aggregatable-debug-reporting-json-key-key_piece①\">key_piece</a></code>\"]\nis not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑨\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>dataKeyPiece</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-key-piece\" id=\"ref-for-parse-an-aggregation-key-piece\">parse an aggregation key piece</a>\nwith <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-key_piece\" id=\"ref-for-aggregatable-debug-reporting-json-key-key_piece②\">key_piece</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>dataKeyPiece</var> is an error, return an error.</p>"
            },
            {
              "html": "<p>If <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-value\" id=\"ref-for-aggregatable-debug-reporting-json-key-value\">value</a></code>\"]\ndoes not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">exist</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-value\" id=\"ref-for-aggregatable-debug-reporting-json-key-value①\">value</a></code>\"] is\nnot an integer or is less than or equal to 0 or is greater than <var>maxValue</var>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>contribution</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution②\">aggregatable contribution</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key\">key</a>\n         </dt><dd data-md=\"\">\n          <p><var>dataKeyPiece</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p><var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-value\" id=\"ref-for-aggregatable-debug-reporting-json-key-value②\">value</a></code>\"]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-filtering-id\" id=\"ref-for-aggregatable-contribution-filtering-id\">filtering ID</a>\n         </dt><dd data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-value\" id=\"ref-for-default-filtering-id-value\">default filtering ID value</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p>If <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-types\" id=\"ref-for-aggregatable-debug-reporting-json-key-types\">types</a></code>\"] does\nnot <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">exist</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>dataTypes</var> be <var>data</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-types\" id=\"ref-for-aggregatable-debug-reporting-json-key-types①\">types</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>dataTypes</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③③\">list</a> or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③\">is empty</a>, return an error.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①②\">For each</a> <var>type</var> of <var>dataTypes</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>type</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⓪\">string</a>, return an error.</p>"
                },
                {
                  "html": "If <var>type</var> is \"<code>unspecified</code>\":",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>unspecifiedContribution</var> is not null, return an error.</p>"
                    },
                    {
                      "html": "<p>Set <var>unspecifiedContribution</var> to <var>contribution</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">Continue</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "If <var>supportedTypes</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> <var>type</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>debugDataMap</var>[<var>type</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">exists</a>, return an error.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④\">Set</a> <var>debugDataMap</var>[<var>type</var>] to <var>contribution</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "Otherwise:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>unknownTypes</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a> <var>type</var>, return an error.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>type</var> to <var>unknownTypes</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>unspecifiedContribution</var> is null, return <var>debugDataMap</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①③\">For each</a> <var>type</var> of <var>supportedTypes</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>debugDataMap</var>[<var>type</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">exist</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤\">set</a>\n<var>debugDataMap</var>[<var>type</var>] to <var>unspecifiedContribution</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>debugDataMap</var>.</p>"
        }
      ]
    },
    {
      "name": "parse an aggregatable debug reporting config",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-an-aggregatable-debug-reporting-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-aggregatable-debug-reporting-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an aggregatable debug reporting config</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②①\">map</a> <var>map</var>, a\npositive integer <var>maxValue</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②③\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#debug-data-type\" id=\"ref-for-debug-data-type⑦\">debug data types</a> <var>supportedTypes</var>,\nand an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config\" id=\"ref-for-aggregatable-debug-reporting-config②\">aggregatable debug reporting config</a> <var>default</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-key_piece\" id=\"ref-for-aggregatable-debug-reporting-json-key-key_piece③\">key_piece</a></code>\"] does not\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">exist</a>, return <var>default</var>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-key_piece\" id=\"ref-for-aggregatable-debug-reporting-json-key-key_piece④\">key_piece</a></code>\"] is not a\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③①\">string</a>, return <var>default</var>.</p>"
        },
        {
          "html": "<p>Let <var>keyPiece</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-key-piece\" id=\"ref-for-parse-an-aggregation-key-piece①\">parse an aggregation key piece</a>\nwith <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-key_piece\" id=\"ref-for-aggregatable-debug-reporting-json-key-key_piece⑤\">key_piece</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>keyPiece</var> is an error, return <var>default</var>.</p>"
        },
        {
          "html": "<p>Let <var>debugDataMap</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②②\">map</a>.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-debug_data\" id=\"ref-for-aggregatable-debug-reporting-json-key-debug_data\">debug_data</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>debugDataMap</var> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-debug-reporting-data\" id=\"ref-for-parse-aggregatable-debug-reporting-data\">parse aggregatable debug reporting data</a>\nwith <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-debug_data\" id=\"ref-for-aggregatable-debug-reporting-json-key-debug_data①\">debug_data</a></code>\"], <var>maxValue</var>,\nand <var>supportedTypes</var>.</p>"
            },
            {
              "html": "<p>If <var>debugDataMap</var> is an error, return <var>default</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>aggregationCoordinator</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-aggregation-coordinator\" id=\"ref-for-default-aggregation-coordinator①\">default aggregation coordinator</a>.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-json-key-aggregation_coordinator_origin\" id=\"ref-for-aggregatable-debug-reporting-json-key-aggregation_coordinator_origin\">aggregation_coordinator_origin</a></code>\"]\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑥\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>aggregationCoordinator</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-coordinator\" id=\"ref-for-parse-an-aggregation-coordinator\">parsing an aggregation coordinator</a>.</p>"
            },
            {
              "html": "<p>If <var>aggregationCoordinator</var> is an error, return <var>default</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>aggregatableDebugReportingConfig</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config\" id=\"ref-for-aggregatable-debug-reporting-config③\">aggregatable debug reporting config</a>\nwith the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-key-piece\" id=\"ref-for-aggregatable-debug-reporting-config-key-piece\">key piece</a>\n       </dt><dd data-md=\"\">\n        <p><var>keyPiece</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-debug-data\" id=\"ref-for-aggregatable-debug-reporting-config-debug-data\">debug data</a>\n       </dt><dd data-md=\"\">\n        <p><var>debugDataMap</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-aggregation-coordinator\" id=\"ref-for-aggregatable-debug-reporting-config-aggregation-coordinator\">aggregation coordinator</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregationCoordinator</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>aggregatableDebugReportingConfig</var>.</p>"
        }
      ]
    },
    {
      "name": "get registration info from a header list",
      "href": "https://wicg.github.io/attribution-reporting-api/#get-registration-info-from-a-header-list",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-registration-info-from-a-header-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get registration info from a header list</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list\">header list</a> <var>headers</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>headers</var> does not <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains\">contain</a> \"<code>Attribution-Reporting-Info</code>\", return a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info\" id=\"ref-for-registration-info④\">registration info</a>.</p>"
        },
        {
          "html": "<p>Let <var>map</var> be the result of\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header\">getting</a> \"<code>Attribution-Reporting-Info</code>\" from <var>headers</var>\nwith a type of \"<code>dictionary</code>\".</p>"
        },
        {
          "html": "<p>If <var>map</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②③\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>preferredPlatform</var> be null.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code>preferred-platform</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑦\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>preferredPlatformValue</var> be <var>map</var>[\"<code>preferred-platform</code>\"][0].</p>"
            },
            {
              "html": "<p>If <var>preferredPlatformValue</var> is not a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar\" id=\"ref-for-registrar③\">registrar</a>, return an error.</p>"
            },
            {
              "html": "<p>Set <var>preferredPlatform</var> to <var>preferredPlatformValue</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>reportHeaderErrors</var> be false.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code>report-header-errors</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑧\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>reportHeaderErrorsValue</var> be <var>map</var>[\"<code>report-header-errors</code>\"][0].</p>"
            },
            {
              "html": "<p>If <var>reportHeaderErrorsValue</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean⑨\">boolean</a>, return an error.</p>"
            },
            {
              "html": "<p>Set <var>reportHeaderErrors</var> to <var>reportHeaderErrorsValue</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>registrationInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info\" id=\"ref-for-registration-info①\">registration info</a> struct whose items are:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info-preferred-platform\" id=\"ref-for-registration-info-preferred-platform\">preferred platform</a>\n       </dt><dd data-md=\"\">\n        <p><var>preferredPlatform</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info-report-header-errors\" id=\"ref-for-registration-info-report-header-errors\">report header errors</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportHeaderErrors</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>registrationInfo</var>.</p>"
        }
      ]
    },
    {
      "name": "check if cookie-based debugging is allowed",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-cookie-based-debugging-is-allowed",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-cookie-based-debugging-is-allowed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if cookie-based debugging is allowed</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin⑦\">suitable origin</a> <var>reportingOrigin</var> and a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①⑧\">site</a> <var>contextSite</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: <var>contextSite</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque①\">opaque origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>domain</var> be the\n<a href=\"https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#name-canonicalized-host-names\">canonicalized domain name</a>\nof <var>reportingOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host\">host</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextDomain</var> be the\n<a href=\"https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#name-canonicalized-host-names\">canonicalized domain name</a>\nof <var>contextSite</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/#concept-scheme-and-host-host\" id=\"ref-for-concept-scheme-and-host-host\">host</a>.</p>"
        },
        {
          "html": "<p>If the User Agent’s <a href=\"https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#name-cookie-policy\">cookie policy</a>\nor <a href=\"https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#name-user controls\">user controls</a>\ndo not allow cookie access for <var>domain</var> on <var>contextDomain</var> within a <a href=\"https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#name-third-party-cookies\">third-party context</a>,\nreturn <strong>blocked</strong>.</p>"
        },
        {
          "html": "<p>Return <strong>allowed</strong>.</p>"
        }
      ]
    },
    {
      "name": "obtain a randomized response",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-randomized-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a randomized response</dfn> given <var>trueValue</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②④\">set</a> <var>possibleValues</var>, and a\ndouble <var>randomPickRate</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: <var>randomPickRate</var> is between 0 and 1 (both inclusive).</p>"
        },
        {
          "html": "<p>Let <var>r</var> be a random double between 0 (inclusive) and 1 (exclusive) with uniform probability.</p>"
        },
        {
          "html": "<p>If <var>r</var> is less than <var>randomPickRate</var>, return a random item from <var>possibleValues</var> with uniform\nprobability.</p>"
        },
        {
          "html": "<p>Otherwise, return <var>trueValue</var>.</p>"
        }
      ]
    },
    {
      "name": "parse an aggregation key piece",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-key-piece",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-aggregation-key-piece\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an aggregation key piece</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③②\">string</a> <var>input</var>, perform the following steps.\nThis algorithm will return either a non-negative 128-bit integer or an error.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>input</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-code-point-length\" id=\"ref-for-string-code-point-length\">code point length</a> is not between 3 and 34 (both inclusive), return an error.</p>"
        },
        {
          "html": "<p>If the first character is not a U+0030 DIGIT ZERO (0), return an error.</p>"
        },
        {
          "html": "<p>If the second character is not a U+0058 LATIN CAPITAL LETTER X character (X) and not a\nU+0078 LATIN SMALL LETTER X character (x), return an error.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point-substring\" id=\"ref-for-code-point-substring\">code point substring</a> from 2 to the end of <var>input</var>.</p>"
        },
        {
          "html": "<p>If the characters within <var>value</var> are not all <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-hex-digit\" id=\"ref-for-ascii-hex-digit\">ASCII hex digits</a>, return an error.</p>"
        },
        {
          "html": "<p>Interpret <var>value</var> as a hexadecimal number and return as a non-negative 128-bit integer.</p>"
        }
      ]
    },
    {
      "name": "check if processing should be blocked by reporting-origin limit",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-processing-should-be-blocked-by-reporting-origin-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-processing-should-be-blocked-by-reporting-origin-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if processing should be blocked by reporting-origin limit</dfn>\ngiven an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①\">attribution rate-limit record</a> <var>newRecord</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>max</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-source-reporting-origins-per-rate-limit-window\" id=\"ref-for-max-source-reporting-origins-per-rate-limit-window\">max source reporting origins per rate-limit window</a>.</p>"
        },
        {
          "html": "<p>Let <var>scopeSet</var> be « \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-source\" id=\"ref-for-rate-limit-scope-source\">source</a></code>\" ».</p>"
        },
        {
          "html": "If <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope\">scope</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-event-attribution\" id=\"ref-for-rate-limit-scope-event-attribution\">event-attribution</a></code>\"\n or \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-aggregatable-attribution\" id=\"ref-for-rate-limit-scope-aggregatable-attribution\">aggregatable-attribution</a></code>\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>max</var> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-attribution-reporting-origins-per-rate-limit-window\" id=\"ref-for-max-attribution-reporting-origins-per-rate-limit-window\">max attribution reporting origins per rate-limit window</a>.</p>"
            },
            {
              "html": "<p>Set <var>scopeSet</var> to « \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-event-attribution\" id=\"ref-for-rate-limit-scope-event-attribution①\">event-attribution</a></code>\", \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-aggregatable-attribution\" id=\"ref-for-rate-limit-scope-aggregatable-attribution①\">aggregatable-attribution</a></code>\" ».</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>matchingRateLimitRecords</var> be all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record②\">attribution rate-limit records</a> <var>record</var> in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①\">attribution rate-limit cache</a> where all of the following are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>scopeSet</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contains</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①\">scope</a></p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site④\">source site</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site⑤\">source site</a> are equal</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination③\">attribution destination</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination④\">attribution destination</a> are equal</p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from①\">duration from</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time\">time</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time①\">time</a> is &lt;= <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-window\" id=\"ref-for-attribution-rate-limit-window③\">attribution rate-limit window</a></p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>distinctReportingOrigins</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑤\">set</a> of all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin②\">reporting origin</a> in <var>matchingRateLimitRecords</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union\">unioned</a> with «<var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin③\">reporting origin</a>».</p>"
        },
        {
          "html": "<p>If <var>distinctReportingOrigins</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①①\">size</a> is greater than <var>max</var>, return <strong>blocked</strong>.</p>"
        },
        {
          "html": "<p>Return <strong>allowed</strong>.</p>"
        }
      ]
    },
    {
      "name": "check if an attribution rate-limit record can be removed",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-rate-limit-record-can-be-removed",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-rate-limit-record-can-be-removed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an attribution rate-limit record can be removed</dfn>\ngiven an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record③\">attribution rate-limit record</a> <var>record</var> and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①⓪\">moment</a> <var>now</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from②\">duration from</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record④\">time</a> and <var>now</var> is &lt;= <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-window\" id=\"ref-for-attribution-rate-limit-window④\">attribution rate-limit window</a> , return false.</p>"
        },
        {
          "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope②\">scope</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-event-attribution\" id=\"ref-for-rate-limit-scope-event-attribution②\">event-attribution</a></code>\"\nor \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-aggregatable-attribution\" id=\"ref-for-rate-limit-scope-aggregatable-attribution②\">aggregatable-attribution</a></code>\", return true.</p>"
        },
        {
          "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time\">expiry time</a> is after <var>now</var>, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver a verbose debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-a-verbose-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver a verbose debug report</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③④\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data\" id=\"ref-for-verbose-debug-data①\">verbose debug data</a> <var>data</var>,\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin⑧\">suitable origin</a> <var>reportingOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⓪\">boolean</a> <var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>fenced</var> is true, return.</p>"
        },
        {
          "html": "<p>Let <var>debugReport</var> be a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report\" id=\"ref-for-verbose-debug-report①\">verbose debug report</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report-data\" id=\"ref-for-verbose-debug-report-data\">data</a>\n       </dt><dd data-md=\"\">\n        <p><var>data</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report-reporting-origin\" id=\"ref-for-verbose-debug-report-reporting-origin\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingOrigin</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-verbose-debug-report\" id=\"ref-for-attempt-to-deliver-a-verbose-debug-report\">attempt to deliver a verbose debug report</a> with <var>debugReport</var>.</p>"
        }
      ]
    },
    {
      "name": "validate a background attributionsrc eligibility",
      "href": "https://wicg.github.io/attribution-reporting-api/#validate-a-background-attributionsrc-eligibility",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-a-background-attributionsrc-eligibility\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate a background attributionsrc eligibility</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility\" id=\"ref-for-eligibility③\">eligibility</a> <var>eligibility</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: <var>eligibility</var> is\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-navigation-source\" id=\"ref-for-eligibility-navigation-source②\">navigation-source</a></code>\" or\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source-or-trigger\" id=\"ref-for-eligibility-event-source-or-trigger⑤\">event-source-or-trigger</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "make a background attributionsrc request",
      "href": "https://wicg.github.io/attribution-reporting-api/#make-a-background-attributionsrc-request",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"make-a-background-attributionsrc-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">make a background attributionsrc request</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org#concept-url\" id=\"ref-for-concept-url⑤\">URL</a> <var>url</var>, an\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④\">origin</a> <var>contextOrigin</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility\" id=\"ref-for-eligibility④\">eligibility</a> <var>eligibility</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①①\">boolean</a> <var>fenced</var>,\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document\">Document</a></code> <var>document</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-referrer-policy/#referrer-policy\" id=\"ref-for-referrer-policy\">referrer policy</a> <var>referrerPolicy</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#validate-a-background-attributionsrc-eligibility\" id=\"ref-for-validate-a-background-attributionsrc-eligibility\">Validate</a> <var>eligibility</var>.</p>"
        },
        {
          "html": "<p>If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable\" id=\"ref-for-check-if-an-origin-is-suitable①\">suitable</a>,\nreturn.</p>"
        },
        {
          "html": "<p>If <var>contextOrigin</var> is not <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable\" id=\"ref-for-check-if-an-origin-is-suitable②\">suitable</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>If <var>context</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context\" id=\"ref-for-secure-context\">secure context</a>, return.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> the \"<code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-permissionpolicy-attribution-reporting\" id=\"ref-for-dom-permissionpolicy-attribution-reporting\">attribution-reporting</a></code></code>\" feature, return.</p>"
        },
        {
          "html": "<p>Let <var>supportedRegistrars</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-supported-registrars\" id=\"ref-for-get-supported-registrars①\">getting supported registrars</a>.</p>"
        },
        {
          "html": "<p>If <var>supportedRegistrars</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty④\">is empty</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-request\" id=\"ref-for-concept-request⑥\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>GET</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag\">keepalive</a>\n       </dt><dd data-md=\"\">\n        <p>true</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#request-attribution-reporting-eligibility\" id=\"ref-for-request-attribution-reporting-eligibility⑧\">Attribution Reporting eligibility</a>\n       </dt><dd data-md=\"\">\n        <p><var>eligibility</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy\">referrer policy</a>\n       </dt><dd data-md=\"\">\n        <p><var>referrerPolicy</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-fetch\" id=\"ref-for-concept-fetch①\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response\" id=\"ref-for-process-response\">processResponse</a> being\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attributionsrc-response\" id=\"ref-for-process-an-attributionsrc-response\">process an attributionsrc response</a> with <var>contextOrigin</var>, <var>eligibility</var>,\nand <var>fenced</var>.</p>"
        }
      ]
    },
    {
      "name": "make background attributionsrc requests",
      "href": "https://wicg.github.io/attribution-reporting-api/#make-background-attributionsrc-requests",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"make-background-attributionsrc-requests\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">make background attributionsrc requests</dfn> given an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#htmlattributionsrcelementutils\" id=\"ref-for-htmlattributionsrcelementutils④\">HTMLAttributionSrcElementUtils</a></code> <var>element</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility\" id=\"ref-for-eligibility⑤\">eligibility</a> <var>eligibility</var>,\nand a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-referrer-policy/#referrer-policy\" id=\"ref-for-referrer-policy①\">referrer policy</a> <var>referrerPolicy</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>attributionSrc</var> be <var>element</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-htmlattributionsrcelementutils-attributionsrc\" id=\"ref-for-dom-htmlattributionsrcelementutils-attributionsrc②\">attributionSrc</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>tokens</var> be the result of\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#split-on-ascii-whitespace\" id=\"ref-for-split-on-ascii-whitespace\">splitting</a> <var>attributionSrc</var> on ASCII\nwhitespace.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①④\">For each</a> <var>token</var> of <var>tokens</var>:",
          "rationale": "parse",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url\" id=\"ref-for-parse-a-url①\">Parse</a> <var>token</var>, relative to\n<var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a>. If that is not successful,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>. Otherwise, let <var>url</var> be the resulting\n<a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL record</a>.</p>"
            },
            {
              "html": "<p>Let <var>fenced</var> be true if <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①\">node navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable\">fenced navigable</a>, false otherwise.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#make-a-background-attributionsrc-request\" id=\"ref-for-make-a-background-attributionsrc-request①\">make a background attributionsrc request</a> with <var>url</var>,\n<var>element</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#node-context-origin\" id=\"ref-for-node-context-origin①\">context origin</a>, <var>eligibility</var>, <var>fenced</var>,\n<var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document①\">node document</a>, and <var>referrerPolicy</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "process an attributionsrc response",
      "href": "https://wicg.github.io/attribution-reporting-api/#process-an-attributionsrc-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-an-attributionsrc-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process an attributionsrc response</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin⑨\">suitable origin</a> <var>contextOrigin</var>,\nan <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility\" id=\"ref-for-eligibility⑥\">eligibility</a> <var>eligibility</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①②\">boolean</a> <var>fenced</var>, and a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response②\">response</a> <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#validate-a-background-attributionsrc-eligibility\" id=\"ref-for-validate-a-background-attributionsrc-eligibility①\">Validate</a> <var>eligibility</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-eligible-response\" id=\"ref-for-process-an-attribution-eligible-response\">process an attribution eligible response</a> with <var>contextOrigin</var>,\n<var>eligibility</var>, <var>fenced</var>, and <var>response</var>.</p>"
        }
      ]
    },
    {
      "name": "get the registration platform",
      "href": "https://wicg.github.io/attribution-reporting-api/#get-the-registration-platform",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-registration-platform\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the registration platform</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value\">header value</a> or null <var>webHeader</var>,\na <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value①\">header value</a> or null <var>osHeader</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar\" id=\"ref-for-registrar④\">registrar</a> or null <var>preferredPlatform</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>webHeader</var> and <var>osHeader</var> are both null, return null.</p>"
        },
        {
          "html": "If <var>preferredPlatform</var> is null:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>webHeader</var> and <var>osHeader</var> are both not null, return null.</p>"
            },
            {
              "html": "<p>If <var>webHeader</var> is not null and the user agent supports web registrations,\nreturn \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-web\" id=\"ref-for-registrar-web\">web</a></code>\".</p>"
            },
            {
              "html": "<p>If <var>osHeader</var> is not null and the user agent supports OS registrations,\nreturn \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-os\" id=\"ref-for-registrar-os\">os</a></code>\".</p>"
            },
            {
              "html": "<p>Return null.</p>"
            }
          ]
        },
        {
          "html": "If <var>preferredPlatform</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"web\"",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>webHeader</var> is null, return null.</p>"
                    },
                    {
                      "html": "<p>If the user agent supports web registrations, return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-web\" id=\"ref-for-registrar-web②\">web</a></code>\".</p>"
                    },
                    {
                      "html": "<p>If <var>osHeader</var> is not null and the user agent supports OS registrations,\n return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-os\" id=\"ref-for-registrar-os①\">os</a></code>\".</p>"
                    },
                    {
                      "html": "<p>Return null.</p>"
                    }
                  ]
                },
                {
                  "case": "\"os\"",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>osHeader</var> is null, return null.</p>"
                    },
                    {
                      "html": "<p>If the user agent supports OS registrations, return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-os\" id=\"ref-for-registrar-os③\">os</a></code>\".</p>"
                    },
                    {
                      "html": "<p>If <var>webHeader</var> is not null and the user agent supports web registrations,\n return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-web\" id=\"ref-for-registrar-web③\">web</a></code>\".</p>"
                    },
                    {
                      "html": "<p>Return null.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "process an attribution source response",
      "href": "https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-an-attribution-source-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process an attribution source response</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①⓪\">suitable origin</a>\n<var>contextOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①①\">suitable origin</a> <var>reportingOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type\" id=\"ref-for-source-type②\">source type</a>\n<var>sourceType</var>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value②\">header value</a> or null <var>webSourceHeader</var>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value③\">header value</a>\nor null <var>osSourceHeader</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info\" id=\"ref-for-registration-info②\">registration info</a> <var>registrationInfo</var>, and a\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①③\">boolean</a> <var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>platform</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-registration-platform\" id=\"ref-for-get-the-registration-platform\">get the registration platform</a> with\n<var>webSourceHeader</var>, <var>osSourceHeader</var>, and <var>registrationInfo</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info-preferred-platform\" id=\"ref-for-registration-info-preferred-platform①\">preferred platform</a>.</p>"
        },
        {
          "html": "<p>If <var>platform</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>reportHeaderErrors</var> be <var>registrationInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info-report-header-errors\" id=\"ref-for-registration-info-report-header-errors①\">report header errors</a>.</p>"
        },
        {
          "html": "If <var>platform</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"web\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>source</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-source-registration-json\" id=\"ref-for-parse-source-registration-json\">parse source-registration JSON</a> with <var>webSourceHeader</var>,\n<var>contextOrigin</var>, <var>reportingOrigin</var>, <var>sourceType</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time\">current wall time</a>, and <var>fenced</var>.</p>"
                    },
                    {
                      "html": "If <var>source</var> is an error:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>reportHeaderErrors</var> is true, run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-registration-header-errors\" id=\"ref-for-obtain-and-deliver-debug-reports-on-registration-header-errors\">obtain and deliver debug reports on registration header errors</a>\nwith \"<code>Attribution-Reporting-Register-Source</code>\",\n<var>webSourceHeader</var>, <var>reportingOrigin</var>, <var>contextOrigin</var>, and <var>fenced</var>.</p>"
                        },
                        {
                          "html": "<p>Return.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>If <var>sourceType</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-navigation\" id=\"ref-for-source-type-navigation⑦\">navigation</a></code>\", enforce\nthe <a href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scope\">attribution-scope privacy limit</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source\" id=\"ref-for-process-an-attribution-source\">Process</a> <var>source</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "\"os\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>osSourceRegistrations</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-os-registrations-from-a-header-value\" id=\"ref-for-get-os-registrations-from-a-header-value\">get OS registrations from a header value</a> with <var>osSourceHeader</var>.</p>"
                    },
                    {
                      "html": "If <var>osSourceRegistrations</var> is an error:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>reportHeaderErrors</var> is true, run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-registration-header-errors\" id=\"ref-for-obtain-and-deliver-debug-reports-on-registration-header-errors①\">obtain and deliver debug reports on registration header errors</a>\nwith \"<code>Attribution-Reporting-Register-OS-Source</code>\",\n<var>osSourceHeader</var>, <var>reportingOrigin</var>, <var>contextOrigin</var>, and <var>fenced</var>.</p>"
                        },
                        {
                          "html": "<p>Return.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Process <var>osSourceRegistrations</var> according to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a> algorithm.</p>"
                    },
                    {
                      "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-os-registrations\" id=\"ref-for-obtain-and-deliver-debug-reports-on-os-registrations\">obtain and deliver debug reports on OS registrations</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-debug-data-type-os-source-delegated\" id=\"ref-for-os-debug-data-type-os-source-delegated\">os-source-delegated</a></code>\", <var>osSourceRegistrations</var>,\n<var>contextOrigin</var>, and <var>fenced</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "process an attribution trigger response",
      "href": "https://wicg.github.io/attribution-reporting-api/#process-an-attribution-trigger-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-an-attribution-trigger-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process an attribution trigger response</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①②\">suitable origin</a>\n<var>contextOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①③\">suitable origin</a> <var>reportingOrigin</var>,\na <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value④\">header value</a> or null <var>webTriggerHeader</var>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value⑤\">header value</a> or null\n<var>osTriggerHeader</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info\" id=\"ref-for-registration-info③\">registration info</a> <var>registrationInfo</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①④\">boolean</a>\n<var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>platform</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-registration-platform\" id=\"ref-for-get-the-registration-platform①\">get the registration platform</a>\nwith <var>webTriggerHeader</var>, <var>osTriggerHeader</var>, and <var>registrationInfo</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info-preferred-platform\" id=\"ref-for-registration-info-preferred-platform②\">preferred platform</a>.</p>"
        },
        {
          "html": "<p>If <var>platform</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>reportHeaderErrors</var> be <var>registrationInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registration-info-report-header-errors\" id=\"ref-for-registration-info-report-header-errors②\">report header errors</a>.</p>"
        },
        {
          "html": "If <var>platform</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"web\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>destinationSite</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site①\">obtaining a site</a> from\n<var>contextOrigin</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>trigger</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-an-attribution-trigger\" id=\"ref-for-create-an-attribution-trigger\">create an attribution trigger</a> with <var>webTriggerHeader</var>\n<var>destinationSite</var>, <var>reportingOrigin</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①\">current wall time</a>, and <var>fenced</var>.</p>"
                    },
                    {
                      "html": "If <var>trigger</var> is an error:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>reportHeaderErrors</var> is true, run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-registration-header-errors\" id=\"ref-for-obtain-and-deliver-debug-reports-on-registration-header-errors②\">obtain and deliver debug reports on registration header errors</a>\nwith \"<code>Attribution-Reporting-Register-Trigger</code>\",\n<var>webTriggerHeader</var>, <var>reportingOrigin</var>, <var>contextOrigin</var>, and <var>fenced</var>.</p>"
                        },
                        {
                          "html": "<p>Return.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#maybe-defer-and-then-complete-trigger-attribution\" id=\"ref-for-maybe-defer-and-then-complete-trigger-attribution\">Maybe defer and then complete trigger attribution</a> with <var>trigger</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "\"os\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>osTriggerRegistrations</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-os-registrations-from-a-header-value\" id=\"ref-for-get-os-registrations-from-a-header-value①\">get OS registrations from a header value</a> with <var>osTriggerHeader</var>.</p>"
                    },
                    {
                      "html": "If <var>osTriggerRegistrations</var> is an error:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>reportHeaderErrors</var> is true, run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-registration-header-errors\" id=\"ref-for-obtain-and-deliver-debug-reports-on-registration-header-errors③\">obtain and deliver debug reports on registration header errors</a>\nwith \"<code>Attribution-Reporting-Register-OS-Trigger</code>\",\n<var>osTriggerHeader</var>, <var>reportingOrigin</var>, <var>contextOrigin</var>, and <var>fenced</var>.</p>"
                        },
                        {
                          "html": "<p>Return.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Process <var>osTriggerRegistrations</var> according to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①\">implementation-defined</a> algorithm.</p>"
                    },
                    {
                      "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-os-registrations\" id=\"ref-for-obtain-and-deliver-debug-reports-on-os-registrations①\">obtain and deliver debug reports on OS registrations</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-debug-data-type-os-trigger-delegated\" id=\"ref-for-os-debug-data-type-os-trigger-delegated\">os-trigger-delegated</a></code>\", <var>osTriggerRegistrations</var>,\n<var>contextOrigin</var>, and <var>fenced</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "process an attribution eligible response",
      "href": "https://wicg.github.io/attribution-reporting-api/#process-an-attribution-eligible-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"process-an-attribution-eligible-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process an attribution eligible response</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①④\">suitable origin</a>\n<var>contextOrigin</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility\" id=\"ref-for-eligibility⑦\">eligibility</a> <var>eligibility</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑤\">boolean</a> <var>fenced</var>,\nand a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③\">response</a> <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The user-agent may ignore the response; if so, return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①\">Queue a task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source\">networking task source</a> to proceed with the following steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a>: <var>eligibility</var> is\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-navigation-source\" id=\"ref-for-eligibility-navigation-source④\">navigation-source</a></code>\" or\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source\" id=\"ref-for-eligibility-event-source②\">event-source</a></code>\" or\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source-or-trigger\" id=\"ref-for-eligibility-event-source-or-trigger⑥\">event-source-or-trigger</a></code>\".</p>"
        },
        {
          "html": "<p>Let <var>reportingOrigin</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin③\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>reportingOrigin</var> is not <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable\" id=\"ref-for-check-if-an-origin-is-suitable③\">suitable</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>sourceHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get\">getting</a>\n\"<code>Attribution-Reporting-Register-Source</code>\" from <var>response</var>’s\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a>.</p>"
        },
        {
          "html": "<p>Let <var>triggerHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get①\">getting</a>\n\"<code>Attribution-Reporting-Register-Trigger</code>\" from <var>response</var>’s\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①\">header list</a>.</p>"
        },
        {
          "html": "<p>Let <var>osSourceHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get②\">getting</a>\n\"<code>Attribution-Reporting-Register-OS-Source</code>\" from <var>response</var>’s\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②\">header list</a>.</p>"
        },
        {
          "html": "<p>Let <var>osTriggerHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get③\">getting</a>\n\"<code>Attribution-Reporting-Register-OS-Trigger</code>\" from <var>response</var>’s\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③\">header list</a>.</p>"
        },
        {
          "html": "<p>Let <var>registrationInfo</var> be the result of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-registration-info-from-a-header-list\" id=\"ref-for-get-registration-info-from-a-header-list\">getting registration info</a>\nfrom <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list④\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>registrationInfo</var> is an error, return.</p>"
        },
        {
          "html": "If <var>eligibility</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"navigation-source\"",
                  "html": "Run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>sourceType</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-navigation\" id=\"ref-for-source-type-navigation⑧\">navigation</a></code>\".</p>"
                    },
                    {
                      "html": "<p>If <var>eligibility</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source\" id=\"ref-for-eligibility-event-source④\">event-source</a></code>\",\nset <var>sourceType</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-event\" id=\"ref-for-source-type-event⑧\">event</a></code>\".</p>"
                    },
                    {
                      "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source-response\" id=\"ref-for-process-an-attribution-source-response\">process an attribution source response</a> with <var>contextOrigin</var>,\n<var>reportingOrigin</var>, <var>sourceType</var>, <var>sourceHeader</var>,\n<var>osSourceHeader</var>, and <var>registrationInfo</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "\"event-source\"",
                  "html": "Run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>sourceType</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-navigation\" id=\"ref-for-source-type-navigation⑧\">navigation</a></code>\".</p>"
                    },
                    {
                      "html": "<p>If <var>eligibility</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source\" id=\"ref-for-eligibility-event-source④\">event-source</a></code>\",\nset <var>sourceType</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-event\" id=\"ref-for-source-type-event⑧\">event</a></code>\".</p>"
                    },
                    {
                      "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source-response\" id=\"ref-for-process-an-attribution-source-response\">process an attribution source response</a> with <var>contextOrigin</var>,\n<var>reportingOrigin</var>, <var>sourceType</var>, <var>sourceHeader</var>,\n<var>osSourceHeader</var>, and <var>registrationInfo</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "\"event-source-or-trigger\"",
                  "html": "Run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>hasSourceRegistration</var> be false.</p>"
                    },
                    {
                      "html": "<p>If <var>sourceHeader</var> or <var>osSourceHeader</var> is not null, set\n<var>hasSourceRegistration</var> to true.</p>"
                    },
                    {
                      "html": "<p>Let <var>hasTriggerRegistration</var> be false.</p>"
                    },
                    {
                      "html": "<p>If <var>triggerHeader</var> or <var>osTriggerHeader</var> is not null, set\n<var>hasTriggerRegistration</var> to true.</p>"
                    },
                    {
                      "html": "<p>If both <var>hasSourceRegistration</var> and <var>hasTriggerRegistration</var> are true,\nreturn.</p>"
                    },
                    {
                      "html": "If <var>hasSourceRegistration</var> is true:",
                      "rationale": "run",
                      "steps": [
                        {
                          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source-response\" id=\"ref-for-process-an-attribution-source-response①\">process an attribution source response</a>\nwith <var>contextOrigin</var>, <var>reportingOrigin</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-event\" id=\"ref-for-source-type-event⑨\">event</a></code>\",\n<var>sourceHeader</var>, <var>osSourceHeader</var>, <var>registrationInfo</var>, and <var>fenced</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <var>hasTriggerRegistration</var> is true:",
                      "rationale": "run",
                      "steps": [
                        {
                          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-trigger-response\" id=\"ref-for-process-an-attribution-trigger-response\">process an attribution trigger response</a>\nwith <var>contextOrigin</var>, <var>reportingOrigin</var>, <var>triggerHeader</var>,\n<var>osTriggerHeader</var>, <var>registrationInfo</var>, and <var>fenced</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "obtain and deliver debug reports on registration header errors",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-registration-header-errors",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-debug-reports-on-registration-header-errors\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver debug reports on registration header errors</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name\">header name</a> <var>headerName</var>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value⑥\">header value</a> <var>headerValue</var>, a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①⑤\">suitable origin</a> <var>reportingOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①⑥\">suitable origin</a> <var>contextOrigin</var>,\nand a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑥\">boolean</a> <var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextSite</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site②\">obtaining a site</a> from <var>contextOrigin</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②④\">map</a> with the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>context_site</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>contextSite</var>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>\n       </dd><dt data-md=\"\">\"<code>header</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>headerName</var>.</p>\n       </dd><dt data-md=\"\">\"<code>value</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>headerValue</var>.</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Optionally, set <var>body</var>[\"<code>error</code>\"] to error details of any type.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data\" id=\"ref-for-verbose-debug-data②\">verbose debug data</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-data-type\" id=\"ref-for-verbose-debug-data-data-type①\">data type</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#header-errors-debug-data-type-header-parsing-error\" id=\"ref-for-header-errors-debug-data-type-header-parsing-error\">header-parsing-error</a></code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-body\" id=\"ref-for-verbose-debug-data-body\">body</a>\n       </dt><dd data-md=\"\">\n        <p><var>body</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report\" id=\"ref-for-obtain-and-deliver-a-verbose-debug-report\">obtain and deliver a verbose debug report</a> with « <var>data</var> », <var>reportingOrigin</var>, and <var>fenced</var>.</p>"
        }
      ]
    },
    {
      "name": "check if attribution debugging can be enabled",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-attribution-debugging-can-be-enabled",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-attribution-debugging-can-be-enabled\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if attribution debugging can be enabled</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-debug-info\" id=\"ref-for-attribution-debug-info②\">attribution debug info</a> <var>debugInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>debugInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-debug-info-source-debug-key\" id=\"ref-for-attribution-debug-info-source-debug-key\">source debug key</a> is null,\nreturn false.</p>"
        },
        {
          "html": "<p>If <var>debugInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-debug-info-trigger-debug-key\" id=\"ref-for-attribution-debug-info-trigger-debug-key\">trigger debug key</a> is null,\nreturn false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "serialize an attribution debug info",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-an-attribution-debug-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-an-attribution-debug-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an attribution debug info</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑤\">map</a> <var>data</var> and an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-debug-info\" id=\"ref-for-attribution-debug-info③\">attribution debug info</a> <var>debugInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-debugging-can-be-enabled\" id=\"ref-for-check-if-attribution-debugging-can-be-enabled\">checking if attribution debugging can be enabled</a> with <var>debugInfo</var> is false, return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥\">Set</a> <var>data</var>[\"<code>source_debug_key</code>\"] to <var>debugInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-debug-info-source-debug-key\" id=\"ref-for-attribution-debug-info-source-debug-key①\">source debug key</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer\">serialized</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦\">Set</a> <var>data</var>[\"<code>trigger_debug_key</code>\"] to <var>debugInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-debug-info-trigger-debug-key\" id=\"ref-for-attribution-debug-info-trigger-debug-key①\">trigger debug key</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①\">serialized</a>.</p>"
        }
      ]
    },
    {
      "name": "check if aggregatable debug reporting should be blocked by rate-limit",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-aggregatable-debug-reporting-should-be-blocked-by-rate-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-aggregatable-debug-reporting-should-be-blocked-by-rate-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if aggregatable debug reporting should be blocked by rate-limit</dfn>\ngiven an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record\" id=\"ref-for-aggregatable-debug-rate-limit-record①\">aggregatable debug rate-limit record</a> <var>newRecord</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingRecords</var> be all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record\" id=\"ref-for-aggregatable-debug-rate-limit-record②\">aggregatable debug rate-limit records</a>\n<var>record</var> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-cache\" id=\"ref-for-aggregatable-debug-rate-limit-cache①\">aggregatable debug rate-limit cache</a> where all of the following\nare true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-context-site\" id=\"ref-for-aggregatable-debug-rate-limit-record-context-site②\">context site</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-context-site\" id=\"ref-for-aggregatable-debug-rate-limit-record-context-site③\">context site</a> are equal</p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from③\">duration from</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-time\" id=\"ref-for-aggregatable-debug-rate-limit-record-time\">time</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-time\" id=\"ref-for-aggregatable-debug-rate-limit-record-time①\">time</a> is &lt;= <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-window\" id=\"ref-for-aggregatable-debug-rate-limit-window②\">aggregatable debug rate-limit window</a></p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>totalBudget</var> be <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-consumed-budget\" id=\"ref-for-aggregatable-debug-rate-limit-record-consumed-budget\">consumed budget</a>.</p>"
        },
        {
          "html": "<p>Let <var>totalSameReportingBudget</var> be <var>totalBudget</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑤\">For each</a> <var>record</var> of <var>matchingRecords</var>:",
          "rationale": "increment",
          "steps": [
            {
              "html": "<p>Increment <var>totalBudget</var> value by <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-consumed-budget\" id=\"ref-for-aggregatable-debug-rate-limit-record-consumed-budget①\">consumed budget</a>.</p>"
            },
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-reporting-site\" id=\"ref-for-aggregatable-debug-rate-limit-record-reporting-site①\">reporting site</a> and\n<var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-reporting-site\" id=\"ref-for-aggregatable-debug-rate-limit-record-reporting-site②\">reporting site</a> are equal,\nincrement <var>totalSameReportingBudget</var> by <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-consumed-budget\" id=\"ref-for-aggregatable-debug-rate-limit-record-consumed-budget②\">consumed budget</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>totalBudget</var> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-debug-budget-per-rate-limit-window\" id=\"ref-for-max-aggregatable-debug-budget-per-rate-limit-window\">max aggregatable debug budget per rate-limit window</a>[0],\nreturn <strong>blocked</strong>.</p>"
        },
        {
          "html": "<p>If <var>totalSameReportingBudget</var> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-debug-budget-per-rate-limit-window\" id=\"ref-for-max-aggregatable-debug-budget-per-rate-limit-window①\">max aggregatable debug budget per rate-limit window</a>[1],\nreturn <strong>blocked</strong>.</p>"
        },
        {
          "html": "<p>Return <strong>allowed</strong>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver an aggregatable debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-an-aggregatable-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver an aggregatable debug report</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑤\">list</a>\nof <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution③\">aggregatable contributions</a> <var>contributions</var>,\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①⑦\">suitable origin</a> <var>reportingOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①⑨\">site</a> <var>effectiveDestination</var>,\nan <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregation-coordinator\" id=\"ref-for-aggregation-coordinator⑤\">aggregation coordinator</a> <var>aggregationCoordinator</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①①\">moment</a> <var>now</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: <var>effectiveDestination</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque②\">opaque origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>report</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-report\" id=\"ref-for-aggregatable-debug-report⑥\">aggregatable debug report</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin②\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-effective-attribution-destination\" id=\"ref-for-aggregatable-report-effective-attribution-destination①\">effective attribution destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>effectiveDestination</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time\">report time</a>\n       </dt><dd data-md=\"\">\n        <p><var>now</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-external-id\" id=\"ref-for-attribution-report-external-id\">external ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/uuid/#dfn-generate-a-random-uuid\" id=\"ref-for-dfn-generate-a-random-uuid\">generating a random UUID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id\">internal ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-next-internal-id\" id=\"ref-for-get-the-next-internal-id\">getting the next internal ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-contributions\" id=\"ref-for-aggregatable-report-contributions①\">contributions</a>\n       </dt><dd data-md=\"\">\n        <p><var>contributions</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-aggregation-coordinator\" id=\"ref-for-aggregatable-report-aggregation-coordinator\">aggregation coordinator</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregationCoordinator</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-an-aggregatable-debug-report\" id=\"ref-for-attempt-to-deliver-an-aggregatable-debug-report\">attempt to deliver an aggregatable debug report</a> with <var>report</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver an aggregatable debug report on registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-an-aggregatable-debug-report-on-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver an aggregatable debug report on registration</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑥\">list</a> <var>contributions</var>,\na <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site②⓪\">site</a> <var>contextSite</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑤\">origin</a> <var>reportingOrigin</var>, a possibly null\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source④⑦\">attribution source</a> <var>source</var>, a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site②①\">site</a> <var>effectiveDestination</var>,\nan <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregation-coordinator\" id=\"ref-for-aggregation-coordinator⑥\">aggregation coordinator</a> <var>aggregationCoordinator</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①②\">moment</a> <var>now</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>contributions</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑤\">is empty</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report\">obtain and deliver an aggregatable debug report</a>\nwith «», <var>contextSite</var>, <var>reportingOrigin</var>, <var>effectiveDestination</var>,\n<var>aggregationCoordinator</var>, and <var>now</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>remainingBudget</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source①\">allowed aggregatable budget per source</a>.</p>"
        },
        {
          "html": "<p>Let <var>numReports</var> be 0.</p>"
        },
        {
          "html": "If <var>source</var> is not null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>remainingBudget</var> to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-aggregatable-debug-budget\" id=\"ref-for-attribution-source-remaining-aggregatable-debug-budget\">remaining aggregatable debug budget</a>.</p>"
            },
            {
              "html": "<p>Set <var>numReports</var> to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-aggregatable-debug-reports\" id=\"ref-for-attribution-source-number-of-aggregatable-debug-reports\">number of aggregatable debug reports</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>requiredBudget</var> be the total <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value①\">value</a> of <var>contributions</var>.</p>"
        },
        {
          "html": "If <var>requiredBudget</var> is greater than <var>remainingBudget</var>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report①\">obtain and deliver an aggregatable debug report</a> with «»,\n<var>reportingOrigin</var>, <var>effectiveDestination</var>, <var>aggregationCoordinator</var>, and <var>now</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "If <var>numReports</var> is equal to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-reports-per-source\" id=\"ref-for-max-aggregatable-reports-per-source\">max aggregatable reports per source</a>[1]:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report②\">obtain and deliver an aggregatable debug report</a> with «»,\n<var>reportingOrigin</var>, <var>effectiveDestination</var>, <var>aggregationCoordinator</var>, and <var>now</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>rateLimitRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record\" id=\"ref-for-aggregatable-debug-rate-limit-record③\">aggregatable debug rate-limit record</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-context-site\" id=\"ref-for-aggregatable-debug-rate-limit-record-context-site④\">context site</a>\n       </dt><dd data-md=\"\">\n        <p><var>contextSite</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-reporting-site\" id=\"ref-for-aggregatable-debug-rate-limit-record-reporting-site③\">reporting site</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site③\">obtaining a site</a> from <var>reportingOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-time\" id=\"ref-for-aggregatable-debug-rate-limit-record-time②\">time</a>\n       </dt><dd data-md=\"\">\n        <p><var>now</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-consumed-budget\" id=\"ref-for-aggregatable-debug-rate-limit-record-consumed-budget③\">consumed budget</a>\n       </dt><dd data-md=\"\">\n        <p><var>requiredBudget</var></p>\n      </dd></dl>"
        },
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-aggregatable-debug-reporting-should-be-blocked-by-rate-limit\" id=\"ref-for-check-if-aggregatable-debug-reporting-should-be-blocked-by-rate-limit\">check if aggregatable debug reporting should be blocked by rate-limit</a>\nwith <var>rateLimitRecord</var> is <strong>blocked</strong>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report③\">obtain and deliver an aggregatable debug report</a> with «»,\n<var>reportingOrigin</var>, <var>effectiveDestination</var>, <var>aggregationCoordinator</var>, and <var>now</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report④\">obtain and deliver an aggregatable debug report</a> with <var>contributions</var>,\n<var>reportingOrigin</var>, <var>effectiveDestination</var>, <var>aggregationCoordinator</var>, and <var>now</var>.</p>"
        },
        {
          "html": "If <var>source</var> is not null:",
          "rationale": "decrement",
          "steps": [
            {
              "html": "<p>Decrement <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-aggregatable-debug-budget\" id=\"ref-for-attribution-source-remaining-aggregatable-debug-budget①\">remaining aggregatable debug budget</a>\nvalue by <var>requiredBudget</var>.</p>"
            },
            {
              "html": "<p>Increment <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-aggregatable-debug-reports\" id=\"ref-for-attribution-source-number-of-aggregatable-debug-reports①\">number of aggregatable debug reports</a>\nvalue by 1.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">Append</a>  <var>rateLimitRecord</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-cache\" id=\"ref-for-aggregatable-debug-rate-limit-cache②\">aggregatable debug rate-limit cache</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove③\">Remove</a> all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record\" id=\"ref-for-aggregatable-debug-rate-limit-record④\">aggregatable debug rate-limit records</a> <var>entry</var> from the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-cache\" id=\"ref-for-aggregatable-debug-rate-limit-cache③\">aggregatable debug rate-limit cache</a> if the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from④\">duration from</a> <var>entry</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-record-time\" id=\"ref-for-aggregatable-debug-rate-limit-record-time③\">time</a> and <var>now</var> is &gt; <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-rate-limit-window\" id=\"ref-for-aggregatable-debug-rate-limit-window③\">aggregatable debug rate-limit window</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain a set of possible trigger states",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-set-of-possible-trigger-states",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-set-of-possible-trigger-states\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a set of possible trigger states</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration\" id=\"ref-for-randomized-response-output-configuration②\">randomized response output configuration</a> <var>config</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>possibleTriggerStates</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑥\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑥\">For each</a> <var>triggerData</var> of <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration-trigger-data\" id=\"ref-for-randomized-response-output-configuration-trigger-data\">trigger data</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑦\">For each</a> <var>reportWindow</var> of <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration-event-level-report-windows\" id=\"ref-for-randomized-response-output-configuration-event-level-report-windows\">event-level report windows</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>state</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state\" id=\"ref-for-trigger-state②\">trigger state</a> with the items:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state-trigger-data\" id=\"ref-for-trigger-state-trigger-data\">trigger data</a>\n           </dt><dd data-md=\"\">\n            <p><var>triggerData</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state-report-window\" id=\"ref-for-trigger-state-report-window\">report window</a>\n           </dt><dd data-md=\"\">\n            <p><var>reportWindow</var></p>\n          </dd></dl>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">Append</a> <var>state</var> to <var>possibleTriggerStates</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>possibleValues</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑦\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑧\">For each</a> integer <var>attributions</var> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range①\">the range</a> 0 to <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration-max-attributions-per-source\" id=\"ref-for-randomized-response-output-configuration-max-attributions-per-source\">max attributions per source</a>, inclusive:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">Append</a> to <var>possibleValues</var> all distinct\n<var>attributions</var>-<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①②\">size</a> combinations of <var>possibleTriggerStates</var>\nwith repetition.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>possibleValues</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain a randomized source response pick rate",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-source-response-pick-rate",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-randomized-source-response-pick-rate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a randomized source response pick rate</dfn> given a positive integer <var>states</var> and a double <var>epsilon</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return <var>states</var> / (<var>states</var> − 1 + e<sup><var>epsilon</var></sup>).</p>"
        }
      ]
    },
    {
      "name": "obtain a randomized source response",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-source-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-randomized-source-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a randomized source response</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑧\">set</a> of possible trigger states <var>possibleValues</var> and a double <var>epsilon</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>pickRate</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-source-response-pick-rate\" id=\"ref-for-obtain-a-randomized-source-response-pick-rate\">obtaining a randomized source response pick rate</a> with <var>possibleValues</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①③\">size</a> and <var>epsilon</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-response\" id=\"ref-for-obtain-a-randomized-response\">obtaining a randomized response</a> with null, <var>possibleValues</var>, and\n<var>pickRate</var>.</p>"
        }
      ]
    },
    {
      "name": "compute the channel capacity of a source",
      "href": "https://wicg.github.io/attribution-reporting-api/#compute-the-channel-capacity-of-a-source",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-channel-capacity-of-a-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the channel capacity of a source</dfn> given a positive integer <var>states</var> and a double <var>epsilon</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>states</var> is 1, return 0.</p>"
        },
        {
          "html": "<p>If <var>states</var> is greater than the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-trigger-state-cardinality\" id=\"ref-for-max-trigger-state-cardinality\">max trigger-state cardinality</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>pickRate</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-source-response-pick-rate\" id=\"ref-for-obtain-a-randomized-source-response-pick-rate①\">randomized response pick rate</a> with <var>states</var> and <var>epsilon</var>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <var>pickRate</var> × (<var>states</var> − 1) / <var>states</var>.</p>"
        },
        {
          "html": "<p>Return log2(<var>states</var>) − h(<var>p</var>) − <var>p</var> × log2(<var>states</var> − 1) where h is the binary entropy function <a data-link-type=\"biblio\" href=\"https://wicg.github.io/attribution-reporting-api/#biblio-bin-ent\" title=\"Binary entropy function\">[BIN-ENT]</a>.</p>"
        }
      ]
    },
    {
      "name": "compute the scopes channel capacity of a source",
      "href": "https://wicg.github.io/attribution-reporting-api/#compute-the-scopes-channel-capacity-of-a-source",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-scopes-channel-capacity-of-a-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the scopes channel capacity of a source</dfn> given a positive integer <var>numTriggerStates</var>, a positive integer <var>attributionScopeLimit</var>, and a positive integer <var>maxEventStates</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>totalStates</var> be <var>numTriggerStates</var> + <var>maxEventStates</var> × (<var>attributionScopeLimit</var> − 1).</p>"
        },
        {
          "html": "<p>Return log2(<var>totalStates</var>).</p>"
        }
      ]
    },
    {
      "name": "parse an attribution destination",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-an-attribution-destination",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-attribution-destination\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an attribution destination</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③③\">string</a> <var>str</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①\">URL parser</a> on the value of\nthe <var>str</var>.</p>"
        },
        {
          "html": "<p>If <var>url</var> is failure or null, return an error.</p>"
        },
        {
          "html": "<p>If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin④\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable\" id=\"ref-for-check-if-an-origin-is-suitable④\">suitable</a>,\nreturn an error.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site④\">obtaining a site</a> from <var>url</var>’s\n<a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑤\">origin</a>.</p>"
        }
      ]
    },
    {
      "name": "parse attribution destinations",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-attribution-destinations",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-attribution-destinations\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse attribution destinations</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑥\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-destination\" id=\"ref-for-source-registration-json-key-destination①\">destination</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑨\">exist</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>val</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-destination\" id=\"ref-for-source-registration-json-key-destination②\">destination</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>val</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③④\">string</a>, set <var>val</var> to « <var>val</var> ».</p>"
        },
        {
          "html": "<p>If <var>val</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑦\">list</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑨\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑨\">For each</a> <var>value</var> of <var>val</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑤\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>destination</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-attribution-destination\" id=\"ref-for-parse-an-attribution-destination\">parse an attribution destination</a> with <var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>destination</var> is an error, return it.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑤\">Append</a> <var>destination</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>result</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑥\">is empty</a> or its <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①④\">size</a> is greater than the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-per-source\" id=\"ref-for-max-destinations-per-source\">max destinations per source</a>, return an error.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-ascending-order\" id=\"ref-for-list-sort-in-ascending-order①\">Sort</a> <var>result</var> in ascending order, with <var>a</var>\nbeing less than <var>b</var> if <var>a</var>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>,\nis less than <var>b</var>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>"
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parse a duration",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-a-duration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-a-duration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse a duration</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑦\">map</a> <var>map</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑥\">string</a> <var>key</var>, and a\ntuple of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①⓪\">durations</a> (<var>clampStart</var>, <var>clampEnd</var>):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a>: <var>clampStart</var> &lt; <var>clampEnd</var>.</p>"
        },
        {
          "html": "<p>Let <var>seconds</var> be null.</p>"
        },
        {
          "html": "<p>If <var>map</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⓪\">exists</a> and is a non-negative integer, set <var>seconds</var> to <var>map</var>[<var>key</var>].</p>"
        },
        {
          "html": "<p>Otherwise, set <var>seconds</var> to the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer\">parse an optional 64-bit unsigned integer</a> with <var>map</var>, <var>key</var>, and null.</p>"
        },
        {
          "html": "<p>If <var>seconds</var> is an error, return an error.</p>"
        },
        {
          "html": "<p>If <var>seconds</var> is null, return <var>clampEnd</var>.</p>"
        },
        {
          "html": "<p>Let <var>duration</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①①\">duration</a> of <var>seconds</var> seconds.</p>"
        },
        {
          "html": "<p>If <var>duration</var> is less than <var>clampStart</var>, return <var>clampStart</var>.</p>"
        },
        {
          "html": "<p>If <var>duration</var> is greater than <var>clampEnd</var>, return <var>clampEnd</var>.</p>"
        },
        {
          "html": "<p>Return <var>duration</var>.</p>"
        }
      ]
    },
    {
      "name": "parse aggregation keys",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregation-keys",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregation-keys\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregation keys</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑧\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>aggregationKeys</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑨\">map</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-aggregation_keys\" id=\"ref-for-source-registration-json-key-aggregation_keys\">aggregation_keys</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②①\">exist</a>, return <var>aggregationKeys</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-aggregation_keys\" id=\"ref-for-source-registration-json-key-aggregation_keys①\">aggregation_keys</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⓪\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>If <var>values</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size④\">size</a> is greater than the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregation-keys-per-source-registration\" id=\"ref-for-max-aggregation-keys-per-source-registration\">max aggregation keys per source registration</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②\">For each</a> <var>key</var> → <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>key</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑦\">length</a> is greater than the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-length-per-aggregation-key-identifier\" id=\"ref-for-max-length-per-aggregation-key-identifier\">max length per aggregation key identifier</a>,\nreturn an error.</p>"
            },
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑦\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>keyPiece</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-key-piece\" id=\"ref-for-parse-an-aggregation-key-piece②\">parse an aggregation key piece</a> with <var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>keyPiece</var> is an error, return it.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑧\">Set</a> <var>aggregationKeys</var>[<var>key</var>] to <var>keyPiece</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>aggregationKeys</var>.</p>"
        }
      ]
    },
    {
      "name": "parse named budgets for source",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-named-budgets-for-source",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-named-budgets-for-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse named budgets for source</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③①\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>namedBudgets</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③②\">map</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-named_budgets\" id=\"ref-for-source-registration-json-key-named_budgets\">named_budgets</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②②\">exist</a>, return <var>namedBudgets</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-named_budgets\" id=\"ref-for-source-registration-json-key-named_budgets①\">named_budgets</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③③\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>If <var>values</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size⑤\">size</a> is greater than the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-named-budgets-per-source-registration\" id=\"ref-for-max-named-budgets-per-source-registration\">max named budgets per source registration</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③\">For each</a> <var>key</var> → <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>key</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑧\">length</a> is greater than the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-length-per-budget-name-for-source\" id=\"ref-for-max-length-per-budget-name-for-source\">max length per budget name for source</a>,\nreturn an error.</p>"
            },
            {
              "html": "<p>If <var>value</var> is not an integer or is less than 0 or is greater than\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source②\">allowed aggregatable budget per source</a>, return an error.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑨\">Set</a> <var>namedBudgets</var>[<var>key</var>] to <var>value</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>namedBudgets</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain default effective windows",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-default-effective-windows",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-default-effective-windows\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain default effective windows</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type\" id=\"ref-for-source-type③\">source type</a> <var>sourceType</var>,\na <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①③\">moment</a> <var>sourceTime</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①②\">duration</a> <var>eventReportWindow</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>deadlines</var> be «» if <var>sourceType</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-event\" id=\"ref-for-source-type-event①⓪\">event</a></code>\", else « 2 days, 7 days ».</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove④\">Remove</a> all elements in <var>deadlines</var> that are greater than or equal to <var>eventReportWindow</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①①\">Append</a> <var>eventReportWindow</var> to <var>deadlines</var>.</p>"
        },
        {
          "html": "<p>Let <var>lastEnd</var> be <var>sourceTime</var>.</p>"
        },
        {
          "html": "<p>Let <var>windows</var> be «».</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⓪\">For each</a> <var>deadline</var> of <var>deadlines</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>window</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window\" id=\"ref-for-report-window⑥\">report window</a> whose items are</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-start\" id=\"ref-for-report-window-start⑤\">start</a>\n         </dt><dd data-md=\"\">\n          <p><var>lastEnd</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-end\" id=\"ref-for-report-window-end④\">end</a>\n         </dt><dd data-md=\"\">\n          <p><var>lastEnd</var> + <var>deadline</var></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①②\">Append</a> <var>window</var> to <var>windows</var>.</p>"
            },
            {
              "html": "<p>Set <var>lastEnd</var> to <var>lastEnd</var> + <var>deadline</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>windows</var>.</p>"
        }
      ]
    },
    {
      "name": "parse top-level report windows",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-top-level-report-windows",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-top-level-report-windows\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse top-level report windows</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③④\">map</a> <var>map</var>, a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①④\">moment</a> <var>sourceTime</var>,\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type\" id=\"ref-for-source-type④\">source type</a> <var>sourceType</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①③\">duration</a> <var>expiry</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_report_window\" id=\"ref-for-source-registration-json-key-event_report_window\">event_report_window</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②③\">exists</a> and\n<var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_report_windows\" id=\"ref-for-source-registration-json-key-event_report_windows\">event_report_windows</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②④\">exists</a>, return an error.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_report_window\" id=\"ref-for-source-registration-json-key-event_report_window①\">event_report_window</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑤\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>eventReportWindow</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-duration\" id=\"ref-for-parse-a-duration\">parse a duration</a>\nwith <var>map</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_report_window\" id=\"ref-for-source-registration-json-key-event_report_window②\">event_report_window</a></code>\", and (<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#min-report-window\" id=\"ref-for-min-report-window\">min report window</a>, <var>expiry</var>).</p>"
            },
            {
              "html": "<p>If <var>eventReportWindow</var> is an error, return <var>eventReportWindow</var>.</p>"
            },
            {
              "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-default-effective-windows\" id=\"ref-for-obtain-default-effective-windows\">obtaining default effective windows</a> given <var>sourceType</var>, <var>sourceTime</var>, and <var>eventReportWindow</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_report_windows\" id=\"ref-for-source-registration-json-key-event_report_windows①\">event_report_windows</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑥\">exist</a>, return the result\nof <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-default-effective-windows\" id=\"ref-for-obtain-default-effective-windows①\">obtaining default effective windows</a> given <var>sourceType</var>, <var>sourceTime</var>,\nand <var>expiry</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-report-windows\" id=\"ref-for-parse-report-windows\">parsing report windows</a> with\n<var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_report_windows\" id=\"ref-for-source-registration-json-key-event_report_windows②\">event_report_windows</a></code>\"], <var>sourceTime</var>, and <var>expiry</var>.</p>"
        }
      ]
    },
    {
      "name": "parse report windows",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-report-windows",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-report-windows\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse report windows</dfn> given a <var>value</var>, a\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①⑤\">moment</a> <var>sourceTime</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①④\">duration</a> <var>expiry</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑤\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>startDuration</var> be 0 seconds.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-start_time\" id=\"ref-for-source-registration-json-key-start_time\">start_time</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑦\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>start</var> be <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-start_time\" id=\"ref-for-source-registration-json-key-start_time①\">start_time</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>start</var> is not a non-negative integer, return an error.</p>"
            },
            {
              "html": "<p>Set <var>startDuration</var> to <var>start</var> seconds.</p>"
            },
            {
              "html": "<p>If <var>startDuration</var> is greater than <var>expiry</var>, return an error.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-end_times\" id=\"ref-for-source-registration-json-key-end_times\">end_times</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑧\">exist</a> or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑧\">list</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>endDurations</var> be <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-end_times\" id=\"ref-for-source-registration-json-key-end_times①\">end_times</a></code>\"].</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑤\">size</a> of <var>endDurations</var> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-settable-event-level-report-windows\" id=\"ref-for-max-settable-event-level-report-windows\">max settable event-level report windows</a>, return an error.</p>"
        },
        {
          "html": "<p>If <var>endDurations</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑦\">is empty</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>windows</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑨\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②①\">For each</a> <var>end</var> of <var>endDurations</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>end</var> is not a positive integer, return an error.</p>"
            },
            {
              "html": "<p>Let <var>endDuration</var> be <var>end</var> seconds.</p>"
            },
            {
              "html": "<p>If <var>endDuration</var> is greater than <var>expiry</var>, set <var>endDuration</var> to <var>expiry</var>.</p>"
            },
            {
              "html": "<p>If <var>endDuration</var> is less than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#min-report-window\" id=\"ref-for-min-report-window①\">min report window</a>, set <var>endDuration</var> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#min-report-window\" id=\"ref-for-min-report-window②\">min report window</a>.</p>"
            },
            {
              "html": "<p>If <var>endDuration</var> is less than or equal to <var>startDuration</var>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>window</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window\" id=\"ref-for-report-window⑦\">report window</a> whose items are</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-start\" id=\"ref-for-report-window-start⑥\">start</a>\n         </dt><dd data-md=\"\">\n          <p><var>sourceTime</var> + <var>startDuration</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-end\" id=\"ref-for-report-window-end⑤\">end</a>\n         </dt><dd data-md=\"\">\n          <p><var>sourceTime</var> + <var>endDuration</var></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①③\">Append</a> <var>window</var> to <var>windows</var>.</p>"
            },
            {
              "html": "<p>Set <var>startDuration</var> to <var>endDuration</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>windows</var>.</p>"
        }
      ]
    },
    {
      "name": "parse trigger data into a trigger data set",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-trigger-data-into-a-trigger-data-set",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-trigger-data-into-a-trigger-data-set\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse trigger data into a trigger data set</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑥\">map</a> <var>map</var>,\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-data-matching-mode\" id=\"ref-for-trigger-data-matching-mode①\">trigger-data matching mode</a> <var>matchingMode</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type\" id=\"ref-for-source-type⑤\">source type</a> <var>sourceType</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>set</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-data-set\" id=\"ref-for-trigger-data-set③\">trigger data set</a>.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-trigger_data\" id=\"ref-for-source-registration-json-key-trigger_data\">trigger_data</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑨\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>triggerDataList</var> be\n<var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-trigger_data\" id=\"ref-for-source-registration-json-key-trigger_data①\">trigger_data</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>triggerDataList</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⓪\">list</a> or its <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑥\">size</a> is greater than\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-distinct-trigger-data-per-source\" id=\"ref-for-max-distinct-trigger-data-per-source\">max distinct trigger data per source</a>, return an error.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②②\">For each</a> <var>triggerData</var> of <var>triggerDataList</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>triggerData</var> is not an integer or cannot be represented by an\nunsigned 32-bit integer, or <var>set</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain④\">contains</a> <var>triggerData</var>,\nreturn an error.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑥\">Append</a> <var>triggerData</var> to <var>set</var>.</p>"
                },
                {
                  "html": "<p>If <var>set</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑦\">size</a> is greater than\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-distinct-trigger-data-per-source\" id=\"ref-for-max-distinct-trigger-data-per-source①\">max distinct trigger data per source</a>, return an error.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②③\">For each</a> integer <var>triggerData</var> of\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-exclusive-range\" id=\"ref-for-the-exclusive-range\">the range</a> 0 to\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-trigger-data-cardinality\" id=\"ref-for-default-trigger-data-cardinality②\">default trigger data cardinality</a>[<var>sourceType</var>], exclusive:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑦\">Append</a> <var>triggerData</var> to <var>set</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>matchingMode</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-data-matching-mode-modulus\" id=\"ref-for-trigger-data-matching-mode-modulus①\">modulus</a></code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>i</var> be 0.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②④\">For each</a> <var>triggerData</var> of <var>set</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>triggerData</var> does not equal <var>i</var>, return an error.</p>"
                },
                {
                  "html": "<p>Set <var>i</var> to <var>i</var> + 1.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>set</var>.</p>"
        }
      ]
    },
    {
      "name": "parse a source aggregatable debug reporting config",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-a-source-aggregatable-debug-reporting-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-a-source-aggregatable-debug-reporting-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse a source aggregatable debug reporting config</dfn> given <var>value</var>, a\nnon-negative integer <var>defaultBudget</var>, and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config\" id=\"ref-for-aggregatable-debug-reporting-config④\">aggregatable debug reporting config</a>\n<var>defaultConfig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑦\">map</a>, return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple⑦\">tuple</a> (<var>defaultBudget</var>, <var>defaultConfig</var>).</p>"
        },
        {
          "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-budget\" id=\"ref-for-source-registration-json-key-budget\">budget</a></code>\"] does not\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⓪\">exist</a>, return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple⑧\">tuple</a> (<var>defaultBudget</var>, <var>defaultConfig</var>).</p>"
        },
        {
          "html": "<p>Let <var>budget</var> be <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-budget\" id=\"ref-for-source-registration-json-key-budget①\">budget</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>budget</var> is not an integer or is less than or equal to 0 or is greater than\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source③\">allowed aggregatable budget per source</a>, return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple⑨\">tuple</a> (<var>defaultBudget</var>, <var>defaultConfig</var>).</p>"
        },
        {
          "html": "<p>Let <var>supportedTypes</var> be the set of all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type\" id=\"ref-for-source-debug-data-type\">source debug data types</a>.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregatable-debug-reporting-config\" id=\"ref-for-parse-an-aggregatable-debug-reporting-config\">parse an aggregatable debug reporting config</a>\nwith <var>value</var>, <var>budget</var>, <var>supportedTypes</var>, and <var>defaultConfig</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①⓪\">tuple</a> (<var>budget</var>, <var>config</var>).</p>"
        }
      ]
    },
    {
      "name": "parse attribution scopes",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-attribution-scopes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-attribution-scopes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse attribution scopes</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑧\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-attribution_scopes\" id=\"ref-for-source-registration-json-key-attribution_scopes\">attribution_scopes</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③①\">exist</a>, return null.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-attribution_scopes\" id=\"ref-for-source-registration-json-key-attribution_scopes①\">attribution_scopes</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑨\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-limit\" id=\"ref-for-source-registration-json-key-limit\">limit</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③②\">exist</a>, return an error.</p>"
        },
        {
          "html": "<p>Set <var>limit</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-limit\" id=\"ref-for-source-registration-json-key-limit①\">limit</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>limit</var> is not an integer, cannot be represented by an unsigned 32-bit integer, or is less than or equal to zero, return an error.</p>"
        },
        {
          "html": "<p>Let <var>maxEventStates</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-max-event-states\" id=\"ref-for-parse-max-event-states\">parse max event states</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>maxEventStates</var> is an error, return an error.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-attribution-scope-values-for-source\" id=\"ref-for-parse-attribution-scope-values-for-source\">parse attribution scope values for source</a> with <var>value</var> and <var>limit</var>.</p>"
        },
        {
          "html": "<p>If <var>values</var> is an error, return an error.</p>"
        },
        {
          "html": "<p>Let <var>attributionScopes</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes\" id=\"ref-for-attribution-scopes①\">attribution scopes</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-limit\" id=\"ref-for-attribution-scopes-limit\">limit</a>\n       </dt><dd data-md=\"\">\n        <p><var>limit</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-values\" id=\"ref-for-attribution-scopes-values③\">values</a>\n       </dt><dd data-md=\"\">\n        <p><var>values</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-max-event-states\" id=\"ref-for-attribution-scopes-max-event-states①\">max event states</a>\n       </dt><dd data-md=\"\">\n        <p><var>maxEventStates</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>attributionScopes</var>.</p>"
        }
      ]
    },
    {
      "name": "parse max event states",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-max-event-states",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-max-event-states\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse max event states</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⓪\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-max_event_states\" id=\"ref-for-source-registration-json-key-max_event_states\">max_event_states</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③③\">exist</a>, return <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-max-event-states\" id=\"ref-for-default-max-event-states\">default max event states</a>.</p>"
        },
        {
          "html": "<p>Let <var>maxEventStates</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-max_event_states\" id=\"ref-for-source-registration-json-key-max_event_states①\">max_event_states</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>maxEventStates</var> is not an integer or is less than or equal to 0, return an error.</p>"
        },
        {
          "html": "<p>If <var>maxEventStates</var> is greater than the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-trigger-state-cardinality\" id=\"ref-for-max-trigger-state-cardinality①\">max trigger-state cardinality</a>, return an error.</p>"
        },
        {
          "html": "<p>Return <var>maxEventStates</var>.</p>"
        }
      ]
    },
    {
      "name": "parse attribution scope values for source",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-attribution-scope-values-for-source",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-attribution-scope-values-for-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse attribution scope values for source</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④①\">map</a> <var>map</var> and a 32-bit positive integer <var>limit</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-values\" id=\"ref-for-source-registration-json-key-values\">values</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③④\">exist</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⓪\">set</a>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-values\" id=\"ref-for-source-registration-json-key-values①\">values</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④①\">list</a>, return an error.</p>"
        },
        {
          "html": "<p>If <var>values</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑧\">is empty</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑤\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑧\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑨\">length</a> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-length-of-attribution-scope-for-source\" id=\"ref-for-max-length-of-attribution-scope-for-source\">max length of attribution scope for source</a>, return an error.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑧\">Append</a> <var>value</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>result</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑧\">size</a> is greater than <var>limit</var> or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-attribution-scopes-per-source\" id=\"ref-for-max-attribution-scopes-per-source\">max attribution scopes per source</a>, return an error.</p>"
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parse source-registration JSON",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-source-registration-json",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-source-registration-json\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse source-registration JSON</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence\">byte sequence</a>\n<var>json</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①⑧\">suitable origin</a> <var>sourceOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin①⑨\">suitable origin</a> <var>reportingOrigin</var>, a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type\" id=\"ref-for-source-type⑥\">source type</a> <var>sourceType</var>, a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①⑥\">moment</a> <var>sourceTime</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑦\">boolean</a> <var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>value</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value\" id=\"ref-for-parse-json-bytes-to-an-infra-value\">parse JSON bytes to an Infra value</a> with <var>json</var>.</p>"
        },
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④②\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>attributionDestinations</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-attribution-destinations\" id=\"ref-for-parse-attribution-destinations\">parse attribution destinations</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>attributionDestinations</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>sourceEventId</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer①\">parse an optional 64-bit unsigned integer</a> with <var>value</var>,\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-source_event_id\" id=\"ref-for-source-registration-json-key-source_event_id\">source_event_id</a></code>\", and 0.</p>"
        },
        {
          "html": "<p>If <var>sourceEventId</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>expiry</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-duration\" id=\"ref-for-parse-a-duration①\">parse a duration</a> with <var>value</var>,\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-expiry\" id=\"ref-for-source-registration-json-key-expiry\">expiry</a></code>\", and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#valid-source-expiry-range\" id=\"ref-for-valid-source-expiry-range\">valid source expiry range</a>.</p>"
        },
        {
          "html": "<p>If <var>expiry</var> is an error, return it.</p>"
        },
        {
          "html": "<p>If <var>sourceType</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-event\" id=\"ref-for-source-type-event①①\">event</a></code>\", round <var>expiry</var> away\nfrom zero to the nearest day (86400 seconds).</p>"
        },
        {
          "html": "<p>Let <var>priority</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-signed-integer\" id=\"ref-for-parse-an-optional-64-bit-signed-integer\">parse an optional 64-bit signed integer</a> with <var>value</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-priority\" id=\"ref-for-source-registration-json-key-priority\">priority</a></code>\", and</p>",
          "ignored": [
            ""
          ]
        },
        {
          "html": "<p>If <var>priority</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>destinationLimitPriority</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-signed-integer\" id=\"ref-for-parse-an-optional-64-bit-signed-integer①\">parse an optional 64-bit signed integer</a> with <var>value</var>,\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-destination_limit_priority\" id=\"ref-for-source-registration-json-key-destination_limit_priority\">destination_limit_priority</a></code>\", and 0.</p>"
        },
        {
          "html": "<p>If <var>destinationLimitPriority</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>filterData</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-map\" id=\"ref-for-filter-map③\">filter map</a>.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-filter_data\" id=\"ref-for-source-registration-json-key-filter_data\">filter_data</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑤\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>filterData</var> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-filter-data\" id=\"ref-for-parse-filter-data\">parse filter data</a> with\n<var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-filter_data\" id=\"ref-for-source-registration-json-key-filter_data①\">filter_data</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>filterData</var> is an error, return it.</p>"
            },
            {
              "html": "<p>If <var>filterData</var>[\"<code>source_type</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑥\">exists</a>, return an error.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⓪\">Set</a> <var>filterData</var>[\"<code>source_type</code>\"] to « <var>sourceType</var> ».</p>"
        },
        {
          "html": "<p>Let <var>debugKey</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer②\">parse an optional 64-bit unsigned integer</a> with <var>value</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-debug_key\" id=\"ref-for-source-registration-json-key-debug_key\">debug_key</a></code>\",\nand null.</p>"
        },
        {
          "html": "<p>If <var>debugKey</var> is an error, set <var>debugKey</var> to null.</p>"
        },
        {
          "html": "<p>Let <var>cookieBasedDebugAllowed</var> be false.</p>"
        },
        {
          "html": "<p>Let <var>sourceSite</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site⑤\">obtaining a site</a> from <var>sourceOrigin</var>.</p>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-cookie-based-debugging-is-allowed\" id=\"ref-for-check-if-cookie-based-debugging-is-allowed\">check if cookie-based debugging is allowed</a>\nwith <var>reportingOrigin</var> and <var>sourceSite</var> is <strong>allowed</strong>, set <var>cookieBasedDebugAllowed</var> to true.</p>"
        },
        {
          "html": "<p>If <var>cookieBasedDebugAllowed</var> is false, set <var>debugKey</var> to null.</p>"
        },
        {
          "html": "<p>Let <var>aggregationKeys</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregation-keys\" id=\"ref-for-parse-aggregation-keys\">parse aggregation keys</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>aggregationKeys</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>maxAttributionsPerSource</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-event-level-attributions-per-source\" id=\"ref-for-default-event-level-attributions-per-source\">default event-level attributions per source</a>[<var>sourceType</var>].</p>"
        },
        {
          "html": "<p>Set <var>maxAttributionsPerSource</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-max_event_level_reports\" id=\"ref-for-source-registration-json-key-max_event_level_reports\">max_event_level_reports</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑦\">exists</a>.</p>"
        },
        {
          "html": "<p>If <var>maxAttributionsPerSource</var> is not a non-negative integer, or is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-settable-event-level-attributions-per-source\" id=\"ref-for-max-settable-event-level-attributions-per-source\">max settable event-level attributions per source</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableReportWindowEnd</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-duration\" id=\"ref-for-parse-a-duration②\">parse a duration</a>\nwith <var>value</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-aggregatable_report_window\" id=\"ref-for-source-registration-json-key-aggregatable_report_window\">aggregatable_report_window</a></code>\", and (<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#min-report-window\" id=\"ref-for-min-report-window③\">min report window</a>, <var>expiry</var>).</p>"
        },
        {
          "html": "<p>If <var>aggregatableReportWindowEnd</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>debugReportingEnabled</var> be false.</p>"
        },
        {
          "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-debug_reporting\" id=\"ref-for-source-registration-json-key-debug_reporting\">debug_reporting</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑧\">exists</a> and is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑧\">boolean</a>, set\n<var>debugReportingEnabled</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-debug_reporting\" id=\"ref-for-source-registration-json-key-debug_reporting①\">debug_reporting</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>aggregatableReportWindow</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window\" id=\"ref-for-report-window⑧\">report window</a> with the following items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-start\" id=\"ref-for-report-window-start⑦\">start</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceTime</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-end\" id=\"ref-for-report-window-end⑥\">end</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceTime</var> + <var>aggregatableReportWindowEnd</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>triggerDataMatchingMode</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-data-matching-mode-modulus\" id=\"ref-for-trigger-data-matching-mode-modulus②\">modulus</a></code>\".</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-trigger_data_matching\" id=\"ref-for-source-registration-json-key-trigger_data_matching\">trigger_data_matching</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑨\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-trigger_data_matching\" id=\"ref-for-source-registration-json-key-trigger_data_matching①\">trigger_data_matching</a></code>\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑨\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-trigger_data_matching\" id=\"ref-for-source-registration-json-key-trigger_data_matching②\">trigger_data_matching</a></code>\"] is not a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-data-matching-mode\" id=\"ref-for-trigger-data-matching-mode②\">trigger-data matching mode</a>, return an error.</p>"
            },
            {
              "html": "<p>Set <var>triggerDataMatchingMode</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-trigger_data_matching\" id=\"ref-for-source-registration-json-key-trigger_data_matching③\">trigger_data_matching</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>eventReportWindows</var> be the result of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-top-level-report-windows\" id=\"ref-for-parse-top-level-report-windows\">parsing top-level report windows</a> with <var>value</var>, <var>sourceTime</var>, <var>sourceType</var>,\nand <var>expiry</var>.</p>"
        },
        {
          "html": "<p>If <var>eventReportWindows</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>triggerDataSet</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-trigger-data-into-a-trigger-data-set\" id=\"ref-for-parse-trigger-data-into-a-trigger-data-set\">parsing trigger data into a trigger data set</a> with <var>value</var>,\n<var>triggerDataMatchingMode</var>, and <var>sourceType</var>.</p>"
        },
        {
          "html": "<p>If <var>triggerDataSet</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>attributionScopes</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-attribution-scopes\" id=\"ref-for-parse-attribution-scopes\">parse attribution scopes</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>attributionScopes</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>epsilon</var> be the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-settable-event-level-epsilon\" id=\"ref-for-max-settable-event-level-epsilon\">max settable event-level epsilon</a>.</p>"
        },
        {
          "html": "<p>Set <var>epsilon</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-event_level_epsilon\" id=\"ref-for-source-registration-json-key-event_level_epsilon\">event_level_epsilon</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⓪\">exists</a>:</p>"
        },
        {
          "html": "<p>If <var>epsilon</var> is not a double, is less than 0, or is greater than the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-settable-event-level-epsilon\" id=\"ref-for-max-settable-event-level-epsilon①\">max settable event-level epsilon</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableDebugBudget</var> be 0.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableDebugReportingConfig</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config\" id=\"ref-for-aggregatable-debug-reporting-config⑤\">aggregatable debug reporting config</a>.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-aggregatable_debug_reporting\" id=\"ref-for-source-registration-json-key-aggregatable_debug_reporting\">aggregatable_debug_reporting</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④①\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set (<var>aggregatableDebugBudget</var>, <var>aggregatableDebugReportingConfig</var>) to the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-source-aggregatable-debug-reporting-config\" id=\"ref-for-parse-a-source-aggregatable-debug-reporting-config\">parse a source aggregatable debug reporting config</a> with\n<var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-registration-json-key-aggregatable_debug_reporting\" id=\"ref-for-source-registration-json-key-aggregatable_debug_reporting①\">aggregatable_debug_reporting</a></code>\"],\n<var>aggregatableDebugBudget</var>, and <var>aggregatableDebugReportingConfig</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>aggregatableAttributionBudget</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source④\">allowed aggregatable budget per source</a> − <var>aggregatableDebugBudget</var>.</p>"
        },
        {
          "html": "<p>Let <var>namedBudgets</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-named-budgets-for-source\" id=\"ref-for-parse-named-budgets-for-source\">parsing named budgets for source</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>namedBudgets</var> is an error, return it.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#automation-local-testing-mode\" id=\"ref-for-automation-local-testing-mode③\">automation local testing mode</a> is true, set <var>epsilon</var> to <code>∞</code>.</p>"
        },
        {
          "html": "<p>Let <var>source</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source④⑧\">attribution source</a> struct whose items are:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id\">internal ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-next-internal-id\" id=\"ref-for-get-the-next-internal-id①\">getting the next internal ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-origin\" id=\"ref-for-attribution-source-source-origin②\">source origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-id\" id=\"ref-for-attribution-source-event-id\">event ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceEventId</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations⑧\">attribution destinations</a>\n       </dt><dd data-md=\"\">\n        <p><var>attributionDestinations</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin⑧\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-expiry\" id=\"ref-for-attribution-source-expiry②\">expiry</a>\n       </dt><dd data-md=\"\">\n        <p><var>expiry</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-report-windows\" id=\"ref-for-attribution-source-event-level-report-windows②\">event-level report windows</a>\n       </dt><dd data-md=\"\">\n        <p><var>eventReportWindows</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-trigger-data\" id=\"ref-for-attribution-source-trigger-data①\">trigger data</a>\n       </dt><dd data-md=\"\">\n        <p><var>triggerDataSet</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-report-window\" id=\"ref-for-attribution-source-aggregatable-report-window①\">aggregatable report window</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableReportWindow</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-priority\" id=\"ref-for-attribution-source-priority\">priority</a>\n       </dt><dd data-md=\"\">\n        <p><var>priority</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②\">source time</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceTime</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-type\" id=\"ref-for-attribution-source-source-type\">source type</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceType</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports\">number of event-level reports</a>\n       </dt><dd data-md=\"\">\n        <p>0</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-max-number-of-event-level-reports\" id=\"ref-for-attribution-source-max-number-of-event-level-reports①\">max number of event-level reports</a>\n       </dt><dd data-md=\"\">\n        <p><var>maxAttributionsPerSource</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-epsilon\" id=\"ref-for-attribution-source-event-level-epsilon\">event-level epsilon</a>\n       </dt><dd data-md=\"\">\n        <p><var>epsilon</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-filter-data\" id=\"ref-for-attribution-source-filter-data③\">filter data</a>\n       </dt><dd data-md=\"\">\n        <p><var>filterData</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key\">debug key</a>\n       </dt><dd data-md=\"\">\n        <p><var>debugKey</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregation-keys\" id=\"ref-for-attribution-source-aggregation-keys②\">aggregation keys</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregationKeys</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-aggregatable-attribution-budget\" id=\"ref-for-attribution-source-remaining-aggregatable-attribution-budget\">remaining aggregatable attribution budget</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableAttributionBudget</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-named-budgets\" id=\"ref-for-attribution-source-named-budgets②\">named budgets</a>\n       </dt><dd data-md=\"\">\n        <p><var>namedBudgets</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-named-budgets\" id=\"ref-for-attribution-source-remaining-named-budgets②\">remaining named budgets</a>\n       </dt><dd data-md=\"\">\n        <p><var>namedBudgets</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-reporting-enabled\" id=\"ref-for-attribution-source-debug-reporting-enabled\">debug reporting enabled</a>\n       </dt><dd data-md=\"\">\n        <p><var>debugReportingEnabled</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-trigger-data-matching-mode\" id=\"ref-for-attribution-source-trigger-data-matching-mode①\">trigger-data matching mode</a>\n       </dt><dd data-md=\"\">\n        <p><var>triggerDataMatchingMode</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cookie-based-debug-allowed\" id=\"ref-for-attribution-source-cookie-based-debug-allowed\">cookie-based debug allowed</a>\n       </dt><dd data-md=\"\">\n        <p><var>cookieBasedDebugAllowed</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-fenced\" id=\"ref-for-attribution-source-fenced\">fenced</a>\n       </dt><dd data-md=\"\">\n        <p><var>fenced</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-aggregatable-debug-budget\" id=\"ref-for-attribution-source-remaining-aggregatable-debug-budget②\">remaining aggregatable debug budget</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableDebugBudget</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-debug-reporting-config\" id=\"ref-for-attribution-source-aggregatable-debug-reporting-config\">aggregatable debug reporting config</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableDebugReportingConfig</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-destination-limit-priority\" id=\"ref-for-attribution-source-destination-limit-priority\">destination limit priority</a>\n       </dt><dd data-md=\"\">\n        <p><var>destinationLimitPriority</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes\">attribution scopes</a>\n       </dt><dd data-md=\"\">\n        <p><var>attributionScopes</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>source</var>.</p>"
        }
      ]
    },
    {
      "name": "check if an attribution source exceeds the time-based destination limits",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-exceeds-the-time-based-destination-limits",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-source-exceeds-the-time-based-destination-limits\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source④⑨\">attribution source</a> exceeds the time-based destination limits</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⓪\">attribution source</a> <var>source</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingSources</var> be all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record⑤\">attribution rate-limit records</a> <var>record</var> in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache②\">attribution rate-limit cache</a> where all of the following are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope③\">scope</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-source\" id=\"ref-for-rate-limit-scope-source①\">source</a></code>\"</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site⑥\">source site</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site④\">source site</a> are equal</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time①\">expiry time</a> is greater than <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time③\">source time</a></p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from⑤\">duration from</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time②\">time</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time④\">source time</a>\nis less than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-window\" id=\"ref-for-destination-rate-limit-window②\">destination rate-limit window</a></p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>matchingSameReportingSources</var> be all the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record⑥\">records</a> in <var>matchingSources</var>\nwhose associated <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin④\">reporting origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site\">same site</a> with <var>source</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin⑨\">reporting origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>destinations</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③①\">set</a> of every <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination⑤\">attribution destination</a> in <var>matchingSources</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union①\">unioned</a> with <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations⑨\">attribution destinations</a>.</p>"
        },
        {
          "html": "<p>Let <var>sameReportingDestinations</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③②\">set</a> of every <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination⑥\">attribution destination</a> in <var>matchingSameReportingSources</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union②\">unioned</a> with <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①⓪\">attribution destinations</a>.</p>"
        },
        {
          "html": "<p>Let <var>hitRateLimit</var> be whether <var>destinations</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑨\">size</a> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-per-rate-limit-window\" id=\"ref-for-max-destinations-per-rate-limit-window\">max destinations per rate-limit window</a>[0].</p>"
        },
        {
          "html": "<p>Let <var>hitSameReportingRateLimit</var> be whether <var>sameReportingDestinations</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②⓪\">size</a> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-per-rate-limit-window\" id=\"ref-for-max-destinations-per-rate-limit-window①\">max destinations per rate-limit window</a>[1].</p>"
        },
        {
          "html": "If (<var>hitRateLimit</var>, <var>hitSameReportingRateLimit</var>) is",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "(false, false)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-result-allowed\" id=\"ref-for-destination-rate-limit-result-allowed\">allowed</a></code>\".</p>"
                },
                {
                  "case": "(false, true)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-result-hit-reporting-limit\" id=\"ref-for-destination-rate-limit-result-hit-reporting-limit\">hit reporting limit</a></code>\".</p>"
                },
                {
                  "case": "(true, false)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-result-hit-global-limit\" id=\"ref-for-destination-rate-limit-result-hit-global-limit\">hit global limit</a></code>\".</p>"
                },
                {
                  "case": "(true, true)",
                  "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-result-hit-reporting-limit\" id=\"ref-for-destination-rate-limit-result-hit-reporting-limit①\">hit reporting limit</a></code>\".</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "check if an attribution source exceeds the per day destination limits",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-exceeds-the-per-day-destination-limits",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-source-exceeds-the-per-day-destination-limits\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤①\">attribution source</a> exceeds the per day destination limits</dfn>\ngiven an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤②\">attribution source</a> <var>source</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingSources</var> be all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record⑦\">attribution rate-limit records</a> <var>record</var> in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache③\">attribution rate-limit cache</a> where all of the following are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope④\">scope</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-source\" id=\"ref-for-rate-limit-scope-source②\">source</a></code>\"</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site⑦\">source site</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site⑤\">source site</a> are equal</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin⑤\">reporting origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site①\">same site</a> with\n<var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①⓪\">reporting origin</a></p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time②\">expiry time</a> is greater than <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time⑤\">source time</a></p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from⑥\">duration from</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time③\">time</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time⑥\">source time</a>\nis less than 1 day</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>destinations</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③③\">set</a> of all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination⑦\">attribution destination</a> in <var>matchingSources</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union③\">unioned</a> with <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①①\">attribution destinations</a>.</p>"
        },
        {
          "html": "<p>Return whether <var>destinations</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②①\">size</a> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-per-source-reporting-site-per-day\" id=\"ref-for-max-destinations-per-source-reporting-site-per-day\">max destinations per source reporting site per day</a>.</p>"
        }
      ]
    },
    {
      "name": "delete sources for unexpired destination limit",
      "href": "https://wicg.github.io/attribution-reporting-api/#delete-sources-for-unexpired-destination-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"delete-sources-for-unexpired-destination-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">delete sources for unexpired destination limit</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③④\">set</a> of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id①\">internal IDs</a> <var>sourcesToDelete</var> and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①⑦\">moment</a> <var>now</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>sourcesToDelete</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑨\">is empty</a>, return.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑥\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤③\">attribution source</a> <var>source</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache③\">attribution source cache</a>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑤\">Remove</a> <var>source</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache④\">attribution source cache</a> if <var>sourcesToDelete</var>\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑤\">contains</a> <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id②\">internal ID</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>deletedEventLevelReports</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑤\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑦\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report⑧\">event-level report</a> <var>report</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache③\">event-level report cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>sourcesToDelete</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑥\">contains</a> <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-source-id\" id=\"ref-for-event-level-report-source-id\">source ID</a>\nand <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-time\" id=\"ref-for-event-level-report-trigger-time\">trigger time</a> is greater than or equal to <var>now</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑨\">Append</a> <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id①\">internal ID</a> to <var>deletedEventLevelReports</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑥\">Remove</a> <var>report</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache④\">event-level report cache</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>deletedAggregatableReports</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑥\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑧\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①⓪\">aggregatable attribution report</a> <var>report</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache③\">aggregatable attribution report cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-id\" id=\"ref-for-aggregatable-attribution-report-source-id\">source ID</a> is not null and <var>sourcesToDelete</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑦\">contains</a> <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-id\" id=\"ref-for-aggregatable-attribution-report-source-id①\">source ID</a>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⓪\">Append</a> <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id②\">internal ID</a> to <var>deletedAggregatableReports</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑦\">Remove</a> <var>report</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache④\">aggregatable attribution report cache</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑨\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record⑧\">attribution rate-limit record</a> <var>record</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache④\">attribution rate-limit cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope⑤\">scope</a> is:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "\"source\"",
                      "html": "<p>Set <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-deactivated-for-unexpired-destination-limit\" id=\"ref-for-attribution-rate-limit-record-deactivated-for-unexpired-destination-limit\">deactivated for unexpired destination limit</a> to\ntrue if <var>sourcesToDelete</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑧\">contains</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id\">entity ID</a>.</p>"
                    },
                    {
                      "case": "\"event-attribution\"",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑧\">Remove</a> <var>record</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache⑤\">attribution rate-limit cache</a> if\n<var>deletedEventLevelReports</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑨\">contains</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id①\">entity ID</a>.</p>"
                    },
                    {
                      "case": "\"aggregatable-attribution\"",
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑨\">Remove</a> <var>record</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache⑥\">attribution rate-limit cache</a> if\n<var>deletedAggregatableReports</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⓪\">contains</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id②\">entity ID</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "get sources to delete for the unexpired destination limit",
      "href": "https://wicg.github.io/attribution-reporting-api/#get-sources-to-delete-for-the-unexpired-destination-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-sources-to-delete-for-the-unexpired-destination-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get sources to delete for the unexpired destination limit</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⑤\">attribution source</a> <var>source</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>destinationRecords</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④②\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⓪\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record⑨\">attribution rate-limit record</a> <var>record</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache⑦\">attribution rate-limit cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope⑥\">scope</a> is not \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-source\" id=\"ref-for-rate-limit-scope-source④\">source</a></code>\", <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-deactivated-for-unexpired-destination-limit\" id=\"ref-for-attribution-rate-limit-record-deactivated-for-unexpired-destination-limit①\">deactivated for unexpired destination limit</a> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site⑧\">source site</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site⑥\">source site</a> are not equal, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin⑥\">reporting origin</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①①\">reporting origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site②\">same site</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time③\">expiry time</a> is less than or equal to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time⑦\">source time</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑧\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a>: <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-destination-limit-priority\" id=\"ref-for-attribution-rate-limit-record-destination-limit-priority\">destination limit priority</a> is not null.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①②\">Assert</a>: <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id③\">entity ID</a> is not null.</p>"
            },
            {
              "html": "<p>Let <var>destinationRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record\" id=\"ref-for-destination-limit-record\">destination limit record</a> struct whose items are:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-attribution-destination\" id=\"ref-for-destination-limit-record-attribution-destination\">attribution destination</a>\n         </dt><dd data-md=\"\">\n          <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination⑧\">attribution destination</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-priority\" id=\"ref-for-destination-limit-record-priority\">priority</a>\n         </dt><dd data-md=\"\">\n          <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-destination-limit-priority\" id=\"ref-for-attribution-rate-limit-record-destination-limit-priority①\">destination limit priority</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-time\" id=\"ref-for-destination-limit-record-time\">time</a>\n         </dt><dd data-md=\"\">\n          <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time④\">time</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-source-id\" id=\"ref-for-destination-limit-record-source-id\">source ID</a>\n         </dt><dd data-md=\"\">\n          <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id④\">entity ID</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①④\">Append</a> <var>destinationRecord</var> to <var>destinationRecords</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③①\">For each</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site②③\">site</a> <var>destination</var> of <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①②\">attribution destinations</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>destinationRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record\" id=\"ref-for-destination-limit-record①\">destination limit record</a> struct whose items are:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-attribution-destination\" id=\"ref-for-destination-limit-record-attribution-destination①\">attribution destination</a>\n         </dt><dd data-md=\"\">\n          <p><var>destination</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-priority\" id=\"ref-for-destination-limit-record-priority①\">priority</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-destination-limit-priority\" id=\"ref-for-attribution-source-destination-limit-priority①\">destination limit priority</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-time\" id=\"ref-for-destination-limit-record-time①\">time</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time⑧\">source time</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-source-id\" id=\"ref-for-destination-limit-record-source-id①\">source ID</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id③\">internal ID</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑤\">Append</a> <var>destinationRecord</var> to <var>destinationRecords</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-descending-order\" id=\"ref-for-list-sort-in-descending-order\">Sort</a> <var>destinationRecords</var> in descending order, with <var>a</var> less than <var>b</var> if the following steps return true:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-priority\" id=\"ref-for-destination-limit-record-priority②\">priority</a> is less than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-priority\" id=\"ref-for-destination-limit-record-priority③\">priority</a>, return true.</p>"
            },
            {
              "html": "<p>If <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-priority\" id=\"ref-for-destination-limit-record-priority④\">priority</a> is greater than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-priority\" id=\"ref-for-destination-limit-record-priority⑤\">priority</a>, return false.</p>"
            },
            {
              "html": "<p>If <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-time\" id=\"ref-for-destination-limit-record-time②\">time</a> is less than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-time\" id=\"ref-for-destination-limit-record-time③\">time</a>, return true.</p>"
            },
            {
              "html": "<p>If <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-time\" id=\"ref-for-destination-limit-record-time④\">time</a> is greater than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-time\" id=\"ref-for-destination-limit-record-time⑤\">time</a>, return false.</p>"
            },
            {
              "html": "<p>If <var>a</var>’s <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-attribution-destination\" id=\"ref-for-destination-limit-record-attribution-destination②\">attribution destination</a>\nis less than <var>b</var>’s <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-attribution-destination\" id=\"ref-for-destination-limit-record-attribution-destination③\">attribution destination</a>, return true.</p>"
            },
            {
              "html": "<p>Return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>sourcesToDelete</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑦\">set</a>.</p>"
        },
        {
          "html": "<p>Let <var>newDestinations</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑧\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③②\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record\" id=\"ref-for-destination-limit-record②\">destination limit record</a> <var>record</var> of <var>destinationRecords</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>destination</var> be <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-attribution-destination\" id=\"ref-for-destination-limit-record-attribution-destination④\">attribution destination</a>.</p>"
            },
            {
              "html": "<p>If <var>newDestinations</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②②\">size</a> is less than the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-covered-by-unexpired-sources\" id=\"ref-for-max-destinations-covered-by-unexpired-sources\">max destinations covered by unexpired sources</a>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①①\">append</a> <var>destination</var> to <var>newDestinations</var>.</p>"
            },
            {
              "html": "Otherwise, if <var>newDestinations</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①①\">contain</a> <var>destination</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①②\">Append</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-limit-record-source-id\" id=\"ref-for-destination-limit-record-source-id②\">source ID</a> to <var>sourcesToDelete</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>sourcesToDelete</var>.</p>"
        }
      ]
    },
    {
      "name": "check if an attribution source should be blocked by reporting-origin per site limit",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-should-be-blocked-by-reporting-origin-per-site-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-source-should-be-blocked-by-reporting-origin-per-site-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⑥\">attribution source</a> should be blocked by reporting-origin per site limit</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⑦\">attribution source</a> <var>source</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingRateLimitRecords</var> be all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①⓪\">attribution rate-limit records</a> <var>record</var> in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache⑧\">attribution rate-limit cache</a> where all of the following are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope⑦\">scope</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-source\" id=\"ref-for-rate-limit-scope-source⑤\">source</a></code>\"</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site⑨\">source site</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site⑦\">source site</a> are equal</p>\n       </li><li data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from⑦\">duration from</a> <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time⑤\">time</a> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time⑨\">source time</a> is &lt;= <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#origin-rate-limit-window\" id=\"ref-for-origin-rate-limit-window①\">origin rate-limit window</a></p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>distinctReportingOrigins</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑨\">set</a> of all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin⑦\">reporting origin</a> in <var>matchingRateLimitRecords</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union④\">unioned</a> with «<var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①②\">reporting origin</a>».</p>"
        },
        {
          "html": "<p>If <var>distinctReportingOrigins</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②③\">size</a> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-source-reporting-origins-per-source-reporting-site\" id=\"ref-for-max-source-reporting-origins-per-source-reporting-site①\">max source reporting origins per source reporting site</a>, return <strong>blocked</strong>.</p>"
        },
        {
          "html": "<p>Return <strong>allowed</strong>.</p>"
        }
      ]
    },
    {
      "name": "obtain a fake report",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-fake-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-fake-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a fake report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⑧\">attribution source</a> <var>source</var> and\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state\" id=\"ref-for-trigger-state③\">trigger state</a> <var>triggerState</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>triggerTime</var> be <var>triggerState</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state-report-window\" id=\"ref-for-trigger-state-report-window①\">report window</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-start\" id=\"ref-for-report-window-start⑧\">start</a>.</p>"
        },
        {
          "html": "<p>Let <var>priority</var> be 0.</p>"
        },
        {
          "html": "<p>Let <var>fakeReport</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report\" id=\"ref-for-obtain-an-event-level-report\">obtain an event-level report</a> with <var>source</var>,\n<var>triggerTime</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-triggerdebugkey\" id=\"ref-for-obtain-an-event-level-report-triggerdebugkey\">triggerDebugKey</a> set to null,\n<var>priority</var>, and <var>triggerState</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state-trigger-data\" id=\"ref-for-trigger-state-trigger-data①\">trigger data</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①③\">Assert</a>: <var>fakeReport</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time①\">report time</a> is equal to\n<var>triggerState</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state-report-window\" id=\"ref-for-trigger-state-report-window②\">report window</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-end\" id=\"ref-for-report-window-end⑦\">end</a>.</p>"
        },
        {
          "html": "<p>Return <var>fakeReport</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver a verbose debug report on source registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report-on-source-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-a-verbose-debug-report-on-source-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver a verbose debug report on source registration</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type\" id=\"ref-for-source-debug-data-type①\">source debug data type</a> <var>dataType</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⑨\">attribution source</a> <var>source</var>,\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑨\">boolean</a> <var>isNoised</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⓪\">boolean</a> <var>destinationLimitReplaced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-reporting-enabled\" id=\"ref-for-attribution-source-debug-reporting-enabled①\">debug reporting enabled</a> is false, return.</p>"
        },
        {
          "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cookie-based-debug-allowed\" id=\"ref-for-attribution-source-cookie-based-debug-allowed①\">cookie-based debug allowed</a> is false, return.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④③\">map</a> with the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>attribution_destination</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①③\">attribution destinations</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-attribution-destinations\" id=\"ref-for-serialize-attribution-destinations\">serialized</a>.</p>\n       </dd><dt data-md=\"\">\"<code>source_event_id</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-id\" id=\"ref-for-attribution-source-event-id①\">event ID</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②\">serialized</a>.</p>\n       </dd><dt data-md=\"\">\"<code>source_site</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site⑧\">source site</a>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key①\">debug key</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①①\">set</a> <var>body</var>[\"<code>source_debug_key</code>\"]\nto <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key②\">debug key</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer③\">serialized</a>.</p>"
        },
        {
          "html": "<p>Let <var>dataTypeToReport</var> be <var>dataType</var>.</p>"
        },
        {
          "html": "If <var>dataType</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"source-destination-global-rate-limit\"",
                  "html": "<p>Set <var>dataTypeToReport</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-success\" id=\"ref-for-source-debug-data-type-source-success\">source-success</a></code>\".</p>"
                },
                {
                  "case": "\"source-reporting-origin-limit\"",
                  "html": "<p>Set <var>dataTypeToReport</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-success\" id=\"ref-for-source-debug-data-type-source-success\">source-success</a></code>\".</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>dataTypeToReport</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-success\" id=\"ref-for-source-debug-data-type-source-success①\">source-success</a></code>\"\n and <var>isNoised</var> is true, set <var>dataTypeToReport</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-noised\" id=\"ref-for-source-debug-data-type-source-noised\">source-noised</a></code>\".</p>"
        },
        {
          "html": "If <var>dataTypeToReport</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"source-destination-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①②\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-covered-by-unexpired-sources\" id=\"ref-for-max-destinations-covered-by-unexpired-sources①\">max destinations covered by unexpired sources</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer④\">serialized</a>.</p>"
                },
                {
                  "case": "\"source-destination-rate-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①③\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-per-rate-limit-window\" id=\"ref-for-max-destinations-per-rate-limit-window②\">max destinations per rate-limit window</a>[1],\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑤\">serialized</a>.</p>"
                },
                {
                  "case": "\"source-destination-per-day-rate-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①④\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-per-source-reporting-site-per-day\" id=\"ref-for-max-destinations-per-source-reporting-site-per-day①\">max destinations per source reporting site per day</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑥\">serialized</a>.</p>"
                },
                {
                  "case": "\"source-storage-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑤\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-pending-sources-per-source-origin\" id=\"ref-for-max-pending-sources-per-source-origin\">max pending sources per source origin</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑦\">serialized</a>.</p>"
                },
                {
                  "case": "\"source-channel-capacity-limit\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>sourceType</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-type\" id=\"ref-for-attribution-source-source-type①\">source type</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑥\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-event-level-channel-capacity-per-source\" id=\"ref-for-max-event-level-channel-capacity-per-source\">max event-level channel capacity per source</a>[<var>sourceType</var>].</p>"
                    }
                  ]
                },
                {
                  "case": "\"source-scopes-channel-capacity-limit\"",
                  "html": "",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①④\">Assert</a>: <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes①\">attribution scopes</a> is not null.</p>"
                    },
                    {
                      "html": "<p>Let <var>sourceType</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-type\" id=\"ref-for-attribution-source-source-type②\">source type</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑦\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-event-level-attribution-scopes-channel-capacity-per-source\" id=\"ref-for-max-event-level-attribution-scopes-channel-capacity-per-source\">max event-level attribution scopes channel capacity per source</a>[<var>sourceType</var>].</p>"
                    }
                  ]
                },
                {
                  "case": "\"source-trigger-state-cardinality-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑧\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-trigger-state-cardinality\" id=\"ref-for-max-trigger-state-cardinality②\">max trigger-state cardinality</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑧\">serialized</a>.</p>"
                },
                {
                  "case": "\"source-reporting-origin-per-site-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑨\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-source-reporting-origins-per-source-reporting-site\" id=\"ref-for-max-source-reporting-origins-per-source-reporting-site②\">max source reporting origins per source reporting site</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑨\">serialized</a>.</p>"
                },
                {
                  "case": "\"source-max-event-states-limit\"",
                  "html": "",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑤\">Assert</a>: <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes②\">attribution scopes</a> is not null.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⓪\">Set</a> <var>body</var>[\"<code>limit</code>\"] to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes③\">attribution scopes</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-max-event-states\" id=\"ref-for-attribution-scopes-max-event-states②\">max event states</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>destinationLimitReplaced</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②①\">set</a> <var>body</var>[\"<code>source_destination_limit</code>\"]\nto the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-destinations-covered-by-unexpired-sources\" id=\"ref-for-max-destinations-covered-by-unexpired-sources②\">max destinations covered by unexpired sources</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①⓪\">serialized</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver a verbose debug report on source registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report-on-source-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-a-verbose-debug-report-on-source-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver a verbose debug report on source registration</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type\" id=\"ref-for-source-debug-data-type①\">source debug data type</a> <var>dataType</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑤⑨\">attribution source</a> <var>source</var>,\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑨\">boolean</a> <var>isNoised</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⓪\">boolean</a> <var>destinationLimitReplaced</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data\" id=\"ref-for-verbose-debug-data③\">verbose debug data</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-data-type\" id=\"ref-for-verbose-debug-data-data-type②\">data type</a>\n       </dt><dd data-md=\"\">\n        <p><var>dataTypeToReport</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-body\" id=\"ref-for-verbose-debug-data-body①\">body</a>\n       </dt><dd data-md=\"\">\n        <p><var>body</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report\" id=\"ref-for-obtain-and-deliver-a-verbose-debug-report①\">obtain and deliver a verbose debug report</a> with « <var>data</var> », <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①③\">reporting origin</a>,\nand <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-fenced\" id=\"ref-for-attribution-source-fenced①\">fenced</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver an aggregatable debug report on source registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-source-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-an-aggregatable-debug-report-on-source-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver an aggregatable debug report on source registration</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type\" id=\"ref-for-source-debug-data-type②\">source debug data type</a> <var>dataType</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥⓪\">attribution source</a> <var>source</var>,\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②①\">boolean</a> <var>isNoised</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②②\">boolean</a> <var>destinationLimitReplaced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-fenced\" id=\"ref-for-attribution-source-fenced②\">fenced</a> is true, return.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-debug-reporting-config\" id=\"ref-for-attribution-source-aggregatable-debug-reporting-config①\">aggregatable debug reporting config</a>.</p>"
        },
        {
          "html": "<p>Let <var>debugDataMap</var> be <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-debug-data\" id=\"ref-for-aggregatable-debug-reporting-config-debug-data①\">debug data</a>.</p>"
        },
        {
          "html": "<p>If <var>debugDataMap</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty①\">is empty</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>dataTypesToReport</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⓪\">set</a>.</p>"
        },
        {
          "html": "<p>If <var>dataType</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-success\" id=\"ref-for-source-debug-data-type-source-success②\">source-success</a></code>\"\nand <var>isNoised</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①③\">append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-noised\" id=\"ref-for-source-debug-data-type-source-noised①\">source-noised</a></code>\"\nto <var>dataTypesToReport</var>.</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①④\">append</a> <var>dataType</var> to <var>dataTypesToReport</var>.</p>"
        },
        {
          "html": "<p>If <var>destinationLimitReplaced</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑤\">append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-destination-limit-replaced\" id=\"ref-for-source-debug-data-type-source-destination-limit-replaced\">source-destination-limit-replaced</a></code>\"\nto <var>dataTypesToReport</var>.</p>"
        },
        {
          "html": "<p>Let <var>contributions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④③\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③③\">For each</a> <var>dataTypeToReport</var> of <var>dataTypesToReport</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>debugDataMap</var>[<var>dataTypeToReport</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④②\">exists</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>contribution</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution④\">aggregatable contribution</a> with items:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key①\">key</a>\n           </dt><dd data-md=\"\">\n            <p><var>debugDataMap</var>[<var>dataTypeToReport</var>]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key②\">key</a> bitwise-OR\n<var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-key-piece\" id=\"ref-for-aggregatable-debug-reporting-config-key-piece①\">key piece</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value②\">value</a>\n           </dt><dd data-md=\"\">\n            <p><var>debugDataMap</var>[<var>dataTypeToReport</var>]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value③\">value</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-filtering-id\" id=\"ref-for-aggregatable-contribution-filtering-id①\">filtering ID</a>\n           </dt><dd data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-value\" id=\"ref-for-default-filtering-id-value①\">default filtering ID value</a></p>\n          </dd></dl>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑥\">Append</a> <var>contribution</var> to <var>contributions</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-registration\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report-on-registration\">obtain and deliver an aggregatable debug report on registration</a> with <var>contributions</var>,\n<var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site⑨\">source site</a>, <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①④\">reporting origin</a>,\n<var>source</var>, <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①④\">attribution destinations</a>[0],\n<var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-aggregation-coordinator\" id=\"ref-for-aggregatable-debug-reporting-config-aggregation-coordinator①\">aggregation coordinator</a>,\nand <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①⓪\">source time</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver debug reports on source registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-debug-reports-on-source-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver debug reports on source registration</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type\" id=\"ref-for-source-debug-data-type③\">source debug data type</a> <var>dataType</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥①\">attribution source</a> <var>source</var>,\nan optional <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②③\">boolean</a> <var>isNoised</var> (default false), and an optional\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②④\">boolean</a> <var>destinationLimitReplaced</var> (default false):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report-on-source-registration\" id=\"ref-for-obtain-and-deliver-a-verbose-debug-report-on-source-registration\">obtain and deliver a verbose debug report on source registration</a>\nwith <var>dataType</var>, <var>source</var>, <var>isNoised</var>, and <var>destinationLimitReplaced</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-source-registration\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report-on-source-registration\">obtain and deliver an aggregatable debug report on source registration</a>\nwith <var>dataType</var>, <var>source</var>, <var>isNoised</var>, and <var>destinationLimitReplaced</var>.</p>"
        }
      ]
    },
    {
      "name": "delete expired sources",
      "href": "https://wicg.github.io/attribution-reporting-api/#delete-expired-sources",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"delete-expired-sources\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">delete expired sources</dfn> given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①⑨\">moment</a> <var>now</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③④\">For each</a> <var>source</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache⑤\">attribution source cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-expiry-time\" id=\"ref-for-attribution-source-expiry-time\">expiry time</a> is less than <var>now</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⓪\">remove</a> <var>source</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache⑥\">attribution source cache</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "find sources with common destinations and reporting origin",
      "href": "https://wicg.github.io/attribution-reporting-api/#find-sources-with-common-destinations-and-reporting-origin",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"find-sources-with-common-destinations-and-reporting-origin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find sources with common destinations and reporting origin</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥②\">attribution source</a> <var>pendingSource</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingSources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④④\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑤\">For each</a> <var>source</var> of the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache⑦\">attribution source cache</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>commonDestinations</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection\">intersection</a> of <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①⑤\">attribution destinations</a> and <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①⑥\">attribution destinations</a>.</p>"
            },
            {
              "html": "<p>If <var>commonDestinations</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⓪\">is empty</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑨\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①⑤\">reporting origin</a> and <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①⑥\">reporting origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin③\">same origin</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⓪\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑦\">Append</a> <var>source</var> to <var>matchingSources</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>matchingSources</var>.</p>"
        }
      ]
    },
    {
      "name": "remove associated event-level reports and rate-limit records",
      "href": "https://wicg.github.io/attribution-reporting-api/#remove-associated-event-level-reports-and-rate-limit-records",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-associated-event-level-reports-and-rate-limit-records\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove associated event-level reports and rate-limit records</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id④\">internal ID</a> <var>sourceId</var> and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②⓪\">moment</a> <var>minTriggerTime</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑥\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①①\">event-level report</a> <var>report</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache⑤\">event-level report cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-source-id\" id=\"ref-for-event-level-report-source-id①\">source ID</a> is not equal to <var>sourceId</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①①\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-time\" id=\"ref-for-event-level-report-trigger-time③\">trigger time</a> is less than <var>minTriggerTime</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①②\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①①\">Remove</a> <var>report</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache⑥\">event-level report cache</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①②\">Remove</a> all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①①\">attribution rate-limit records</a> <var>entry</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache⑨\">attribution rate-limit cache</a> where <var>entry</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id⑤\">entity ID</a> is equal to <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id③\">internal ID</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remove sources with unselected attribution scopes for destination",
      "href": "https://wicg.github.io/attribution-reporting-api/#remove-sources-with-unselected-attribution-scopes-for-destination",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-sources-with-unselected-attribution-scopes-for-destination\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove sources with unselected attribution scopes for destination</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site②④\">site</a> <var>destination</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥③\">attribution source</a> <var>pendingSource</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>scopeRecords</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑤\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>scopes</var> be <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes④\">attribution scopes</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-values\" id=\"ref-for-attribution-scopes-values④\">values</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑦\">For each</a> <var>source</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache⑧\">attribution source cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①⑦\">reporting origin</a> and <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①⑧\">reporting origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin④\">same origin</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①③\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①⑦\">attribution destinations</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①②\">contain</a> <var>destination</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①④\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes⑤\">attribution scopes</a>’s is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑤\">continue</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑧\">For each</a> <var>scope</var> in <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes⑥\">attribution scopes</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-values\" id=\"ref-for-attribution-scopes-values⑤\">values</a>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑧\">Append</a> the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①①\">tuple</a> (<var>scope</var>, <var>source</var>) to <var>scopeRecords</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-ascending-order\" id=\"ref-for-list-sort-in-ascending-order②\">Sort</a> <var>scopeRecords</var> in ascending order with <var>a</var> being less than <var>b</var> if any of the following are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>a</var>[1]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①①\">source time</a> is greater than <var>b</var>[1]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①②\">source time</a>.</p>\n       </li><li data-md=\"\">\n        <p><var>a</var>[1]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①③\">source time</a> is equal to <var>b</var>[1]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①④\">source time</a> and <var>a</var>[0] is greater than <var>b</var>[0].</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>selectedScopes</var> be <var>scopes</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone\">cloned</a>.</p>"
        },
        {
          "html": "<p>Let <var>sourcesToRemove</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④①\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑨\">For each</a> <var>record</var> of <var>scopeRecords</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>selectedScopes</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②④\">size</a> is less than <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes⑦\">attribution scopes</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-limit\" id=\"ref-for-attribution-scopes-limit①\">limit</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑥\">append</a> <var>record</var>[0] to <var>selectedScopes</var>.</p>"
            },
            {
              "html": "<p>Otherwise, if <var>selectedScopes</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①③\">contain</a> <var>record</var>[0], <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑦\">append</a> <var>record</var>[1] to <var>sourcesToRemove</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⓪\">For each</a> <var>source</var> of the <var>sourcesToRemove</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#remove-associated-event-level-reports-and-rate-limit-records\" id=\"ref-for-remove-associated-event-level-reports-and-rate-limit-records\">Remove associated event-level reports and rate-limit records</a> with <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id⑤\">internal ID</a> and <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①⑤\">source time</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①③\">Remove</a> <var>source</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache⑨\">attribution source cache</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remove sources with unselected attribution scopes",
      "href": "https://wicg.github.io/attribution-reporting-api/#remove-sources-with-unselected-attribution-scopes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-sources-with-unselected-attribution-scopes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove sources with unselected attribution scopes</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥④\">attribution source</a> <var>pendingSource</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes⑧\">attribution scopes</a> is null, return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑥\">Assert</a>: <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①⑧\">attribution destinations</a> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-ascending-order\" id=\"ref-for-list-sort-in-ascending-order③\">sorted</a> in\nascending order, with <var>a</var> being less than <var>b</var> if <var>a</var>,\n<a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>,\nis less than <var>b</var>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④①\">For each</a> <var>destination</var> in <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations①⑨\">attribution destinations</a>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#remove-sources-with-unselected-attribution-scopes-for-destination\" id=\"ref-for-remove-sources-with-unselected-attribution-scopes-for-destination\">Remove sources with unselected attribution scopes for destination</a> with <var>destination</var> and <var>pendingSource</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remove or update sources for attribution scopes",
      "href": "https://wicg.github.io/attribution-reporting-api/#remove-or-update-sources-for-attribution-scopes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-or-update-sources-for-attribution-scopes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove or update sources for attribution scopes</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥⑤\">attribution source</a> <var>pendingSource</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>pendingScopes</var> be <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes⑨\">attribution scopes</a>.</p>"
        },
        {
          "html": "<p>Let <var>matchingSources</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#find-sources-with-common-destinations-and-reporting-origin\" id=\"ref-for-find-sources-with-common-destinations-and-reporting-origin\">find sources with common destinations and reporting origin</a> with <var>pendingSource</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④②\">For each</a> <var>source</var> of <var>matchingSources</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>existingScopes</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes①⓪\">attribution scopes</a>.</p>"
            },
            {
              "html": "If <var>pendingScopes</var> is null:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes①①\">attribution scopes</a> to null if\n<var>existingScopes</var> is not null.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>existingScopes</var> is null or <var>existingScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-max-event-states\" id=\"ref-for-attribution-scopes-max-event-states③\">max event states</a>\nis not equal to <var>pendingScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-max-event-states\" id=\"ref-for-attribution-scopes-max-event-states④\">max event states</a> or\n<var>existingScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-limit\" id=\"ref-for-attribution-scopes-limit②\">limit</a> is less than <var>pendingScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-limit\" id=\"ref-for-attribution-scopes-limit③\">limit</a>:",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#remove-associated-event-level-reports-and-rate-limit-records\" id=\"ref-for-remove-associated-event-level-reports-and-rate-limit-records①\">Remove associated event-level reports and rate-limit records</a> with <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id⑥\">internal ID</a> and <var>pendingSource</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①⑥\">source time</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①④\">Remove</a> <var>source</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache①⓪\">attribution source cache</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#remove-sources-with-unselected-attribution-scopes\" id=\"ref-for-remove-sources-with-unselected-attribution-scopes\">Remove sources with unselected attribution scopes</a> with <var>pendingSource</var>.</p>"
        }
      ]
    },
    {
      "name": "process an attribution source",
      "href": "https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-an-attribution-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process an attribution source</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥⑥\">attribution source</a> <var>source</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#delete-expired-sources\" id=\"ref-for-delete-expired-sources\">Delete expired sources</a> with <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①⑦\">source time</a>.</p>"
        },
        {
          "html": "<p>Let <var>randomizedResponseConfig</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration\" id=\"ref-for-randomized-response-output-configuration①\">randomized response output configuration</a> whose items are:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration-max-attributions-per-source\" id=\"ref-for-randomized-response-output-configuration-max-attributions-per-source①\">max attributions per source</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-max-number-of-event-level-reports\" id=\"ref-for-attribution-source-max-number-of-event-level-reports②\">max number of event-level reports</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration-trigger-data\" id=\"ref-for-randomized-response-output-configuration-trigger-data①\">trigger data</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-trigger-data\" id=\"ref-for-attribution-source-trigger-data②\">trigger data</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-response-output-configuration-event-level-report-windows\" id=\"ref-for-randomized-response-output-configuration-event-level-report-windows①\">event-level report windows</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-report-windows\" id=\"ref-for-attribution-source-event-level-report-windows③\">event-level report windows</a></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>epsilon</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-epsilon\" id=\"ref-for-attribution-source-event-level-epsilon①\">event-level epsilon</a>.</p>"
        },
        {
          "html": "<p>Let <var>possibleTriggerStates</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-set-of-possible-trigger-states\" id=\"ref-for-obtain-a-set-of-possible-trigger-states①\">obtaining a set of possible trigger states</a> with <var>randomizedResponseConfig</var>.</p>"
        },
        {
          "html": "<p>Let <var>numPossibleTriggerStates</var> be <var>possibleTriggerStates</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②⑤\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>channelCapacity</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#compute-the-channel-capacity-of-a-source\" id=\"ref-for-compute-the-channel-capacity-of-a-source①\">computing the channel capacity of a source</a> with <var>numPossibleTriggerStates</var> and <var>epsilon</var>.</p>"
        },
        {
          "html": "If <var>channelCapacity</var> is an error:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-trigger-state-cardinality-limit\" id=\"ref-for-source-debug-data-type-source-trigger-state-cardinality-limit①\">source-trigger-state-cardinality-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>sourceType</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-type\" id=\"ref-for-attribution-source-source-type③\">source type</a>.</p>"
        },
        {
          "html": "If <var>channelCapacity</var> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-event-level-channel-capacity-per-source\" id=\"ref-for-max-event-level-channel-capacity-per-source①\">max event-level channel capacity per source</a>[<var>sourceType</var>]:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration①\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-channel-capacity-limit\" id=\"ref-for-source-debug-data-type-source-channel-capacity-limit①\">source-channel-capacity-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes①②\">attribution scopes</a> is not null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>attributionScopes</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes①③\">attribution scopes</a>.</p>"
            },
            {
              "html": "If <var>sourceType</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-type-event\" id=\"ref-for-source-type-event①②\">event</a></code>\" and <var>numPossibleTriggerStates</var> is greater than <var>attributionScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-max-event-states\" id=\"ref-for-attribution-scopes-max-event-states⑤\">max event states</a>:",
              "rationale": "run",
              "steps": [
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration②\">obtain and deliver debug reports on source registration</a> with \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-max-event-states-limit\" id=\"ref-for-source-debug-data-type-source-max-event-states-limit①\">source-max-event-states-limit</a></code>\" and <var>source</var>.</p>"
                },
                {
                  "html": "<p>Return.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>scopesChannelCapacity</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#compute-the-scopes-channel-capacity-of-a-source\" id=\"ref-for-compute-the-scopes-channel-capacity-of-a-source\">computing the scopes channel capacity of a source</a> with <var>numPossibleTriggerStates</var>, <var>attributionScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-limit\" id=\"ref-for-attribution-scopes-limit④\">limit</a>, and <var>attributionScopes</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-max-event-states\" id=\"ref-for-attribution-scopes-max-event-states⑥\">max event states</a>.</p>"
            },
            {
              "html": "If <var>scopesChannelCapacity</var> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-event-level-attribution-scopes-channel-capacity-per-source\" id=\"ref-for-max-event-level-attribution-scopes-channel-capacity-per-source①\">max event-level attribution scopes channel capacity per source</a>[<var>sourceType</var>]:",
              "rationale": "run",
              "steps": [
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration③\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-scopes-channel-capacity-limit\" id=\"ref-for-source-debug-data-type-source-scopes-channel-capacity-limit①\">source-scopes-channel-capacity-limit</a></code>\" and <var>source</var>.</p>"
                },
                {
                  "html": "<p>Return.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response①\">randomized response</a> to the result of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-source-response\" id=\"ref-for-obtain-a-randomized-source-response①\">obtaining a randomized source response</a> with <var>possibleTriggerStates</var> and <var>epsilon</var>.</p>"
        },
        {
          "html": "<p>Set <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-trigger-rate\" id=\"ref-for-attribution-source-randomized-trigger-rate\">randomized trigger rate</a> to the result of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-randomized-source-response-pick-rate\" id=\"ref-for-obtain-a-randomized-source-response-pick-rate②\">obtaining a randomized source response pick rate</a> with <var>numPossibleTriggerStates</var> and <var>epsilon</var>.</p>"
        },
        {
          "html": "<p>Set <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports①\">number of event-level reports</a> to 0 if\n<var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response②\">randomized response</a> is null,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response③\">randomized response</a>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②⑥\">size</a> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>pendingSourcesForSourceOrigin</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④②\">set</a> of all\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥⑦\">attribution sources</a> <var>pendingSource</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache①①\">attribution source cache</a> where <var>pendingSource</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-origin\" id=\"ref-for-attribution-source-source-origin③\">source origin</a> and <var>source</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-origin\" id=\"ref-for-attribution-source-source-origin④\">source origin</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑤\">same origin</a>.</p>"
        },
        {
          "html": "If <var>pendingSourcesForSourceOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②⑦\">size</a> is greater than or equal\nto the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-pending-sources-per-source-origin\" id=\"ref-for-max-pending-sources-per-source-origin①\">max pending sources per source origin</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration④\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-storage-limit\" id=\"ref-for-source-debug-data-type-source-storage-limit①\">source-storage-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-should-be-blocked-by-reporting-origin-per-site-limit\" id=\"ref-for-check-if-an-attribution-source-should-be-blocked-by-reporting-origin-per-site-limit\">check if an attribution source should be blocked by reporting-origin per site limit</a>\nwith <var>source</var> is <strong>blocked</strong>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration⑤\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-reporting-origin-per-site-limit\" id=\"ref-for-source-debug-data-type-source-reporting-origin-per-site-limit①\">source-reporting-origin-per-site-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>destinationRateLimitResult</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-exceeds-the-time-based-destination-limits\" id=\"ref-for-check-if-an-attribution-source-exceeds-the-time-based-destination-limits\">check if an attribution source exceeds the time-based destination limit</a> with <var>source</var>.</p>"
        },
        {
          "html": "If <var>destinationRateLimitResult</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-result-hit-reporting-limit\" id=\"ref-for-destination-rate-limit-result-hit-reporting-limit③\">hit reporting limit</a></code>\":",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration⑥\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-destination-rate-limit\" id=\"ref-for-source-debug-data-type-source-destination-rate-limit①\">source-destination-rate-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-exceeds-the-per-day-destination-limits\" id=\"ref-for-check-if-an-attribution-source-exceeds-the-per-day-destination-limits\">check if an attribution source exceeds the per day destination limit</a>\nwith <var>source</var> is true:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration⑦\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-destination-per-day-rate-limit\" id=\"ref-for-source-debug-data-type-source-destination-per-day-rate-limit①\">source-destination-per-day-rate-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>sourcesToDeleteForDestinationLimit</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-sources-to-delete-for-the-unexpired-destination-limit\" id=\"ref-for-get-sources-to-delete-for-the-unexpired-destination-limit\">get sources to delete for the unexpired destination limit</a>\nwith <var>source</var>.</p>"
        },
        {
          "html": "If <var>sourcesToDeleteForDestinationLimit</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①④\">contains</a> <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id⑦\">internal ID</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration⑧\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-destination-limit\" id=\"ref-for-source-debug-data-type-source-destination-limit②\">source-destination-limit</a></code>\" and <var>source</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>destinationLimitReplaced</var> be true if <var>sourcesToDeleteForDestinationLimit</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①①\">empty</a>,\notherwise false.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#delete-sources-for-unexpired-destination-limit\" id=\"ref-for-delete-sources-for-unexpired-destination-limit\">delete sources for unexpired destination limit</a> with <var>sourcesToDeleteForDestinationLimit</var> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①⑧\">source time</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#remove-or-update-sources-for-attribution-scopes\" id=\"ref-for-remove-or-update-sources-for-attribution-scopes\">Remove or update sources for attribution scopes</a> with <var>source</var>.</p>"
        },
        {
          "html": "<p>Let <var>isNoised</var> be true if <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response④\">randomized response</a>\nis not null, otherwise false.</p>"
        },
        {
          "html": "If <var>destinationRateLimitResult</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#destination-rate-limit-result-hit-global-limit\" id=\"ref-for-destination-rate-limit-result-hit-global-limit①\">hit global limit</a></code>\":",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration⑨\">obtain and deliver debug reports on source registration</a>\nwith \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-destination-global-rate-limit\" id=\"ref-for-source-debug-data-type-source-destination-global-rate-limit①\">source-destination-global-rate-limit</a></code>\",\n<var>source</var>, <var>isNoised</var>, and <var>destinationLimitReplaced</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>newRateLimitRecords</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④③\">set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④③\">For each</a> <var>destination</var> in <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations②⓪\">attribution destinations</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>rateLimitRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①②\">attribution rate-limit record</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope⑧\">scope</a>\n         </dt><dd data-md=\"\">\n          <p>\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-source\" id=\"ref-for-rate-limit-scope-source⑥\">source</a></code>\"</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site①⓪\">source site</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site①⓪\">source site</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination⑨\">attribution destination</a>\n         </dt><dd data-md=\"\">\n          <p><var>destination</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin⑧\">reporting origin</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin①⑨\">reporting origin</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time⑥\">time</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time①⑨\">source time</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time④\">expiry time</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-expiry-time\" id=\"ref-for-attribution-source-expiry-time①\">expiry time</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id⑥\">entity ID</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id⑧\">internal ID</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-destination-limit-priority\" id=\"ref-for-attribution-rate-limit-record-destination-limit-priority②\">destination limit priority</a>\n         </dt><dd data-md=\"\">\n          <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-destination-limit-priority\" id=\"ref-for-attribution-source-destination-limit-priority②\">destination limit priority</a></p>\n        </dd></dl>"
            },
            {
              "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-processing-should-be-blocked-by-reporting-origin-limit\" id=\"ref-for-check-if-processing-should-be-blocked-by-reporting-origin-limit\">check if processing should be blocked by reporting-origin limit</a> with\n<var>rateLimitRecord</var> is <strong>blocked</strong>:",
              "rationale": "run",
              "steps": [
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration①⓪\">obtain and deliver debug reports on source registration</a>\nwith \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-reporting-origin-limit\" id=\"ref-for-source-debug-data-type-source-reporting-origin-limit①\">source-reporting-origin-limit</a></code>\",\n<var>source</var>, <var>isNoised</var>, and <var>destinationLimitReplaced</var>.</p>"
                },
                {
                  "html": "<p>Return.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑧\">Append</a> <var>rateLimitRecord</var> to <var>newRateLimitRecords</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④④\">For each</a> <var>record</var> of <var>newRateLimitRecords</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑨\">append</a> <var>record</var> to\nthe <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①⓪\">attribution rate-limit cache</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑤\">Remove</a> all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①③\">attribution rate-limit records</a> <var>entry</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①①\">attribution rate-limit cache</a> if the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-rate-limit-record-can-be-removed\" id=\"ref-for-check-if-an-attribution-rate-limit-record-can-be-removed\">check if an attribution rate-limit record can be removed</a> with <var>entry</var> and <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②⓪\">source time</a> is true.</p>"
        },
        {
          "html": "If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response⑤\">randomized response</a> is not null and is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑥\">list</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑤\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-state\" id=\"ref-for-trigger-state④\">trigger state</a> <var>triggerState</var> of <var>source</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response⑥\">randomized response</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>fakeReport</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-fake-report\" id=\"ref-for-obtain-a-fake-report②\">obtain a fake report</a>\nwith <var>source</var> and <var>triggerState</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②⓪\">Append</a> <var>fakeReport</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache⑦\">event-level report cache</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response⑦\">randomized response</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①②\">empty</a>,\nthen set <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-attributable\" id=\"ref-for-attribution-source-event-level-attributable\">event-level attributable</a> value to false.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate④\">For each</a> <var>destination</var> in <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations②①\">attribution destinations</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>rateLimitRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①④\">attribution rate-limit record</a> with the items:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope⑨\">scope</a>\n           </dt><dd data-md=\"\">\n            <p>\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-event-attribution\" id=\"ref-for-rate-limit-scope-event-attribution④\">event-attribution</a></code>\"</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site①①\">source site</a>\n           </dt><dd data-md=\"\">\n            <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site①①\">source site</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination①⓪\">attribution destination</a>\n           </dt><dd data-md=\"\">\n            <p><var>destination</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin⑨\">reporting origin</a>\n           </dt><dd data-md=\"\">\n            <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin②⓪\">reporting origin</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time⑦\">time</a>\n           </dt><dd data-md=\"\">\n            <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②①\">source time</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time⑤\">expiry time</a>\n           </dt><dd data-md=\"\">\n            <p>null</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id⑦\">entity ID</a>\n           </dt><dd data-md=\"\">\n            <p>null</p>\n          </dd></dl>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②①\">Append</a> <var>rateLimitRecord</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①②\">attribution rate-limit cache</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-source-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-source-registration①①\">obtain and deliver debug reports on source registration</a> with\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#source-debug-data-type-source-success\" id=\"ref-for-source-debug-data-type-source-success③\">source-success</a></code>\", <var>source</var>, <var>isNoised</var>, and <var>destinationLimitReplaced</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②②\">Append</a> <var>source</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache①②\">attribution source cache</a>.</p>"
        }
      ]
    },
    {
      "name": "parse event triggers",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-event-triggers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-event-triggers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse event triggers</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④④\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>eventTriggers</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④④\">set</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-event_trigger_data\" id=\"ref-for-trigger-registration-json-key-event_trigger_data\">event_trigger_data</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④③\">exist</a>, return\n<var>eventTriggers</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-event_trigger_data\" id=\"ref-for-trigger-registration-json-key-event_trigger_data①\">event_trigger_data</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑦\">list</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑥\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑤\">map</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>triggerData</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer③\">parse an optional 64-bit unsigned integer</a> with <var>value</var>,\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-trigger_data\" id=\"ref-for-trigger-registration-json-key-trigger_data\">trigger_data</a></code>\", and 0.</p>"
            },
            {
              "html": "<p>If <var>triggerData</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>dedupKey</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer④\">parse an optional 64-bit unsigned integer</a> with <var>value</var>,\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-deduplication_key\" id=\"ref-for-trigger-registration-json-key-deduplication_key\">deduplication_key</a></code>\", and null.</p>"
            },
            {
              "html": "<p>If <var>dedupKey</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>priority</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-signed-integer\" id=\"ref-for-parse-an-optional-64-bit-signed-integer②\">parse an optional 64-bit signed integer</a> with <var>value</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-priority\" id=\"ref-for-trigger-registration-json-key-priority\">priority</a></code>\",\nand 0.</p>"
            },
            {
              "html": "<p>If <var>priority</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>filterPair</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair\" id=\"ref-for-parse-a-filter-pair\">parse a filter pair</a> with\n<var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>filterPair</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>eventTrigger</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration\" id=\"ref-for-event-level-trigger-configuration①\">event-level trigger configuration</a> with\nthe items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-trigger-data\" id=\"ref-for-event-level-trigger-configuration-trigger-data③\">trigger data</a>\n         </dt><dd data-md=\"\">\n          <p><var>triggerData</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-dedup-key\" id=\"ref-for-event-level-trigger-configuration-dedup-key①\">dedup key</a>\n         </dt><dd data-md=\"\">\n          <p><var>dedupKey</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-priority\" id=\"ref-for-event-level-trigger-configuration-priority\">priority</a>\n         </dt><dd data-md=\"\">\n          <p><var>priority</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-filters\" id=\"ref-for-event-level-trigger-configuration-filters\">filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[0]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-negated-filters\" id=\"ref-for-event-level-trigger-configuration-negated-filters\">negated filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[1]</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②③\">Append</a> <var>eventTrigger</var> to <var>eventTriggers</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>eventTriggers</var>.</p>"
        }
      ]
    },
    {
      "name": "parse aggregatable trigger data",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-trigger-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregatable-trigger-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregatable trigger data</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑥\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>aggregatableTriggerData</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑧\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_trigger_data\" id=\"ref-for-trigger-registration-json-key-aggregatable_trigger_data\">aggregatable_trigger_data</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④④\">exist</a>, return <var>aggregatableTriggerData</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_trigger_data\" id=\"ref-for-trigger-registration-json-key-aggregatable_trigger_data①\">aggregatable_trigger_data</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑨\">list</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑦\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑦\">map</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-key_piece\" id=\"ref-for-trigger-registration-json-key-key_piece\">key_piece</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑤\">exist</a> or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⓪\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>keyPiece</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-key-piece\" id=\"ref-for-parse-an-aggregation-key-piece③\">parse an aggregation key piece</a> with <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-key_piece\" id=\"ref-for-trigger-registration-json-key-key_piece①\">key_piece</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>keyPiece</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>sourceKeys</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑤\">set</a>.</p>"
            },
            {
              "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-source_keys\" id=\"ref-for-trigger-registration-json-key-source_keys\">source_keys</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑥\">exists</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-source_keys\" id=\"ref-for-trigger-registration-json-key-source_keys①\">source_keys</a></code>\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⓪\">list</a>, return an error.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑧\">For each</a> <var>sourceKey</var> of <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-source_keys\" id=\"ref-for-trigger-registration-json-key-source_keys②\">source_keys</a></code>\"]:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>sourceKey</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④①\">string</a>, return an error.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②④\">Append</a> <var>sourceKey</var> to <var>sourceKeys</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Let <var>filterPair</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair\" id=\"ref-for-parse-a-filter-pair①\">parse a filter pair</a> with\n<var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>filterPair</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>aggregatableTrigger</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data\" id=\"ref-for-aggregatable-trigger-data①\">aggregatable trigger data</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-key-piece\" id=\"ref-for-aggregatable-trigger-data-key-piece\">key piece</a>\n         </dt><dd data-md=\"\">\n          <p><var>keyPiece</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-source-keys\" id=\"ref-for-aggregatable-trigger-data-source-keys\">source keys</a>\n         </dt><dd data-md=\"\">\n          <p><var>sourceKeys</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-filters\" id=\"ref-for-aggregatable-trigger-data-filters\">filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[0]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-negated-filters\" id=\"ref-for-aggregatable-trigger-data-negated-filters\">negated filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[1]</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑨\">Append</a> <var>aggregatableTrigger</var> to <var>aggregatableTriggerData</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>aggregatableTriggerData</var>.</p>"
        }
      ]
    },
    {
      "name": "parse aggregatable filtering ID max bytes",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-filtering-id-max-bytes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregatable-filtering-id-max-bytes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregatable filtering ID max bytes</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑧\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>maxBytes</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-max-bytes\" id=\"ref-for-default-filtering-id-max-bytes\">default filtering ID max bytes</a>.</p>"
        },
        {
          "html": "If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_filtering_id_max_bytes\" id=\"ref-for-trigger-registration-json-key-aggregatable_filtering_id_max_bytes\">aggregatable_filtering_id_max_bytes</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑦\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>maxBytes</var> to <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_filtering_id_max_bytes\" id=\"ref-for-trigger-registration-json-key-aggregatable_filtering_id_max_bytes①\">aggregatable_filtering_id_max_bytes</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>maxBytes</var> is a positive integer and is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑤\">contained</a> in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#valid-filtering-id-max-bytes-range\" id=\"ref-for-valid-filtering-id-max-bytes-range\">valid filtering ID max bytes range</a>,\nreturn <var>maxBytes</var>.</p>"
            },
            {
              "html": "<p>Otherwise, return an error.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>maxBytes</var>.</p>"
        }
      ]
    },
    {
      "name": "validate aggregatable key-values value",
      "href": "https://wicg.github.io/attribution-reporting-api/#validate-aggregatable-key-values-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-aggregatable-key-values-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate aggregatable key-values value</dfn> given a <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not an integer, return false.</p>"
        },
        {
          "html": "<p>If <var>value</var> is less than or equal to 0, return false.</p>"
        },
        {
          "html": "<p>If <var>value</var> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source⑤\">allowed aggregatable budget per source</a>, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "parse aggregatable key-values",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-key-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregatable-key-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregatable key-values</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑨\">map</a> <var>map</var> and a positive integer <var>maxBytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>out</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⓪\">map</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑤\">For each</a> <var>key</var> → <var>value</var> of <var>map</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤①\">map</a> or an integer, return an error.</p>"
            },
            {
              "html": "If <var>value</var> is an integer:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#validate-aggregatable-key-values-value\" id=\"ref-for-validate-aggregatable-key-values-value\">validate aggregatable key-values value</a> with <var>value</var> is false, return an error.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②②\">Set</a> <var>out</var>[<var>key</var>] to a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value\" id=\"ref-for-aggregatable-key-value①\">aggregatable key value</a> whose items are</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value-value\" id=\"ref-for-aggregatable-key-value-value\">value</a>\n           </dt><dd data-md=\"\">\n            <p><var>value</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value-filtering-id\" id=\"ref-for-aggregatable-key-value-filtering-id\">filtering ID</a>\n           </dt><dd data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-value\" id=\"ref-for-default-filtering-id-value②\">default filtering ID value</a></p>\n          </dd></dl>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑥\">Continue</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-value\" id=\"ref-for-trigger-registration-json-key-value\">value</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑧\">exist</a>, return an error.</p>"
            },
            {
              "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#validate-aggregatable-key-values-value\" id=\"ref-for-validate-aggregatable-key-values-value①\">validate aggregatable key-values value</a> with\n<var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-value\" id=\"ref-for-trigger-registration-json-key-value①\">value</a></code>\"] is false, return an error.</p>"
            },
            {
              "html": "<p>Let <var>filteringId</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-value\" id=\"ref-for-default-filtering-id-value③\">default filtering ID value</a>.</p>"
            },
            {
              "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-filtering_id\" id=\"ref-for-trigger-registration-json-key-filtering_id\">filtering_id</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑨\">exists</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>filteringId</var> to the result of applying the\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-non-negative-integers\" id=\"ref-for-rules-for-parsing-non-negative-integers①\">rules for parsing non-negative integers</a> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-filtering_id\" id=\"ref-for-trigger-registration-json-key-filtering_id①\">filtering_id</a></code>\"].</p>"
                },
                {
                  "html": "<p>If <var>filteringId</var> is an error, return it.</p>"
                },
                {
                  "html": "<p>If <var>filteringId</var> is not in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-exclusive-range\" id=\"ref-for-the-exclusive-range①\">the range</a>\n0 to 256<sup><var>maxBytes</var></sup>, exclusive, return an error.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②③\">Set</a> <var>out</var>[<var>key</var>] to a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value\" id=\"ref-for-aggregatable-key-value②\">aggregatable key value</a> whose items are</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value-value\" id=\"ref-for-aggregatable-key-value-value①\">value</a>\n         </dt><dd data-md=\"\">\n          <p><var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-value\" id=\"ref-for-trigger-registration-json-key-value②\">value</a></code>\"]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value-filtering-id\" id=\"ref-for-aggregatable-key-value-filtering-id①\">filtering ID</a>\n         </dt><dd data-md=\"\">\n          <p><var>filteringId</var></p>\n        </dd></dl>"
            }
          ]
        },
        {
          "html": "<p>Return <var>out</var>.</p>"
        }
      ]
    },
    {
      "name": "parse aggregatable values",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregatable-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregatable values</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤②\">map</a> <var>map</var> and a positive integer <var>maxBytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_values\" id=\"ref-for-trigger-registration-json-key-aggregatable_values\">aggregatable_values</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⓪\">exist</a>, return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤①\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_values\" id=\"ref-for-trigger-registration-json-key-aggregatable_values①\">aggregatable_values</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤③\">map</a> or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤②\">list</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableValuesConfigurations</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration\" id=\"ref-for-aggregatable-values-configuration①\">aggregatable values configurations</a>, initially empty.</p>"
        },
        {
          "html": "If <var>values</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤④\">map</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>aggregatableKeyValues</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-key-values\" id=\"ref-for-parse-aggregatable-key-values\">parse aggregatable key-values</a> with <var>values</var> and <var>maxBytes</var>.</p>"
            },
            {
              "html": "<p>If <var>aggregatableKeyValues</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>aggregatableValuesConfiguration</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration\" id=\"ref-for-aggregatable-values-configuration②\">aggregatable values configuration</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-values\" id=\"ref-for-aggregatable-values-configuration-values\">values</a>\n         </dt><dd data-md=\"\">\n          <p><var>aggregatableKeyValues</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-filters\" id=\"ref-for-aggregatable-values-configuration-filters\">filters</a>\n         </dt><dd data-md=\"\">\n          <p>«»</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-negated-filters\" id=\"ref-for-aggregatable-values-configuration-negated-filters\">negated filters</a>\n         </dt><dd data-md=\"\">\n          <p>«»</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⓪\">Append</a> <var>aggregatableValuesConfiguration</var> to <var>aggregatableValuesConfigurations</var>.</p>"
            },
            {
              "html": "<p>Return <var>aggregatableValuesConfigurations</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑨\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑤\">map</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-values\" id=\"ref-for-trigger-registration-json-key-values\">values</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤①\">exist</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>aggregatableKeyValues</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-key-values\" id=\"ref-for-parse-aggregatable-key-values①\">parse aggregatable key-values</a> with\n<var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-values\" id=\"ref-for-trigger-registration-json-key-values①\">values</a></code>\"] and <var>maxBytes</var>.</p>"
            },
            {
              "html": "<p>If <var>aggregatableKeyValues</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>filterPair</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair\" id=\"ref-for-parse-a-filter-pair②\">parse a filter pair</a> with\n<var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>filterPair</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>aggregatableValuesConfiguration</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration\" id=\"ref-for-aggregatable-values-configuration③\">aggregatable values configuration</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-values\" id=\"ref-for-aggregatable-values-configuration-values①\">values</a>\n         </dt><dd data-md=\"\">\n          <p><var>aggregatableKeyValues</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-filters\" id=\"ref-for-aggregatable-values-configuration-filters①\">filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[0]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-negated-filters\" id=\"ref-for-aggregatable-values-configuration-negated-filters①\">negated filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[1]</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②①\">Append</a> <var>aggregatableValuesConfiguration</var> to <var>aggregatableValuesConfigurations</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>aggregatableValuesConfigurations</var>.</p>"
        }
      ]
    },
    {
      "name": "parse aggregatable dedup keys",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-dedup-keys",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-aggregatable-dedup-keys\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse aggregatable dedup keys</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑥\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>aggregatableDedupKeys</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤④\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_deduplication_keys\" id=\"ref-for-trigger-registration-json-key-aggregatable_deduplication_keys\">aggregatable_deduplication_keys</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤②\">exist</a>, return <var>aggregatableDedupKeys</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_deduplication_keys\" id=\"ref-for-trigger-registration-json-key-aggregatable_deduplication_keys①\">aggregatable_deduplication_keys</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑤\">list</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⓪\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑦\">map</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>dedupKey</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer⑤\">parse an optional 64-bit unsigned integer</a> with <var>value</var>,\n\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-deduplication_key\" id=\"ref-for-trigger-registration-json-key-deduplication_key①\">deduplication_key</a></code>\", and null.</p>"
            },
            {
              "html": "<p>If <var>dedupKey</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>filterPair</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair\" id=\"ref-for-parse-a-filter-pair③\">parse a filter pair</a> with\n<var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>filterPair</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>aggregatableDedupKey</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key\" id=\"ref-for-aggregatable-dedup-key①\">aggregatable dedup key</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key-dedup-key\" id=\"ref-for-aggregatable-dedup-key-dedup-key①\">dedup key</a>\n         </dt><dd data-md=\"\">\n          <p><var>dedupKey</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key-filters\" id=\"ref-for-aggregatable-dedup-key-filters\">filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[0]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key-negated-filters\" id=\"ref-for-aggregatable-dedup-key-negated-filters\">negated filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[1]</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②⑤\">Append</a> <var>aggregatableDedupKey</var> to <var>aggregatableDedupKeys</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>aggregatableDedupKeys</var>.</p>"
        }
      ]
    },
    {
      "name": "parse named budgets for trigger",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-named-budgets-for-trigger",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-named-budgets-for-trigger\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse named budgets for trigger</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑧\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>namedBudgets</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑥\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-named_budgets\" id=\"ref-for-trigger-registration-json-key-named_budgets\">named_budgets</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤③\">exist</a>, return <var>namedBudgets</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-named_budgets\" id=\"ref-for-trigger-registration-json-key-named_budgets①\">named_budgets</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑦\">list</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤①\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑨\">map</a>, return an error.</p>"
            },
            {
              "html": "<p>Let <var>name</var> be null.</p>"
            },
            {
              "html": "If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-name\" id=\"ref-for-trigger-registration-json-key-name\">name</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤④\">exists</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>name</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-name\" id=\"ref-for-trigger-registration-json-key-name①\">name</a></code>\"].</p>"
                },
                {
                  "html": "<p>If <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④②\">string</a>, return an error.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>filterPair</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair\" id=\"ref-for-parse-a-filter-pair④\">parse a filter pair</a> with\n<var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>filterPair</var> is an error, return it.</p>"
            },
            {
              "html": "<p>Let <var>namedBudget</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget\" id=\"ref-for-named-budget①\">named budget</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget-name\" id=\"ref-for-named-budget-name\">name</a>\n         </dt><dd data-md=\"\">\n          <p><var>name</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget-filters\" id=\"ref-for-named-budget-filters\">filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[0]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget-negated-filters\" id=\"ref-for-named-budget-negated-filters\">negated filters</a>\n         </dt><dd data-md=\"\">\n          <p><var>filterPair</var>[1]</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②②\">Append</a> <var>namedBudget</var> to <var>namedBudgets</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>namedBudgets</var>.</p>"
        }
      ]
    },
    {
      "name": "parse attribution scopes for trigger",
      "href": "https://wicg.github.io/attribution-reporting-api/#parse-attribution-scopes-for-trigger",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-attribution-scopes-for-trigger\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse attribution scopes for trigger</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⓪\">map</a> <var>map</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑥\">set</a>.</p>"
        },
        {
          "html": "<p>If <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-attribution_scopes\" id=\"ref-for-trigger-registration-json-key-attribution_scopes\">attribution_scopes</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑤\">exist</a>, return <var>result</var>.</p>"
        },
        {
          "html": "<p>Let <var>values</var> be <var>map</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-attribution_scopes\" id=\"ref-for-trigger-registration-json-key-attribution_scopes①\">attribution_scopes</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>values</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑧\">list</a>, return an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤②\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④③\">string</a>, return an error.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②⑥\">Append</a> <var>value</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "create an attribution trigger",
      "href": "https://wicg.github.io/attribution-reporting-api/#create-an-attribution-trigger",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-an-attribution-trigger\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create an attribution trigger</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①\">byte sequence</a>\n<var>json</var>, a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site②⑤\">site</a> <var>destination</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin②⓪\">suitable origin</a> <var>reportingOrigin</var>,\na <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②①\">moment</a> <var>triggerTime</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⑤\">boolean</a> <var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>value</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value\" id=\"ref-for-parse-json-bytes-to-an-infra-value①\">parse JSON bytes to an Infra value</a> with <var>json</var>.</p>"
        },
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥①\">map</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>eventTriggers</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-event-triggers\" id=\"ref-for-parse-event-triggers\">parse event triggers</a>\nwith <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>eventTriggers</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableTriggerData</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-trigger-data\" id=\"ref-for-parse-aggregatable-trigger-data\">parse aggregatable trigger data</a>\nwith <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>aggregatableTriggerData</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>filteringIdsMaxBytes</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-filtering-id-max-bytes\" id=\"ref-for-parse-aggregatable-filtering-id-max-bytes\">parsing aggregatable filtering ID max bytes</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>filteringIdsMaxBytes</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableValuesConfigurations</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-values\" id=\"ref-for-parse-aggregatable-values\">parse aggregatable values</a> with <var>value</var> and <var>filteringIdsMaxBytes</var>.</p>"
        },
        {
          "html": "<p>If <var>aggregatableValuesConfigurations</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableDedupKeys</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-aggregatable-dedup-keys\" id=\"ref-for-parse-aggregatable-dedup-keys\">parse aggregatable dedup keys</a>\nwith <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>aggregatableDedupKeys</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>namedBudgets</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-named-budgets-for-trigger\" id=\"ref-for-parse-named-budgets-for-trigger\">parse named budgets for trigger</a>\nwith <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>namedBudgets</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>debugKey</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-optional-64-bit-unsigned-integer\" id=\"ref-for-parse-an-optional-64-bit-unsigned-integer⑥\">parse an optional 64-bit unsigned integer</a> with <var>value</var>, \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-debug_key\" id=\"ref-for-trigger-registration-json-key-debug_key\">debug_key</a></code>\",\nand null.</p>"
        },
        {
          "html": "<p>If <var>debugKey</var> is an error, set <var>debugKey</var> to null.</p>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-cookie-based-debugging-is-allowed\" id=\"ref-for-check-if-cookie-based-debugging-is-allowed①\">check if cookie-based debugging is allowed</a> with\n<var>reportingOrigin</var> and <var>destination</var> is <strong>blocked</strong>, set <var>debugKey</var> to null.</p>"
        },
        {
          "html": "<p>Let <var>filterPair</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-a-filter-pair\" id=\"ref-for-parse-a-filter-pair⑤\">parse a filter pair</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>filterPair</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>debugReportingEnabled</var> be false.</p>"
        },
        {
          "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-debug_reporting\" id=\"ref-for-trigger-registration-json-key-debug_reporting\">debug_reporting</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑥\">exists</a> and is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⑥\">boolean</a>, set\n<var>debugReportingEnabled</var> to value[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-debug_reporting\" id=\"ref-for-trigger-registration-json-key-debug_reporting①\">debug_reporting</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>aggregationCoordinator</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-aggregation-coordinator\" id=\"ref-for-default-aggregation-coordinator②\">default aggregation coordinator</a>.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregation_coordinator_origin\" id=\"ref-for-trigger-registration-json-key-aggregation_coordinator_origin\">aggregation_coordinator_origin</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑦\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>aggregationCoordinator</var> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregation-coordinator\" id=\"ref-for-parse-an-aggregation-coordinator①\">parse an aggregation coordinator</a> with\n<var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregation_coordinator_origin\" id=\"ref-for-trigger-registration-json-key-aggregation_coordinator_origin①\">aggregation_coordinator_origin</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>aggregationCoordinator</var> is an error, return it.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>aggregatableSourceRegTimeConfig</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-source-registration-time-configuration-exclude\" id=\"ref-for-aggregatable-source-registration-time-configuration-exclude①\">exclude</a></code>\".</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_source_registration_time\" id=\"ref-for-trigger-registration-json-key-aggregatable_source_registration_time\">aggregatable_source_registration_time</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑧\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_source_registration_time\" id=\"ref-for-trigger-registration-json-key-aggregatable_source_registration_time①\">aggregatable_source_registration_time</a></code>\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④④\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_source_registration_time\" id=\"ref-for-trigger-registration-json-key-aggregatable_source_registration_time②\">aggregatable_source_registration_time</a></code>\"] is not an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-source-registration-time-configuration\" id=\"ref-for-aggregatable-source-registration-time-configuration②\">aggregatable source registration time configuration</a>,\nreturn an error.</p>"
            },
            {
              "html": "<p>Set <var>aggregatableSourceRegTimeConfig</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_source_registration_time\" id=\"ref-for-trigger-registration-json-key-aggregatable_source_registration_time③\">aggregatable_source_registration_time</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>triggerContextID</var> be null.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-trigger_context_id\" id=\"ref-for-trigger-registration-json-key-trigger_context_id\">trigger_context_id</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑨\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-trigger_context_id\" id=\"ref-for-trigger-registration-json-key-trigger_context_id①\">trigger_context_id</a></code>\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⑤\">string</a>, return an error.</p>"
            },
            {
              "html": "<p>If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-trigger_context_id\" id=\"ref-for-trigger-registration-json-key-trigger_context_id②\">trigger_context_id</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①⓪\">length</a> is greater than the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-length-per-trigger-context-id\" id=\"ref-for-max-length-per-trigger-context-id\">max length per trigger context ID</a>,\nreturn an error.</p>"
            },
            {
              "html": "<p>Set <var>triggerContextID</var> to <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-trigger_context_id\" id=\"ref-for-trigger-registration-json-key-trigger_context_id③\">trigger_context_id</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>aggregatableDebugReportingConfig</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config\" id=\"ref-for-aggregatable-debug-reporting-config⑥\">aggregatable debug reporting config</a>.</p>"
        },
        {
          "html": "If <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_debug_reporting\" id=\"ref-for-trigger-registration-json-key-aggregatable_debug_reporting\">aggregatable_debug_reporting</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⓪\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>supportedTypes</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑦\">set</a> of all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type\" id=\"ref-for-trigger-debug-data-type①\">trigger debug data types</a>.</p>"
            },
            {
              "html": "<p>Set <var>aggregatableDebugReportingConfig</var> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-an-aggregatable-debug-reporting-config\" id=\"ref-for-parse-an-aggregatable-debug-reporting-config①\">parse an aggregatable debug reporting config</a>\nwith <var>value</var>[\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-registration-json-key-aggregatable_debug_reporting\" id=\"ref-for-trigger-registration-json-key-aggregatable_debug_reporting①\">aggregatable_debug_reporting</a></code>\"],\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source⑥\">allowed aggregatable budget per source</a>, <var>supportedTypes</var>, and <var>aggregatableDebugReportingConfig</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>attributionScopes</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#parse-attribution-scopes-for-trigger\" id=\"ref-for-parse-attribution-scopes-for-trigger\">parse attribution scopes for trigger</a> with <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>attributionScopes</var> is an error, return it.</p>"
        },
        {
          "html": "<p>Let <var>trigger</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①①\">attribution trigger</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination\">attribution destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>destination</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time\">trigger time</a>\n       </dt><dd data-md=\"\">\n        <p><var>triggerTime</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-reporting-origin\" id=\"ref-for-attribution-trigger-reporting-origin①\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-filters\" id=\"ref-for-attribution-trigger-filters\">filters</a>\n       </dt><dd data-md=\"\">\n        <p><var>filterPair</var>[0]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-negated-filters\" id=\"ref-for-attribution-trigger-negated-filters\">negated filters</a>\n       </dt><dd data-md=\"\">\n        <p><var>filterPair</var>[1]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-key\" id=\"ref-for-attribution-trigger-debug-key\">debug key</a>\n       </dt><dd data-md=\"\">\n        <p><var>debugKey</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-event-level-trigger-configurations\" id=\"ref-for-attribution-trigger-event-level-trigger-configurations\">event-level trigger configurations</a>\n       </dt><dd data-md=\"\">\n        <p><var>eventTriggers</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-trigger-data\" id=\"ref-for-attribution-trigger-aggregatable-trigger-data\">aggregatable trigger data</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableTriggerData</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-values-configurations\" id=\"ref-for-attribution-trigger-aggregatable-values-configurations\">aggregatable values configurations</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableValuesConfigurations</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-dedup-keys\" id=\"ref-for-attribution-trigger-aggregatable-dedup-keys\">aggregatable dedup keys</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableDedupKeys</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-reporting-enabled\" id=\"ref-for-attribution-trigger-debug-reporting-enabled\">debug reporting enabled</a>\n       </dt><dd data-md=\"\">\n        <p><var>debugReportingEnabled</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregation-coordinator\" id=\"ref-for-attribution-trigger-aggregation-coordinator\">aggregation coordinator</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregationCoordinator</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-source-registration-time-configuration\" id=\"ref-for-attribution-trigger-aggregatable-source-registration-time-configuration②\">aggregatable source registration time configuration</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableSourceRegTimeConfig</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id①\">trigger context ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>triggerContextID</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-fenced\" id=\"ref-for-attribution-trigger-fenced\">fenced</a>\n       </dt><dd data-md=\"\">\n        <p><var>fenced</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-filtering-id-max-bytes\" id=\"ref-for-attribution-trigger-aggregatable-filtering-id-max-bytes\">aggregatable filtering ID max bytes</a>\n       </dt><dd data-md=\"\">\n        <p><var>filteringIdsMaxBytes</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-debug-reporting-config\" id=\"ref-for-attribution-trigger-aggregatable-debug-reporting-config\">aggregatable debug reporting config</a>\n       </dt><dd data-md=\"\">\n        <p><var>aggregatableDebugReportingConfig</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-scopes\" id=\"ref-for-attribution-trigger-attribution-scopes\">attribution scopes</a>\n       </dt><dd data-md=\"\">\n        <p><var>attributionScopes</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>aggregatableSourceRegTimeConfig</var> is not \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-source-registration-time-configuration-exclude\" id=\"ref-for-aggregatable-source-registration-time-configuration-exclude②\">exclude</a></code>\"\nand the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent\" id=\"ref-for-check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent\">check if an aggregatable attribution report should be unconditionally sent</a> with <var>trigger</var> is true, return an error.</p>"
        },
        {
          "html": "<p>Return <var>trigger</var>.</p>"
        }
      ]
    },
    {
      "name": "match filter values",
      "href": "https://wicg.github.io/attribution-reporting-api/#match-filter-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-filter-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-value\" id=\"ref-for-filter-value①\">filter values</a></dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-value\" id=\"ref-for-filter-value②\">filter value</a> <var>a</var> and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-value\" id=\"ref-for-filter-value③\">filter value</a> <var>b</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>b</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①③\">is empty</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>a</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①④\">is empty</a>, then return true.</p>"
            },
            {
              "html": "<p>Otherwise, return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>i</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection①\">intersection</a> of <var>a</var> and <var>b</var>.</p>"
        },
        {
          "html": "<p>If <var>i</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⑤\">is empty</a>, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "match filter values with negation",
      "href": "https://wicg.github.io/attribution-reporting-api/#match-filter-values-with-negation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-filter-values-with-negation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-value\" id=\"ref-for-filter-value④\">filter values</a> with negation</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-value\" id=\"ref-for-filter-value⑤\">filter value</a> <var>a</var> and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-value\" id=\"ref-for-filter-value⑥\">filter value</a> <var>b</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>b</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⑥\">is empty</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>a</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⑦\">empty</a>, then return true.</p>"
            },
            {
              "html": "<p>Otherwise, return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>i</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection②\">intersection</a> of <var>a</var> and <var>b</var>.</p>"
        },
        {
          "html": "<p>If <var>i</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⑧\">empty</a>, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "match an attribution source against a filter config",
      "href": "https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-a-filter-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-an-attribution-source-against-a-filter-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match an attribution source against a filter config</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥⑧\">attribution source</a> <var>source</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①⑤\">filter config</a> <var>filter</var>, a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②②\">moment</a> <var>moment</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⑦\">boolean</a>\n<var>isNegated</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>lookbackWindow</var> be <var>filter</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config-lookback-window\" id=\"ref-for-filter-config-lookback-window①\">lookback window</a>.</p>"
        },
        {
          "html": "If <var>lookbackWindow</var> is not null:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from⑧\">duration from</a> <var>moment</var> and the <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②②\">source time</a> is greater than <var>lookbackWindow</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>isNegated</var> is false, return false.</p>"
                }
              ]
            },
            {
              "html": "<p>Else if <var>isNegated</var> is true, return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>filterMap</var> be <var>filter</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config-map\" id=\"ref-for-filter-config-map①\">map</a>.</p>"
        },
        {
          "html": "<p>Let <var>sourceData</var> be <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-filter-data\" id=\"ref-for-attribution-source-filter-data④\">filter data</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑥\">For each</a> <var>key</var> → <var>filterValues</var> of <var>filterMap</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>sourceData</var>[<var>key</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥①\">exist</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>sourceValues</var> be <var>sourceData</var>[<var>key</var>].</p>"
            },
            {
              "html": "If <var>isNegated</var> is:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "false",
                      "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-filter-values\" id=\"ref-for-match-filter-values\">match filter values</a> with <var>sourceValues</var> and <var>filterValues</var>\n     is false, return false."
                    },
                    {
                      "case": "true",
                      "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-filter-values-with-negation\" id=\"ref-for-match-filter-values-with-negation\">match filter values with negation</a> with <var>sourceValues</var> and\n    <var>filterValues</var> is false, return false."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "match an attribution source against filters",
      "href": "https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-an-attribution-source-against-filters\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match an attribution source against filters</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑥⑨\">attribution source</a> <var>source</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑨\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①⑥\">filter configs</a> <var>filters</var>, a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②③\">moment</a> <var>moment</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⑧\">boolean</a>\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"match an attribution source against filters\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-an-attribution-source-against-filters-isnegated\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>isNegated</var></dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>filters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⑨\">is empty</a>, return true.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤③\">For each</a> <var>filter</var> of <var>filters</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-a-filter-config\" id=\"ref-for-match-an-attribution-source-against-a-filter-config\">match an attribution source against a filter config</a> with <var>source</var>, <var>filter</var>, <var>moment</var>, and <var>isNegated</var> is true, return true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "match an attribution source against filters and negated filters",
      "href": "https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-an-attribution-source-against-filters-and-negated-filters\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match an attribution source against filters and negated filters</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦⓪\">attribution source</a> <var>source</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①⑦\">filter configs</a> <var>filters</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#filter-config\" id=\"ref-for-filter-config①⑧\">filter configs</a> <var>notFilters</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②④\">moment</a> <var>moment</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters\" id=\"ref-for-match-an-attribution-source-against-filters\">match an attribution source against filters</a> with\n<var>source</var>, <var>filters</var>, <var>moment</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-isnegated\" id=\"ref-for-match-an-attribution-source-against-filters-isnegated\">isNegated</a> set to false is false, return false.</p>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters\" id=\"ref-for-match-an-attribution-source-against-filters①\">match an attribution source against filters</a> with\n<var>source</var>, <var>notFilters</var>, <var>moment</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-isnegated\" id=\"ref-for-match-an-attribution-source-against-filters-isnegated①\">isNegated</a> set to true is false, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "check if an aggregatable attribution report should be unconditionally sent",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an aggregatable attribution report should be unconditionally sent</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①②\">attribution trigger</a> <var>trigger</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id②\">trigger context ID</a> is not null, return true.</p>"
        },
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-filtering-id-max-bytes\" id=\"ref-for-attribution-trigger-aggregatable-filtering-id-max-bytes①\">aggregatable filtering ID max bytes</a>\nis not equal to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-max-bytes\" id=\"ref-for-default-filtering-id-max-bytes①\">default filtering ID max bytes</a>, return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "check if attribution should be blocked by attribution rate limit",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-attribution-should-be-blocked-by-attribution-rate-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-attribution-should-be-blocked-by-attribution-rate-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if attribution should be blocked by attribution rate limit</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①⑤\">attribution rate-limit record</a> <var>newRecord</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingRateLimitRecords</var> be all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①⑥\">attribution rate-limit records</a> <var>record</var> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①③\">attribution rate-limit cache</a> where all of the following are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①⓪\">scope</a> is <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①①\">scope</a></p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site①②\">source site</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site①③\">source site</a> are equal</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination①①\">attribution destination</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination①②\">attribution destination</a> are equal</p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin①⓪\">reporting origin</a> and <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin①①\">reporting origin</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site③\">same site</a></p>\n       </li><li data-md=\"\">\n        <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time⑧\">time</a> is greater than <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-window\" id=\"ref-for-attribution-rate-limit-window⑤\">attribution rate-limit window</a> before <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time⑨\">time</a></p>\n      </li></ul>"
        },
        {
          "html": "<p>If <var>matchingRateLimitRecords</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②⑧\">size</a> is greater than or equal to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-attributions-per-rate-limit-window\" id=\"ref-for-max-attributions-per-rate-limit-window\">max attributions per rate-limit window</a>, return <strong>blocked</strong>.</p>"
        },
        {
          "html": "<p>Return <strong>allowed</strong>.</p>"
        }
      ]
    },
    {
      "name": "check if attribution should be blocked by rate limits",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-attribution-should-be-blocked-by-rate-limits",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-attribution-should-be-blocked-by-rate-limits\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if attribution should be blocked by rate limits</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①⑦\">attribution rate-limit record</a> <var>newRecord</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-should-be-blocked-by-attribution-rate-limit\" id=\"ref-for-check-if-attribution-should-be-blocked-by-attribution-rate-limit\">check if attribution should be blocked by attribution rate limit</a> with <var>newRecord</var> is <strong>blocked</strong>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>debugDataType</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-attributions-per-source-destination-limit\" id=\"ref-for-trigger-debug-data-type-trigger-event-attributions-per-source-destination-limit\">trigger-event-attributions-per-source-destination-limit</a></code>\".</p>"
            },
            {
              "html": "<p>If <var>newRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①②\">scope</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-aggregatable-attribution\" id=\"ref-for-rate-limit-scope-aggregatable-attribution④\">aggregatable-attribution</a></code>\",\nset <var>debugDataType</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-attributions-per-source-destination-limit\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-attributions-per-source-destination-limit\">trigger-aggregate-attributions-per-source-destination-limit</a></code>\".</p>"
            },
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result②③\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped\">dropped</a></code>\", (<var>debugDataType</var>, null)).</p>"
            }
          ]
        },
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-processing-should-be-blocked-by-reporting-origin-limit\" id=\"ref-for-check-if-processing-should-be-blocked-by-reporting-origin-limit①\">check if processing should be blocked by reporting-origin limit</a> with\n<var>newRecord</var> is <strong>blocked</strong>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-reporting-origin-limit\" id=\"ref-for-trigger-debug-data-type-trigger-reporting-origin-limit\">trigger-reporting-origin-limit</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "create aggregatable contributions from aggregation keys and aggregatable values",
      "href": "https://wicg.github.io/attribution-reporting-api/#create-aggregatable-contributions-from-aggregation-keys-and-aggregatable-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-aggregatable-contributions-from-aggregation-keys-and-aggregatable-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution⑤\">aggregatable contributions</a> from <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregation-keys\" id=\"ref-for-attribution-source-aggregation-keys③\">aggregation keys</a> and aggregatable <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-values\" id=\"ref-for-aggregatable-values-configuration-values②\">values</a></dfn>\n given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥②\">map</a> <var>aggregationKeys</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥③\">map</a> <var>aggregatableValues</var>,\n run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contributions</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥②\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑦\">For each</a> <var>id</var> → <var>key</var> of <var>aggregationKeys</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>aggregatableValues</var>[<var>id</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥②\">exist</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑧\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>contribution</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution⑥\">aggregatable contribution</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key③\">key</a>\n         </dt><dd data-md=\"\">\n          <p><var>key</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value④\">value</a>\n         </dt><dd data-md=\"\">\n          <p><var>aggregatableValues</var>[<var>id</var>]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value-value\" id=\"ref-for-aggregatable-key-value-value②\">value</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-filtering-id\" id=\"ref-for-aggregatable-contribution-filtering-id②\">filtering ID</a>\n         </dt><dd data-md=\"\">\n          <p><var>aggregatableValues</var>[<var>id</var>]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-key-value-filtering-id\" id=\"ref-for-aggregatable-key-value-filtering-id②\">filtering ID</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②③\">Append</a> <var>contribution</var> to <var>contributions</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>contributions</var>.</p>"
        }
      ]
    },
    {
      "name": "create aggregatable contributions",
      "href": "https://wicg.github.io/attribution-reporting-api/#create-aggregatable-contributions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-aggregatable-contributions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution⑦\">aggregatable contributions</a></dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦①\">attribution source</a> <var>source</var> and an\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①③\">attribution trigger</a> <var>trigger</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>aggregationKeys</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone\">cloning</a> <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregation-keys\" id=\"ref-for-attribution-source-aggregation-keys④\">aggregation keys</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤④\">For each</a> <var>triggerData</var> of <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-trigger-data\" id=\"ref-for-attribution-trigger-aggregatable-trigger-data①\">aggregatable trigger data</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters\" id=\"ref-for-match-an-attribution-source-against-filters-and-negated-filters\">match an attribution source against filters and negated filters</a> with\n<var>source</var>, <var>triggerData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-filters\" id=\"ref-for-aggregatable-trigger-data-filters①\">filters</a>,\n<var>triggerData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-negated-filters\" id=\"ref-for-aggregatable-trigger-data-negated-filters①\">negated filters</a>, and\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①\">trigger time</a>\nis false, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑨\">continue</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑤\">For each</a> <var>sourceKey</var> of <var>triggerData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-source-keys\" id=\"ref-for-aggregatable-trigger-data-source-keys①\">source keys</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>aggregationKeys</var>[<var>sourceKey</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥③\">exist</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⓪\">continue</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②④\">Set</a> <var>aggregationKeys</var>[<var>sourceKey</var>] to <var>aggregationKeys</var>[<var>sourceKey</var>] bitwise-OR <var>triggerData</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-trigger-data-key-piece\" id=\"ref-for-aggregatable-trigger-data-key-piece①\">key piece</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>aggregatableValuesConfigurations</var> be <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-values-configurations\" id=\"ref-for-attribution-trigger-aggregatable-values-configurations①\">aggregatable values configurations</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑥\">For each</a> <var>aggregatableValuesConfiguration</var> of <var>aggregatableValuesConfigurations</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters\" id=\"ref-for-match-an-attribution-source-against-filters-and-negated-filters①\">match an attribution source against filters and negated filters</a> with\n<var>source</var>, <var>aggregatableValuesConfiguration</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-filters\" id=\"ref-for-aggregatable-values-configuration-filters②\">filters</a>,\n<var>aggregatableValuesConfiguration</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-negated-filters\" id=\"ref-for-aggregatable-values-configuration-negated-filters②\">negated filters</a>, and\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time②\">trigger time</a> is true:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-aggregatable-contributions-from-aggregation-keys-and-aggregatable-values\" id=\"ref-for-create-aggregatable-contributions-from-aggregation-keys-and-aggregatable-values\">create aggregatable contributions from aggregation keys and aggregatable values</a> with\n<var>aggregationKeys</var> and <var>aggregatableValuesConfiguration</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-values\" id=\"ref-for-aggregatable-values-configuration-values③\">values</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥③\">list</a>.</p>"
        }
      ]
    },
    {
      "name": "check if an attribution source can create aggregatable contributions",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-can-create-aggregatable-contributions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-source-can-create-aggregatable-contributions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦②\">attribution source</a> can create <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution⑧\">aggregatable contributions</a></dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①①\">aggregatable attribution report</a> <var>report</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦③\">attribution source</a> <var>sourceToAttribute</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>remainingAggregatableBudget</var> be <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-aggregatable-attribution-budget\" id=\"ref-for-attribution-source-remaining-aggregatable-attribution-budget①\">remaining aggregatable attribution budget</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑦\">Assert</a>: <var>remainingAggregatableBudget</var> is greater than or equal to 0.</p>"
        },
        {
          "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-required-aggregatable-budget\" id=\"ref-for-aggregatable-report-required-aggregatable-budget③\">required aggregatable budget</a> is greater than\n<var>remainingAggregatableBudget</var>, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "find matching budget name",
      "href": "https://wicg.github.io/attribution-reporting-api/#find-matching-budget-name",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"find-matching-budget-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find matching budget name</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①④\">attribution trigger</a> <var>trigger</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦④\">attribution source</a> <var>sourceToAttribute</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑦\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget\" id=\"ref-for-named-budget②\">named budget</a> <var>namedBudget</var> of <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-named-budgets\" id=\"ref-for-attribution-trigger-named-budgets\">named budgets</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters\" id=\"ref-for-match-an-attribution-source-against-filters-and-negated-filters②\">match an attribution source against filters and negated filters</a>\nwith <var>sourceToAttribute</var>, <var>namedBudget</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget-filters\" id=\"ref-for-named-budget-filters①\">filters</a>,\n<var>namedBudget</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget-negated-filters\" id=\"ref-for-named-budget-negated-filters①\">negated filters</a>, and\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time③\">trigger time</a> is true:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>namedBudget</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#named-budget-name\" id=\"ref-for-named-budget-name①\">name</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "check if an attribution source can create aggregatable contributions for matched budget name",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-can-create-aggregatable-contributions-for-matched-budget-name",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-source-can-create-aggregatable-contributions-for-matched-budget-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦⑤\">attribution source</a> can create <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution⑨\">aggregatable contributions</a> for matched budget name</dfn>\ngiven an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①②\">aggregatable attribution report</a> <var>report</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦⑥\">attribution source</a> <var>sourceToAttribute</var>,\nand a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⑥\">string</a> <var>matchedBudgetName</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-named-budgets\" id=\"ref-for-attribution-source-remaining-named-budgets③\">remaining named budgets</a>[<var>matchedBudgetName</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥④\">exist</a>, return true.</p>"
        },
        {
          "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-required-aggregatable-budget\" id=\"ref-for-aggregatable-report-required-aggregatable-budget④\">required aggregatable budget</a> is greater than\n<var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-named-budgets\" id=\"ref-for-attribution-source-remaining-named-budgets④\">remaining named budgets</a>[<var>matchedBudgetName</var>], return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "obtain verbose debug data body on trigger registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-verbose-debug-data-body-on-trigger-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-verbose-debug-data-body-on-trigger-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain verbose debug data body on trigger registration</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type\" id=\"ref-for-trigger-debug-data-type②\">trigger debug data type</a> <var>dataType</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①⑤\">attribution trigger</a> <var>trigger</var>,\na possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦⑦\">attribution source</a> <var>sourceToAttribute</var>, and a possibly null\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report⑤\">attribution report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥④\">map</a>.</p>"
        },
        {
          "html": "If <var>dataType</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"trigger-event-attributions-per-source-destination-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑤\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-attributions-per-rate-limit-window\" id=\"ref-for-max-attributions-per-rate-limit-window①\">max attributions per rate-limit window</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①①\">serialized</a>.</p>"
                },
                {
                  "case": "\"trigger-aggregate-attributions-per-source-destination-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑤\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-attributions-per-rate-limit-window\" id=\"ref-for-max-attributions-per-rate-limit-window①\">max attributions per rate-limit window</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①①\">serialized</a>.</p>"
                },
                {
                  "case": "\"trigger-reporting-origin-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑥\">Set</a> <var>body</var>[\"<code>limit</code>\"] to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-attribution-reporting-origins-per-rate-limit-window\" id=\"ref-for-max-attribution-reporting-origins-per-rate-limit-window①\">max attribution reporting origins per rate-limit window</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①②\">serialized</a>.</p>"
                },
                {
                  "case": "\"trigger-event-storage-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑦\">Set</a> <var>body</var>[\"<code>limit</code>\"] to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-event-level-reports-per-attribution-destination\" id=\"ref-for-max-event-level-reports-per-attribution-destination\">max event-level reports per attribution destination</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①③\">serialized</a>.</p>"
                },
                {
                  "case": "\"trigger-aggregate-storage-limit\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑧\">Set</a> <var>body</var>[\"<code>limit</code>\"] to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-attribution-reports-per-attribution-destination\" id=\"ref-for-max-aggregatable-attribution-reports-per-attribution-destination\">max aggregatable attribution reports per attribution destination</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①④\">serialized</a>.</p>"
                },
                {
                  "case": "\"trigger-aggregate-insufficient-budget\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑨\">Set</a> <var>body</var>[\"<code>limit</code>\"] to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#allowed-aggregatable-budget-per-source\" id=\"ref-for-allowed-aggregatable-budget-per-source⑦\">allowed aggregatable budget per source</a>,\n <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①⑤\">serialized</a>.</p>"
                },
                {
                  "case": "\"trigger-aggregate-insufficient-named-budget\"",
                  "html": "",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑧\">Assert</a>: <var>sourceToAttribute</var> is not null.</p>"
                    },
                    {
                      "html": "<p>Let <var>matchedBudgetName</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#find-matching-budget-name\" id=\"ref-for-find-matching-budget-name\">find matching budget name</a> with <var>trigger</var> and <var>sourceToAttribute</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑨\">Assert</a>: <var>matchedBudgetName</var> is not null and <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-named-budgets\" id=\"ref-for-attribution-source-named-budgets③\">named budgets</a>[<var>matchedBudgetName</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑤\">exists</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⓪\">Set</a> <var>body</var>[\"<code>name</code>\"] to <var>matchedBudgetName</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③①\">Set</a> <var>body</var>[\"<code>limit</code>\"] to <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-named-budgets\" id=\"ref-for-attribution-source-named-budgets④\">named budgets</a>[<var>matchedBudgetName</var>],\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①⑥\">serialized</a>.</p>"
                    }
                  ]
                },
                {
                  "case": "\"trigger-aggregate-excessive-reports\"",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③②\">Set</a> <var>body</var>[\"<code>limit</code>\"] to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-reports-per-source\" id=\"ref-for-max-aggregatable-reports-per-source①\">max aggregatable reports per source</a>[0],</p>"
                },
                {
                  "case": "\"trigger-event-low-priority\"",
                  "html": "",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⓪\">Assert</a>: <var>report</var> is not null and is an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①②\">event-level report</a>.</p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-body\" id=\"ref-for-obtain-an-event-level-report-body\">obtain an event-level report body</a> with <var>report</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "\"trigger-event-excessive-reports\"",
                  "html": "",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⓪\">Assert</a>: <var>report</var> is not null and is an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①②\">event-level report</a>.</p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-body\" id=\"ref-for-obtain-an-event-level-report-body\">obtain an event-level report body</a> with <var>report</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③③\">Set</a> <var>body</var>[\"<code>attribution_destination</code>\"] to <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination①\">attribution destination</a>,\n<a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>"
        },
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-key\" id=\"ref-for-attribution-trigger-debug-key①\">debug key</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③④\">set</a> <var>body</var>[\"<code>trigger_debug_key</code>\"]\nto <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-key\" id=\"ref-for-attribution-trigger-debug-key②\">debug key</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①⑦\">serialized</a>.</p>"
        },
        {
          "html": "If <var>sourceToAttribute</var> is not null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑤\">Set</a> <var>body</var>[\"<code>source_event_id</code>\"] to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-id\" id=\"ref-for-attribution-source-event-id②\">event ID</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①⑧\">serialized</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑥\">Set</a> <var>body</var>[\"<code>source_site</code>\"] to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site①②\">source site</a>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>"
            },
            {
              "html": "<p>If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key③\">debug key</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑦\">set</a>\n<var>body</var>[\"<code>source_debug_key</code>\"] to <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key④\">debug key</a>,\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①⑨\">serialized</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain verbose debug data on trigger registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-verbose-debug-data-on-trigger-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-verbose-debug-data-on-trigger-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain verbose debug data on trigger registration</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type\" id=\"ref-for-trigger-debug-data-type③\">trigger debug data type</a> <var>dataType</var>,\nan <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①⑥\">attribution trigger</a> <var>trigger</var>, a possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦⑧\">attribution source</a>\n<var>sourceToAttribute</var>, and a possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report⑥\">attribution report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-reporting-enabled\" id=\"ref-for-attribution-trigger-debug-reporting-enabled①\">debug reporting enabled</a> is false, return null.</p>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-cookie-based-debugging-is-allowed\" id=\"ref-for-check-if-cookie-based-debugging-is-allowed②\">check if cookie-based debugging is allowed</a> with <var>trigger</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-reporting-origin\" id=\"ref-for-attribution-trigger-reporting-origin②\">reporting origin</a> and <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination②\">attribution destination</a> is <strong>blocked</strong>, return null.</p>"
        },
        {
          "html": "<p>If <var>sourceToAttribute</var> is not null and <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cookie-based-debug-allowed\" id=\"ref-for-attribution-source-cookie-based-debug-allowed②\">cookie-based debug allowed</a> is false,\n return null.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data\" id=\"ref-for-verbose-debug-data⑤\">verbose debug data</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-data-type\" id=\"ref-for-verbose-debug-data-data-type③\">data type</a>\n       </dt><dd data-md=\"\">\n        <p><var>dataType</var>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-body\" id=\"ref-for-verbose-debug-data-body②\">body</a>\n       </dt><dd data-md=\"\">\n        <p>The result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-verbose-debug-data-body-on-trigger-registration\" id=\"ref-for-obtain-verbose-debug-data-body-on-trigger-registration\">obtain verbose debug data body on trigger registration</a> with <var>dataType</var>, <var>trigger</var>, <var>sourceToAttribute</var>, and <var>report</var>.</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>data</var>.</p>"
        }
      ]
    },
    {
      "name": "maybe replace event-level report",
      "href": "https://wicg.github.io/attribution-reporting-api/#maybe-replace-event-level-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"maybe-replace-event-level-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">maybe replace event-level report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑦⑨\">attribution source</a>\n<var>sourceToAttribute</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①⑤\">event-level report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②①\">Assert</a>: <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports②\">number of event-level reports</a> is less than or equal to\n<var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-max-number-of-event-level-reports\" id=\"ref-for-attribution-source-max-number-of-event-level-reports⑤\">max number of event-level reports</a>.</p>"
        },
        {
          "html": "<p>If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports③\">number of event-level reports</a> is less than\n<var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-max-number-of-event-level-reports\" id=\"ref-for-attribution-source-max-number-of-event-level-reports⑥\">max number of event-level reports</a>, return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-replacement-result-add-new-report\" id=\"ref-for-event-level-report-replacement-result-add-new-report\">add-new-report</a></code>\".</p>"
        },
        {
          "html": "<p>Let <var>matchingReports</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥④\">list</a> whose elements are all the elements in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache⑧\">event-level report cache</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time②\">report time</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-source-id\" id=\"ref-for-event-level-report-source-id②\">source ID</a> are equal to <var>report</var>’s, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-ascending-order\" id=\"ref-for-list-sort-in-ascending-order④\">sorted in ascending order</a> using <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-is-lower-priority-than\" id=\"ref-for-event-level-report-is-lower-priority-than①\">is lower-priority than</a>.</p>"
        },
        {
          "html": "If <var>matchingReports</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②⓪\">is empty</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-attributable\" id=\"ref-for-attribution-source-event-level-attributable①\">event-level attributable</a> value to false.</p>"
            },
            {
              "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-replacement-result-drop-new-report-none-to-replace\" id=\"ref-for-event-level-report-replacement-result-drop-new-report-none-to-replace\">drop-new-report-none-to-replace</a></code>\".</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②②\">Assert</a>: <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports④\">number of event-level reports</a>\nis greater than or equal to <var>matchingReports</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②⑨\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>lowestPriorityReport</var> be <var>matchingReports</var>[0].</p>"
        },
        {
          "html": "<p>If <var>report</var> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-is-lower-priority-than\" id=\"ref-for-event-level-report-is-lower-priority-than②\">is lower-priority than</a> <var>lowestPriorityReport</var>,\nreturn \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-replacement-result-drop-new-report-low-priority\" id=\"ref-for-event-level-report-replacement-result-drop-new-report-low-priority\">drop-new-report-low-priority</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑥\">Remove</a> <var>lowestPriorityReport</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache⑨\">event-level report cache</a>.</p>"
        },
        {
          "html": "<p>Decrement <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports⑤\">number of event-level reports</a> value by 1.</p>"
        },
        {
          "html": "<p>Let <var>rateLimitRecord</var> be the element from <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①④\">attribution rate-limit cache</a> whose\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id⑧\">entity ID</a> is equal to <var>lowestPriorityReport</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id④\">internal ID</a>\nand <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①③\">scope</a> is equal to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-event-attribution\" id=\"ref-for-rate-limit-scope-event-attribution⑤\">event-attribution</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②③\">Assert</a>: <var>rateLimitRecord</var> is not null.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑦\">Remove</a> <var>rateLimitRecord</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①⑤\">attribution rate-limit cache</a>.</p>"
        },
        {
          "html": "<p>Return \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-replacement-result-add-new-report\" id=\"ref-for-event-level-report-replacement-result-add-new-report①\">add-new-report</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "trigger event-level attribution",
      "href": "https://wicg.github.io/attribution-reporting-api/#trigger-event-level-attribution",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"trigger-event-level-attribution\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">trigger event-level attribution</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①⑦\">attribution trigger</a> <var>trigger</var> and an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧⓪\">attribution source</a> <var>sourceToAttribute</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-event-level-trigger-configurations\" id=\"ref-for-attribution-trigger-event-level-trigger-configurations①\">event-level trigger configurations</a>\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②①\">is empty</a>, return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result②\">triggering result</a>\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped②\">dropped</a></code>\", null).</p>"
        },
        {
          "html": "If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response⑧\">randomized response</a> is not null and is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②②\">empty</a>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②④\">Assert</a>: <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-attributable\" id=\"ref-for-attribution-source-event-level-attributable②\">event-level attributable</a> is false.</p>"
            },
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result③\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped③\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-noise\" id=\"ref-for-trigger-debug-data-type-trigger-event-noise\">trigger-event-noise</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>matchedConfig</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑧\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration\" id=\"ref-for-event-level-trigger-configuration②\">event-level trigger configuration</a> <var>config</var> of <var>trigger</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-event-level-trigger-configurations\" id=\"ref-for-attribution-trigger-event-level-trigger-configurations②\">event-level trigger configurations</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters\" id=\"ref-for-match-an-attribution-source-against-filters-and-negated-filters③\">match an attribution source against filters and negated filters</a> with <var>sourceToAttribute</var>,\n<var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-filters\" id=\"ref-for-event-level-trigger-configuration-filters①\">filters</a>,\n<var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-negated-filters\" id=\"ref-for-event-level-trigger-configuration-negated-filters①\">negated filters</a>, and\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time④\">trigger time</a> is true:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>matchedConfig</var> to <var>config</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">Break</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>matchedConfig</var> is null:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result④\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped④\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-no-matching-configurations\" id=\"ref-for-trigger-debug-data-type-trigger-event-no-matching-configurations\">trigger-event-no-matching-configurations</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "If <var>matchedConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-dedup-key\" id=\"ref-for-event-level-trigger-configuration-dedup-key②\">dedup key</a> is not null and\n<var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-dedup-keys\" id=\"ref-for-attribution-source-dedup-keys\">dedup keys</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑥\">contains</a> it:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result⑤\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped⑤\">dropped</a></code>\",\n (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-deduplicated\" id=\"ref-for-trigger-debug-data-type-trigger-event-deduplicated\">trigger-event-deduplicated</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>triggerData</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#find-matching-trigger-data\" id=\"ref-for-find-matching-trigger-data\">finding matching trigger data</a> with\n<var>sourceToAttribute</var> and <var>matchedConfig</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-trigger-data\" id=\"ref-for-event-level-trigger-configuration-trigger-data④\">trigger data</a>.</p>"
        },
        {
          "html": "If <var>triggerData</var> is an error:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result⑥\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped⑥\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-no-matching-trigger-data\" id=\"ref-for-trigger-debug-data-type-trigger-event-no-matching-trigger-data\">trigger-event-no-matching-trigger-data</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>windowResult</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-whether-a-moment-falls-within-a-window\" id=\"ref-for-check-whether-a-moment-falls-within-a-window\">check whether a moment falls within a window</a>\nwith <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time⑤\">trigger time</a> and\n<var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-report-windows\" id=\"ref-for-attribution-source-event-level-report-windows④\">event-level report windows</a>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-list-total-window\" id=\"ref-for-report-window-list-total-window①\">total window</a>.</p>"
        },
        {
          "html": "If <var>windowResult</var> is <strong>falls before</strong>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result⑦\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped⑦\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-report-window-not-started\" id=\"ref-for-trigger-debug-data-type-trigger-event-report-window-not-started\">trigger-event-report-window-not-started</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "If <var>windowResult</var> is <strong>falls after</strong>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result⑧\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped⑧\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-report-window-passed\" id=\"ref-for-trigger-debug-data-type-trigger-event-report-window-passed\">trigger-event-report-window-passed</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑤\">Assert</a>: <var>windowResult</var> is <strong>falls within</strong>.</p>"
        },
        {
          "html": "<p>Let <var>report</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report\" id=\"ref-for-obtain-an-event-level-report①\">obtain an event-level report</a> with <var>sourceToAttribute</var>,\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time⑥\">trigger time</a>, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-key\" id=\"ref-for-attribution-trigger-debug-key③\">debug key</a>,\n<var>matchedConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-priority\" id=\"ref-for-event-level-trigger-configuration-priority①\">priority</a>, and <var>triggerData</var>.</p>"
        },
        {
          "html": "If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-attributable\" id=\"ref-for-attribution-source-event-level-attributable③\">event-level attributable</a> value\nis false:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result⑨\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped⑨\">dropped</a></code>\",\n (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-excessive-reports\" id=\"ref-for-trigger-debug-data-type-trigger-event-excessive-reports①\">trigger-event-excessive-reports</a></code>\", <var>report</var>)).</p>"
            }
          ]
        },
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#maybe-replace-event-level-report\" id=\"ref-for-maybe-replace-event-level-report\">maybe replace event-level report</a> with <var>sourceToAttribute</var> and <var>report</var> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"add-new-report\"",
                  "html": "",
                  "rationale": "do",
                  "steps": [
                    {
                      "html": "<p>Do nothing.</p>"
                    }
                  ]
                },
                {
                  "case": "\"drop-new-report-none-to-replace\"",
                  "html": "",
                  "rationale": "return",
                  "steps": [
                    {
                      "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①⓪\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①⓪\">dropped</a></code>\",\n (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-excessive-reports\" id=\"ref-for-trigger-debug-data-type-trigger-event-excessive-reports②\">trigger-event-excessive-reports</a></code>\", <var>report</var>)).</p>"
                    }
                  ]
                },
                {
                  "case": "\"drop-new-report-low-priority\"",
                  "html": "",
                  "rationale": "return",
                  "steps": [
                    {
                      "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①①\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①①\">dropped</a></code>\",\n (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-low-priority\" id=\"ref-for-trigger-debug-data-type-trigger-event-low-priority①\">trigger-event-low-priority</a></code>\", <var>report</var>)).</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>rateLimitRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①⑧\">attribution rate-limit record</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①④\">scope</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-event-attribution\" id=\"ref-for-rate-limit-scope-event-attribution⑥\">event-attribution</a></code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site①④\">source site</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site①③\">source site</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination①③\">attribution destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination③\">attribution destination</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin①②\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin②①\">reporting origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time①⓪\">time</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②③\">source time</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time⑥\">expiry time</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id⑨\">entity ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id⑤\">internal ID</a></p>\n      </dd></dl>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-should-be-blocked-by-rate-limits\" id=\"ref-for-check-if-attribution-should-be-blocked-by-rate-limits\">check if attribution should be blocked by rate limits</a>\nwith <var>rateLimitRecord</var> is not null, return it.</p>"
        },
        {
          "html": "<p>Let <var>numMatchingReports</var> be the number of entries in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache①⓪\">event-level report cache</a> whose\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-destinations\" id=\"ref-for-event-level-report-attribution-destinations②\">attribution destinations</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑦\">contains</a> <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination④\">attribution destination</a>.</p>"
        },
        {
          "html": "If <var>numMatchingReports</var> is greater than or equal to the user agent’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-event-level-reports-per-attribution-destination\" id=\"ref-for-max-event-level-reports-per-attribution-destination①\">max event-level reports per attribution destination</a>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①②\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①②\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-storage-limit\" id=\"ref-for-trigger-debug-data-type-trigger-event-storage-limit①\">trigger-event-storage-limit</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>triggeringStatus</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-attributed\" id=\"ref-for-triggering-status-attributed\">attributed</a></code>\".</p>"
        },
        {
          "html": "<p>Let <var>debugData</var> be null.</p>"
        },
        {
          "html": "If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-response\" id=\"ref-for-attribution-source-randomized-response⑨\">randomized response</a> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "null",
                  "html": "",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②⑦\">Append</a> <var>report</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache①①\">event-level report cache</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②⑧\">Append</a> <var>rateLimitRecord</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①⑥\">attribution rate-limit cache</a>.</p>"
                    }
                  ]
                },
                {
                  "case": "not null",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>triggeringStatus</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-noised\" id=\"ref-for-triggering-status-noised①\">noised</a></code>\".</p>"
                    },
                    {
                      "html": "<p>Set <var>debugData</var> to (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-event-noise\" id=\"ref-for-trigger-debug-data-type-trigger-event-noise①\">trigger-event-noise</a></code>\", null).</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Increment <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-event-level-reports\" id=\"ref-for-attribution-source-number-of-event-level-reports⑥\">number of event-level reports</a> value by 1.</p>"
        },
        {
          "html": "<p>If <var>matchedConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-trigger-configuration-dedup-key\" id=\"ref-for-event-level-trigger-configuration-dedup-key③\">dedup key</a> is not null,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②④\">append</a> it to <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-dedup-keys\" id=\"ref-for-attribution-source-dedup-keys①\">dedup keys</a>.</p>"
        },
        {
          "html": "<p>If <var>triggeringStatus</var> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-attributed\" id=\"ref-for-triggering-status-attributed①\">attributed</a></code>\" and\nthe result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-debugging-can-be-enabled\" id=\"ref-for-check-if-attribution-debugging-can-be-enabled①\">checking if attribution debugging can be enabled</a>\nwith <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-debug-info\" id=\"ref-for-event-level-report-attribution-debug-info\">attribution debug info</a> is true, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③\">queue a task</a> to\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-debug-report\" id=\"ref-for-attempt-to-deliver-a-debug-report\">attempt to deliver a debug report</a> with <var>report</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①③\">triggering result</a> (<var>triggeringStatus</var>, <var>debugData</var>).</p>"
        }
      ]
    },
    {
      "name": "trigger aggregatable attribution",
      "href": "https://wicg.github.io/attribution-reporting-api/#trigger-aggregatable-attribution",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"trigger-aggregatable-attribution\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">trigger aggregatable attribution</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①⑧\">attribution trigger</a> <var>trigger</var> and an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧①\">attribution source</a> <var>sourceToAttribute</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-trigger-contains-aggregatable-data\" id=\"ref-for-check-if-an-attribution-trigger-contains-aggregatable-data\">check if an attribution trigger contains aggregatable data</a> is false,\nreturn the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①④\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①③\">dropped</a></code>\", null).</p>"
        },
        {
          "html": "<p>Let <var>windowResult</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-whether-a-moment-falls-within-a-window\" id=\"ref-for-check-whether-a-moment-falls-within-a-window①\">check whether a moment falls within a window</a> with <var>trigger</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time⑦\">trigger time</a> and <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-report-window\" id=\"ref-for-attribution-source-aggregatable-report-window②\">aggregatable report window</a>.</p>"
        },
        {
          "html": "If <var>windowResult</var> is <strong>falls after</strong>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①⑤\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①④\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-report-window-passed\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-report-window-passed\">trigger-aggregate-report-window-passed</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑥\">Assert</a>: <var>windowResult</var> is <strong>falls within</strong>.</p>"
        },
        {
          "html": "<p>Let <var>matchedDedupKey</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑨\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key\" id=\"ref-for-aggregatable-dedup-key②\">aggregatable dedup key</a> <var>aggregatableDedupKey</var> of <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-dedup-keys\" id=\"ref-for-attribution-trigger-aggregatable-dedup-keys①\">aggregatable dedup keys</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters\" id=\"ref-for-match-an-attribution-source-against-filters-and-negated-filters④\">match an attribution source against filters and negated filters</a>\nwith <var>sourceToAttribute</var>, <var>aggregatableDedupKey</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key-filters\" id=\"ref-for-aggregatable-dedup-key-filters①\">filters</a>,\n<var>aggregatableDedupKey</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key-negated-filters\" id=\"ref-for-aggregatable-dedup-key-negated-filters①\">negated filters</a>, and\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time⑧\">trigger time</a> is true:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>matchedDedupKey</var> to <var>aggregatableDedupKey</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-dedup-key-dedup-key\" id=\"ref-for-aggregatable-dedup-key-dedup-key②\">dedup key</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">Break</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>matchedDedupKey</var> is not null and <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-dedup-keys\" id=\"ref-for-attribution-source-aggregatable-dedup-keys\">aggregatable dedup keys</a>\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑧\">contains</a> it:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①⑥\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①⑤\">dropped</a></code>\",\n (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-deduplicated\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-deduplicated\">trigger-aggregate-deduplicated</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>report</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-attribution-report\" id=\"ref-for-obtain-an-aggregatable-attribution-report\">obtain an aggregatable attribution report</a> with <var>sourceToAttribute</var> and <var>trigger</var>.</p>"
        },
        {
          "html": "If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-contributions\" id=\"ref-for-aggregatable-report-contributions②\">contributions</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②③\">is empty</a>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①⑦\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①⑥\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-no-contributions\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-no-contributions\">trigger-aggregate-no-contributions</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>numMatchingReports</var> be the number of entries in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache⑤\">aggregatable attribution report cache</a> whose\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-effective-attribution-destination\" id=\"ref-for-aggregatable-report-effective-attribution-destination②\">effective attribution destination</a> equals <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination⑤\">attribution destination</a>\n and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-is-null-report\" id=\"ref-for-aggregatable-attribution-report-is-null-report\">is null report</a> is false.</p>"
        },
        {
          "html": "If <var>numMatchingReports</var> is greater than or equal to the user agent’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-attribution-reports-per-attribution-destination\" id=\"ref-for-max-aggregatable-attribution-reports-per-attribution-destination①\">max aggregatable attribution reports per attribution destination</a>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①⑧\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①⑦\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-storage-limit\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-storage-limit①\">trigger-aggregate-storage-limit</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>rateLimitRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record①⑨\">attribution rate-limit record</a> with the items:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-scope\" id=\"ref-for-attribution-rate-limit-record-scope①⑤\">scope</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#rate-limit-scope-aggregatable-attribution\" id=\"ref-for-rate-limit-scope-aggregatable-attribution⑤\">aggregatable-attribution</a></code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-source-site\" id=\"ref-for-attribution-rate-limit-record-source-site①⑤\">source site</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-site\" id=\"ref-for-attribution-source-source-site①④\">source site</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-attribution-destination\" id=\"ref-for-attribution-rate-limit-record-attribution-destination①④\">attribution destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination⑥\">attribution destination</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-reporting-origin\" id=\"ref-for-attribution-rate-limit-record-reporting-origin①③\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin②②\">reporting origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-time\" id=\"ref-for-attribution-rate-limit-record-time①①\">time</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②④\">source time</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-expiry-time\" id=\"ref-for-attribution-rate-limit-record-expiry-time⑦\">expiry time</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record-entity-id\" id=\"ref-for-attribution-rate-limit-record-entity-id①⓪\">entity ID</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n      </dd></dl>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-should-be-blocked-by-rate-limits\" id=\"ref-for-check-if-attribution-should-be-blocked-by-rate-limits①\">check if attribution should be blocked by rate limits</a>\nwith <var>rateLimitRecord</var> is not null, return it.</p>"
        },
        {
          "html": "If <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-aggregatable-attribution-reports\" id=\"ref-for-attribution-source-number-of-aggregatable-attribution-reports\">number of aggregatable attribution reports</a> value is equal to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregatable-reports-per-source\" id=\"ref-for-max-aggregatable-reports-per-source②\">max aggregatable reports per source</a>[0] and <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id③\">trigger context ID</a> is null, then:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result①⑨\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①⑧\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-excessive-reports\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-excessive-reports①\">trigger-aggregate-excessive-reports</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-can-create-aggregatable-contributions\" id=\"ref-for-check-if-an-attribution-source-can-create-aggregatable-contributions\">check if an attribution source can create aggregatable contributions</a>\nwith <var>report</var> and <var>sourceToAttribute</var> is false:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result②⓪\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped①⑨\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-insufficient-budget\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-insufficient-budget①\">trigger-aggregate-insufficient-budget</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>matchedBudgetName</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#find-matching-budget-name\" id=\"ref-for-find-matching-budget-name①\">find matching budget name</a> with <var>trigger</var> and <var>sourceToAttribute</var>.</p>"
        },
        {
          "html": "If <var>matchedBudgetName</var> is not null and the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-can-create-aggregatable-contributions-for-matched-budget-name\" id=\"ref-for-check-if-an-attribution-source-can-create-aggregatable-contributions-for-matched-budget-name\">check if an attribution source can create aggregatable contributions for matched budget name</a>\nwith <var>report</var>, <var>sourceToAttribute</var>, and <var>matchedBudgetName</var> is false:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result②①\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped②⓪\">dropped</a></code>\",\n(\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-aggregate-insufficient-named-budget\" id=\"ref-for-trigger-debug-data-type-trigger-aggregate-insufficient-named-budget①\">trigger-aggregate-insufficient-named-budget</a></code>\", null)).</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②⑨\">Append</a> <var>report</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache⑥\">aggregatable attribution report cache</a>.</p>"
        },
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id④\">trigger context ID</a> is null, increment <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-number-of-aggregatable-attribution-reports\" id=\"ref-for-attribution-source-number-of-aggregatable-attribution-reports①\">number of aggregatable attribution reports</a> value by 1.</p>"
        },
        {
          "html": "<p>Decrement <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-aggregatable-attribution-budget\" id=\"ref-for-attribution-source-remaining-aggregatable-attribution-budget②\">remaining aggregatable attribution budget</a> value by\n<var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-required-aggregatable-budget\" id=\"ref-for-aggregatable-report-required-aggregatable-budget⑤\">required aggregatable budget</a>.</p>"
        },
        {
          "html": "If <var>matchedBudgetName</var> is not null and <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-named-budgets\" id=\"ref-for-attribution-source-remaining-named-budgets⑤\">remaining named budgets</a>[<var>matchedBudgetName</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑥\">exists</a>:",
          "rationale": "decrement",
          "steps": [
            {
              "html": "<p>Decrement <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-remaining-named-budgets\" id=\"ref-for-attribution-source-remaining-named-budgets⑥\">remaining named budgets</a>[<var>matchedBudgetName</var>] value by\n<var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-required-aggregatable-budget\" id=\"ref-for-aggregatable-report-required-aggregatable-budget⑥\">required aggregatable budget</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>matchedDedupKey</var> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑤\">append</a> it to <var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-dedup-keys\" id=\"ref-for-attribution-source-aggregatable-dedup-keys①\">aggregatable dedup keys</a>.</p>"
        },
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id⑤\">trigger context ID</a> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③⓪\">append</a> <var>rateLimitRecord</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①⑦\">attribution rate-limit cache</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports\" id=\"ref-for-generate-null-attribution-reports\">generate null attribution reports</a> with <var>trigger</var> and <var>report</var>.</p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-debugging-can-be-enabled\" id=\"ref-for-check-if-attribution-debugging-can-be-enabled②\">checking if attribution debugging can be enabled</a>\nwith <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-attribution-debug-info\" id=\"ref-for-aggregatable-attribution-report-attribution-debug-info\">attribution debug info</a> is true,\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task④\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-debug-report\" id=\"ref-for-attempt-to-deliver-a-debug-report①\">attempt to deliver a debug report</a> with <var>report</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result\" id=\"ref-for-triggering-result②②\">triggering result</a> (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-attributed\" id=\"ref-for-triggering-status-attributed②\">attributed</a></code>\", null).</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver a verbose debug report on trigger registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report-on-trigger-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-a-verbose-debug-report-on-trigger-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver a verbose debug report on trigger registration</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑧\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data\" id=\"ref-for-trigger-debug-data①\">trigger debug data</a> <var>dataSet</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger①⑨\">attribution trigger</a> <var>trigger</var>,\nand a possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧②\">attribution source</a> <var>sourceToAttribute</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>debugDataList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑤\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⓪\">For each</a> <var>data</var> of <var>dataSet</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>debugData</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-verbose-debug-data-on-trigger-registration\" id=\"ref-for-obtain-verbose-debug-data-on-trigger-registration\">obtain verbose debug data on trigger registration</a> with\n<var>data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-data-type\" id=\"ref-for-trigger-debug-data-data-type\">data type</a>, <var>trigger</var>, <var>sourceToAttribute</var>,\nand <var>data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-report\" id=\"ref-for-trigger-debug-data-report\">report</a>.</p>"
            },
            {
              "html": "<p>If <var>debugData</var> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑥\">append</a> <var>debugData</var> to <var>debugDataList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>debugDataList</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②④\">is empty</a>, return.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report\" id=\"ref-for-obtain-and-deliver-a-verbose-debug-report②\">obtain and deliver a verbose debug report</a> with <var>debugDataList</var>, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-reporting-origin\" id=\"ref-for-attribution-trigger-reporting-origin③\">reporting origin</a>,\nand <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-fenced\" id=\"ref-for-attribution-trigger-fenced①\">fenced</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver an aggregatable debug report on trigger registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-trigger-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-an-aggregatable-debug-report-on-trigger-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver an aggregatable debug report on trigger registration</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑨\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data\" id=\"ref-for-trigger-debug-data②\">trigger debug data</a> <var>dataSet</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②⓪\">attribution trigger</a> <var>trigger</var>,\nand a possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧③\">attribution source</a> <var>sourceToAttribute</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-fenced\" id=\"ref-for-attribution-trigger-fenced②\">fenced</a> is true, return.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-debug-reporting-config\" id=\"ref-for-attribution-trigger-aggregatable-debug-reporting-config①\">aggregatable debug reporting config</a>.</p>"
        },
        {
          "html": "<p>Let <var>debugDataMap</var> be <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-debug-data\" id=\"ref-for-aggregatable-debug-reporting-config-debug-data②\">debug data</a>.</p>"
        },
        {
          "html": "<p>If <var>debugDataMap</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty②\">is empty</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>sourceKeyPiece</var> be 0.</p>"
        },
        {
          "html": "<p>If <var>sourceToAttribute</var> is not null, then set <var>sourceKeyPiece</var> to\n<var>sourceToAttribute</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-aggregatable-debug-reporting-config\" id=\"ref-for-attribution-source-aggregatable-debug-reporting-config②\">aggregatable debug reporting config</a>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-key-piece\" id=\"ref-for-aggregatable-debug-reporting-config-key-piece②\">key piece</a>.</p>"
        },
        {
          "html": "<p>Let <var>contributions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑥\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextKeyPiece</var> be <var>sourceKeyPiece</var> bitwise-OR <var>config</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-key-piece\" id=\"ref-for-aggregatable-debug-reporting-config-key-piece③\">key piece</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥①\">For each</a> <var>data</var> of <var>dataSet</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>type</var> be <var>data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-data-type\" id=\"ref-for-trigger-debug-data-data-type①\">data type</a>.</p>"
            },
            {
              "html": "If <var>debugDataMap</var>[<var>type</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑦\">exists</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>keyPiece</var> be <var>contextKeyPiece</var> bitwise-OR <var>debugDataMap</var>[<var>type</var>]'s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key④\">key</a>.</p>"
                },
                {
                  "html": "<p>Let <var>contribution</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution①⓪\">aggregatable contribution</a> with the items:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key⑤\">key</a>\n           </dt><dd data-md=\"\">\n            <p><var>keyPiece</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value⑤\">value</a>\n           </dt><dd data-md=\"\">\n            <p><var>debugDataMap</var>[<var>type</var>]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value⑥\">value</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-filtering-id\" id=\"ref-for-aggregatable-contribution-filtering-id③\">filtering ID</a>\n           </dt><dd data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-value\" id=\"ref-for-default-filtering-id-value④\">default filtering ID value</a></p>\n          </dd></dl>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑦\">Append</a> <var>contribution</var> to <var>contributions</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-registration\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report-on-registration①\">obtain and deliver an aggregatable debug report on registration</a> with <var>contributions</var>,\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination⑦\">attribution destination</a>, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-reporting-origin\" id=\"ref-for-attribution-trigger-reporting-origin④\">reporting origin</a>,\n<var>sourceToAttribute</var>, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination⑧\">attribution destination</a>,\n<var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-reporting-config-aggregation-coordinator\" id=\"ref-for-aggregatable-debug-reporting-config-aggregation-coordinator②\">aggregation coordinator</a>,\nand <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time⑨\">trigger time</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver debug reports on trigger registration",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-trigger-registration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-debug-reports-on-trigger-registration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver debug reports on trigger registration</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⓪\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data\" id=\"ref-for-trigger-debug-data③\">trigger debug data</a> <var>dataSet</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②①\">attribution trigger</a> <var>trigger</var>,\nand a possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧④\">attribution source</a>\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"obtain and deliver debug reports on trigger registration\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-debug-reports-on-trigger-registration-sourcetoattribute\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>sourceToAttribute</var></dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report-on-trigger-registration\" id=\"ref-for-obtain-and-deliver-a-verbose-debug-report-on-trigger-registration\">obtain and deliver a verbose debug report on trigger registration</a>\nwith <var>dataSet</var>, <var>trigger</var>, and <var>sourceToAttribute</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-an-aggregatable-debug-report-on-trigger-registration\" id=\"ref-for-obtain-and-deliver-an-aggregatable-debug-report-on-trigger-registration\">obtain and deliver an aggregatable debug report on trigger registration</a>\nwith <var>dataSet</var>, <var>trigger</var>, and <var>sourceToAttribute</var>.</p>"
        }
      ]
    },
    {
      "name": "check if an attribution source and attribution trigger have matching attribution scopes",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-and-attribution-trigger-have-matching-attribution-scopes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-source-and-attribution-trigger-have-matching-attribution-scopes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧⑤\">attribution source</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②②\">attribution trigger</a> have matching attribution scopes</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧⑥\">attribution source</a> <var>source</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②③\">attribution trigger</a> <var>trigger</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-scopes\" id=\"ref-for-attribution-trigger-attribution-scopes①\">attribution scopes</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②⑤\">is empty</a>, return true.</p>"
        },
        {
          "html": "<p>Return whether the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection③\">intersection</a> of <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-scopes\" id=\"ref-for-attribution-source-attribution-scopes①④\">attribution scopes</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-scopes-values\" id=\"ref-for-attribution-scopes-values⑥\">values</a> and <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-scopes\" id=\"ref-for-attribution-trigger-attribution-scopes②\">attribution scopes</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②⑥\">empty</a>.</p>"
        }
      ]
    },
    {
      "name": "attribution source/is higher-priority than",
      "href": "https://wicg.github.io/attribution-reporting-api/#attribution-source-is-higher-priority-than",
      "html": "An <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧⑦\">attribution source</a> <var>a</var> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"attribution source\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attribution-source-is-higher-priority-than\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">is higher-priority than</dfn> an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧⑧\">attribution source</a> <var>b</var>\nif the following steps return true:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-priority\" id=\"ref-for-attribution-source-priority①\">priority</a> is greater than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-priority\" id=\"ref-for-attribution-source-priority②\">priority</a>, return true.</p>"
        },
        {
          "html": "<p><var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-priority\" id=\"ref-for-attribution-source-priority③\">priority</a> is less than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-priority\" id=\"ref-for-attribution-source-priority④\">priority</a>, return false.</p>"
        },
        {
          "html": "<p>If <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②⑤\">source time</a> is greater than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②⑥\">source time</a>, return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "find matching sources",
      "href": "https://wicg.github.io/attribution-reporting-api/#find-matching-sources",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"find-matching-sources\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find matching sources</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②④\">attribution trigger</a> <var>trigger</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>matchingSources</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑦\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥②\">For each</a> <var>source</var> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache①③\">attribution source cache</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations②②\">attribution destinations</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑨\">contain</a> <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination⑨\">attribution destination</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②①\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin②③\">reporting origin</a> and <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-reporting-origin\" id=\"ref-for-attribution-trigger-reporting-origin⑤\">reporting origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑥\">same origin</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②②\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-expiry-time\" id=\"ref-for-attribution-source-expiry-time②\">expiry time</a> is less than or equal to <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①⓪\">trigger time</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②③\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑧\">Append</a> <var>source</var> to <var>matchingSources</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>sourceToAttribute</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥③\">For each</a> <var>source</var> of <var>matchingSources</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-source-and-attribution-trigger-have-matching-attribution-scopes\" id=\"ref-for-check-if-an-attribution-source-and-attribution-trigger-have-matching-attribution-scopes\">checking if an attribution source and attribution trigger have matching attribution scopes</a>\nwith <var>source</var> and <var>trigger</var> is false, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②④\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>sourceToAttribute</var> is null or <var>source</var> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-is-higher-priority-than\" id=\"ref-for-attribution-source-is-higher-priority-than\">is higher-priority than</a>\n<var>sourceToAttribute</var>, set <var>sourceToAttribute</var> to <var>source</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>sourceToAttribute</var> is null, return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①②\">tuple</a> (null, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②⑦\">empty</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑧\">list</a>).</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑧\">Remove</a> <var>sourceToAttribute</var> from <var>matchingSources</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①③\">tuple</a> (<var>sourceToAttribute</var>, <var>matchingSources</var>).</p>"
        }
      ]
    },
    {
      "name": "check if an attribution trigger contains aggregatable data",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-trigger-contains-aggregatable-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-an-attribution-trigger-contains-aggregatable-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②⑤\">attribution trigger</a> contains aggregatable data</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②⑥\">attribution trigger</a> <var>trigger</var>,\nrun the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-trigger-data\" id=\"ref-for-attribution-trigger-aggregatable-trigger-data②\">aggregatable trigger data</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②⑧\">empty</a>, return true.</p>"
        },
        {
          "html": "<p>If any of <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-values-configurations\" id=\"ref-for-attribution-trigger-aggregatable-values-configurations②\">aggregatable values configurations</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-values-configuration-values\" id=\"ref-for-aggregatable-values-configuration-values④\">values</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②⑨\">empty</a>, return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "trigger attribution",
      "href": "https://wicg.github.io/attribution-reporting-api/#trigger-attribution",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"trigger-attribution\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">trigger attribution</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②⑦\">attribution trigger</a> <var>trigger</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>hasAggregatableData</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-trigger-contains-aggregatable-data\" id=\"ref-for-check-if-an-attribution-trigger-contains-aggregatable-data①\">checking if an attribution trigger contains aggregatable data</a>\nwith <var>trigger</var>.</p>"
        },
        {
          "html": "<p>If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-event-level-trigger-configurations\" id=\"ref-for-attribution-trigger-event-level-trigger-configurations③\">event-level trigger configurations</a>\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③⓪\">is empty</a> and <var>hasAggregatableData</var> is false, return.</p>"
        },
        {
          "html": "<p>Let (<var>sourceToAttribute</var>, <var>matchingSources</var>) be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#find-matching-sources\" id=\"ref-for-find-matching-sources\">find matching sources</a> with <var>trigger</var>.</p>"
        },
        {
          "html": "If <var>sourceToAttribute</var> is null:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-trigger-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-trigger-registration\">obtain and deliver debug reports on trigger registration</a> with\n« (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-no-matching-source\" id=\"ref-for-trigger-debug-data-type-trigger-no-matching-source\">trigger-no-matching-source</a></code>\", null) »,\n<var>trigger</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-trigger-registration-sourcetoattribute\" id=\"ref-for-obtain-and-deliver-debug-reports-on-trigger-registration-sourcetoattribute\">sourceToAttribute</a> set to null.</p>"
            },
            {
              "html": "<p>If <var>hasAggregatableData</var> is true, then run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports\" id=\"ref-for-generate-null-attribution-reports①\">generate null attribution reports</a>\nwith <var>trigger</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports-report\" id=\"ref-for-generate-null-attribution-reports-report\">report</a> set to null.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "If the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#match-an-attribution-source-against-filters-and-negated-filters\" id=\"ref-for-match-an-attribution-source-against-filters-and-negated-filters⑤\">match an attribution source against filters and negated filters</a> with\n<var>sourceToAttribute</var>, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-filters\" id=\"ref-for-attribution-trigger-filters①\">filters</a>,\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-negated-filters\" id=\"ref-for-attribution-trigger-negated-filters①\">negated filters</a>, and\n<var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①①\">trigger time</a> is false:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-trigger-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-trigger-registration①\">obtain and deliver debug reports on trigger registration</a> with\n« (\"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-debug-data-type-trigger-no-matching-filter-data\" id=\"ref-for-trigger-debug-data-type-trigger-no-matching-filter-data\">trigger-no-matching-filter-data</a></code>\", null) »,\n<var>trigger</var>, and <var>sourceToAttribute</var>.</p>"
            },
            {
              "html": "<p>If <var>hasAggregatableData</var> is true, then run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports\" id=\"ref-for-generate-null-attribution-reports②\">generate null attribution reports</a>\nwith <var>trigger</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports-report\" id=\"ref-for-generate-null-attribution-reports-report①\">report</a> set to null.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥④\">For each</a> <var>item</var> of <var>matchingSources</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑨\">Remove</a> <var>item</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-cache\" id=\"ref-for-attribution-source-cache①④\">attribution source cache</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>eventLevelResult</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-event-level-attribution\" id=\"ref-for-trigger-event-level-attribution②\">trigger event-level attribution</a>\nwith <var>trigger</var> and <var>sourceToAttribute</var>.</p>"
        },
        {
          "html": "<p>Let <var>aggregatableResult</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-aggregatable-attribution\" id=\"ref-for-trigger-aggregatable-attribution①\">trigger aggregatable attribution</a>\nwith <var>trigger</var> and <var>sourceToAttribute</var>.</p>"
        },
        {
          "html": "<p>Let <var>debugDataSet</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤①\">set</a>.</p>"
        },
        {
          "html": "<p>If <var>eventLevelResult</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result-debug-data\" id=\"ref-for-triggering-result-debug-data\">debug data</a> is not null,\nthen <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③①\">append</a> <var>eventLevelResult</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result-debug-data\" id=\"ref-for-triggering-result-debug-data①\">debug data</a> to <var>debugDataSet</var>.</p>"
        },
        {
          "html": "<p>If <var>aggregatableResult</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result-debug-data\" id=\"ref-for-triggering-result-debug-data②\">debug data</a> is not null,\nthen <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③②\">append</a> <var>aggregatableResult</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result-debug-data\" id=\"ref-for-triggering-result-debug-data③\">debug data</a> to <var>debugDataSet</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-trigger-registration\" id=\"ref-for-obtain-and-deliver-debug-reports-on-trigger-registration②\">obtain and deliver debug reports on trigger registration</a> with <var>debugDataSet</var>,\n<var>trigger</var>, and <var>sourceToAttribute</var>.</p>"
        },
        {
          "html": "<p>If <var>hasAggregatableData</var> and <var>aggregatableResult</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-result-status\" id=\"ref-for-triggering-result-status\">status</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#triggering-status-dropped\" id=\"ref-for-triggering-status-dropped②①\">dropped</a></code>\",\nrun <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports\" id=\"ref-for-generate-null-attribution-reports③\">generate null attribution reports</a> with <var>trigger</var> and\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports-report\" id=\"ref-for-generate-null-attribution-reports-report②\">report</a> set to null.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②⓪\">Remove</a> all <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-record\" id=\"ref-for-attribution-rate-limit-record②⓪\">attribution rate-limit records</a> <var>entry</var> from the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-rate-limit-cache\" id=\"ref-for-attribution-rate-limit-cache①⑧\">attribution rate-limit cache</a> if the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-attribution-rate-limit-record-can-be-removed\" id=\"ref-for-check-if-an-attribution-rate-limit-record-can-be-removed①\">check if an attribution rate-limit record can be removed</a> with <var>entry</var> and <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①②\">trigger time</a> is true.</p>"
        }
      ]
    },
    {
      "name": "check whether a moment falls within a window",
      "href": "https://wicg.github.io/attribution-reporting-api/#check-whether-a-moment-falls-within-a-window",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-whether-a-moment-falls-within-a-window\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check whether a moment falls within a window</dfn> given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②⑤\">moment</a> <var>moment</var> and\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window\" id=\"ref-for-report-window⑨\">report window</a> <var>window</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>moment</var> is less than <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-start\" id=\"ref-for-report-window-start⑨\">start</a>, return\n<strong>falls before</strong>.</p>"
        },
        {
          "html": "<p>If <var>moment</var> is greater than or equal to <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-end\" id=\"ref-for-report-window-end⑧\">end</a>,\nreturn <strong>falls after</strong>.</p>"
        },
        {
          "html": "<p>Return <strong>falls within</strong>.</p>"
        }
      ]
    },
    {
      "name": "obtain an event-level report delivery time",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-delivery-time",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-event-level-report-delivery-time\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain an event-level report delivery time</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-list\" id=\"ref-for-report-window-list③\">report window list</a> <var>windows</var> and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②⑥\">moment</a> <var>triggerTime</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#automation-local-testing-mode\" id=\"ref-for-automation-local-testing-mode④\">automation local testing mode</a> is true, return <var>triggerTime</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑤\">For each</a> <var>window</var> of <var>windows</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-whether-a-moment-falls-within-a-window\" id=\"ref-for-check-whether-a-moment-falls-within-a-window②\">check whether a moment falls within a window</a> with\n<var>triggerTime</var> and <var>window</var> is <strong>falls within</strong>, return\n<var>window</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#report-window-end\" id=\"ref-for-report-window-end⑨\">end</a>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑦\">Assert</a>: not reached.</p>"
        }
      ]
    },
    {
      "name": "obtain an aggregatable attribution report delivery time",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-attribution-report-delivery-time",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-aggregatable-attribution-report-delivery-time\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain an aggregatable attribution report delivery time</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②⑧\">attribution trigger</a>\n<var>trigger</var>, perform the following steps. They return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②⑦\">moment</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>triggerTime</var> be <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①③\">trigger time</a>.</p>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent\" id=\"ref-for-check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent①\">check if an aggregatable attribution report should be unconditionally sent</a> with <var>trigger</var>\nis true, return <var>triggerTime</var>.</p>"
        },
        {
          "html": "<p>Let <var>r</var> be a random double between 0 (inclusive) and 1 (exclusive) with uniform probability.</p>"
        },
        {
          "html": "<p>Return <var>triggerTime</var> + <var>r</var> × <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-aggregatable-attribution-report-delay\" id=\"ref-for-randomized-aggregatable-attribution-report-delay\">randomized aggregatable attribution report delay</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain an event-level report",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-event-level-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain an event-level report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑧⑨\">attribution source</a> <var>source</var>,\na <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②⑧\">moment</a> <var>triggerTime</var>, a possibly null non-negative 64-bit integer\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"obtain an event-level report\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-event-level-report-triggerdebugkey\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>triggerDebugKey</var></dfn>,\na 64-bit integer priority <var>priority</var>, and a non-negative 64-bit integer <var>triggerData</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>reportTime</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-delivery-time\" id=\"ref-for-obtain-an-event-level-report-delivery-time\">obtain an event-level report delivery time</a> with <var>source</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-level-report-windows\" id=\"ref-for-attribution-source-event-level-report-windows⑤\">event-level report windows</a> and\n<var>triggerTime</var>.</p>"
        },
        {
          "html": "<p>Let <var>report</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①⑥\">event-level report</a> struct whose items are:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-event-id\" id=\"ref-for-event-level-report-event-id\">event ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-event-id\" id=\"ref-for-attribution-source-event-id③\">event ID</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-data\" id=\"ref-for-event-level-report-trigger-data\">trigger data</a>\n       </dt><dd data-md=\"\">\n        <p><var>triggerData</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-randomized-trigger-rate\" id=\"ref-for-event-level-report-randomized-trigger-rate\">randomized trigger rate</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-randomized-trigger-rate\" id=\"ref-for-attribution-source-randomized-trigger-rate①\">randomized trigger rate</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin③\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin②④\">reporting origin</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-destinations\" id=\"ref-for-event-level-report-attribution-destinations③\">attribution destinations</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-attribution-destinations\" id=\"ref-for-attribution-source-attribution-destinations②③\">attribution destinations</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time③\">report time</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportTime</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-priority\" id=\"ref-for-event-level-report-trigger-priority④\">trigger priority</a>\n       </dt><dd data-md=\"\">\n        <p><var>priority</var>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-time\" id=\"ref-for-event-level-report-trigger-time⑥\">trigger time</a>\n       </dt><dd data-md=\"\">\n        <p><var>triggerTime</var>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-source-id\" id=\"ref-for-event-level-report-source-id③\">source ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id⑨\">internal ID</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-external-id\" id=\"ref-for-attribution-report-external-id①\">external ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/uuid/#dfn-generate-a-random-uuid\" id=\"ref-for-dfn-generate-a-random-uuid①\">generating a random UUID</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id⑥\">internal ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-next-internal-id\" id=\"ref-for-get-the-next-internal-id②\">getting the next internal ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-debug-info\" id=\"ref-for-event-level-report-attribution-debug-info①\">attribution debug info</a>\n       </dt><dd data-md=\"\">\n        <p>(<var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key⑤\">debug key</a>, <var>triggerDebugKey</var>).</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>report</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain an aggregatable attribution report",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-attribution-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-aggregatable-attribution-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain an aggregatable attribution report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source⑨⓪\">attribution source</a> <var>source</var> and\nan <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger②⑨\">attribution trigger</a> <var>trigger</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>reportTime</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-attribution-report-delivery-time\" id=\"ref-for-obtain-an-aggregatable-attribution-report-delivery-time\">obtain an aggregatable attribution report delivery time</a> with <var>trigger</var>.</p>"
        },
        {
          "html": "<p>Let <var>report</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①③\">aggregatable attribution report</a> struct whose items are:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin④\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-reporting-origin\" id=\"ref-for-attribution-source-reporting-origin②⑤\">reporting origin</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-effective-attribution-destination\" id=\"ref-for-aggregatable-report-effective-attribution-destination③\">effective attribution destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination①⓪\">attribution destination</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-time\" id=\"ref-for-aggregatable-attribution-report-source-time\">source time</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-source-time\" id=\"ref-for-attribution-source-source-time②⑦\">source time</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time④\">report time</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportTime</var>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-external-id\" id=\"ref-for-attribution-report-external-id②\">external ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/uuid/#dfn-generate-a-random-uuid\" id=\"ref-for-dfn-generate-a-random-uuid②\">generating a random UUID</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id⑦\">internal ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-next-internal-id\" id=\"ref-for-get-the-next-internal-id③\">getting the next internal ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-attribution-debug-info\" id=\"ref-for-aggregatable-attribution-report-attribution-debug-info①\">attribution debug info</a>\n       </dt><dd data-md=\"\">\n        <p>(<var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-debug-key\" id=\"ref-for-attribution-source-debug-key⑥\">debug key</a>, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-key\" id=\"ref-for-attribution-trigger-debug-key④\">debug key</a>).</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-contributions\" id=\"ref-for-aggregatable-report-contributions④\">contributions</a>\n       </dt><dd data-md=\"\">\n        <p>The result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-aggregatable-contributions\" id=\"ref-for-create-aggregatable-contributions\">create aggregatable contributions</a> with <var>source</var> and <var>trigger</var>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-aggregation-coordinator\" id=\"ref-for-aggregatable-report-aggregation-coordinator①\">aggregation coordinator</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregation-coordinator\" id=\"ref-for-attribution-trigger-aggregation-coordinator①\">aggregation coordinator</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-registration-time-configuration\" id=\"ref-for-aggregatable-attribution-report-source-registration-time-configuration\">source registration time configuration</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-source-registration-time-configuration\" id=\"ref-for-attribution-trigger-aggregatable-source-registration-time-configuration③\">aggregatable source registration time configuration</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-trigger-context-id\" id=\"ref-for-aggregatable-attribution-report-trigger-context-id\">trigger context ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id⑥\">trigger context ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-filtering-id-max-bytes\" id=\"ref-for-aggregatable-attribution-report-filtering-id-max-bytes\">filtering ID max bytes</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-filtering-id-max-bytes\" id=\"ref-for-attribution-trigger-aggregatable-filtering-id-max-bytes②\">aggregatable filtering ID max bytes</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-id\" id=\"ref-for-aggregatable-attribution-report-source-id②\">source ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>source</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source-internal-id\" id=\"ref-for-attribution-source-internal-id①⓪\">internal ID</a>.</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>report</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain a null attribution report",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-a-null-attribution-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-null-attribution-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a null attribution report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger③⓪\">attribution trigger</a> <var>trigger</var> and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②⑨\">moment</a> <var>sourceTime</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>reportTime</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-attribution-report-delivery-time\" id=\"ref-for-obtain-an-aggregatable-attribution-report-delivery-time①\">obtain an aggregatable attribution report delivery time</a> with <var>trigger</var>.</p>"
        },
        {
          "html": "<p>Let <var>report</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①④\">aggregatable attribution report</a> struct whose items are:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin⑤\">reporting origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-reporting-origin\" id=\"ref-for-attribution-trigger-reporting-origin⑥\">reporting origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-effective-attribution-destination\" id=\"ref-for-aggregatable-report-effective-attribution-destination④\">effective attribution destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-attribution-destination\" id=\"ref-for-attribution-trigger-attribution-destination①①\">attribution destination</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-time\" id=\"ref-for-aggregatable-attribution-report-source-time①\">source time</a>\n       </dt><dd data-md=\"\">\n        <p><var>sourceTime</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time⑤\">report time</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportTime</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-external-id\" id=\"ref-for-attribution-report-external-id③\">external ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/uuid/#dfn-generate-a-random-uuid\" id=\"ref-for-dfn-generate-a-random-uuid③\">generating a random UUID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-internal-id\" id=\"ref-for-attribution-report-internal-id⑧\">internal ID</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#get-the-next-internal-id\" id=\"ref-for-get-the-next-internal-id④\">getting the next internal ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-attribution-debug-info\" id=\"ref-for-aggregatable-attribution-report-attribution-debug-info②\">attribution debug info</a>\n       </dt><dd data-md=\"\">\n        <p>(null, <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-debug-key\" id=\"ref-for-attribution-trigger-debug-key⑤\">debug key</a>)</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-contributions\" id=\"ref-for-aggregatable-report-contributions⑤\">contributions</a>\n       </dt><dd data-md=\"\">\n        <p>«»</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-aggregation-coordinator\" id=\"ref-for-aggregatable-report-aggregation-coordinator②\">aggregation coordinator</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregation-coordinator\" id=\"ref-for-attribution-trigger-aggregation-coordinator②\">aggregation coordinator</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-registration-time-configuration\" id=\"ref-for-aggregatable-attribution-report-source-registration-time-configuration①\">source registration time configuration</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-source-registration-time-configuration\" id=\"ref-for-attribution-trigger-aggregatable-source-registration-time-configuration④\">aggregatable source registration time configuration</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-is-null-report\" id=\"ref-for-aggregatable-attribution-report-is-null-report①\">is null report</a>\n       </dt><dd data-md=\"\">\n        <p>true</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-trigger-context-id\" id=\"ref-for-aggregatable-attribution-report-trigger-context-id①\">trigger context ID</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id⑦\">trigger context ID</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-filtering-id-max-bytes\" id=\"ref-for-aggregatable-attribution-report-filtering-id-max-bytes①\">filtering ID max bytes</a>\n       </dt><dd data-md=\"\">\n        <p><var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-filtering-id-max-bytes\" id=\"ref-for-attribution-trigger-aggregatable-filtering-id-max-bytes③\">aggregatable filtering ID max bytes</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-id\" id=\"ref-for-aggregatable-attribution-report-source-id③\">source ID</a>\n       </dt><dd data-md=\"\">\n        <p>Null</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>report</var>.</p>"
        }
      ]
    },
    {
      "name": "determine if a randomized null attribution report is generated",
      "href": "https://wicg.github.io/attribution-reporting-api/#determine-if-a-randomized-null-attribution-report-is-generated",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-if-a-randomized-null-attribution-report-is-generated\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine if a randomized null attribution report is generated</dfn> given a double <var>randomPickRate</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑧\">Assert</a>: <var>randomPickRate</var> is between 0 and 1 (both inclusive).</p>"
        },
        {
          "html": "<p>Let <var>r</var> be a random double between 0 (inclusive) and 1 (exclusive) with uniform probability.</p>"
        },
        {
          "html": "<p>If <var>r</var> is less than <var>randomPickRate</var>, return true.</p>"
        },
        {
          "html": "<p>Otherwise, return false.</p>"
        }
      ]
    },
    {
      "name": "generate null attribution reports",
      "href": "https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-null-attribution-reports\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate null attribution reports</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger③①\">attribution trigger</a> <var>trigger</var> and a possibly null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①⑤\">aggregatable attribution report</a>\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"generate null attribution reports\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-null-attribution-reports-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>report</var></dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>nullReports</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⓪\">list</a>.</p>"
        },
        {
          "html": "If <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-aggregatable-source-registration-time-configuration\" id=\"ref-for-attribution-trigger-aggregatable-source-registration-time-configuration⑤\">aggregatable source registration time configuration</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-source-registration-time-configuration-exclude\" id=\"ref-for-aggregatable-source-registration-time-configuration-exclude③\">exclude</a></code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>randomizedNullReportRate</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-null-attribution-report-rate-excluding-source-registration-time\" id=\"ref-for-randomized-null-attribution-report-rate-excluding-source-registration-time\">randomized null attribution report rate excluding source registration time</a>.</p>"
            },
            {
              "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent\" id=\"ref-for-check-if-an-aggregatable-attribution-report-should-be-unconditionally-sent②\">check if an aggregatable attribution report should be unconditionally sent</a> with <var>trigger</var>\nis true, set <var>randomizedNullReportRate</var> to 1.</p>"
            },
            {
              "html": "If <var>report</var> is null and the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#determine-if-a-randomized-null-attribution-report-is-generated\" id=\"ref-for-determine-if-a-randomized-null-attribution-report-is-generated\">determining if a randomized null attribution report is generated</a> with\n<var>randomizedNullReportRate</var> is true:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>nullReport</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-null-attribution-report\" id=\"ref-for-obtain-a-null-attribution-report\">obtaining a null attribution report</a> with <var>trigger</var> and <var>trigger</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①④\">trigger time</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③③\">Append</a> <var>nullReport</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache⑦\">aggregatable attribution report cache</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑨\">Append</a> <var>nullReport</var> to <var>nullReports</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑨\">Assert</a>: <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-context-id\" id=\"ref-for-attribution-trigger-trigger-context-id⑧\">trigger context ID</a> is null.</p>"
            },
            {
              "html": "<p>Let <var>maxSourceExpiry</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#valid-source-expiry-range\" id=\"ref-for-valid-source-expiry-range①\">valid source expiry range</a>[1].</p>"
            },
            {
              "html": "<p>Round <var>maxSourceExpiry</var> away from zero to the nearest day (86400 seconds).</p>"
            },
            {
              "html": "<p>Let <var>roundedAttributedSourceTime</var> be null.</p>"
            },
            {
              "html": "<p>If <var>report</var> is not null, set <var>roundedAttributedSourceTime</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-rounded-source-time\" id=\"ref-for-obtain-rounded-source-time\">obtaining rounded source time</a> with <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-time\" id=\"ref-for-aggregatable-attribution-report-source-time②\">source time</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑥\">For each</a> integer <var>day</var> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range②\">the range</a> 0 to the number of days in <var>maxSourceExpiry</var>, inclusive:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>fakeSourceTime</var> be <var>trigger</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger-trigger-time\" id=\"ref-for-attribution-trigger-trigger-time①⑤\">trigger time</a> − <var>day</var> days.</p>"
                },
                {
                  "html": "If <var>roundedAttributedSourceTime</var> is not null and equals the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-rounded-source-time\" id=\"ref-for-obtain-rounded-source-time①\">obtaining rounded source time</a> with <var>fakeSourceTime</var>:",
                  "rationale": "continue",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑤\">Continue</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#determine-if-a-randomized-null-attribution-report-is-generated\" id=\"ref-for-determine-if-a-randomized-null-attribution-report-is-generated①\">determining if a randomized null attribution report is generated</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#randomized-null-attribution-report-rate-including-source-registration-time\" id=\"ref-for-randomized-null-attribution-report-rate-including-source-registration-time\">randomized null attribution report rate including source registration time</a> is true:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>nullReport</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-a-null-attribution-report\" id=\"ref-for-obtain-a-null-attribution-report①\">obtaining a null attribution report</a> with <var>trigger</var> and <var>fakeSourceTime</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③④\">Append</a> <var>nullReport</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache⑧\">aggregatable attribution report cache</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⓪\">Append</a> <var>nullReport</var> to <var>nullReports</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>nullReports</var>.</p>"
        }
      ]
    },
    {
      "name": "maybe defer and then complete trigger attribution",
      "href": "https://wicg.github.io/attribution-reporting-api/#maybe-defer-and-then-complete-trigger-attribution",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"maybe-defer-and-then-complete-trigger-attribution\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">maybe defer and then complete trigger attribution</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger③②\">attribution trigger</a> <var>trigger</var>,\nrun the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation</var> be the navigation that landed on the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document①\">document</a> from which <var>trigger</var>’s registration was initiated.</p>"
        },
        {
          "html": "<p>If <var>navigation</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>sources</var> be all source registrations originating from background attributionsrc requests initiated by <var>navigation</var>.</p>"
        },
        {
          "html": "<p>If <var>sources</var> is empty, return.</p>"
        },
        {
          "html": "<p>Wait until all <var>sources</var> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-source\" id=\"ref-for-process-an-attribution-source①\">processed</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑤\">Queue a task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source①\">networking task source</a> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-attribution\" id=\"ref-for-trigger-attribution①\">trigger attribution</a> with <var>trigger</var>.</p>"
        }
      ]
    },
    {
      "name": "queue reports for delivery",
      "href": "https://wicg.github.io/attribution-reporting-api/#queue-reports-for-delivery",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"queue-reports-for-delivery\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">queue reports for delivery</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤②\">set</a> of\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report⑧\">attribution reports</a> <var>cache</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>reportsToSend</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦②\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑦\">For each</a> <var>report</var> of <var>cache</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time⑥\">report time</a> is greater than the\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time②\">current wall time</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑥\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②①\">Remove</a> <var>report</var> from <var>cache</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③①\">Append</a> <var>report</var> to <var>reportsToSend</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#shuffle-a-list\" id=\"ref-for-shuffle-a-list①\">Shuffle</a> <var>reportsToSend</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑧\">For each</a> <var>report</var> of <var>reportsToSend</var>, run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined③\">implementation-defined</a> random non-negative <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①⑤\">duration</a>.</p>"
            },
            {
              "html": "<p>Optionally, wait a further <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined④\">implementation-defined</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①⑥\">duration</a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-report\" id=\"ref-for-attempt-to-deliver-a-report\">attempt to deliver a report</a> with <var>report</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "aggregatable report/debug mode",
      "href": "https://wicg.github.io/attribution-reporting-api/#aggregatable-report-debug-mode",
      "html": "An <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report⑥\">aggregatable report</a> <var>report</var>’s <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"aggregatable report\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"aggregatable-report-debug-mode\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">debug mode</dfn> is the result\nof running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>report</var> is an:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "aggregatable attribution report",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-attribution-debugging-can-be-enabled\" id=\"ref-for-check-if-attribution-debugging-can-be-enabled③\">checking if attribution debugging can be enabled</a> with\n<var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-attribution-debug-info\" id=\"ref-for-aggregatable-attribution-report-attribution-debug-info③\">attribution debug info</a> is true,\nreturn <strong>enabled</strong>.</p>"
                    },
                    {
                      "html": "<p>Return <strong>disabled</strong>.</p>"
                    }
                  ]
                },
                {
                  "case": "aggregatable debug report",
                  "html": "<p>Return <strong>disabled</strong>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "aggregatable report, aggregatable attribution report/shared info",
      "href": "https://wicg.github.io/attribution-reporting-api/#aggregatable-report-shared-info",
      "html": "An <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report⑦\">aggregatable report</a> <var>report</var>’s <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"aggregatable report, aggregatable attribution report\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"aggregatable-report-shared-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">shared info</dfn> is the result\nof running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>reportingOrigin</var> be <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin⑥\">reporting origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>api</var> be null.</p>"
        },
        {
          "html": "If <var>report</var> is an:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "aggregatable attribution report",
                  "html": "<p>Set <var>api</var> to \"<code>attribution-reporting</code>\".</p>"
                },
                {
                  "case": "aggregatable debug report",
                  "html": "<p>Set <var>api</var> to \"<code>attribution-reporting-debug</code>\".</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>sharedInfo</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑤\">map</a> of the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>api</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>api</var></p>\n       </dd><dt data-md=\"\">\"<code>attribution_destination</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-effective-attribution-destination\" id=\"ref-for-aggregatable-report-effective-attribution-destination⑤\">effective attribution destination</a>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a></p>\n       </dd><dt data-md=\"\">\"<code>report_id</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-external-id\" id=\"ref-for-attribution-report-external-id④\">external ID</a></p>\n      </dd></dl>\n      \n      <dl>\n       <dt data-md=\"\">\"<code>reporting_origin</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>reportingOrigin</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin\">serialized</a></p>\n       </dd><dt data-md=\"\">\"<code>scheduled_report_time</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time⑧\">report time</a> in seconds since the UNIX epoch, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②⓪\">serialized</a></p>\n       </dd><dt data-md=\"\">\"<code>version</code>\"\n       </dt><dd data-md=\"\">\n        <p>\"<code>1.0</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-debug-mode\" id=\"ref-for-aggregatable-report-debug-mode\">debug mode</a> is <strong>enabled</strong>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑧\">set</a> <var>sharedInfo</var>[\"<code>debug_mode</code>\"] to \"<code>enabled</code>\".</p>"
        },
        {
          "html": "<p>If <var>report</var> is an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report①⑧\">aggregatable attribution report</a> and <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-registration-time-configuration\" id=\"ref-for-aggregatable-attribution-report-source-registration-time-configuration②\">source registration time configuration</a> is \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-source-registration-time-configuration-include\" id=\"ref-for-aggregatable-source-registration-time-configuration-include①\">include</a></code>\":\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑨\">set</a> <var>sharedInfo</var>[\"<code>source_registration_time</code>\"] to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-rounded-source-time\" id=\"ref-for-obtain-rounded-source-time②\">obtaining rounded source time</a>\nwith <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-source-time\" id=\"ref-for-aggregatable-attribution-report-source-time③\">source time</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②①\">serialized</a>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⑦\">string</a> resulting from executing <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string\">serialize an infra value to a json string</a> on <var>sharedInfo</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain the public key for encryption",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-the-public-key-for-encryption",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-the-public-key-for-encryption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain the public key for encryption</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregation-coordinator\" id=\"ref-for-aggregation-coordinator⑦\">aggregation coordinator</a> <var>aggregationCoordinator</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be a new <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL record</a>.</p>"
        },
        {
          "html": "<p>Set <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a> to <var>aggregationCoordinator</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme①\">scheme</a>.</p>"
        },
        {
          "html": "<p>Set <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host\">host</a> to <var>aggregationCoordinator</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host①\">host</a>.</p>"
        },
        {
          "html": "<p>Set <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port\">port</a> to <var>aggregationCoordinator</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port\" id=\"ref-for-concept-origin-port\">port</a>.</p>"
        },
        {
          "html": "<p>Set <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path\">path</a>  to «\"<code>.well-known</code>\", \"<code>aggregation-service</code>\", \"<code>v1</code>\", \"<code>public-keys</code>\"».</p>"
        },
        {
          "html": "<p>Return a user-agent-determined public key from <var>url</var> or an error in the event that the user\nagent failed to obtain the public key from <var>url</var>. This step may be asynchronous.</p>"
        }
      ]
    },
    {
      "name": "aggregatable report/plaintext payload",
      "href": "https://wicg.github.io/attribution-reporting-api/#aggregatable-report-plaintext-payload",
      "html": "An <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report⑧\">aggregatable report</a> <var>report</var>’s <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"aggregatable report\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"aggregatable-report-plaintext-payload\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">plaintext payload</dfn>\nis the result of running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>payloadData</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦③\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>maxContributions</var> be null.</p>"
        },
        {
          "html": "If <var>report</var> is an:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "aggregatable attribution report",
                  "html": "<p>Set <var>maxContributions</var> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-aggregation-keys-per-source-registration\" id=\"ref-for-max-aggregation-keys-per-source-registration①\">max aggregation keys per source registration</a>.</p>"
                },
                {
                  "case": "aggregatable debug report",
                  "html": "<p>Set <var>maxContributions</var> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#max-contributions-per-aggregatable-debug-report\" id=\"ref-for-max-contributions-per-aggregatable-debug-report\">max contributions per aggregatable debug report</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>contributions</var> be <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-contributions\" id=\"ref-for-aggregatable-report-contributions⑥\">contributions</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⓪\">Assert</a>: <var>contributions</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size③⓪\">size</a> is less than or equal to <var>maxContributions</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-while\" id=\"ref-for-iteration-while\">While</a> <var>contributions</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size③①\">size</a> is less than <var>maxContributions</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>nullContribution</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution\" id=\"ref-for-aggregatable-contribution①①\">aggregatable contribution</a> with the\nitems:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key⑥\">key</a>\n         </dt><dd data-md=\"\">\n          <p>0</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value⑧\">value</a>\n         </dt><dd data-md=\"\">\n          <p>0</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-filtering-id\" id=\"ref-for-aggregatable-contribution-filtering-id④\">filtering ID</a>\n         </dt><dd data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#default-filtering-id-value\" id=\"ref-for-default-filtering-id-value⑤\">default filtering ID value</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③②\">Append</a> <var>nullContribution</var> to <var>contributions</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑨\">For each</a> <var>contribution</var> of <var>contributions</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>contributionData</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑥\">map</a> of the following key/value pairs:</p>\n        <dl>\n         <dt data-md=\"\">\"<code>bucket</code>\"\n         </dt><dd data-md=\"\">\n          <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#encode-an-unsigned-k-byte-integer\" id=\"ref-for-encode-an-unsigned-k-byte-integer\">encoding an unsigned k-byte integer</a> given\n<var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-key\" id=\"ref-for-aggregatable-contribution-key⑦\">key</a> and 16.</p>\n         </dd><dt data-md=\"\">\"<code>value</code>\"\n         </dt><dd data-md=\"\">\n          <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#encode-an-unsigned-k-byte-integer\" id=\"ref-for-encode-an-unsigned-k-byte-integer①\">encoding an unsigned k-byte integer</a> given\n<var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-value\" id=\"ref-for-aggregatable-contribution-value⑨\">value</a> and 4.</p>\n         </dd><dt data-md=\"\">\"<code>id</code>\"\n         </dt><dd data-md=\"\">\n          <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#encode-an-unsigned-k-byte-integer\" id=\"ref-for-encode-an-unsigned-k-byte-integer②\">encoding an unsigned k-byte integer</a> given\n<var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-contribution-filtering-id\" id=\"ref-for-aggregatable-contribution-filtering-id⑤\">filtering ID</a> and\n<var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-filtering-id-max-bytes\" id=\"ref-for-aggregatable-attribution-report-filtering-id-max-bytes②\">filtering ID max bytes</a>.</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③③\">Append</a> <var>contributionData</var> to <var>payloadData</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>payload</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑦\">map</a> of the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>data</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>payloadData</var></p>\n       </dd><dt data-md=\"\">\"<code>operation</code>\"\n       </dt><dd data-md=\"\">\n        <p>\"<code>histogram</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence③\">byte sequence</a> resulting from <a data-link-type=\"biblio\" href=\"https://wicg.github.io/attribution-reporting-api/#biblio-rfc8949\" title=\"Concise Binary Object Representation (CBOR)\">CBOR encoding</a> <var>payload</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain the encrypted payload",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-the-encrypted-payload",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-the-encrypted-payload\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain the encrypted payload</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report⑨\">aggregatable report</a> <var>report</var> and\na public key <var>pkR</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>plaintext</var> be <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-plaintext-payload\" id=\"ref-for-aggregatable-report-plaintext-payload\">plaintext payload</a>.</p>"
        },
        {
          "html": "<p>Let <var>encodedSharedInfo</var> be <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-shared-info\" id=\"ref-for-aggregatable-report-shared-info②\">shared info</a>, <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode\">encoded</a>.</p>"
        },
        {
          "html": "<p>Let <var>info</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①\">concatenation</a> of «\"<code>aggregation_service</code>\", <var>encodedSharedInfo</var>».</p>"
        },
        {
          "html": "<p>Set up <a data-link-type=\"biblio\" href=\"https://wicg.github.io/attribution-reporting-api/#biblio-rfc9180\" title=\"Hybrid Public Key Encryption\">HPKE</a> <a href=\"https://www.rfc-editor.org/rfc/rfc9180#name-encryption-to-a-public-key\">sender’s context</a>\nwith <var>pkR</var> and <var>info</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence④\">byte sequence</a> or an error resulting from <a href=\"https://www.rfc-editor.org/rfc/rfc9180#name-encryption-and-decryption\">encrypting</a>\n<var>plaintext</var> with the <a href=\"https://www.rfc-editor.org/rfc/rfc9180#name-encryption-to-a-public-key\">sender’s context</a>.</p>"
        }
      ]
    },
    {
      "name": "obtain the aggregation service payloads",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-the-aggregation-service-payloads",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-the-aggregation-service-payloads\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain the aggregation service payloads</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report①⓪\">aggregatable report</a> <var>report</var>,\nrun the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>pkR</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-the-public-key-for-encryption\" id=\"ref-for-obtain-the-public-key-for-encryption\">obtain the public key for encryption</a>\nwith <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-aggregation-coordinator\" id=\"ref-for-aggregatable-report-aggregation-coordinator③\">aggregation coordinator</a>.</p>"
        },
        {
          "html": "<p>If <var>pkR</var> is an error, return <var>pkR</var>.</p>"
        },
        {
          "html": "<p>Let <var>encryptedPayload</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-the-encrypted-payload\" id=\"ref-for-obtain-the-encrypted-payload\">obtain the encrypted payload</a> with <var>report</var> and <var>pkR</var>.</p>"
        },
        {
          "html": "<p>If <var>encryptedPayload</var> is an error, return <var>encryptedPayload</var>.</p>"
        },
        {
          "html": "<p>Let <var>aggregationServicePayloads</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦④\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>aggregationServicePayload</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑧\">map</a> of the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>payload</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>encryptedPayload</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-encode\" id=\"ref-for-forgiving-base64-encode\">base64 encoded</a></p>\n       </dd><dt data-md=\"\">\"<code>key_id</code>\"\n       </dt><dd data-md=\"\">\n        <p>A <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⑧\">string</a> identifying <var>pkR</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-debug-mode\" id=\"ref-for-aggregatable-report-debug-mode①\">debug mode</a> is <strong>enabled</strong>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⓪\">set</a> <var>aggregationServicePayload</var>[\"<code>debug_cleartext_payload</code>\"] to <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-plaintext-payload\" id=\"ref-for-aggregatable-report-plaintext-payload①\">plaintext payload</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-encode\" id=\"ref-for-forgiving-base64-encode①\">base64 encoded</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③④\">Append</a> <var>aggregationServicePayload</var> to <var>aggregationServicePayloads</var>.</p>"
        },
        {
          "html": "<p>Return <var>aggregationServicePayloads</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain an event-level report body",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-event-level-report-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain an event-level report body</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report⑨\">attribution report</a> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑨\">map</a> of the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>attribution_destination</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-destinations\" id=\"ref-for-event-level-report-attribution-destinations④\">attribution destinations</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-attribution-destinations\" id=\"ref-for-serialize-attribution-destinations①\">serialized</a>.</p>\n       </dd><dt data-md=\"\">\"<code>randomized_trigger_rate</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-randomized-trigger-rate\" id=\"ref-for-event-level-report-randomized-trigger-rate①\">randomized trigger rate</a>, rounded to 7 digits after the decimal point</p>\n       </dd><dt data-md=\"\">\"<code>source_type</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-source-type\" id=\"ref-for-event-level-report-source-type\">source type</a></p>\n       </dd><dt data-md=\"\">\"<code>source_event_id</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-event-id\" id=\"ref-for-event-level-report-event-id②\">event ID</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②②\">serialized</a></p>\n       </dd><dt data-md=\"\">\"<code>trigger_data</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-data\" id=\"ref-for-event-level-report-trigger-data①\">trigger data</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②③\">serialized</a></p>\n       </dd><dt data-md=\"\">\"<code>report_id</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-external-id\" id=\"ref-for-attribution-report-external-id⑤\">external ID</a></p>\n      </dd></dl>\n      \n      <dl>\n       <dt data-md=\"\">\"<code>scheduled_report_time</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-report-time\" id=\"ref-for-attribution-report-report-time⑨\">report time</a> in seconds since the UNIX epoch, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②④\">serialized</a></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-attribution-debug-info\" id=\"ref-for-serialize-an-attribution-debug-info\">serialize an attribution debug info</a> with <var>data</var> and <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-attribution-debug-info\" id=\"ref-for-event-level-report-attribution-debug-info②\">attribution debug info</a>.</p>"
        },
        {
          "html": "<p>Return <var>data</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize an event-level report",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-an-event-level-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-an-event-level-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①⑧\">event-level report</a></dfn> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-event-level-report-body\" id=\"ref-for-obtain-an-event-level-report-body①\">obtain an event-level report body</a> with <var>report</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑤\">byte sequence</a> resulting from executing <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes\">serialize an infra value to JSON bytes</a> on <var>data</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain an aggregatable report body",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-report-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-an-aggregatable-report-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report①①\">aggregatable report</a> body</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report\" id=\"ref-for-aggregatable-report①②\">aggregatable report</a> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③①\">Assert</a>: <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-effective-attribution-destination\" id=\"ref-for-aggregatable-report-effective-attribution-destination⑥\">effective attribution destination</a> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque③\">opaque origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>aggregationServicePayloads</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-the-aggregation-service-payloads\" id=\"ref-for-obtain-the-aggregation-service-payloads\">obtain the aggregation service payloads</a>.</p>"
        },
        {
          "html": "<p>If <var>aggregationServicePayloads</var> is an error, return <var>aggregationServicePayloads</var>.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⓪\">map</a> of the following key/value pairs:</p>\n      <dl>\n       <dt data-md=\"\">\"<code>shared_info</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-shared-info\" id=\"ref-for-aggregatable-report-shared-info③\">shared info</a></p>\n       </dd><dt data-md=\"\">\"<code>aggregation_service_payloads</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>aggregationServicePayloads</var></p>\n       </dd><dt data-md=\"\">\"<code>aggregation_coordinator_origin</code>\"\n       </dt><dd data-md=\"\">\n        <p><var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-aggregation-coordinator\" id=\"ref-for-aggregatable-report-aggregation-coordinator④\">aggregation coordinator</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin①\">serialized</a></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>data</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize an aggregatable attribution report",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-an-aggregatable-attribution-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"serialize an aggregatable attribution report\" data-noexport=\"\" id=\"serialize-an-aggregatable-attribution-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report②⓪\">aggregatable attribution report</a> </dfn> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-report-body\" id=\"ref-for-obtain-an-aggregatable-report-body\">obtain an aggregatable report body</a> with <var>report</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-attribution-debug-info\" id=\"ref-for-serialize-an-attribution-debug-info①\">serialize an attribution debug info</a> with <var>data</var> and <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-attribution-debug-info\" id=\"ref-for-aggregatable-attribution-report-attribution-debug-info④\">attribution debug info</a>.</p>"
        },
        {
          "html": "<p>If <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-trigger-context-id\" id=\"ref-for-aggregatable-attribution-report-trigger-context-id②\">trigger context ID</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④①\">set</a>\n<var>data</var>[\"<code>trigger_context_id</code>\"] to <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-trigger-context-id\" id=\"ref-for-aggregatable-attribution-report-trigger-context-id③\">trigger context ID</a>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑥\">byte sequence</a> resulting from executing <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes①\">serialize an infra value to JSON bytes</a> on <var>data</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize an aggregatable debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-an-aggregatable-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"serialize an aggregatable debug report\" data-noexport=\"\" id=\"serialize-an-aggregatable-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-report\" id=\"ref-for-aggregatable-debug-report①⓪\">aggregatable debug report</a> </dfn> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-an-aggregatable-report-body\" id=\"ref-for-obtain-an-aggregatable-report-body①\">obtain an aggregatable report body</a> with <var>report</var>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑦\">byte sequence</a> resulting from executing <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes②\">serialize an infra value to JSON bytes</a> on <var>data</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize an attribution report",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-an-attribution-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-an-attribution-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report①⓪\">attribution report</a></dfn> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③②\">Assert</a>: <var>report</var> is an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report①⑨\">event-level report</a> or an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report②①\">aggregatable attribution report</a>.</p>"
        },
        {
          "html": "If <var>report</var> is an:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "event-level report",
                  "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-event-level-report\" id=\"ref-for-serialize-an-event-level-report\">serialize an event-level report</a> with <var>report</var>.</p>"
                },
                {
                  "case": "aggregatable attribution report",
                  "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-aggregatable-attribution-report\" id=\"ref-for-serialize-an-aggregatable-attribution-report\">serialize an aggregatable attribution report</a> with <var>report</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "serialize a verbose debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#serialize-a-verbose-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-a-verbose-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report\" id=\"ref-for-verbose-debug-report③\">verbose debug report</a></dfn> <var>report</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>collection</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑤\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⓪\">For each</a> <var>debugData</var> of <var>report</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report-data\" id=\"ref-for-verbose-debug-report-data①\">data</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>data</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦①\">map</a> of the following key/value pairs:</p>\n        <dl>\n         <dt data-md=\"\">\"<code>type</code>\"\n         </dt><dd data-md=\"\">\n          <p><var>debugData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-data-type\" id=\"ref-for-verbose-debug-data-data-type④\">data type</a></p>\n         </dd><dt data-md=\"\">\"<code>body</code>\"\n         </dt><dd data-md=\"\">\n          <p><var>debugData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-body\" id=\"ref-for-verbose-debug-data-body③\">body</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑤\">Append</a> <var>data</var> to <var>collection</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑧\">byte sequence</a> resulting from executing <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes③\">serialize an Infra value to JSON bytes</a> on <var>collection</var>.</p>"
        }
      ]
    },
    {
      "name": "generate a report URL",
      "href": "https://wicg.github.io/attribution-reporting-api/#generate-a-report-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-a-report-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate a report URL</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#suitable-origin\" id=\"ref-for-suitable-origin②①\">suitable origin</a> <var>reportingOrigin</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑥\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⑨\">strings</a> <var>path</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>reportUrl</var> be a new <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org#concept-url\" id=\"ref-for-concept-url⑧\">URL</a> record.</p>"
        },
        {
          "html": "<p>Set <var>reportUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a> to <var>reportingOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme②\">scheme</a>.</p>"
        },
        {
          "html": "<p>Set <var>reportUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host①\">host</a> to <var>reportingOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host②\">host</a>.</p>"
        },
        {
          "html": "<p>Set <var>reportUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port①\">port</a> to <var>reportingOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port\" id=\"ref-for-concept-origin-port①\">port</a>.</p>"
        },
        {
          "html": "<p>Let <var>fullPath</var> be «\"<code>.well-known</code>\", \"<code>attribution-reporting</code>\"».</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑥\">Append</a> <var>path</var> to <var>fullPath</var>.</p>"
        },
        {
          "html": "<p>Set <var>reportUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path①\">path</a> to <var>fullPath</var>.</p>"
        },
        {
          "html": "<p>Return <var>reportUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "generate an attribution report URL",
      "href": "https://wicg.github.io/attribution-reporting-api/#generate-an-attribution-report-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-an-attribution-report-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate an attribution report URL</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report①①\">attribution report</a> <var>report</var> and an optional\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②⑨\">boolean</a> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"generate an attribution report URL\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-an-attribution-report-url-isdebugreport\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>isDebugReport</var></dfn> (default false):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③③\">Assert</a>: <var>report</var> is an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report\" id=\"ref-for-event-level-report②①\">event-level report</a> or an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report②③\">aggregatable attribution report</a>.</p>"
        },
        {
          "html": "<p>Let <var>path</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑦\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>isDebugReport</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑦\">append</a> \"<code>debug</code>\" to <var>path</var>.</p>"
        },
        {
          "html": "If <var>report</var> is an:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "event-level report",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑧\">Append</a> \"<code>report-event-attribution</code>\" to <var>path</var>.</p>"
                },
                {
                  "case": "aggregatable attribution report",
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑨\">Append</a> \"<code>report-aggregate-attribution</code>\" to <var>path</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-a-report-url\" id=\"ref-for-generate-a-report-url\">generate a report URL</a> with <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin⑦\">reporting origin</a> and <var>path</var>.</p>"
        }
      ]
    },
    {
      "name": "generate a verbose debug report URL",
      "href": "https://wicg.github.io/attribution-reporting-api/#generate-a-verbose-debug-report-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-a-verbose-debug-report-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate a verbose debug report URL</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report\" id=\"ref-for-verbose-debug-report④\">verbose debug report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>path</var> be «\"<code>debug</code>\", \"<code>verbose</code>\"».</p>"
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-a-report-url\" id=\"ref-for-generate-a-report-url①\">generate a report URL</a> with <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report-reporting-origin\" id=\"ref-for-verbose-debug-report-reporting-origin①\">reporting origin</a> and <var>path</var>.</p>"
        }
      ]
    },
    {
      "name": "generate an aggregatable debug report URL",
      "href": "https://wicg.github.io/attribution-reporting-api/#generate-an-aggregatable-debug-report-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-an-aggregatable-debug-report-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate an aggregatable debug report URL</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-report\" id=\"ref-for-aggregatable-debug-report①①\">aggregatable debug report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>path</var> be «\"<code>debug</code>\", \"<code>report-aggregate-debug</code>\"».</p>"
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-a-report-url\" id=\"ref-for-generate-a-report-url②\">generate a report URL</a> with <var>report</var>’s\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report-reporting-origin\" id=\"ref-for-attribution-report-reporting-origin⑧\">reporting origin</a> and <var>path</var>.</p>"
        }
      ]
    },
    {
      "name": "create a report request",
      "href": "https://wicg.github.io/attribution-reporting-api/#create-a-report-request",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-report-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a report request</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org#concept-url\" id=\"ref-for-concept-url⑨\">URL</a> <var>url</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑨\">byte sequence</a> <var>body</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>headers</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①\">header list</a> containing a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header\">header</a> named\n\"<code>Content-Type</code>\" whose value is \"<code>application/json</code>\".</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-request\" id=\"ref-for-concept-request⑦\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①\">method</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>POST</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">header list</a>\n       </dt><dd data-md=\"\">\n        <p><var>headers</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body\">body</a>\n       </dt><dd data-md=\"\">\n        <p>A <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body\">body</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source\">source</a> is <var>body</var>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑥\">origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>none</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator\">initiator</a>\n       </dt><dd data-md=\"\">\n        <p>\"\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>same-origin</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#unsafe-request-flag\" id=\"ref-for-unsafe-request-flag\">unsafe-request flag</a>\n       </dt><dd data-md=\"\">\n        <p>set</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode\">cache mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-store</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "attempt to deliver a report",
      "href": "https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attempt-to-deliver-a-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attempt to deliver a report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report①②\">attribution report</a> <var>report</var>, run the following steps:\n\n\n    \n    \n    <p>A user agent may retry this algorithm in the event that there was an error.\nTo prevent the report recipient from learning additional information about\nwhether a user is online, retries might be limited in number and subject to random delays.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③④\">Assert</a>: Neither the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache①③\">event-level report cache</a> nor the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache①⓪\">aggregatable attribution report cache</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②⓪\">contains</a> <var>report</var>.</p>"
        },
        {
          "html": "<p>The user-agent may ignore the report; if so, return.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-an-attribution-report-url\" id=\"ref-for-generate-an-attribution-report-url\">generate an attribution report URL</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-attribution-report\" id=\"ref-for-serialize-an-attribution-report\">serialize an attribution report</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>If <var>data</var> is an error, return.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-a-report-request\" id=\"ref-for-create-a-report-request\">create a report request</a> on <var>url</var> and <var>data</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task⑥\">Queue a task</a> to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-fetch\" id=\"ref-for-concept-fetch④\">fetch</a> <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "attempt to deliver a debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attempt-to-deliver-a-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attempt to deliver a debug report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-report\" id=\"ref-for-attribution-report①③\">attribution report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The user-agent may ignore the report; if so, return.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-an-attribution-report-url\" id=\"ref-for-generate-an-attribution-report-url①\">generate an attribution report URL</a> on <var>report</var> with\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-an-attribution-report-url-isdebugreport\" id=\"ref-for-generate-an-attribution-report-url-isdebugreport\">isDebugReport</a> set to true.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-attribution-report\" id=\"ref-for-serialize-an-attribution-report①\">serialize an attribution report</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>If <var>data</var> is an error, return.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-a-report-request\" id=\"ref-for-create-a-report-request①\">create a report request</a> on <var>url</var> and <var>data</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-fetch\" id=\"ref-for-concept-fetch⑤\">Fetch</a> <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "attempt to deliver a verbose debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-verbose-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attempt-to-deliver-a-verbose-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attempt to deliver a verbose debug report</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-report\" id=\"ref-for-verbose-debug-report⑤\">verbose debug report</a> <var>report</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The user-agent may ignore the report; if so, return.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-a-verbose-debug-report-url\" id=\"ref-for-generate-a-verbose-debug-report-url\">generate a verbose debug report URL</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-a-verbose-debug-report\" id=\"ref-for-serialize-a-verbose-debug-report\">serialize a verbose debug report</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-a-report-request\" id=\"ref-for-create-a-report-request②\">create a report request</a> on <var>url</var> and <var>data</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-fetch\" id=\"ref-for-concept-fetch⑥\">Fetch</a> <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "attempt to deliver an aggregatable debug report",
      "href": "https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-an-aggregatable-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attempt-to-deliver-an-aggregatable-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attempt to deliver an aggregatable debug report</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-debug-report\" id=\"ref-for-aggregatable-debug-report①②\">aggregatable debug report</a> <var>report</var>:\n\n\n    \n    \n    <p>A user agent may retry this algorithm in the event that there was an error.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The user-agent may ignore the report; if so, return.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-an-aggregatable-debug-report-url\" id=\"ref-for-generate-an-aggregatable-debug-report-url\">generate an aggregatable debug report URL</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#serialize-an-aggregatable-debug-report\" id=\"ref-for-serialize-an-aggregatable-debug-report\">serialize an aggregatable debug report</a> on <var>report</var>.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#create-a-report-request\" id=\"ref-for-create-a-report-request③\">create a report request</a> on <var>url</var> and <var>data</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org#concept-fetch\" id=\"ref-for-concept-fetch⑦\">Fetch</a> <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "get OS registrations from a header value",
      "href": "https://wicg.github.io/attribution-reporting-api/#get-os-registrations-from-a-header-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-os-registrations-from-a-header-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration\" id=\"ref-for-os-registration\">OS registrations</a> from a header value</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value⑦\">header value</a> <var>header</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>values</var> be the result of <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc8941#text-parse\" id=\"ref-for-text-parse\">parsing structured fields</a>\nwith <var>input_bytes</var> set to <var>header</var> and\n<var>field_type</var> set to \"<code>list</code>\".</p>"
        },
        {
          "html": "<p>If parsing failed, return an error.</p>"
        },
        {
          "html": "<p>Let <var>registrations</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑧\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦①\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤⓪\">string</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser②\">URL parser</a> on <var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>url</var> is failure or null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑧\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>debugReporting</var> be false.</p>"
            },
            {
              "html": "<p>Let <var>params</var> be the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc8941#param\" id=\"ref-for-param\">parameters</a> associated with <var>value</var>.</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"<code>debug-reporting</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑧\">exists</a> and <var>params</var>[\"<code>debug-reporting</code>\"] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③①\">boolean</a>,\n set <var>debugReporting</var> to <var>params</var>[\"<code>debug-reporting</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>registration</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration\" id=\"ref-for-os-registration①\">OS registration</a> struct whose items are:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration-url\" id=\"ref-for-os-registration-url\">URL</a>\n         </dt><dd data-md=\"\">\n          <p><var>url</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration-debug-reporting-enabled\" id=\"ref-for-os-registration-debug-reporting-enabled\">debug reporting enabled</a>\n         </dt><dd data-md=\"\">\n          <p><var>debugReporting</var></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⓪\">Append</a> <var>registration</var> to <var>registrations</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>registrations</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③①\">is empty</a>, return an error.</p>"
        },
        {
          "html": "<p>Return <var>registrations</var>.</p>"
        }
      ]
    },
    {
      "name": "get supported registrars",
      "href": "https://wicg.github.io/attribution-reporting-api/#get-supported-registrars",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-supported-registrars\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get supported registrars</dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>supportedRegistrars</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑨\">list</a>.</p>"
        },
        {
          "html": "<p>If the user agent supports web registrations, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④①\">append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-web\" id=\"ref-for-registrar-web⑥\">web</a></code>\"\nto <var>supportedRegistrars</var>.</p>"
        },
        {
          "html": "<p>If the user agent supports OS registrations, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④②\">append</a> \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#registrar-os\" id=\"ref-for-registrar-os⑥\">os</a></code>\"\nto <var>supportedRegistrars</var>.</p>"
        },
        {
          "html": "<p>Return <var>supportedRegistrars</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain and deliver debug reports on OS registrations",
      "href": "https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-debug-reports-on-os-registrations",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-and-deliver-debug-reports-on-os-registrations\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain and deliver debug reports on OS registrations</dfn> given an\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-debug-data-type\" id=\"ref-for-os-debug-data-type\">OS debug data type</a> <var>dataType</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration\" id=\"ref-for-os-registration②\">OS registrations</a> <var>registrations</var>,\nan <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥\">origin</a> <var>contextOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③②\">boolean</a> <var>fenced</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⑤\">Assert</a>: <var>registrations</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③②\">empty</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextSite</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site⑥\">obtaining a site</a> from <var>contextOrigin</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦②\">For each</a> <var>registration</var> of <var>registrations</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>registration</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration-debug-reporting-enabled\" id=\"ref-for-os-registration-debug-reporting-enabled①\">debug reporting enabled</a> is false, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑨\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>origin</var> be <var>registration</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration-url\" id=\"ref-for-os-registration-url①\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑦\">origin</a>.</p>"
            },
            {
              "html": "<p>If <var>origin</var> is not <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable\" id=\"ref-for-check-if-an-origin-is-suitable⑤\">suitable</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③⓪\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦②\">map</a> with the following key/value pairs:</p>\n        <dl>\n         <dt data-md=\"\">\"<code>context_site</code>\"\n         </dt><dd data-md=\"\">\n          <p><var>contextSite</var>, <a href=\"https://html.spec.whatwg.org/multipage/origin.html#serialization-of-a-site\">serialized</a>.</p>\n         </dd><dt data-md=\"\">\"<code>registration_url</code>\"\n         </dt><dd data-md=\"\">\n          <p><var>registration</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#os-registration-url\" id=\"ref-for-os-registration-url②\">URL</a>, <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer\">serialized</a>.</p>\n        </dd></dl>"
            },
            {
              "html": "<p>Let <var>data</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data\" id=\"ref-for-verbose-debug-data⑥\">verbose debug data</a> with the items:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-data-type\" id=\"ref-for-verbose-debug-data-data-type⑤\">data type</a>\n         </dt><dd data-md=\"\">\n          <p><var>dataType</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#verbose-debug-data-body\" id=\"ref-for-verbose-debug-data-body④\">body</a>\n         </dt><dd data-md=\"\">\n          <p><var>body</var></p>\n        </dd></dl>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-and-deliver-a-verbose-debug-report\" id=\"ref-for-obtain-and-deliver-a-verbose-debug-report③\">obtain and deliver a verbose debug report</a> with « <var>data</var> », <var>origin</var>, and <var>fenced</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON-formatted <a href=\"https://tc39.es/ecma262/multipage/overview.html#sec-objects\">Object</a>,\nreturn a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>enabled</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-getting-properties\" id=\"ref-for-dfn-getting-properties\">getting a property</a> named <code>\"enabled\"</code> from\n<var>parameters</var>.</p>"
        },
        {
          "html": "<p>If <var>enabled</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①\">undefined</a></code> or is not a boolean, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①\">WebDriver error</a>\nwith <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#automation-local-testing-mode\" id=\"ref-for-automation-local-testing-mode⑤\">automation local testing mode</a> to <var>enabled</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①\">remote end steps</a> are:",
      "rationale": "for",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦③\">For each</a> <var>cache</var> of « <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-cache\" id=\"ref-for-event-level-report-cache①④\">event-level report cache</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report-cache\" id=\"ref-for-aggregatable-attribution-report-cache①①\">aggregatable attribution report cache</a> »:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦④\">For each</a> <var>report</var> of <var>cache</var>:",
              "rationale": "remove",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②②\">Remove</a> <var>report</var> from <var>cache</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attempt-to-deliver-a-report\" id=\"ref-for-attempt-to-deliver-a-report①\">Attempt to deliver</a> <var>report</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "Aggregatable attribution reports protect against cross-site information disclosure in two primary ways:",
      "rationale": "for",
      "steps": [
        {
          "html": "<p>For a given <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger③③\">attribution trigger</a>, whether it is <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#trigger-attribution\" id=\"ref-for-trigger-attribution③\">attributed</a> to a\nsource is subject to one-way noise via <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#generate-null-attribution-reports\" id=\"ref-for-generate-null-attribution-reports④\">generating null attribution reports</a> with\nsome probability. Note that because the noise does not drop true reports, this is only a partial\nmitigation, as if an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source①⓪④\">attribution source</a> never generates an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report②⑤\">aggregatable attribution report</a>, an\nadversary can learn with 100% certainty that an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-source\" id=\"ref-for-attribution-source①⓪⑤\">attribution source</a> was never matched with\nan <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#attribution-trigger\" id=\"ref-for-attribution-trigger③④\">attribution trigger</a>.</p>"
        },
        {
          "html": "<p>Cross-site information embedded in an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-attribution-report\" id=\"ref-for-aggregatable-attribution-report②⑥\">aggregatable attribution report</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#aggregatable-report-contributions\" id=\"ref-for-aggregatable-report-contributions⑦\">contributions</a>\nis encrypted with a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#obtain-the-public-key-for-encryption\" id=\"ref-for-obtain-the-public-key-for-encryption①\">public key</a>, ensuring that individual\ncontributions cannot be accessed until an aggregation service subjects them to aggregation\nand an additive noise process.</p>"
        }
      ]
    },
    {
      "html": "Possible mitigations:",
      "rationale": "send",
      "steps": [
        {
          "html": "<p>Only send reports with a given reporting origin when the browser has already\nmade a request to that origin on the same network. This prevents the network\nadministrator from gaining additional information from the Attribution\nReporting API. However, it increases report loss and report delays, which\nreduces the utility of the API for the reporting origin. It might also\nincrease the effectiveness of timing attacks, as the origin may be able to\nbetter link the report with the user’s request that allowed the report to be released.</p>"
        },
        {
          "html": "<p>Send reports immediately: This reduces the likelihood of a report being\nstored and sent on different networks. However, it increases the likelihood\nthat the reporting origin can correlate the original request made to the\nreporting origin for attribution to the report, which weakens the\nattribution-side privacy controls of the API. In particular,\nthis destroys the differential privacy framework we have\nfor event-level reports. It would also make the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-priority\" id=\"ref-for-event-level-report-trigger-priority⑤\">trigger priority</a> functionality impossible, as there\nwould be no way to replace a lower-priority report that was already sent.</p>"
        },
        {
          "html": "<p>Use a trusted proxy server to send reports: This effectively moves the\nreporting origin into the report body, so only the proxy server would be\nvisible to the network administrator.</p>"
        },
        {
          "html": "<p>Require <a href=\"https://datatracker.ietf.org/doc/html/rfc8484\">DNS over HTTPS</a>:\nThis effectively hides the reporting origin from the network administrator, but is\nlikely impractical to enforce and is itself perhaps circumventable by the network\nadministrator.</p>"
        }
      ]
    },
    {
      "html": "Possible mitigations:",
      "rationale": "send",
      "steps": [
        {
          "html": "<p>Send reports immediately: This effectively eliminates the presence tracking,\nas the original request made to the reporting origin is in close temporal\nproximity to the report request. However, it increases the likelihood that\nthe reporting origin can correlate the two requests, which weakens the\nattribution-side privacy controls of the API. It would also make the\n<a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-priority\" id=\"ref-for-event-level-report-trigger-priority⑥\">trigger priority</a> functionality impossible, as there\nwould be no way to replace a lower-priority report that was already sent.</p>"
        },
        {
          "html": "<p>Send reports immediately to a trusted proxy server, which would itself send\nthe report to the reporting origin with additional delay. This would\neffectively hide both the user’s IP address and their online-offline\npresence from the reporting origin. Compared to the previous mitigation, the\nproxy server could itself handle the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#event-level-report-trigger-priority\" id=\"ref-for-event-level-report-trigger-priority⑦\">trigger priority</a>\nfunctionality, at the cost of increased complexity in the proxy.</p>"
        }
      ]
    }
  ]
}