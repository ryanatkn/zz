{
  "spec": {
    "title": "JSON-LD 1.1 Processing Algorithms and API",
    "url": "https://www.w3.org/TR/json-ld11-api/"
  },
  "algorithms": [
    {
      "name": "4.1.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x4-1-2-algorithm",
      "html": "This algorithm specifies how a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a> is updated\n        with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>. The algorithm takes three required\n        <span class=\"changed\">and four optional</span>\n        input variables.\n        The required inputs are\n        an <var>active context</var>,\n        a <var>local context</var>,\n        <span class=\"changed\">and a <var>base URL</var> used when resolving relative context URLs</span>.\n        The optional inputs are\n        an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>remote contexts</var>,\n        defaulting to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, which is used to detect cyclical context inclusions,\n        <span class=\"changed\">\n          <var>override protected</var>, defaulting to <code>false</code>,\n          which is used to allow changes to protected terms,\n          <var>propagate</var>, defaulting to <code>true</code>\n          to mark <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definitions</a> associated with non-propagated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-context\">contexts</a>,\n          and <var>validate scoped context</var> defaulting to <code>true</code>,\n          which is used to limit recursion when validating possibly recursive <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-scoped-context\">scoped contexts</a>.</span>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>result</var> to the result of cloning\n          <var>active context</var>,\n          <span class=\"changed\">with <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> set to <code>null</code>.</span>."
        },
        {
          "html": "If <var>local context</var> is an object containing the member <code>@propagate</code>,\n          its value <em class=\"rfc2119\" title=\"MUST\">MUST</em> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\">boolean</a> <code>true</code> or <code>false</code>,\n          set <var>propagate</var> to that value."
        },
        {
          "html": "If <var>propagate</var> is <code>false</code>, and <var>result</var>\n          does not have a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a>, set <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a>\n          in <var>result</var> to <var>active context</var>."
        },
        {
          "html": "If <var>local context</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n          set <var>local context</var> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only\n          <var>local context</var>."
        },
        {
          "html": "For each item <var>context</var> in <var>local context</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>context</var> is <code>null</code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>override protected</var> is <code>false</code> and <var>active context</var>\n                  contains any <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-protected\" class=\"internalDFN\" data-link-type=\"dfn\">protected</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definitions</a>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-context-nullification\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid context nullification</code></a>\n                  has been detected and processing is aborted."
                },
                {
                  "html": "Initialize <var>result</var> as a\n                  newly-initialized <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a>,\n                  <span class=\"changed\">\n                    setting both <a data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" class=\"internalDFN\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> and <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-original-base-url\" class=\"internalDFN\" data-link-type=\"dfn\">original base URL</a> to the value of\n                    <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-original-base-url\" class=\"internalDFN\" data-link-type=\"dfn\">original base URL</a> in <var>active context</var></span>,\n                    and, if <var>propagate</var> is <code>false</code>,\n                    <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a> in <var>result</var>\n                    to the previous value of <var>result</var>."
                },
                {
                  "html": "Continue with the next <var>context</var>."
                }
              ]
            },
            {
              "html": "If <var>context</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>context</var> to the result of resolving <var>context</var> against\n                  <var>base URL</var>. If <var>base URL</var> is not a valid <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>,\n                  then <var>context</var> <em class=\"rfc2119\" title=\"MUST\">MUST</em> be a valid <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, otherwise\n                  a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-document-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading document failed</code></a> error\n                  has been detected and processing is aborted."
                },
                {
                  "html": "If <var>validate scoped context</var> is <code>false</code>,\n                  and <var>remote contexts</var> already includes <var>context</var>\n                  do not process <var>context</var> further and continue to any next\n                  <var>context</var> in <var>local context</var>."
                },
                {
                  "html": "If the number of entries in the <var>remote contexts</var> array\n                  exceeds a processor defined limit, a\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-context-overflow\" class=\"internalDFN\" data-link-type=\"idl\"><code>context overflow</code></a>\n                  error has been detected and processing is aborted;\n                  otherwise, add <var>context</var> to <var>remote contexts</var>."
                },
                {
                  "html": "If <var>context</var> was previously dereferenced,\n                  then the processor <em class=\"rfc2119\" title=\"MUST NOT\">MUST NOT</em> do a further dereference, and\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-context\">context</a> is set to the\n                  previously established <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a>:\n                  set <var>context document</var> to the previously dereferenced document,\n                  and set <var>loaded context</var> to the value of the <code>@context</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from the document in <var>context document</var>."
                },
                {
                  "html": "Otherwise, set <var>context document</var>\n                  to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>RemoteDocument</code></code></a> obtained\n                  by dereferencing <var>context</var> using\n                  the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentcallback\" class=\"internalDFN\" data-link-type=\"idl\"><code>LoadDocumentCallback</code></a>, passing <var>context</var>\n                  for <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>,\n                  and <code>http://www.w3.org/ns/json-ld#context</code> for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-profile\" class=\"internalDFN\" data-link-type=\"idl\"><code>profile</code></a>\n                  and for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-requestprofile\" class=\"internalDFN\" data-link-type=\"idl\"><code>requestProfile</code></a>.",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>context</var> cannot be dereferenced,\n                      <span class=\"changed\">\n                        or the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-document\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>document</code></code></a> from <var>context document</var>\n                        cannot be transformed into the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a>\n                      </span>,\n                      a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-remote-context-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading remote context failed</code></a>\n                      error has been detected and processing is aborted."
                    },
                    {
                      "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-document\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>document</code></code></a> has no\n                      top-level <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with an <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-remote-context\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid remote context</code></a>\n                      has been detected and processing is aborted."
                    },
                    {
                      "html": "Set <var>loaded context</var> to the value of that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                    }
                  ]
                },
                {
                  "html": "Set <var>result</var> to the result of recursively calling this algorithm,\n                  passing <var>result</var> for <var>active context</var>,\n                  <var>loaded context</var> for <var>local context</var>,\n                  <span class=\"changed\">\n                    the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-documenturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>documentUrl</code></code></a> of <var>context document</var> for <var>base URL</var>,\n                  </span>\n                  <span class=\"changed\">a copy of</span> <var>remote contexts</var>,\n                  <span class=\"changed\">and <var>validate scoped context</var></span>."
                },
                {
                  "html": "Continue with the next <var>context</var>."
                }
              ]
            },
            {
              "html": "If <var>context</var> is not a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-local-context\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid local context</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Otherwise, <var>context</var> is a <a href=\"https://www.w3.org/TR/json-ld11/#dfn-context-definition\">context definition</a>."
            },
            {
              "html": "If <var>context</var> has an <code>@version</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the associated value is not <code>1.1</code>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@version-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @version value</code></a>\n                  has been detected, and processing is aborted."
                },
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a>\n                  is set to <code>json-ld-1.0</code>,\n                  a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-processing-mode-conflict\" class=\"internalDFN\" data-link-type=\"idl\"><code>processing mode conflict</code></a>\n                  error has been detected and processing is aborted."
                }
              ]
            },
            {
              "html": "If <var>context</var> has an <code>@import</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-context-entry\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid context entry</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "Otherwise, if the value of <code>@import</code> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@import-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @import value</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "Initialize <var>import</var> to the result of resolving the value of <code>@import</code> against\n                  <var>base URL</var>."
                },
                {
                  "html": "Dereference <var>import</var> using\n                  the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentcallback\" class=\"internalDFN\" data-link-type=\"idl\"><code>LoadDocumentCallback</code></a>, passing <var>import</var>\n                  for <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>,\n                  and <code>http://www.w3.org/ns/json-ld#context</code> for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-profile\" class=\"internalDFN\" data-link-type=\"idl\"><code>profile</code></a>\n                  and for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-requestprofile\" class=\"internalDFN\" data-link-type=\"idl\"><code>requestProfile</code></a>."
                },
                {
                  "html": "If <var>import</var> cannot be dereferenced,\n                  <span>or cannot be transformed into the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a></span>,\n                  a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-remote-context-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading remote context failed</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "If the dereferenced document has no\n                  top-level <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with an <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  or if the value of <code>@context</code> is not a <a href=\"https://www.w3.org/TR/json-ld11/#dfn-context-definition\">context definition</a>\n                  (i.e., it is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>),\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-remote-context\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid remote context</code></a>\n                  has been detected and processing is aborted; otherwise,\n                  set <var>import context</var> to the value of that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                },
                {
                  "html": "If <var>import context</var> has a <code>@import</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-context-entry\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid context entry</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "Set <var>context</var> to the result of merging <var>context</var>\n                  into <var>import context</var>, replacing common entries\n                  with those from <var>context</var>."
                }
              ]
            },
            {
              "html": "If <var>context</var> has an <code>@base</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> and <var>remote contexts</var> is empty, i.e., the currently\n              being processed context is not a remote context:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>value</var> to the value associated with the\n                  <code>@base</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                },
                {
                  "html": "If <var>value</var> is <code>null</code>, remove the\n                  <a class=\"changed internalDFN\" data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of <var>result</var>."
                },
                {
                  "html": "Otherwise, if <var>value</var> is an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>,\n                  the <a class=\"changed internalDFN\" data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of <var>result</var> is set to <var>value</var>."
                },
                {
                  "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-6.5\">relative <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> reference</a> and\n                  the <a class=\"changed internalDFN\" data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of <var>result</var> is not <code>null</code>,\n                  set the <a class=\"changed internalDFN\" data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of <var>result</var> to the result of\n                  resolving <var>value</var> against the current <a class=\"changed internalDFN\" data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>\n                  of <var>result</var>."
                },
                {
                  "html": "Otherwise, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-base-iri\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></code></a>\n                  error has been detected and processing is aborted."
                }
              ]
            },
            {
              "html": "If <var>context</var> has an <code>@vocab</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>value</var> to the value associated with the\n                  <code>@vocab</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                },
                {
                  "html": "If <var>value</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#nulls\">null</a>, remove\n                  any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a> from <var>result</var>."
                },
                {
                  "html": "Otherwise, if <var>value</var> is\n                  an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>\n                  or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>\n                  of <var>result</var> is set to\n                  <span class=\"changed\">the result of\n                    <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a> <var>value</var>\n                    using <code>true</code> for <var>document relative</var>\n                  </span>.\n                  If it is not an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-vocab-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid vocab mapping</code></a>\n                  error has been detected and processing is aborted."
                }
              ]
            },
            {
              "html": "If <var>context</var> has an <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>value</var> to the value associated with the\n                  <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                },
                {
                  "html": "If <var>value</var> is <code>null</code>, remove\n                  any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a> from <var>result</var>."
                },
                {
                  "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, the\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a> of <var>result</var> is set to\n                  <var>value</var>.\n                  If it is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-default-language\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid default language</code></a>\n                  error has been detected and processing is aborted.\n                  <span class=\"changed\">If <var>value</var> is not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> according to\n                    <a href=\"https://tools.ietf.org/html/bcp47#section-2.2.9\">section 2.2.9</a> of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-bcp47\" title=\"Tags for Identifying Languages\">BCP47</a></cite>],\n                    processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> issue a warning.</span>"
                }
              ]
            },
            {
              "html": "If <var>context</var> has an <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-context-entry\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid context entry</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "Initialize <var>value</var> to the value associated with the\n                  <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                },
                {
                  "html": "If <var>value</var> is <code>null</code>, remove\n                  any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">base direction</a> from <var>result</var>."
                },
                {
                  "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, the\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">base direction</a> of <var>result</var> is set to\n                  <var>value</var>. If it is not <code>null</code>, <code>\"ltr\"</code>, or <code>\"rtl\"</code>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-base-direction\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid base direction</code></a>\n                  error has been detected and processing is aborted."
                }
              ]
            },
            {
              "html": "If <var>context</var> has an <code>@propagate</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-context-entry\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid context entry</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "Otherwise, if the value of <code>@propagate</code> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\">boolean</a> <code>true</code> or <code>false</code>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@propagate-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @propagate value</code></a>\n                  error has been detected and processing is aborted."
                }
              ]
            },
            {
              "html": "Create a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>defined</var> to keep\n              track of whether or not a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> has already been defined\n              or is currently being defined during recursion."
            },
            {
              "html": "For each <var>key</var>-<var>value</var> pair in <var>context</var> where\n              <var>key</var> is not\n              <code>@base</code>,\n              <code class=\"changed\">@direction</code>,\n              <code class=\"changed\">@import</code>,\n              <code>@language</code>,\n              <code class=\"changed\">@propagate</code>,\n              <code class=\"changed\">@protected</code>,\n              <code>@version</code>, or\n              <code>@vocab</code>,\n              invoke the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#create-term-definition\">Create Term Definition algorithm</a>,\n              passing <var>result</var> for <var>active context</var>,\n              <var>context</var> for <var>local context</var>, <var>key</var>,\n              <var>defined</var>,\n              <span class=\"changed\">\n                <var>base URL</var>,\n                the value of the <code>@protected</code>\n                entry from <var>context</var>, if any, for <var>protected</var>,\n                <var>override protected</var>,\n                and a copy of <var>remote contexts</var>.\n              </span>"
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "4.2.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x4-2-2-algorithm",
      "html": "The algorithm has four required <span class=\"changed\">and five optional</span> inputs.\n        The required inputs are\n        an <var>active context</var>,\n        a <var>local context</var>,\n        a <var>term</var>,\n        and a map <var>defined</var>.\n        <span class=\"changed\">The optional inputs are\n          <var>base URL</var> defaulting to <code>null</code>,\n          <var>protected</var> which defaults to <code>false</code>,\n          and <var>override protected</var>, defaulting to <code>false</code>,\n          which is used to allow changes to protected terms,\n          an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>remote contexts</var>,\n          defaulting to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, which is used to detect cyclical context inclusions,\n          and <var>validate scoped context</var> defaulting to <code>true</code>,\n          which is used to limit recursion when validating possibly recursive <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-scoped-context\">scoped contexts</a>.</span>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>defined</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <var>term</var> and the associated\n          value is <code>true</code> (indicating that the\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has already been created), return. Otherwise,\n          if the value is <code>false</code>, a\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-cyclic-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>cyclic <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n          error has been detected and processing is aborted."
        },
        {
          "html": "If <var>term</var> is the empty string (<code>\"\"</code>),\n          an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n          error has been detected and processing is aborted.\n          Otherwise, set the value associated with <var>defined</var>'s <var>term</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to\n          <code>false</code>. This indicates that the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a>\n          is now being created but is not yet complete."
        },
        {
          "html": "Initialize <var>value</var> to a copy of the value associated with the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          <var>term</var> in <var>local context</var>."
        },
        {
          "html": "If <var>term</var> is <code>@type</code>,\n          and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n          a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-keyword-redefinition\" class=\"internalDFN\" data-link-type=\"idl\"><code>keyword redefinition</code></a> error has\n          been detected and processing is aborted.\n          At this point,\n          <var>value</var> <em class=\"rfc2119\" title=\"MUST\">MUST</em> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with only either or both of the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>:\n          <ul>\n            <li>An entry for <code>@container</code> with value <code>@set</code>.</li>\n            <li>An entry for <code>@protected</code>.</li>\n          </ul>\n          Any other value means that a\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-keyword-redefinition\" class=\"internalDFN\" data-link-type=\"idl\"><code>keyword redefinition</code></a> error has\n          been detected and processing is aborted."
        },
        {
          "html": "<span class=\"changed\">Otherwise</span>, since <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keywords</a> cannot be overridden,\n          <var>term</var> <em class=\"rfc2119\" title=\"MUST NOT\">MUST NOT</em> be a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a> and a\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-keyword-redefinition\" class=\"internalDFN\" data-link-type=\"idl\"><code>keyword redefinition</code></a>\n          error has been detected and processing is aborted.\n          If <var>term</var> has the form of a keyword\n          (i.e., it matches the ABNF rule <code>\"@\"1*ALPHA</code> from [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc5234\" title=\"Augmented BNF for Syntax Specifications: ABNF\">RFC5234</a></cite>]),\n          return; processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> generate a warning."
        },
        {
          "html": "Initialize <var>previous definition</var> to any existing\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>term</var> in <var>active context</var>,\n          removing that <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> from <var>active context</var>."
        },
        {
          "html": "If <var>value</var> is <code>null</code>,\n          convert it to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose\n          key is <code>@id</code> and whose value is <code>null</code>."
        },
        {
          "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, convert it\n          to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose\n          key is <code>@id</code> and whose value is <var>value</var>.\n          <span class=\"changed\">Set <var>simple term</var> to <code>true</code></span>."
        },
        {
          "html": "Otherwise, <var>value</var> <em class=\"rfc2119\" title=\"MUST\">MUST</em> be a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, if not, an\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n          error has been detected and processing is aborted.\n          <span class=\"changed\">Set <var>simple term</var> to <code>false</code></span>."
        },
        {
          "html": "Create a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a>, <var>definition</var>,\n          <span class=\"changed\">initializing <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a> to <code>false</code>,\n            <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-protected\" class=\"internalDFN\" data-link-type=\"dfn\">protected</a> to <var>protected</var>,\n            and <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a> to <code>false</code></span>."
        },
        {
          "html": "If <var>value</var> has an <code>@protected</code> entry,\n          set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-protected\" class=\"internalDFN\" data-link-type=\"dfn\">protected</a> flag in <var>definition</var> to the value of this entry.\n          If the value of <code>@protected</code> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\">boolean</a>,\n          an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@protected-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @protected value</code></a> error has been detected and processing is aborted.\n          If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n          an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n          has been detected and processing is aborted."
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@type</code>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>type</var> to the value associated with the\n              <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>. Otherwise, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-type-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid type mapping</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Set <var>type</var> to the result of\n              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a> <var>type</var></span>,\n              using <var>local context</var>, and <var>defined</var>."
            },
            {
              "html": "If the expanded <var>type</var> is\n              <code>@json</code> or <code>@none</code>, and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-type-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid type mapping</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Otherwise, if the expanded <var>type</var> is\n              neither <code>@id</code>, nor <code>@json</code>,\n              nor <code>@none</code>,\n              nor <code>@vocab</code>, \n              nor an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>,\n              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-type-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid type mapping</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> for <var>definition</var> to <var>type</var>."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@reverse</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>value</var> contains <code>@id</code> or <code>@nest</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-reverse-property\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid reverse property</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "If the value associated with the <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "If the value associated with the <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is a string\n              having the form of a keyword\n              (i.e., it matches the ABNF rule <code>\"@\"1*ALPHA</code> from [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc5234\" title=\"Augmented BNF for Syntax Specifications: ABNF\">RFC5234</a></cite>]),\n              return; processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> generate a warning."
            },
            {
              "html": "Otherwise, set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var> to the\n              result of\n              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span>\n              the value associated with the <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              using <var>local context</var>, and <var>defined</var>.\n              If the result does not have the <a href=\"https://tools.ietf.org/html/rfc3987#section-2.2\">form</a> of an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,\n              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "If <var>value</var> contains an <code>@container</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> of <var>definition</var>\n              to <span class=\"changed\">an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing</span> its value;\n              if its value is neither <code>@set</code>, nor\n              <code>@index</code>, nor <code>null</code>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-reverse-property\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid reverse property</code></a>\n              error has been detected (reverse properties only support set- and\n              index-containers) and processing is aborted."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a> flag of <var>definition</var>\n              to <code>true</code>."
            },
            {
              "html": "Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> of <var>term</var> in\n              <var>active context</var> to <var>definition</var> and the\n              value associated with <var>defined</var>'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <var>term</var> to\n              <code>true</code> and return."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> and its value\n          does not equal <var>term</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>value</var>\n              is <code>null</code>, the term is not used for <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expansion, but is\n              retained to be able to detect future redefinitions of this term."
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the value associated with the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "If the value associated with the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                  is not a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>, but\n                  has the form of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>\n                  (i.e., it matches the ABNF rule <code>\"@\"1*ALPHA</code> from [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc5234\" title=\"Augmented BNF for Syntax Specifications: ABNF\">RFC5234</a></cite>]),\n                  return; processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> generate a warning."
                },
                {
                  "html": "Otherwise, set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var> to the\n                  result of\n                  <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span>\n                  the value associated with the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  using <var>local context</var>, and <var>defined</var>.\n                  If the resulting <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> is neither a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>, nor an\n                  <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, nor a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n                  error has been detected and processing is aborted; if it equals <code>@context</code>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-keyword-alias\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid keyword alias</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "If the <var>term</var> contains a colon (<code>:</code>)\n                  anywhere but as the first or last character of <var>term</var>,\n                  or if it contains a slash (<code>/</code>) anywhere:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set the value associated with <var>defined</var>'s <var>term</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to\n                      <code>true</code>."
                    },
                    {
                      "html": "If the result of <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>term</var>\n                      using <var>local context</var>, and <var>defined</var>,\n                      is not the same as the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var>,\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n                      error has been detected and processing is aborted."
                    }
                  ]
                },
                {
                  "html": "If <var>term</var> contains neither a colon (<code>:</code>) nor a slash (<code>/</code>),\n                  <span class=\"changed\"><var>simple term</var> is <code>true</code></span>,\n                  and if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var>\n                  is either an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> ending with a <a href=\"https://tools.ietf.org/html/rfc3986#section-2.2\">gen-delim</a> character,\n                  or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,\n                  set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a> in <var>definition</var> to <code>true</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise if the <var>term</var> contains a colon (<code>:</code>)\n          <span class=\"changed\">anywhere after the first character</span>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>term</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-compact-iri\">compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> with a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-prefix\">prefix</a> that is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>local context</var>\n              a dependency has been found. Use this algorithm recursively passing\n              <var>active context</var>, <var>local context</var>, the\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-prefix\">prefix</a> as <var>term</var>, and <var>defined</var>."
            },
            {
              "html": "If <var>term</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-prefix\">prefix</a> has a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <var>active context</var>, set\n              the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var> to the result of\n              concatenating the value associated with the <a data-lt=\"prefix\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-prefix\">prefix's</a>\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> and the <var>term</var>'s <var>suffix</var>."
            },
            {
              "html": "Otherwise, <var>term</var> is an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>. Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n              of <var>definition</var> to <var>term</var>."
            }
          ]
        },
        {
          "html": "Otherwise if the <var>term</var> contains a slash (<code>/</code>):",
          "rationale": "set",
          "steps": [
            {
              "html": "<var>Term</var> is a <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-6.5\">relative <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> reference</a>."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var> to the\n              result of <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>term</var>.\n              If the resulting <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> is not an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n              error has been detected and processing is aborted."
            }
          ]
        },
        {
          "html": "Otherwise, if term is <code>@type</code>, set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n          of <var>definition</var> to <code>@type</code>."
        },
        {
          "html": "Otherwise, if <var>active context</var> has a\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>, the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n          of <var>definition</var> is set to the result of concatenating the value\n          associated with the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a> and <var>term</var>.\n          If it does not have a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>, an\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-iri-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</code></a>\n          error been detected and processing is aborted."
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@container</code>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>container</var> to the value associated with the\n              <code>@container</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be either\n              <code class=\"changed\">@graph</code>,\n              <code class=\"changed\">@id</code>,\n              <code>@index</code>,\n              <code>@language</code>,\n              <code>@list</code>,\n              <code>@set</code>,\n              <code class=\"changed\">@type</code>,\n              <span class=\"changed\">\n                or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing exactly any one of those keywords,\n                an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing <code>@graph</code> and\n                either <code>@id</code> or <code>@index</code> optionally\n                including <code>@set</code>,\n                or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing a combination of <code>@set</code> and any of\n                <code>@index</code>, <code>@graph</code>,\n                <code>@id</code>, <code>@type</code>,\n                <code>@language</code> in any order\n              </span>.\n              Otherwise, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-container-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid container mapping</code></a>\n              has been detected and processing is aborted."
            },
            {
              "html": "If the container value\n              is <code>@graph</code>, <code>@id</code>, or <code>@type</code>, or is otherwise not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,\n              generate an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-container-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid container mapping</code></a>\n              error and abort processing if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> of <var>definition</var> to\n              <var>container</var>\n              <span class=\"changed\">coercing to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, if necessary</span>."
            },
            {
              "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> of <var>definition</var> includes <code>@type</code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>type mapping</var> in <var>definition</var> is undefined, set it to <code>@id</code>."
                },
                {
                  "html": "If <var>type mapping</var> in <var>definition</var> is neither <code>@id</code> nor <code>@vocab</code>,\n                  an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-type-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid type mapping</code></a>\n                  error has been detected and processing is aborted."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@index</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code> or\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> does not include <code>@index</code>,\n              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n              has been detected and processing is aborted."
            },
            {
              "html": "Initialize <var>index</var> to the value associated with the\n              <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>.\n              If the result of <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a> that value is not an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>,\n              an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n              has been detected and processing is aborted."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-index-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">index mapping</a> of <var>definition</var> to <var>index</var>"
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@context</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n              has been detected and processing is aborted."
            },
            {
              "html": "Initialize <var>context</var> to the value associated with the\n              <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which is treated as a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>."
            },
            {
              "html": "Invoke the <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>\n              using the <var>active context</var>, <var>context</var> as <var>local context</var>,\n              <var>base URL</var>,\n              <code>true</code> for <var>override protected</var>,\n              <span class=\"changed\">a copy of</span> <var>remote contexts</var>,\n              and <code>false</code> for <var>validate scoped context</var>.\n              If any error is detected, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-scoped-context\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid scoped context</code></a> error\n              has been detected and processing is aborted."
            },
            {
              "html": "Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a> of <var>definition</var> to <var>context</var>,\n              and <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-base-url\" class=\"internalDFN\" data-link-type=\"dfn\">base URL</a> to <var>base URL</var>."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@language</code> and\n          does not contain the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@type</code>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>language</var> to the value associated with the\n              <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be either <code>null</code>\n              or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>.\n              <span class=\"changed\">If <var>language</var> is not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> according to\n                <a href=\"https://tools.ietf.org/html/bcp47#section-2.2.9\">section 2.2.9</a> of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-bcp47\" title=\"Tags for Identifying Languages\">BCP47</a></cite>],\n                processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> issue a warning.</span>\n              Otherwise, an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-language-mapping\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid language mapping</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> of <var>definition</var> to <var>language</var>."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@direction</code> and\n          does not contain the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@type</code>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>direction</var> to the value associated with the\n              <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be either <code>null</code>,\n              <code>\"ltr\"</code>, or <code>\"rtl\"</code>. Otherwise, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-base-direction\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid base direction</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a>\n              of <var>definition</var> to <var>direction</var>."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@nest</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n              has been detected and processing is aborted."
            },
            {
              "html": "Initialize <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-nest-value\" class=\"internalDFN\" data-link-type=\"dfn\">nest value</a> in <var>definition</var> to the value associated with the\n              <code>@nest</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> and\n              <em class=\"rfc2119\" title=\"MUST NOT\">MUST NOT</em> be a keyword other than <code>@nest</code>. Otherwise, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@nest-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @nest value</code></a>\n              error has been detected and processing is aborted."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@prefix</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>, or if\n              <var>term</var> contains a colon (<code>:</code>) or slash (<code>/</code>), an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n              has been detected and processing is aborted."
            },
            {
              "html": "Set the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a> to the value associated with the\n              <code>@prefix</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\">boolean</a>. Otherwise, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@prefix-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @prefix value</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a> of <var>definition</var> is set to <code>true</code>,\n              and its <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>,\n              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a>\n              has been detected and processing is aborted."
            }
          ]
        },
        {
          "html": "If <var>value</var> contains any <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> other than <code>@id</code>,\n          <code>@reverse</code>, <code>@container</code>,\n          <code class=\"changed\">@context</code>, \n          <code class=\"changed\">@direction</code>,\n          <code class=\"changed\">@index</code>,\n          <code>@language</code>,\n          <code class=\"changed\">@nest</code>,\n          <code class=\"changed\">@prefix</code>,\n          <code class=\"changed\">@protected</code>,\n          or <code>@type</code>,\n          an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-term-definition\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid term definition</code></a> error has\n          been detected and processing is aborted."
        },
        {
          "html": "If <var>override protected</var> is <code>false</code>\n          and <var>previous definition</var> exists and is protected;",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>definition</var> is not the same as <var>previous definition</var>\n              (other than the value of <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-protected\" class=\"internalDFN\" data-link-type=\"dfn\">protected</a>),\n              a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-protected-term-redefinition\" class=\"internalDFN\" data-link-type=\"idl\"><code>protected term redefinition</code></a> error has been detected,\n              and processing is aborted."
            },
            {
              "html": "Set <var>definition</var> to <var>previous definition</var> to retain the value\n              of <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-protected\" class=\"internalDFN\" data-link-type=\"dfn\">protected</a>."
            }
          ]
        },
        {
          "html": "Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> of <var>term</var> in\n          <var>active context</var> to <var>definition</var> and set the value\n          associated with <var>defined</var>'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <var>term</var> to\n          <code>true</code>."
        }
      ]
    },
    {
      "name": "4.3.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x4-3-2-algorithm",
      "html": "The algorithm takes one required input: the <var>active context</var> that\n        the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-inverse-context\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> is being created for.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>result</var> to an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "Initialize <var>default language</var> to <code>@none</code>.\n          If the <var>active context</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a>,\n          set <var>default language</var> to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a>\n          <span class=\"changed\">normalized to lower case</span>."
        },
        {
          "html": "For each key <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> and value <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in\n          the <var>active context</var>, ordered by shortest <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n          first (breaking ties by choosing the lexicographically least\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>):",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> is <code>null</code>,\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> cannot be selected during <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-compact\" class=\"internalDFN\" data-link-type=\"dfn\">compaction</a>,\n              so continue to the next <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>."
            },
            {
              "html": "Initialize <var>container</var> to <code>@none</code>.\n              <span class=\"changed\">\n                If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> is not empty, set <var>container</var>\n                to the concatenation of all values of the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a>\n                in lexicographical order\n              </span>."
            },
            {
              "html": "Initialize <var>var</var> to the value of the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n              for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a>."
            },
            {
              "html": "If <var>var</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>result</var>, add\n              an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> where the key is <var>var</var> and the value\n              is an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> to <var>result</var>."
            },
            {
              "html": "Reference the value associated with the <var>var</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in\n              <var>result</var> using the variable <var>container map</var>."
            },
            {
              "html": "If <var>container map</var> has no <var>container</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              create one and set its value to a new\n              <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with <span class=\"changed\">three</span> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>.\n              The first <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is <code>@language</code> and its value is a new empty\n              <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, the second <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is <code>@type</code>\n              and its value is a new empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>,\n              <span class=\"changed\">and the third <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is <code>@any</code>\n                and its value is a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                <code>@none</code> set to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> being processed</span>."
            },
            {
              "html": "Reference the value associated with the <var>container</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              in <var>container map</var> using the variable <var>type/language map</var>."
            },
            {
              "html": "Reference the value associated with the <code>@type</code>\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>type/language map</var> using the variable\n              <var>type map</var>."
            },
            {
              "html": "Reference the value associated with the <code>@language</code>\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>type/language map</var> using the variable\n              <var>language map</var>."
            },
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> indicates that the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n              represents a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>type map</var> does not have an <code>@reverse</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has a\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> which is <code>@none</code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>language map</var> does not have an <code>@any</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                },
                {
                  "html": "If <var>type map</var> does not have an <code>@any</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has a\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>type map</var> does not have an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> corresponding\n                  to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> in <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has both\n              a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> and a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a>:",
              "rationale": "create",
              "steps": [
                {
                  "html": "Create a new variable <var>lang dir</var>."
                },
                {
                  "html": "If neither the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> nor the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a>\n                  are <code>null</code>, set <var>lang dir</var> to the concatenation\n                  of <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> and <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a>\n                  separated by an underscore (<code>\"_\"</code>)\n                  normalized to lower case."
                },
                {
                  "html": "Otherwise, if <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> is not <code>null</code>,\n                  set <var>lang dir</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a>,\n                  normalized to lower case."
                },
                {
                  "html": "Otherwise, if <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a> is not <code>null</code>,\n                  set <var>lang dir</var> to <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a>\n                  preceded by an underscore (<code>\"_\"</code>)."
                },
                {
                  "html": "Otherwise, set <var>lang dir</var> to <code>@null</code>."
                },
                {
                  "html": "If <var>language map</var> does not have a <var>lang dir</var>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has a\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> (might be <code>null</code>):",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> equals <code>null</code>,\n                  set <var>language</var> to <code>@null</code>; otherwise\n                  to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a>,\n                  <span class=\"changed\">normalized to lower case</span>."
                },
                {
                  "html": "If <var>language map</var> does not have a <var>language</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has a\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a> (might be <code>null</code>):",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a> equals <code>null</code>,\n                  set <var>direction</var> to <code>@none</code>; otherwise\n                  to <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a> preceded by an underscore (<code>\"_\"</code>)."
                },
                {
                  "html": "If <var>language map</var> does not have a <var>direction</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise, if <var>active context</var> has a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize a variable <var>lang dir</var>\n                  with the concatenation of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a> and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>,\n                  separate by an underscore (<code>\"_\"</code>),\n                  normalized to lower case."
                },
                {
                  "html": "If <var>language map</var> does not have a <var>lang dir</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                },
                {
                  "html": "If <var>language map</var> does not have an <code>@none</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                },
                {
                  "html": "If <var>type map</var> does not have an <code>@none</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>language map</var> does not have a <var>default language</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                  <span class=\"changed\">(after being normalized to lower case)</span>,\n                  create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                },
                {
                  "html": "If <var>language map</var> does not have an <code>@none</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                },
                {
                  "html": "If <var>type map</var> does not have an <code>@none</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set its value to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>\n                  being processed."
                }
              ]
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "4.4.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x4-4-2-algorithm",
      "html": "This algorithm has five required inputs. They are:\n        an <var class=\"changed\">active context</var>,\n        a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a> or <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> <var>var</var>,\n        an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>containers</var> that represents an\n        ordered list of preferred <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a>,\n        a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> <var>type/language</var> that indicates whether\n        to look for a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> with a matching <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a>\n        or <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a>,\n        and an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> representing an ordered list of <var>preferred values</var>\n        for the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> or <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> to look for.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <var>active context</var> has a <code>null</code>\n          <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a>,\n          set <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> in <var>active context</var>\n          to the result of calling the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#inverse-context-creation\">Inverse Context Creation algorithm</a>\n          using <var>active context</var>."
        },
        {
          "html": "Initialize <var>inverse context</var> to the value of\n          <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> in <var>active context</var>."
        },
        {
          "html": "Initialize <var>container map</var> to the value associated with\n          <var>var</var> in the <var>inverse context</var>."
        },
        {
          "html": "For each item <var>container</var> in <var>containers</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>container</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>container map</var>, then\n              there is no <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> with a matching\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for it, so continue to the next\n              <var>container</var>."
            },
            {
              "html": "Initialize <var>type/language map</var> to the value associated\n              with the <var>container</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>container map</var>."
            },
            {
              "html": "Initialize <var>value map</var> to the value associated\n              with <var>type/language</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>type/language map</var>."
            },
            {
              "html": "For each <var>item</var> in <var>preferred values</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>item</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>value map</var>,\n                  then there is no <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> with a matching\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> or <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a>,\n                  so continue to the next <var>item</var>."
                },
                {
                  "html": "Otherwise, a matching term has been found, return the value\n                  associated with the <var>item</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in\n                  <var>value map</var>."
                }
              ]
            }
          ]
        },
        {
          "html": "No matching term has been found. Return <code>null</code>."
        }
      ]
    },
    {
      "name": "5.1.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x5-1-2-algorithm",
      "html": "The algorithm also performs processing steps specific to expanding\n        a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11-framing/#dfn-frame\">JSON-LD Frame</a>. For a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11-framing/#dfn-frame\">frame</a>, the <code>@id</code> and\n        <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> can accept an array of <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\">IRIs</a> or\n        an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>. The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a> can also\n        accept an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">strings</a>, or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>.\n        Framing also uses additional keyword <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>:\n        (<code>@explicit</code>, <code>@default</code>,\n        <code>@embed</code>, <code>@explicit</code>, <code>@omitDefault</code>, or\n        <code>@requireAll</code>) which are preserved through expansion.\n        Special processing for a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11-framing/#dfn-frame\">JSON-LD Frame</a> is invoked when the\n        <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set to <code>true</code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>element</var> is <code>null</code>, return <code>null</code>."
        },
        {
          "html": "If <var>active property</var> is <code>@default</code>,\n          initialize the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag to <code>false</code>."
        },
        {
          "html": "If <var>active property</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <var>active context</var>\n          with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>, initialize <var>property-scoped context</var> to that <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>."
        },
        {
          "html": "If <var>element</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#primitive-data-types\">scalar</a>,",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>active property</var> is <code>null</code> or <code>@graph</code>,\n              drop the free-floating <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#primitive-data-types\">scalar</a> by returning <code>null</code>."
            },
            {
              "html": "If <var>property-scoped context</var> is defined,\n              set <var>active context</var> to the result of the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n              passing <var>active context</var>, <var>property-scoped context</var> as <var>local context</var>,\n              and <var>base URL</var> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>active property</var>\n              in <var>active context</var>."
            },
            {
              "html": "Return the result of the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#value-expansion\">Value Expansion algorithm</a>, passing the\n              <var>active context</var>, <var>active property</var>, and\n              <var>element</var> as <var>value</var>."
            }
          ]
        },
        {
          "html": "If <var>element</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize an empty array, <var>result</var>."
            },
            {
              "html": "For each <var>item</var> in <var>element</var>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>expanded item</var> to the result of using this\n                  algorithm recursively, passing <var>active context</var>,\n                  <var>active property</var>, <var>item</var> as <var>element</var>,\n                  <var class=\"changed\">base URL</var>,\n                  <span class=\"changed\">the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                    <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a></span>,\n                    and <var>from map</var> flags."
                },
                {
                  "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a>\n                  of <var>active property</var> includes <code>@list</code>,\n                  and <var>expanded item</var> is an\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, set <var>expanded item</var> to a new\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                  <code>@list</code> where the value is the original\n                  <var>expanded item</var>."
                },
                {
                  "html": "If <var>expanded item</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, append each\n                  of its items to <var>result</var>. Otherwise, if\n                  <var>expanded item</var> is not null, append it to <var>result</var>."
                }
              ]
            },
            {
              "html": "Return <var>result</var>."
            }
          ]
        },
        {
          "html": "Otherwise <var>element</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "If <var>active context</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a>,\n          the <var>active context</var> is not propagated.\n          If <var>from map</var> is undefined or <code>false</code>,\n          and <var>element</var> does not contain an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> expanding to <code>@value</code>,\n          and <var>element</var> does not consist of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> expanding to <code>@id</code>\n          (where <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> are <span class=\"changed\"><a data-lt=\"IRI expanding\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanded</a></span>,\n          set <var>active context</var> to <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a> from <var>active context</var>,\n          as the scope of a term-scoped <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-context\">context</a> does not apply when processing new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node objects</a>."
        },
        {
          "html": "If <var>property-scoped context</var> is defined,\n          set <var>active context</var> to the result of the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n          passing <var>active context</var>, <var>property-scoped context</var> as <var>local context</var>,\n          <var>base URL</var> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>active property</var>,\n          in <var>active context</var>\n          and <code>true</code> for <var>override protected</var>."
        },
        {
          "html": "If <var>element</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@context</code>, set\n          <var>active context</var> to the result of the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n          passing <var>active context</var>, the value of the\n          <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> as <var>local context</var>\n          <span class=\"changed\">and <var>base URL</var></span>."
        },
        {
          "html": "Initialize <var>type-scoped context</var> to <var>active context</var>.\n          This is used for expanding values that may be relevant to any previous\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-type-scoped-context\">type-scoped context</a>."
        },
        {
          "html": "For each <var>key</var> and <var>value</var> in <var>element</var>\n          ordered lexicographically by <var>key</var>\n          where <var>key</var> <span class=\"changed\"><a data-lt=\"IRI expanding\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expands</a></span> to <code>@type</code>:",
          "rationale": "convert",
          "steps": [
            {
              "html": "Convert <var>value</var> into an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, if necessary."
            },
            {
              "html": "For each <var>term</var> which is a value of <var>value</var> ordered lexicographically,\n              if <var>term</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,\n              and <var>term</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <var>type-scoped context</var>\n              has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>, set <var>active context</var> to the result\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n              passing <var>active context</var>,\n              the value of the\n              <var>term</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a> as <var>local context</var>,\n              <var>base URL</var> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>value</var>\n              in <var>active context</var>,\n              and <code>false</code> for <var>propagate</var>."
            }
          ]
        },
        {
          "html": "Initialize two empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a>, <var>result</var>\n          <span class=\"changed\">and <var>nests</var>.\n            Initialize <var>input type</var> to expansion of the last value of the first <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>element</var>\n            expanding to <code>@type</code> (if any), ordering <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> lexicographically by key</span>.\n            Both the key and value of the matched entry are\n            <span class=\"changed\"><a data-lt=\"IRI expanding\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanded</a></span>."
        },
        {
          "html": "For each <var>key</var> and <var>value</var> in <var>element</var>,\n          ordered lexicographically by <var>key</var> <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>key</var> is <code>@context</code>, continue to\n              the next <var>key</var>."
            },
            {
              "html": "Initialize <var>expanded property</var> to the result of\n              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>key</var>."
            },
            {
              "html": "If <var>expanded property</var> is <code>null</code> or it neither\n              contains a colon (<code>:</code>) nor it is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>,\n              drop <var>key</var> by continuing to the next <var>key</var>."
            },
            {
              "html": "If <var>expanded property</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>active property</var> equals <code>@reverse</code>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-reverse-property-map\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid reverse property map</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "If <var>result</var> already has an <var>expanded property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  <span class=\"changed\">other than <code>@included</code> or <code>@type</code>\n                  (unless <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>)</span>,\n                  a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-colliding-keywords\" class=\"internalDFN\" data-link-type=\"idl\"><code>colliding keywords</code></a>\n                  error has been detected and processing is aborted."
                },
                {
                  "html": "If <var>expanded property</var> is <code>@id</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@id-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @id value</code></a>\n                      error has been detected and processing is aborted.\n                      <span class=\"changed\">\n                        When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, <var>value</var>\n                        <em class=\"rfc2119\" title=\"MAY\">MAY</em> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of one\n                        or more <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">strings</a>.</span>"
                    },
                    {
                      "html": "Otherwise,\n                      set <var>expanded value</var> to the result of\n                      <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>value</var>\n                      using <code>true</code> for <var>document relative</var>\n                      and <code>false</code> for <var>vocab</var>.\n                      <span class=\"changed\">\n                        When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, <var>expanded value</var> will be\n                        an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of one or more of the values, with <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>\n                        values expanded using the <a href=\"https://www.w3.org/TR/json-ld11-api/#iri-expansion\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> Expansion algorithm</a> as above.</span>"
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@type</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>value</var>\n                      is neither a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> nor an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">strings</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-type-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid type value</code></a>\n                      error has been detected and processing is aborted.\n                      <span class=\"changed\">\n                        When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, <var>value</var>\n                        <em class=\"rfc2119\" title=\"MAY\">MAY</em> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-object\">default object</a>\n                        where the value of <code>@default</code> is restricted to be\n                        an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>.\n                        All other values mean that <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-type-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid type value</code></a>\n                        error has been detected and processing is aborted.</span>"
                    },
                    {
                      "html": "If <var>value</var>\n                      is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, set <var>expanded value</var> to <var>value</var>."
                    },
                    {
                      "html": "Otherwise, if <var>value</var>\n                      is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-object\">default object</a>, set <var>expanded value</var> to\n                      a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-object\">default object</a> with the value of <code>@default</code> set\n                      to the result of\n                      <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>value</var>\n                      using <var class=\"changed\">type-scoped context</var> for <var>active context</var>,\n                      and <code>true</code> for <var>document relative</var>."
                    },
                    {
                      "html": "Otherwise,\n                      set <var>expanded value</var> to the result of\n                      <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span>\n                      each of its values\n                      using <var class=\"changed\">type-scoped context</var> for <var>active context</var>,\n                      and <code>true</code> for <var>document relative</var>."
                    },
                    {
                      "html": "<span class=\"changed\">If <var>result</var> already has an entry for <code>@type</code>,\n                      prepend the value of <code>@type</code> in <var>result</var> to <var>expanded value</var>,\n                      transforming it into an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, if necessary.</span>"
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@graph</code>, set\n                  <var>expanded value</var> to the result of using this algorithm\n                  recursively passing <var>active context</var>, <code>@graph</code>\n                  for <var>active property</var>, <var>value</var> for <var>element</var>,\n                  <var class=\"changed\">base URL</var>,\n                  <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>,\n                  <span class=\"changed\">\n                    ensuring that <var>expanded value</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of one or more <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a></span>."
                },
                {
                  "html": "If <var>expanded property</var> is <code>@included</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n                      continue with the next <var>key</var> from <var>element</var>."
                    },
                    {
                      "html": "Set <var>expanded value</var> to the result of using\n                      this algorithm recursively passing <var>active context</var>,\n                      <code>null</code> for <var>active property</var>,\n                      <var>value</var> for <var>element</var>,\n                      <var>base URL</var>,\n                      and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                      and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags,\n                      ensuring that the result is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                    },
                    {
                      "html": "If any element of <var>expanded value</var> is not a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node object</a>,\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@included-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @included value</code></a>\n                      error has been detected and processing is aborted."
                    },
                    {
                      "html": "If <var>result</var> already has an entry for <code>@included</code>,\n                      prepend the value of <code>@included</code> in <var>result</var> to <var>expanded value</var>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@value</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If\n                      <var>input type</var> is <code>@json</code>,\n                      set <var>expanded value</var> to <var>value</var>.\n                      If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-value-object-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid value object value</code></a>\n                      error has been detected and processing is aborted."
                    },
                    {
                      "html": "Otherwise, if <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#primitive-data-types\">scalar</a> or <code>null</code>,\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-value-object-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid value object value</code></a>\n                      error has been detected and processing is aborted.\n                      <span class=\"changed\">When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, <var>value</var>\n                      <em class=\"rfc2119\" title=\"MAY\">MAY</em> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> or an array of\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#primitive-data-types\">scalar</a> values.</span>"
                    },
                    {
                      "html": "Otherwise, set <var>expanded value</var> to <var>value</var>.\n                      <span class=\"changed\">When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set,\n                      <var>expanded value</var> will be an\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of one or more <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> values\n                      or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>.</span>"
                    },
                    {
                      "html": "If <var>expanded value</var>\n                      is <code>null</code>, set the <code>@value</code>\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>result</var> to <code>null</code> and continue with the\n                      next <var>key</var> from <var>element</var>. Null values need to be preserved\n                      in this case as the meaning of an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> depends\n                      on the existence of an <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@language</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-language-tagged-string\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid language-tagged string</code></a>\n                      error has been detected and processing is aborted.\n                      <span class=\"changed\">When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, <var>value</var>\n                        <em class=\"rfc2119\" title=\"MAY\">MAY</em> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> or an array of zero or more\n                        <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">strings</a></span>."
                    },
                    {
                      "html": "<span class=\"changed\">\n                      Otherwise, set <var>expanded value</var> to <var>value</var>.\n                      If <var>value</var> is not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> according to\n                      <a href=\"https://tools.ietf.org/html/bcp47#section-2.2.9\">section 2.2.9</a> of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-bcp47\" title=\"Tags for Identifying Languages\">BCP47</a></cite>],\n                      processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> issue a warning.\n                      When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set,\n                       <var>expanded value</var> will be an\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of one or more <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> values\n                      or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>.</span>"
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@direction</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.0</code>,\n                      continue with the next <var>key</var> from <var>element</var>."
                    },
                    {
                      "html": "If <var>value</var> is neither <code>\"ltr\"</code> nor <code>\"rtl\"</code>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-base-direction\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid base direction</code></a>\n                      error has been detected and processing is aborted.\n                      When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, <var>value</var>\n                      <em class=\"rfc2119\" title=\"MAY\">MAY</em> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> or an array of zero or more\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">strings</a>."
                    },
                    {
                      "html": "Otherwise, set <var>expanded value</var> to <var>value</var>.\n                      When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set,\n                      <var>expanded value</var> will be an\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of one or more <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> values\n                      or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@index</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@index-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @index value</code></a>\n                      error has been detected and processing is aborted."
                    },
                    {
                      "html": "Otherwise,\n                      set <var>expanded value</var> to <var>value</var>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@list</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>active property</var> is <code>null</code> or\n                      <code>@graph</code>, continue with the next <var>key</var>\n                      from <var>element</var> to remove the free-floating list."
                    },
                    {
                      "html": "Otherwise, initialize <var>expanded value</var> to the result of using\n                      this algorithm recursively passing <var>active context</var>,\n                      <var>active property</var>, <var>value</var> for <var>element</var>,\n                      <var class=\"changed\">base URL</var>,\n                      <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                        and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags,\n                        ensuring that the result is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>.</span>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@set</code>, set\n                  <var>expanded value</var> to the result of using this algorithm\n                  recursively, passing <var>active context</var>,\n                  <var>active property</var>, <var>value</var> for <var>element</var>,\n                  <var class=\"changed\">base URL</var>,\n                  <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                },
                {
                  "html": "If <var>expanded property</var> is <code>@reverse</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>value</var> is not a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@reverse-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @reverse value</code></a>\n                      error has been detected and processing is aborted."
                    },
                    {
                      "html": "Otherwise initialize <var>expanded value</var> to the result of using this\n                      algorithm recursively, passing <var>active context</var>,\n                      <code>@reverse</code> as <var>active property</var>,\n                      <var>value</var> as <var>element</var>,\n                      <var class=\"changed\">base URL</var>,\n                      <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                        and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                    },
                    {
                      "html": "If <var>expanded value</var> contains an <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      i.e., <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-property\">properties</a> that are reversed twice, execute for each of its\n                      <var>property</var> and <var>item</var> the following steps:",
                      "rationale": "use",
                      "steps": [
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>item</var>\n                          to the <var>property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>result</var>\n                          using <code>true</code> for <var>as array</var>."
                        }
                      ]
                    },
                    {
                      "html": "If <var>expanded value</var> contains an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> other than <code>@reverse</code>:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set <var>reverse map</var> to the value\n                          of the <code>@reverse</code> entry in <var>result</var>,\n                          initializing it to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, if necessary."
                        },
                        {
                          "html": "For each <var>property</var> and <var>items</var> in <var>expanded value</var>\n                          other than <code>@reverse</code>:",
                          "rationale": "for",
                          "steps": [
                            {
                              "html": "For each <var>item</var> in <var>items</var>:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>, an\n                                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-reverse-property-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid reverse property value</code></a>\n                                  has been detected and processing is aborted."
                                },
                                {
                                  "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>item</var>\n                                  to the <var>property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>reverse map</var>\n                                  using <code>true</code> for <var>as array</var>."
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "html": "Continue with the next <var>key</var> from <var>element</var>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded property</var> is <code>@nest</code>,\n                  add <var>key</var> to <var>nests</var>, initializing it to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n                  if necessary.\n                  Continue with the next <var>key</var> from <var>element</var>."
                },
                {
                  "html": "When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set,\n                  if <var>expanded property</var> is any other\n                  framing keyword (<code>@default</code>,\n                  <code>@embed</code>, <code>@explicit</code>, <code>@omitDefault</code>, or\n                  <code>@requireAll</code>),\n                  set <var>expanded value</var> to the result of performing the\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#expansion-algorithm\">Expansion Algorithm</a>\n                  recursively, passing <var>active context</var>,\n                  <var>active property</var>, <var>value</var> for <var>element</var>,\n                  <var>base URL</var>,\n                  <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                },
                {
                  "html": "Unless <var>expanded value</var> is <code>null</code>,\n                  <span class=\"changed\"><var>expanded property</var> is <code>@value</code>,\n                    and <var>input type</var> is not <code>@json</code>,</span>\n                    set the <var>expanded property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>result</var> to\n                  <var>expanded value</var>."
                },
                {
                  "html": "Continue with the next <var>key</var> from <var>element</var>."
                }
              ]
            },
            {
              "html": "Initialize <var>container mapping</var> to <var>key</var>'s <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> in\n              <var>active context</var>."
            },
            {
              "html": "If <var>key</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <var>active context</var>\n              has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <code>@json</code>,\n              set <var>expanded value</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, set the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              <code>@value</code> to <var>value</var>, and set the entry <code>@type</code> to <code>@json</code>."
            },
            {
              "html": "Otherwise, if <var>container mapping</var> <span class=\"changed\">includes</span> <code>@language</code> and\n              <var>value</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> then <var>value</var>\n              is expanded from a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-language-map\">language map</a>\n              as follows:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>expanded value</var> to an empty\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "Initialize <var>direction</var> to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a> from <var>active context</var>."
                },
                {
                  "html": "If <var>key</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a>\n                  has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a>,\n                  update <var>direction</var> with that value."
                },
                {
                  "html": "For each key-value pair <var>language</var>-<var>language value</var>\n                  in <var>value</var>, ordered lexicographically by <var>language</var> <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>language value</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                      set <var>language value</var> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only\n                      <var>language value</var>."
                    },
                    {
                      "html": "For each <var>item</var> in <var>language value</var>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>item</var> is <code>null</code>,\n                          continue to the next entry in <var>language value</var>."
                        },
                        {
                          "html": "<var>item</var> must be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,\n                          otherwise an\n                          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-language-map-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid language map value</code></a>\n                          error has been detected and processing is aborted."
                        },
                        {
                          "html": "Initialize a new <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>v</var>\n                          consisting of two\n                          key-value pairs: (<code>@value</code>-<var>item</var>)\n                          and (<code>@language</code>-<var>language</var>).\n                          <span class=\"changed\">If <var>item</var> is neither <code>@none</code> nor <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> according to\n                            <a href=\"https://tools.ietf.org/html/bcp47#section-2.2.9\">section 2.2.9</a> of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-bcp47\" title=\"Tags for Identifying Languages\">BCP47</a></cite>],\n                            processors <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> issue a warning.</span>"
                        },
                        {
                          "html": "If <var>language</var> is <code>@none</code>,\n                          or expands to <code>@none</code>, remove <code>@language</code> from <var>v</var>."
                        },
                        {
                          "html": "If <var>direction</var> is not <code>null</code>,\n                          add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> for <code>@direction</code> to <var>v</var> with <var>direction</var>."
                        },
                        {
                          "html": "Append <var>v</var> to <var>expanded value</var>."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise, if <var>container mapping</var>\n              <span class=\"changed\">includes</span> <code>@index</code>,\n              <span class=\"changed\"><code>@type</code>, or <code>@id</code></span> and\n              <var>value</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> then <var>value</var>\n              is expanded from an map as follows:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>expanded value</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "Initialize <var>index key</var> to\n                  the <var>key</var>'s <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-index-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">index mapping</a> in <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a>,\n                  or <code>@index</code>, if it does not exist."
                },
                {
                  "html": "For each key-value pair <var>index</var>-<var>index value</var>\n                  in <var>value</var>, ordered lexicographically by <var>index</var>\n                  <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>container mapping</var> includes <code>@id</code> or <code>@type</code>,\n                      initialize <var>map context</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a>\n                      from <var>active context</var> if it exists,\n                      otherwise, set <var>map context</var> to <var>active context</var>."
                    },
                    {
                      "html": "If <var>container mapping</var> includes <code>@type</code>\n                      and <var>index</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in\n                      <var>map context</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>, update\n                      <var>map context</var> to the result of the\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n                      passing <var>map context</var> as <var>active context</var>\n                      the value of the <var>index</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>\n                      as <var>local context</var>\n                      and <var>base URL</var> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>index</var>\n                      in <var>map context</var>."
                    },
                    {
                      "html": "Otherwise, set <var>map context</var> to <var>active context</var>."
                    },
                    {
                      "html": "Initialize <var>expanded index</var> to the result of\n                      <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>index</var>."
                    },
                    {
                      "html": "If <var>index value</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                      set <var>index value</var> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only\n                      <var>index value</var>."
                    },
                    {
                      "html": "Initialize <var>index value</var> to the result of\n                      using this algorithm recursively, passing\n                      <var class=\"changed\">map context</var> as <var>active context</var>,\n                      <var>key</var> as <var>active property</var>,\n                      <var>index value</var> as <var>element</var>,\n                      <var class=\"changed\">base URL</var>,\n                      <span class=\"changed\"><code>true</code> for <var>from map</var>,\n                        and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                        and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                    },
                    {
                      "html": "For each <var>item</var> in <var>index value</var>:",
                      "rationale": ".algorithm",
                      "steps": [
                        {
                          "html": "If <var>container mapping</var> includes <code>@graph</code>,\n                          <span class=\"changed\">and <var>item</var> is not a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a>,</span>\n                          set <var>item</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing the key-value pair\n                          <code>@graph</code>-<var>item</var>,\n                          ensuring that the value is represented using an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                        },
                        {
                          "html": "If <var>container mapping</var> includes <code>@index</code>,\n                          <var>index key</var> is not <code>@index</code>,\n                          and <var>expanded index</var> is not <code>@none</code>:",
                          "rationale": "initialize",
                          "steps": [
                            {
                              "html": "Initialize <var>re-expanded index</var> to the result of calling\n                              the <a href=\"https://www.w3.org/TR/json-ld11-api/#value-expansion\">Value Expansion algorithm</a>,\n                              passing the <var>active context</var>,\n                              <var>index key</var> as <var>active property</var>,\n                              and <var>index</var> as <var>value</var>."
                            },
                            {
                              "html": "Initialize <var>expanded index key</var> to the result of\n                              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>index key</var>."
                            },
                            {
                              "html": "Initialize <var>index property values</var> to\n                              an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> consisting of <var>re-expanded index</var> followed\n                              by the existing values of \n                              the concatenation of <var>expanded index key</var> in <var>item</var>,\n                              if any."
                            },
                            {
                              "html": "Add the key-value pair (<var>expanded index key</var>-<var>index property values</var>)\n                              to <var>item</var>."
                            },
                            {
                              "html": "If <var>item</var> is a value object,\n                              it <em class=\"rfc2119\" title=\"MUST NOT\">MUST NOT</em> contain any extra properties;\n                              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-value-object\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid value object</code></a>\n                              error has been detected and processing is aborted."
                            }
                          ]
                        },
                        {
                          "html": "Otherwise, if <var>container mapping</var> includes <code>@index</code>,\n                          <var>item</var> does not have an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@index</code>,\n                          and <var>expanded index</var> is not <code>@none</code>,\n                          add the key-value pair (<code>@index</code>-<var>index</var>) to <var>item</var>."
                        },
                        {
                          "html": "Otherwise, if <var>container mapping</var> includes <code>@id</code>\n                          <var>item</var> does not have the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code>,\n                          and <var>expanded index</var> is not <code>@none</code>,\n                          add the key-value pair (<code>@id</code>-<var>expanded index</var>) to <var>item</var>,\n                          where <var>expanded index</var> is set to the result of\n                          <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span><var>index</var>\n                          using <code>true</code> for <var>document relative</var>\n                          and <code>false</code> for <var>vocab</var>."
                        },
                        {
                          "html": "Otherwise, if <var>container mapping</var> includes <code>@type</code>\n                          and <var>expanded index</var> is not <code>@none</code>,\n                          initialize <var>types</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                          consisting of <var>expanded index</var> followed by any existing\n                          values of <code>@type</code> in <var>item</var>.\n                          Add the key-value pair (<code>@type</code>-<var>types</var>) to <var>item</var>."
                        },
                        {
                          "html": "Append <var>item</var> to <var>expanded value</var>."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise, initialize <var>expanded value</var> to the result of\n              using this algorithm recursively, passing <var>active context</var>,\n              <var>key</var> for <var>active property</var>, <var>value</var> for <var>element</var>,\n              <var class=\"changed\">base URL</var>,\n              <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a>\n                and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
            },
            {
              "html": "If <var>expanded value</var> is <code>null</code>, ignore <var>key</var>\n              by continuing to the next <var>key</var> from <var>element</var>."
            },
            {
              "html": "If <var>container mapping</var> <span class=\"changed\">includes</span> <code>@list</code> and\n              <var>expanded value</var> is not already a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>,\n              convert <var>expanded value</var> to a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>\n              by first setting it to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only\n              <var>expanded value</var> if it is not already an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n              and then by setting it to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing\n              the key-value pair <code>@list</code>-<var>expanded value</var>."
            },
            {
              "html": "If <var>container mapping</var> <span>includes</span>\n              <code>@graph</code>,\n              and includes neither <code>@id</code> nor <code>@index</code>,\n              convert <var>expanded value</var> into an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, if necessary,\n              then convert each value <var>ev</var> in <var>expanded value</var> into a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a>:",
              "rationale": "convert",
              "steps": [
                {
                  "html": "Convert <var>ev</var> into\n                  a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a> by creating a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing the key-value\n                  pair <code>@graph</code>-<var>ev</var>\n                  where <var>ev</var> is represented as an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                }
              ]
            },
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> associated to\n              <var>key</var> indicates that it is a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a>",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>result</var> has no <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create\n                  one and initialize its value to an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
                },
                {
                  "html": "Reference the value of the <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>result</var>\n                  using the variable <var>reverse map</var>."
                },
                {
                  "html": "If <var>expanded value</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, set\n                  it to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing <var>expanded value</var>."
                },
                {
                  "html": "For each <var>item</var> in <var>expanded value</var>",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-reverse-property-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid reverse property value</code></a>\n                      has been detected and processing is aborted."
                    },
                    {
                      "html": "If <var>reverse map</var> has no <var>expanded property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      create one and initialize its value to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                    },
                    {
                      "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>item</var>\n                      to the <var>expanded property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>reverse map</var>\n                      using <code>true</code> for <var>as array</var>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise, <var>key</var> is not a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a>\n              <span class=\"changed\">use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>expanded value</var>\n                to the <var>expanded property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>result</var>\n                using <code>true</code> for <var>as array</var>.</span>"
            }
          ]
        },
        {
          "html": "For each key <var>nesting-key</var> in <var>nests</var>,\n          ordered lexicographically if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>nested values</var> to the value of <var>nesting-key</var>\n              in <var>element</var>, ensuring that it is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
            },
            {
              "html": "For each <var>nested value</var> in <var>nested values</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>nested value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, or any key within\n                  <var>nested value</var> expands to <code>@value</code>, an\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@nest-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @nest value</code></a> error\n                  has been detected and processing is aborted."
                },
                {
                  "html": "Recursively repeat steps <a href=\"https://www.w3.org/TR/json-ld11-api/#alg-expand-each-key-value\">13</a>\n                  and <a href=\"https://www.w3.org/TR/json-ld11-api/#alg-expand-resolve-nest\">14</a>\n                  using <var>nested value</var> for <var>element</var>."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>result</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@value</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "The <var>result</var> must not contain any <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> other than\n              <code class=\"changed\">@direction</code>,\n              <code>@index</code>,\n              <code>@language</code>,\n              <code>@type</code>,\n              and <code>@value</code>.\n              It must not contain an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> if it contains either <code>@language</code> or <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>.\n              Otherwise, an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-value-object\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid value object</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "If the <var>result</var>'s <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              is <code>@json</code>, then the <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> may\n              contain any value, and is treated as a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-json-literal\">JSON literal</a>."
            },
            {
              "html": "Otherwise, if the value of <var>result</var>'s <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is\n              <code>null</code>, or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, return <code>null</code>."
            },
            {
              "html": "Otherwise, if the value of <var>result</var>'s <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> and <var>result</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              <code>@language</code>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-language-tagged-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid language-tagged value</code></a>\n              error has been detected (only <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">strings</a>\n              can be language-tagged) and processing is aborted."
            },
            {
              "html": "Otherwise, if the <var>result</var> has an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              and its value is not an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-typed-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid typed value</code></a>\n              error has been detected and processing is aborted."
            }
          ]
        },
        {
          "html": "Otherwise, if <var>result</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@type</code>\n          and its associated value is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, set it to\n          an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only the associated value."
        },
        {
          "html": "Otherwise, if <var>result</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@set</code>\n          or <code>@list</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "The <var>result</var> must contain at most one other <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              which must be <code>@index</code>. Otherwise, an\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-set-or-list-object\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid set or list object</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "If <var>result</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@set</code>, then\n              set <var>result</var> to the <a data-lt=\"entry\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry's</a> associated value."
            }
          ]
        },
        {
          "html": "If <var>result</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> that contains only the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          <code>@language</code>, <span class=\"changed\">return</span> <code>null</code>."
        },
        {
          "html": "If <var>active property</var> is <code>null</code> or <code>@graph</code>,\n          drop free-floating values as follows:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>result</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> which is empty,\n              or contains only the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> <code>@value</code> or <code>@list</code>,\n              set <var>result</var> to <code>null</code>."
            },
            {
              "html": "Otherwise, if <var>result</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> whose only\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is <code>@id</code>, set <var>result</var> to <code>null</code>.\n              <span class=\"changed\">\n                When the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a> flag is set, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n                containing only the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is retained.</span>"
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "5.2.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x5-2-2-algorithm",
      "html": "The algorithm takes two required and four optional input variables. The\n        required inputs are an <var>active context</var> and a <var>value</var>\n        to be expanded. The optional inputs are two flags,\n        <var>document relative</var> and <var>vocab</var>, that specifying\n        whether <var>value</var> can be interpreted as a <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-6.5\">relative <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> reference</a>\n        against the document's base <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or the\n        <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a>\n        <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>, respectively, and\n        a <var>local context</var> and a map <var>defined</var> to be used when\n        this algorithm is used during <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing</a>.\n        If not passed, the two flags are set to <code>false</code> and\n        <var>local context</var> and <var>defined</var> are initialized to <code>null</code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a> or <code>null</code>,\n          return <var>value</var> as is."
        },
        {
          "html": "If <var>value</var> has the form of a keyword\n          (i.e., it matches the ABNF rule <code>\"@\"1*ALPHA</code> from [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc5234\" title=\"Augmented BNF for Syntax Specifications: ABNF\">RFC5234</a></cite>]),\n          a processor <em class=\"rfc2119\" title=\"SHOULD\">SHOULD</em> generate a warning and return <code>null</code>."
        },
        {
          "html": "If <var>local context</var> is not <code>null</code>, it contains\n          an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> with a key that equals <var>value</var>, and the value of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          for <var>value</var> in <var>defined</var> is not <code>true</code>,\n          invoke the <a href=\"https://www.w3.org/TR/json-ld11-api/#create-term-definition\">Create Term Definition algorithm</a>,\n          passing <var>active context</var>, <var>local context</var>,\n          <var>value</var> as <var>term</var>, and <var>defined</var>. This will ensure that\n          a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> is created for <var>value</var> in\n          <var>active context</var> during <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing</a>."
        },
        {
          "html": "If <var>active context</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for\n          <var>value</var>, and the associated <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>,\n          return that <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>."
        },
        {
          "html": "If <var>vocab</var> is <code>true</code> and the\n          <var>active context</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for\n          <var>value</var>, return the associated <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>."
        },
        {
          "html": "If <var>value</var> contains a colon (<code>:</code>)\n          <span class=\"changed\">anywhere after the first character</span>,\n          it is either\n          an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-compact-iri\">compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, or a\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>:",
          "rationale": "split",
          "steps": [
            {
              "html": "Split <var>value</var> into a <var>prefix</var> and <var>suffix</var>\n              at the first occurrence of a colon (<code>:</code>)."
            },
            {
              "html": "If <var>prefix</var> is underscore (<code>_</code>)\n              or <var>suffix</var> begins with double-forward-slash\n              (<code>//</code>), return <var>value</var> as it is already an\n              <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>."
            },
            {
              "html": "If <var>local context</var> is not <code>null</code>, it\n              contains a <var>prefix</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, and the value\n              of the <var>prefix</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>defined</var>\n              is not <code>true</code>, invoke the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#create-term-definition\">Create Term Definition algorithm</a>,\n              passing <var>active context</var>,\n              <var>local context</var>, <var>prefix</var> as <var>term</var>,\n              and <var>defined</var>. This will ensure that a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> is created for <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-prefix\">prefix</a>\n              in <var>active context</var> during\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing</a>."
            },
            {
              "html": "If <var>active context</var> contains a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a>\n              for <var>prefix</var>\n              <span class=\"changed\">having a non-<code>null</code> <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n                and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> is <code>true</code></span>,\n              return the result of concatenating the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n              associated with <var>prefix</var> and <var>suffix</var>."
            },
            {
              "html": "<span class=\"changed\">If <var>value</var> has the <a href=\"https://tools.ietf.org/html/rfc3987#section-2.2\">form</a> of an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a></span>,\n              return <var>value</var>."
            }
          ]
        },
        {
          "html": "If <var>vocab</var> is <code>true</code>, and\n          <var>active context</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>,\n          return the result of concatenating the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>\n          with <var>value</var>."
        },
        {
          "html": "Otherwise, if <var>document relative</var> is <code>true</code>\n          set <var>value</var> to the result of resolving <var>value</var> against\n          the <a class=\"changed internalDFN\" data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> from <var>active context</var>. Only the basic algorithm in\n          <a href=\"https://tools.ietf.org/html/rfc3986#section-5.2\">section 5.2</a>\n          of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc3986\" title=\"Uniform Resource Identifier (URI): Generic Syntax\">RFC3986</a></cite>] is used; neither\n          <a href=\"https://tools.ietf.org/html/rfc3986#section-6.2.2\">Syntax-Based Normalization</a> nor\n          <a href=\"https://tools.ietf.org/html/rfc3986#section-6.2.3\">Scheme-Based Normalization</a>\n          are performed. Characters additionally allowed in <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> references are treated\n          in the same way that unreserved characters are treated in URI references, per\n          <a href=\"https://tools.ietf.org/html/rfc3987#section-6.5\">section 6.5</a>\n          of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc3987\" title=\"Internationalized Resource Identifiers (IRIs)\">RFC3987</a></cite>]."
        },
        {
          "html": "Return <var>value</var> as is."
        }
      ]
    },
    {
      "name": "5.3.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x5-3-2-algorithm",
      "html": "The algorithm takes three required inputs: an <var>active context</var>,\n        an <var>active property</var>, and a <var>value</var> to expand.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <var>active property</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a>\n          in <var>active context</var> that is <code>@id</code>,\n          <span class=\"changed\">and the <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,</span>\n          return a new\n          <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> where the\n          key is <code>@id</code> and the value is the result\n          <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>value</var>\n          using <code>true</code> for <var>document relative</var>\n          and <code>false</code> for <var>vocab</var>."
        },
        {
          "html": "If <var>active property</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> in\n          <var>active context</var> that is <code>@vocab</code>,\n          <span class=\"changed\">and the <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,</span>\n          return a new\n          <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> where the\n          key is <code>@id</code> and the value is the result of\n          <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-expanding\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> expanding</a></span> <var>value</var>\n          using <code>true</code> for <var>document relative</var>."
        },
        {
          "html": "Otherwise, initialize <var>result</var> to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n          with an <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose value is set to\n          <var>value</var>."
        },
        {
          "html": "If <var>active property</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> in\n          <var>active context</var>,\n          <span class=\"changed\">other than <code>@id</code>, <code>@vocab</code>, or <code>@none</code>,</span>\n          add <code>@type</code> to\n          <var>result</var> and set its value to the value associated with the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a>."
        },
        {
          "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>language</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> for <var>active property</var>\n              in <var>active context</var>, if any, otherwise to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a>\n              of <var>active context</var>."
            },
            {
              "html": "Initialize <var>direction</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a> for <var>active property</var>\n              in <var>active context</var>, if any, otherwise to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>\n              of <var>active context</var>."
            },
            {
              "html": "If <var>language</var> is not <code>null</code>,\n              add <code>@language</code> to <var>result</var> with the value <var>language</var>."
            },
            {
              "html": "If <var>direction</var> is not <code>null</code>,\n              add <code>@direction</code> to <var>result</var> with the value <var>direction</var>."
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "6.1.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x6-1-2-algorithm",
      "html": "The algorithm takes <span class=\"changed\">three required and two optional</span> input variables.\n        The required inputs are an <var>active context</var>,\n        an <var>active property</var>,\n        and an <var>element</var> to be compacted.\n        <span class=\"changed\">The optional inputs are the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a> flag\n          and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flag, used to order\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">map entry</a> keys lexicographically, where noted.\n          If not passed, both flags are set to <code>false</code></span>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>type-scoped context</var> to <var>active context</var>.\n          This is used for compacting values that may be relevant to any previous\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-type-scoped-context\">type-scoped context</a>."
        },
        {
          "html": "If <var>element</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#primitive-data-types\">scalar</a>, it is already in its most\n          compact form, so simply return <var>element</var>."
        },
        {
          "html": "If <var>element</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>result</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
            },
            {
              "html": "For each <var>item</var> in <var>element</var>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>compacted item</var> to the result of using this\n                  algorithm recursively, passing <var>active context</var>,\n                  <var>active property</var>,\n                  <var>item</var> for <var>element</var>,\n                  <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                },
                {
                  "html": "If <var>compacted item</var> is not <code>null</code>, then append\n                  it to <var>result</var>."
                }
              ]
            },
            {
              "html": "If <var>result</var> is empty or contains more than one value,\n              or <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a> is <code>false</code>,\n              <span class=\"changed\">or <var>active property</var> is either <code>@graph</code> or <code>@set</code>,\n              or <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for <var>active property</var> in\n              <var>active context</var> includes either <code>@list</code> or <code>@set</code>,</span>\n              return <var>result</var>."
            },
            {
              "html": "Otherwise, return the value in <var>result</var>."
            }
          ]
        },
        {
          "html": "Otherwise <var>element</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "If <var>active context</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a>,\n          the <var>active context</var> is not propagated.\n          If <var>element</var> does not contain an <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n          and <var>element</var> does not consist of a single <code>@id</code> entry,\n          set <var>active context</var> to <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-previous-context\" class=\"internalDFN\" data-link-type=\"dfn\">previous context</a> from <var>active context</var>,\n          as the scope of a term-scoped <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-context\">context</a> does not apply when processing new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node objects</a>."
        },
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>active property</var> in <var>active context</var>\n          has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var>active context</var> to the result of the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n              passing <var>active context</var>,\n              the value of the <var>active property</var>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a> as <var>local context</var>,\n              <span class=\"changed\">\n                <var>base URL</var> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>active property</var>\n                in <var>active context</var>,\n                and <code>true</code> for <var>override protected</var></span>."
            }
          ]
        },
        {
          "html": "If <var>element</var> has an <code>@value</code> or <code>@id</code>\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> and the result of using the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#value-compaction\">Value Compaction algorithm</a>,\n          passing <var>active context</var>,\n          <var>active property</var>, and <var>element</var> as <var>value</var> is\n          a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#primitive-data-types\">scalar</a>,\n          <span class=\"changed\">or the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>active property</var>\n            has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <code>@json</code>,</span>\n          return that result."
        },
        {
          "html": "If <var>element</var> is a\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>, and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for\n          <var>active property</var> in <var>active context</var> <span class=\"changed\">includes</span> <code>@list</code>,\n          return the result of using this algorithm recursively, passing\n          <var>active context</var>,\n          <var>active property</var>, value of <code>@list</code>\n          in <var>element</var> for <var>element</var>,\n          <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>\n            and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
        },
        {
          "html": "Initialize <var>inside reverse</var> to <code>true</code> if\n          <var>active property</var> equals <code>@reverse</code>,\n          otherwise to <code>false</code>."
        },
        {
          "html": "Initialize <var>result</var> to an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "If <var>element</var> has an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n          create a new array <var>compacted types</var> initialized\n          by transforming each <var>expanded type</var> of that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          into its compacted form\n          <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded type</var></span>.\n          Then, for each <var>term</var>\n          in <var>compacted types</var> ordered lexicographically:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>term</var> in <var>type-scoped context</var> has a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a>\n              set <var>active context</var> to the result of the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n              passing <var>active context</var> and the value of <var>term</var>'s\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-local-context\">local context</a> in <var>type-scoped context</var> as <var>local context</var>\n              <span class=\"changed\">\n                <var>base URL</var> from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>term</var>\n                in <var>type-scoped context</var>,\n                and <code>false</code> for <var>propagate</var></span>."
            }
          ]
        },
        {
          "html": "For each key <var>expanded property</var> and value <var>expanded value</var>\n          in <var>element</var>, ordered lexicographically by <var>expanded property</var>\n          <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>expanded property</var> is <code>@id</code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>expanded value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,\n                  then initialize <var>compacted value</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded value</var>\n                    with <var>vocab</var> set to <code>false</code></span>."
                },
                {
                  "html": "Initialize <var>alias</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded property</var></span>."
                },
                {
                  "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <var>alias</var> to <var>result</var> whose value is\n                  set to <var>compacted value</var> and continue to the next\n                  <var>expanded property</var>."
                }
              ]
            },
            {
              "html": "If <var>expanded property</var> is <code>@type</code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>expanded value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>,\n                  then initialize <var>compacted value</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded value</var>\n                    using <var>type-scoped context</var> for <var>active context</var></span>."
                },
                {
                  "html": "Otherwise, <var>expanded value</var> must be a\n                  <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>:",
                  "rationale": "initialize",
                  "steps": [
                    {
                      "html": "Initialize <var>compacted value</var> to an empty\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                    },
                    {
                      "html": "For each item <var>expanded type</var> in\n                      <var>expanded value</var>:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set <var>term</var>\n                          <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded type</var>\n                            using <var>type-scoped context</var> for <var>active context</var></span>."
                        },
                        {
                          "html": "Append <var>term</var>, to <var>compacted value</var>."
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "Initialize <var>alias</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded property</var></span>."
                },
                {
                  "html": "Initialize <var>as array</var>\n                  to <code>true</code> if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is <code>json-ld-1.1</code> and\n                  the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for <var>alias</var> in the\n                  <var>active context</var> includes <code>@set</code>,\n                  otherwise to the negation of <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>."
                },
                {
                  "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted value</var>\n                  to the <var>alias</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>result</var>\n                  using <var>as array</var>."
                },
                {
                  "html": "Continue to the next <var>expanded property</var>."
                }
              ]
            },
            {
              "html": "If <var>expanded property</var> is <code>@reverse</code>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>compacted value</var> to the result of using this\n                  algorithm recursively, passing <var>active context</var>,\n                  <code>@reverse</code> for\n                  <var>active property</var>, <var>expanded value</var>\n                  for <var>element</var>,\n                  <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                },
                {
                  "html": "For each <var>property</var> and <var>value</var> in <var>compacted value</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>property</var> in the\n                      <var>active context</var> indicates that <var>property</var> is\n                      a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a>",
                      "rationale": "initialize",
                      "steps": [
                        {
                          "html": "Initialize <var>as array</var>\n                          to <code>true</code> if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for <var>property</var> in the\n                          <var>active context</var> includes <code>@set</code>,\n                          otherwise the negation of <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>."
                        },
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>value</var>\n                          to the <var>property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>result</var>\n                          using <var>as array</var>."
                        },
                        {
                          "html": "Remove the <var>property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from\n                          <var>compacted value</var>."
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "If <var>compacted value</var> has some remaining <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">map entries</a>, i.e.,\n                  it is not an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>:",
                  "rationale": "initialize",
                  "steps": [
                    {
                      "html": "Initialize <var>alias</var>\n                      <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@reverse</code></span>."
                    },
                    {
                      "html": "Set the value of the <var>alias</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>result</var> to\n                      <var>compacted value</var>."
                    }
                  ]
                },
                {
                  "html": "Continue with the next <var>expanded property</var> from <var>element</var>."
                }
              ]
            },
            {
              "html": "If <var>expanded property</var> is <code>@preserve</code>\n              then:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>compacted value</var> to the result of using this\n                  algorithm recursively, passing\n                  <var>active context</var>,\n                  <var>active property</var>,\n                  <var>expanded value</var> for <var>element</var>,\n                  <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>."
                },
                {
                  "html": "Add <var>compacted value</var> as the value of <code>@preserve</code>\n                  in <var>result</var> unless <var>expanded value</var> is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                }
              ]
            },
            {
              "html": "If <var>expanded property</var> is <code>@index</code> and\n              <var>active property</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a>\n              in <var>active context</var> that <span class=\"changed\">includes</span> <code>@index</code>,\n              then the compacted result will be inside of an <code>@index</code>\n              container, drop the <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> by continuing\n              to the next <var>expanded property</var>."
            },
            {
              "html": "Otherwise, if <var>expanded property</var> is\n              <code class=\"changed\">@direction</code>,\n              <code>@index</code>,\n              <code>@language</code>,\n              or <code>@value</code>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>alias</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded property</var></span>."
                },
                {
                  "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <var>alias</var> to <var>result</var> whose value is\n                  set to <var>expanded value</var> and continue with the next\n                  <var>expanded property</var>."
                }
              ]
            },
            {
              "html": "If <var>expanded value</var> is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>item active property</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded property</var>\n                    using <var>expanded value</var> for <var>value</var>\n                    and <var>inside reverse</var> for <var>reverse</var></span>."
                },
                {
                  "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>item active property</var>\n                  in the <var>active context</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-nest-value\" class=\"internalDFN\" data-link-type=\"dfn\">nest value</a>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> (<var>nest term</var>):",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>nest term</var> is not <code>@nest</code>,\n                      or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> in the <var>active context</var> that expands to <code>@nest</code>,\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@nest-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @nest value</code></a>\n                      error has been detected, and processing is aborted."
                    },
                    {
                      "html": "If <var>result</var> does not have a <var>nest term</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      initialize it to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
                    },
                    {
                      "html": "Initialize <var>nest result</var> to the value of <var>nest term</var> in <var>result</var>."
                    }
                  ]
                },
                {
                  "html": "Otherwise, initialize <var>nest result</var> to <var>result</var>."
                },
                {
                  "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                  to the <var>item active property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>nest result</var>\n                  using <code>true</code> for <var>as array</var>."
                }
              ]
            },
            {
              "html": "At this point, <var>expanded value</var> must be an\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> due to the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#expansion-algorithm\">Expansion algorithm</a>.\n              For each item <var>expanded item</var> in <var>expanded value</var>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>item active property</var>\n                  <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <var>expanded property</var>\n                    using <var>expanded item</var> for <var>value</var>\n                    and <var>inside reverse</var> for <var>reverse</var></span>."
                },
                {
                  "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> for <var>item active property</var>\n                  in the <var>active context</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-nest-value\" class=\"internalDFN\" data-link-type=\"dfn\">nest value</a>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> (<var>nest term</var>):",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>nest term</var> is not <code>@nest</code>,\n                      or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> in the <var>active context</var> that expands to <code>@nest</code>,\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-@nest-value\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid @nest value</code></a>\n                      error has been detected, and processing is aborted."
                    },
                    {
                      "html": "If <var>result</var> does not have a <var>nest term</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      initialize it to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
                    },
                    {
                      "html": "Initialize <var>nest result</var> to the value of <var>nest term</var> in <var>result</var>."
                    }
                  ]
                },
                {
                  "html": "Otherwise, initialize <var>nest result</var> to <var>result</var>."
                },
                {
                  "html": "Initialize <var>container</var> to <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for\n                  <var>item active property</var> in <var>active context</var>,\n                  or to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, if there is no such <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a>."
                },
                {
                  "html": "Initialize <var>as array</var>\n                  to <code>true</code> if <var>container</var> includes <code>@set</code>,\n                  or if <var>item active property</var> is <code>@graph</code> or <code>@list</code>,\n                  otherwise the negation of <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>."
                },
                {
                  "html": "Initialize <var>compacted item</var> to the result of using\n                  this algorithm recursively, passing\n                  <var>active context</var>,\n                  <var>item active property</var> for <var>active property</var>,\n                  <var>expanded item</var> for <var>element</var>,\n                  <span class=\"changed\">along with the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>\n                    and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flags</span>.\n                  If <var>expanded item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a> or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a>,\n                  use the value of the <code>@list</code> <span class=\"changed\">or <code>@graph</code></span> entries,\n                  respectively, for <var>element</var> instead of <var>expanded item</var>."
                },
                {
                  "html": "If <var>expanded item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>compacted item</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n                      then set <var>compacted item</var> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only\n                      <var>compacted item</var>."
                    },
                    {
                      "html": "If <var>container</var> does not include <code>@list</code>:",
                      "rationale": "convert",
                      "steps": [
                        {
                          "html": "Convert <var>compacted item</var> to a\n                          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a> by setting it to a\n                          <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                          where the key is the result of\n                          <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@list</code></span>\n                          and the value is the original <var>compacted item</var>."
                        },
                        {
                          "html": "If <var>expanded item</var> contains the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                          <code>@index</code>-<var>value</var>, then add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                          to <var>compacted item</var> where the key is the\n                          result of\n                          <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@index</code></span>\n                          and value is <var>value</var>."
                        },
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                          to the <var>item active property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in\n                          <var>nest result</var>\n                          using <var>as array</var>."
                        }
                      ]
                    },
                    {
                      "html": "Otherwise, set the value of the <var>item active property</var> entry\n                      in <var>nest result</var> to <var>compacted item</var>."
                    }
                  ]
                },
                {
                  "html": "If <var>expanded item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>container</var> includes <code>@graph</code> and <code>@id</code>:",
                      "rationale": "initialize",
                      "steps": [
                        {
                          "html": "Initialize <var>map object</var> to the value of <var>item active property</var>\n                          in <var>nest result</var>,\n                          initializing it to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, if necessary."
                        },
                        {
                          "html": "Initialize <var>map key</var>\n                          <span class=\"changed\">by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a>\n                            the value of <code>@id</code> in <var>expanded item</var>\n                            or <code>@none</code> if no such value exists\n                            with <var>vocab</var> set to <code>false</code>\n                            if there is an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>expanded item</var></span>."
                        },
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                          to the <var>map key</var> entry in <var>map object</var>\n                          using <var>as array</var>."
                        }
                      ]
                    },
                    {
                      "html": "Otherwise, if <var>container</var> includes <code>@graph</code> and <code>@index</code>\n                      and <var>expanded item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-simple-graph-object\">simple graph object</a>:",
                      "rationale": "initialize",
                      "steps": [
                        {
                          "html": "Initialize <var>map object</var> to the value of <var>item active property</var>\n                          in <var>nest result</var>,\n                          initializing it to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, if necessary."
                        },
                        {
                          "html": "Initialize <var>map key</var> the value of <code>@index</code> in\n                          <var>expanded item</var> or <code>@none</code>, if no such\n                          value exists."
                        },
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                          to the <var>map key</var> entry in <var>map object</var>\n                          using <var>as array</var>."
                        }
                      ]
                    },
                    {
                      "html": "Otherwise, if <var>container</var> includes <code>@graph</code>\n                      and <var>expanded item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-simple-graph-object\">simple graph object</a>\n                      the value cannot be represented as a map object.",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>compacted item</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                          with more than one value, it cannot be directly represented,\n                          as multiple objects would be interpreted as different named graphs.\n                          Set <var>compacted item</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>,\n                          containing the key\n                          from <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@included</code></span>\n                          and the original <var>compacted item</var> as the value."
                        },
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                          to the <var>item active property</var> entry in <var>nest result</var>\n                          using <var>as array</var>."
                        }
                      ]
                    },
                    {
                      "html": "Otherwise, <var>container</var> does not include <code>@graph</code>\n                      or otherwise does not match one of the previous cases.",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set <var>compacted item</var> to a new map containing\n                          the key\n                          from <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@graph</code></span>\n                          using the original <var>compacted item</var> as a value."
                        },
                        {
                          "html": "If expanded item contains an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                          add an entry in <var>compacted item</var> using the key\n                          from <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@id</code></span>\n                          using the value\n                          of <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> the value of <code>@id</code> in <var>expanded item</var>\n                            using <code>false</code> for <var>vocab</var></span>."
                        },
                        {
                          "html": "If expanded item contains an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                          add an entry in <var>compacted item</var> using the key\n                          from <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@index</code></span>\n                          and the value of <code>@index</code> in <var>expanded item</var>."
                        },
                        {
                          "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                          to the <var>item active property</var> entry in <var>nest result</var>\n                          using <var>as array</var>."
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<span class=\"changed\">Otherwise</span>, if <var>container</var> <span class=\"changed\">includes</span> <code>@language</code>,\n                  <code>@index</code>, <span class=\"changed\"><code>@id</code>,\n                    or <code>@type</code></span>\n                    <span class=\"changed\">and <var>container</var> does not include <code>@graph</code></span>:",
                  "rationale": "initialize",
                  "steps": [
                    {
                      "html": "Initialize <var>map object</var> to the value of <var>item active property</var>\n                      in <var>nest result</var>,\n                      initializing it to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, if necessary."
                    },
                    {
                      "html": "Initialize <var>container key</var>\n                      by <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a></span>\n                      either <code>@language</code>, <code>@index</code>, <code>@id</code>, or <code>@type</code>\n                      based on the contents of <var>container</var>."
                    },
                    {
                      "html": "Initialize <var>index key</var> to the value of <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-index-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">index mapping</a> in\n                      the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> associated with <var>item active property</var> in <var>active context</var>,\n                      or <code>@index</code>, if no such value exists."
                    },
                    {
                      "html": "If <var>container</var> includes <code>@language</code> and\n                      <var>expanded item</var> contains a\n                      <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, then set <var>compacted item</var>\n                      to the value associated with its <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>.\n                      Set <var>map key</var> to the value of <code>@language</code> in <var>expanded item</var>, if any."
                    },
                    {
                      "html": "Otherwise, if <var>container</var> includes <code>@index</code>\n                      and <var>index key</var> is <code>@index</code>,\n                      set <var>map key</var> to the value of <code>@index</code> in <var>expanded item</var>, if any."
                    },
                    {
                      "html": "Otherwise, if <var>container</var> includes <code>@index</code>\n                      and <var>index key</var> is not <code>@index</code>:",
                      "rationale": "reinitialize",
                      "steps": [
                        {
                          "html": "Reinitialize <var>container key</var> by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a>\n                          <var>index key</var>."
                        },
                        {
                          "html": "Set <var>map key</var> to the first value of <var>container key</var> in <var>compacted item</var>, if any."
                        },
                        {
                          "html": "If there are remaining values in <var>compacted item</var>\n                          for <var>container key</var>, use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to\n                          add those remaining values to the <var>container key</var> in <var>compacted item</var>.\n                          Otherwise, remove that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>compacted item</var>."
                        }
                      ]
                    },
                    {
                      "html": "Otherwise, if <var>container</var> includes <code>@id</code>, set\n                      <var>map key</var> to the value of <var>container key</var> in\n                      <var>compacted item</var> and remove <var>container key</var> from <var>compacted item</var>."
                    },
                    {
                      "html": "Otherwise, if <var>container</var> includes <code>@type</code>:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set <var>map key</var> to the first value of <var>container key</var> in <var>compacted item</var>, if any."
                        },
                        {
                          "html": "If there are remaining values in <var>compacted item</var>\n                          for <var>container key</var>, use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to\n                          add those remaining values to the <var>container key</var> in <var>compacted item</var>."
                        },
                        {
                          "html": "Otherwise, remove that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>compacted item</var>."
                        },
                        {
                          "html": "If <var>compacted item</var> contains a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> with a key expanding\n                          to <code>@id</code>, set <var>compacted item</var>\n                          to the result of using\n                          this algorithm recursively, passing\n                          <var>active context</var>,\n                          <var>item active property</var> for <var>active property</var>,\n                          and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> composed of the single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> for <code>@id</code> from <var>expanded item</var> for <var>element</var>."
                        }
                      ]
                    },
                    {
                      "html": "If <var>map key</var> is <code>null</code>,\n                      set it to the result of\n                      <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@none</code></span>."
                    },
                    {
                      "html": "Use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                      to the <var>map key</var> entry in <var>map object</var>\n                      using <var>as array</var>."
                    }
                  ]
                },
                {
                  "html": "Otherwise, use <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-add-value\" class=\"internalDFN\" data-link-type=\"dfn\">add value</a> to add <var>compacted item</var>\n                  to the <var>item active property</var> entry in <var>nest result</var>\n                  using <var>as array</var>."
                }
              ]
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "6.2.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x6-2-2-algorithm",
      "html": "This algorithm takes <span class=\"changed\">two</span> required inputs and three optional inputs.\n        The required inputs are an <var>active context</var>,\n        and the <var>var</var> to be compacted.\n        The optional inputs are a <var>value</var> associated with the <var>var</var>,\n        a <var>vocab</var> flag which specifies whether the passed <var>var</var>\n        should be compacted using the <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>,\n        and a <var>reverse</var> flag which specifies whether a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-reverse-property\" class=\"internalDFN\" data-link-type=\"dfn\">reverse property</a> is being compacted.\n        If not passed, <var>value</var> is set to <code>null</code>\n        and both <var>vocab</var> and <var>reverse</var> are both set to <code>false</code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>var</var> is <code>null</code>, return <code>null</code>."
        },
        {
          "html": "If the <var>active context</var> has a <code>null</code>\n          <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a>,\n          set <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> in <var>active context</var>\n          to the result of calling the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#inverse-context-creation\">Inverse Context Creation algorithm</a>\n          using <var>active context</var>."
        },
        {
          "html": "Initialize <var>inverse context</var> to the value of\n          <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> in <var>active context</var>."
        },
        {
          "html": "If <var>vocab</var> is <code>true</code> and <var>var</var> is an\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>inverse context</var>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>default language</var>\n              based on the <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a>\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a>, normalized to lower case and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>\n                  is not <code>null</code>, to the concatenation of\n                  the <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a>\n                  and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>, separated by an underscore (<code>\"_\"</code>),\n                  normalized to lower case."
                },
                {
                  "html": "Otherwise, to the <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a>,\n                  if it has one,\n                  normalized to lower case,\n                  otherwise to <code>@none</code>."
                }
              ]
            },
            {
              "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing an <code>@preserve</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              use the first element from the value of <code>@preserve</code> as <var>value</var>."
            },
            {
              "html": "Initialize <var>containers</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. This\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> will be used to keep track of an ordered list of\n              preferred <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> for a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>,\n              based on what is compatible with <var>value</var>."
            },
            {
              "html": "Initialize <var>type/language</var> to <code>@language</code>,\n              and <var>type/language value</var> to <code>@null</code>. These two\n              variables will keep track of the preferred\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> or <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> for\n              a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a>, based on what is compatible with <var>value</var>."
            },
            {
              "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              and <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a>\n              then append the values <code>@index</code> and <code>@index@set</code> to <var>containers</var>."
            },
            {
              "html": "If <var>reverse</var> is <code>true</code>, set <var>type/language</var>\n              to <code>@type</code>, <var>type/language value</var> to\n              <code>@reverse</code>, and append <code>@set</code> to <var>containers</var>."
            },
            {
              "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>, then set\n              <var>type/language</var> and <var>type/language value</var>\n              to the most specific values that work for all items in\n              the list as follows:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <code>@index</code> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>value</var>, then\n                  append <code>@list</code> to <var>containers</var>."
                },
                {
                  "html": "Initialize <var>list</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> associated\n                  with the <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>value</var>."
                },
                {
                  "html": "Initialize <var>common type</var> and <var>common language</var> to <code>null</code>. If\n                  <var>list</var> is empty, set <var>common language</var> to\n                  <var>default language</var>."
                },
                {
                  "html": "For each <var>item</var> in <var>list</var>:",
                  "rationale": "initialize",
                  "steps": [
                    {
                      "html": "Initialize <var>item language</var> to <code>@none</code> and\n                      <var>item type</var> to <code>@none</code>."
                    },
                    {
                      "html": "If <var>item</var> contains an <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>item</var> contains an <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                          then set <var>item language</var> to the concatenation of\n                          the <var>item</var>'s <code>@language</code> entry (if any)\n                          the <var>item</var>'s <code>@direction</code>, separated by an underscore (<code>\"_\"</code>),\n                          normalized to lower case."
                        },
                        {
                          "html": "Otherwise, if <var>item</var> contains an <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                          then set <var>item language</var> to its associated value,\n                          normalized to lower case."
                        },
                        {
                          "html": "Otherwise, if <var>item</var> contains a\n                          <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, set <var>item type</var> to its\n                          associated value."
                        },
                        {
                          "html": "Otherwise, set <var>item language</var> to\n                          <code>@null</code>."
                        }
                      ]
                    },
                    {
                      "html": "Otherwise, set <var>item type</var> to <code>@id</code>."
                    },
                    {
                      "html": "If <var>common language</var> is <code>null</code>,\n                      set <var>common language</var> to <var>item language</var>."
                    },
                    {
                      "html": "Otherwise, if <var>item language</var> does not equal\n                      <var>common language</var> and <var>item</var> contains a\n                      <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, then set <var>common language</var>\n                      to <code>@none</code> because list items have conflicting\n                      languages."
                    },
                    {
                      "html": "If <var>common type</var> is <code>null</code>,\n                      set <var>common type</var> to <var>item type</var>."
                    },
                    {
                      "html": "Otherwise, if <var>item type</var> does not equal\n                      <var>common type</var>, then set <var>common type</var>\n                      to <code>@none</code> because list items have conflicting\n                      types."
                    },
                    {
                      "html": "If <var>common language</var> is <code>@none</code> and\n                      <var>common type</var> is <code>@none</code>, then\n                      stop processing items in the list because it has been\n                      detected that there is no common language or type amongst\n                      the items."
                    }
                  ]
                },
                {
                  "html": "If <var>common language</var> is <code>null</code>,\n                  set <var>common language</var> to <code>@none</code>."
                },
                {
                  "html": "If <var>common type</var> is <code>null</code>,\n                  set <var>common type</var> to <code>@none</code>."
                },
                {
                  "html": "If <var>common type</var> is not <code>@none</code> then set\n                  <var>type/language</var> to <code>@type</code> and\n                  <var>type/language value</var> to <var>common type</var>."
                },
                {
                  "html": "Otherwise, set <var>type/language value</var> to\n                  <var>common language</var>."
                }
              ]
            },
            {
              "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-graph-object\">graph object</a>,\n              prefer a mapping most appropriate for the particular value.",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>value</var> contains an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  append the values <code>@graph@index</code> and <code>@graph@index@set</code>\n                  to <var>containers</var>."
                },
                {
                  "html": "If <var>value</var> contains an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  append the values <code>@graph@id</code> and <code>@graph@id@set</code>\n                  to <var>containers</var>."
                },
                {
                  "html": "Append the values <code>@graph</code> <code>@graph@set</code>,\n                  and <code>@set</code>\n                  to <var>containers</var>."
                },
                {
                  "html": "If <var>value</var> does not contain an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  append the values <code>@graph@index</code> and <code>@graph@index@set</code>\n                  to <var>containers</var>."
                },
                {
                  "html": "If the <var>value</var> does not contain an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  append the values <code>@graph@id</code> and <code>@graph@id@set</code>\n                  to <var>containers</var>."
                },
                {
                  "html": "Append the values <code>@index</code> and <code>@index@set</code>\n                  to <var>containers</var>."
                },
                {
                  "html": "Set <var>type/language</var> to <code>@type</code>\n                  and set <var>type/language value</var> to <code>@id</code>."
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>value</var> contains an <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                      and does not contain an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      then set <var>type/language value</var> to the concatenation of\n                      the <var>value</var>'s <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> (if any)\n                      and the <var>value</var>'s <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, separated by an underscore (<code>\"_\"</code>),\n                      normalized to lower case.\n                      Append <code>@language</code> and <code>@language@set</code> to <var>containers</var>."
                    },
                    {
                      "html": "Otherwise, if <var>value</var> contains an <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                      and does not contain an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      then set <var>type/language value</var> to\n                      the value of <code>@language</code> normalized to lower case,\n                      and append <code>@language</code>,\n                      <span class=\"changed\">and <code>@language@set</code></span> to\n                      <var>containers</var>."
                    },
                    {
                      "html": "Otherwise, if <var>value</var> contains an\n                      <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, then set <var>type/language value</var> to\n                      its associated value and set <var>type/language</var> to\n                      <code>@type</code>."
                    }
                  ]
                },
                {
                  "html": "Otherwise, set <var>type/language</var> to <code>@type</code>\n                  and set <var>type/language value</var> to <code>@id</code>,\n                  <span class=\"changed\">and append <code>@id</code>, <code>@id@set</code>,\n                    <code>@type</code>, and <code>@set@type</code></span>,\n                  to <var>containers</var>."
                },
                {
                  "html": "Append <code>@set</code> to <var>containers</var>."
                }
              ]
            },
            {
              "html": "Append <code>@none</code> to <var>containers</var>. This represents\n              the non-existence of a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a>, and it will\n              be the last <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> value to be checked as it\n              is the most generic."
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is not <code>json-ld-1.0</code> and <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n              or does not contain an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              append <code>@index</code> and <code>@index@set</code> to <var>containers</var>."
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is not <code>json-ld-1.0</code> and\n              <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing only an <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              append <code>@language</code> and <code>@language@set</code> to <var>containers</var>."
            },
            {
              "html": "If <var>type/language value</var> is <code>null</code>,\n              set <var>type/language value</var> to <code>@null</code>.\n              This is the key under which <code>null</code> values\n              are stored in the <var>inverse context</var> <var>entry</var>."
            },
            {
              "html": "Initialize <var>preferred values</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>.\n              This <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> will indicate, in order, the preferred values for\n              a <a data-lt=\"term\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term's</a> <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> or\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a>."
            },
            {
              "html": "If <var>type/language value</var> is <code>@reverse</code>, append\n              <code>@reverse</code> to <var>preferred values</var>."
            },
            {
              "html": "If <var>type/language value</var> is <code>@id</code> or <code>@reverse</code> and\n              <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> containing an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the result of\n                  <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a>\n                    the value of the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>value</var></span>\n                  has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in the <var>active context</var>\n                  with an <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> that equals the value of the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>value</var>,\n                  then append <code>@vocab</code>, <code>@id</code>, and\n                  <code>@none</code>, in that order, to <var>preferred values</var>."
                },
                {
                  "html": "Otherwise, append <code>@id</code>, <code>@vocab</code>, and\n                  <code>@none</code>, in that order, to <var>preferred values</var>."
                }
              ]
            },
            {
              "html": "Otherwise, append <var>type/language value</var> and <code>@none</code>, in\n              that order, to <var>preferred values</var>.\n              <span class=\"changed\">If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>\n                with an empty <var>array</var> as the value of <code>@list</code>,\n                set <var>type/language</var> to <code>@any</code>.</span>"
            },
            {
              "html": "Append <code>@any</code> to <var>preferred values</var>."
            },
            {
              "html": "If <var>preferred values</var>\n              contains any entry having an underscore (<code>\"_\"</code>),\n              append the substring of that entry from the underscore to the end of the string\n              to <var>preferred values</var>."
            },
            {
              "html": "Initialize <var>term</var> to the result of the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#term-selection\">Term Selection algorithm</a>, passing\n              <var>var</var>, <var>containers</var>,\n              <var>type/language</var>, and <var>preferred values</var>."
            },
            {
              "html": "If <var>term</var> is not <code>null</code>, return <var>term</var>."
            }
          ]
        },
        {
          "html": "At this point, there is no simple <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term\">term</a> that <var>var</var>\n          can be compacted to. If <var>vocab</var> is <code>true</code> and\n          <var>active context</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>var</var> begins with the\n              <a data-lt=\"vocabulary mapping\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping's</a> value\n              but is longer, then initialize <var>suffix</var> to the substring\n              of <var>var</var> that does not match. If <var>suffix</var> does not\n              have a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <var>active context</var>,\n              then return <var>suffix</var>."
            }
          ]
        },
        {
          "html": "The <var>var</var> could not be compacted using the\n          <a data-lt=\"active context\" data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context's</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-vocabulary-mapping\">vocabulary mapping</a>.\n          Try to create a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-compact-iri\">compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, starting by initializing\n          <var>compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></var> to <code>null</code>. This variable will be used to\n          store the created <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-compact-iri\">compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>, if any."
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> <var>definition</var> in <var>active context</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> of <var>definition</var> is <code>null</code>,\n              its <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> equals <var>var</var>,\n              its <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a> is not a substring at the beginning of\n              <var>var</var>,\n              <span class=\"changed\"> or <var>definition</var> does not have\n                a <code>true</code> <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a>,</span>\n              <var>definition</var>'s key cannot be used as a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-prefix\">prefix</a>.\n              Continue with the next <var>definition</var>."
            },
            {
              "html": "Initialize <var>candidate</var> by concatenating <var>definition</var> key,\n              a colon (<code>:</code>), and the substring of <var>var</var>\n              that follows after the value of the\n              <var>definition</var>'s <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>."
            },
            {
              "html": "If either <var>compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></var> is <code>null</code>, <var>candidate</var> is\n              shorter or the same length but lexicographically less than\n              <var>compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></var> and <var>candidate</var> does not have a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> in <var>active context</var>, or if that\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-term-definition\">term definition</a> has an <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-mapping\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> mapping</a>\n              that equals <var>var</var> and <var>value</var> is <code>null</code>,\n              set <var>compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></var> to <var>candidate</var>."
            }
          ]
        },
        {
          "html": "If <var>compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></var> is not <code>null</code>, return <var>compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></var>."
        },
        {
          "html": "To ensure that the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> <var>var</var> is\n          not confused with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-compact-iri\">compact <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>,\n          if the <a href=\"https://tools.ietf.org/html/rfc3986#section-3.1\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> scheme</a> of <var>var</var>\n          matches any term in <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a> with <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-prefix-flag\" class=\"internalDFN\" data-link-type=\"dfn\">prefix flag</a> set to <code>true</code>,\n          and <var>var</var> has no <a href=\"https://tools.ietf.org/html/rfc3986#section-3.2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> authority</a> (preceded by double-forward-slash (<code>//</code>),\n          an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-iri-confused-with-prefix\" class=\"internalDFN\" data-link-type=\"idl\"><code><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> confused with prefix</code></a> error has been detected,\n          and processing is aborted."
        },
        {
          "html": "If <var>vocab</var> is <code>false</code>,\n          transform <var>var</var> to a <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-6.5\">relative <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> reference</a> using\n          the <span class=\"changed\"><a data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" class=\"internalDFN\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> from <var>active context</var>, if it exists</span>."
        },
        {
          "html": "Finally, return <var>var</var> as is."
        }
      ]
    },
    {
      "name": "6.3.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x6-3-2-algorithm",
      "html": "This algorithm has <span class=\"changed\">three</span> required inputs: an <var>active context</var>,\n        an <var>active property</var>, and a <var>value</var>\n        to be compacted.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>result</var> to a copy of <var>value</var>."
        },
        {
          "html": "If the <var>active context</var> has a <code>null</code>\n          <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a>,\n          set <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> in <var>active context</var>\n          to the result of calling the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#inverse-context-creation\">Inverse Context Creation algorithm</a>\n          using <var>active context</var>."
        },
        {
          "html": "Initialize <var>inverse context</var> to the value of\n          <a data-lt=\"context-inverse\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-inverse\" class=\"internalDFN\" data-link-type=\"dfn\">inverse context</a> in <var>active context</var>."
        },
        {
          "html": "Initialize <var>language</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-language-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">language mapping</a> for <var>active property</var>\n          in <var>active context</var>, if any, otherwise to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-default-language\">default language</a>\n          of <var>active context</var>."
        },
        {
          "html": "Initialize <var>direction</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-direction-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">direction mapping</a> for <var>active property</var>\n          in <var>active context</var>, if any, otherwise to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-base-direction\">default base direction</a>\n          of <var>active context</var>."
        },
        {
          "html": "If <var>value</var> has an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          and has no other <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> other than <code>@index</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <var>active property</var>\n              is set to <code>@id</code>, set <var>result</var> to the result of\n              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a>\n                the value associated with the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                using <code>false</code> for <var>vocab</var></span>."
            },
            {
              "html": "Otherwise, if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <var>active property</var>\n              is set to <code>@vocab</code>, set <var>result</var> to the result of\n              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a>\n                the value associated with the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a></span>."
            }
          ]
        },
        {
          "html": "Otherwise, if <var>value</var> has an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose\n          value matches the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <var>active property</var>,\n          set <var>result</var> to the value associated with the <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          of <var>value</var>."
        },
        {
          "html": "Otherwise, if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <var>active property</var> is <code>@none</code>,\n          or <var>value</var> has an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n          and the value of <code>@type</code> in <var>value</var> does not match the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-type-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">type mapping</a> of <var>active property</var>,\n          leave <var>value</var> as is, as value compaction is disabled.",
          "rationale": "replace",
          "steps": [
            {
              "html": "Replace any value of <code>@type</code> in <var>result</var> with the result of\n              <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a></span>\n              the value of the <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
            }
          ]
        },
        {
          "html": "Otherwise, if the value of the <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>value</var> has an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> associated to <var>active property</var>\n              includes <code>@index</code>,\n              or if <var>value</var> has no <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              set <var>result</var> to the value associated with the <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
            }
          ]
        },
        {
          "html": "Otherwise, if <var>value</var> has an <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          whose value exactly matches <var>language</var>,\n          <span class=\"changed\">using a case-insensitive comparison</span>\n          if it is not <code>null</code>, or is not present, if <var>language</var> is <code>null</code>,\n          <span class=\"changed\">and the <var>value</var> has an <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n            whose value exactly matches <var>direction</var>,\n            if it is not <code>null</code>, or is not present, if <var>direction</var> is <code>null</code></span>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>value</var> has an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-container-mapping\" class=\"internalDFN\" data-link-type=\"dfn\">container mapping</a> associated to <var>active property</var>\n              includes <code>@index</code>,\n              or <var>value</var> has no <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              set <var>result</var> to the value associated with the <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
            }
          ]
        },
        {
          "html": "If <var>result</var> is a <var>map</var>,\n          replace each key in <var>result</var> with the result of\n          <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> that key</span>."
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "7.1.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x7-1-2-algorithm",
      "html": "This algorithm uses the\n        <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">Generate Blank Node Identifier algorithm</a>\n        to generate new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifiers</a>\n        and relabel existing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifiers</a>.\n        The <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">Generate Blank Node Identifier algorithm</a>\n        maintains an <var>identifier map</var>\n        <span class=\"changed\">to ensure that blank node identifiers in the source\n          document are consistently remapped to new blank node identifiers\n          avoiding collisions.</span>\n        Thus, before this algorithm is run, the <var>identifier map</var> is reset.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>node map</var> to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of\n          a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose key is <code>@default</code> and whose value is\n          an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "Perform the <a href=\"https://www.w3.org/TR/json-ld11-api/#node-map-generation\">Node Map Generation algorithm</a>, passing\n          <var>element</var> and <var>node map</var>."
        },
        {
          "html": "Initialize <var>default graph</var> to the value of the <code>@default</code>\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node map</var>, which is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> representing\n          the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-default-graph\">default graph</a>."
        },
        {
          "html": "For each key-value pair <var>graph name</var>-<var>graph</var> in <var>node map</var>\n          where <var>graph name</var> is not <code>@default</code>,\n          <span class=\"changed\">ordered lexicographically by <var>graph name</var>\n          if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>,\n          perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>default graph</var> does not have a <var>graph name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create\n              one and initialize its value to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of an\n              <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose value is set to <var>graph name</var>."
            },
            {
              "html": "Reference the value associated with the <var>graph name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in\n              <var>default graph</var> using the variable <var>entry</var>."
            },
            {
              "html": "Add an <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>entry</var> and set it to an\n              empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
            },
            {
              "html": "For each <var>id</var>-<var>node</var> pair in <var>graph</var> ordered lexicographically by <var>id</var>\n              <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>,\n              add <var>node</var> to the <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>entry</var>,\n              unless the only <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var> is <code>@id</code>."
            }
          ]
        },
        {
          "html": "Initialize an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>flattened</var>."
        },
        {
          "html": "For each <var>id</var>-<var>node</var> pair in <var>default graph</var> ordered lexicographically by <var>id</var>\n          <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>,\n          add <var>node</var> to <var>flattened</var>,\n          unless the only <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var> is <code>@id</code>."
        },
        {
          "html": "Return <var>flattened</var>."
        }
      ]
    },
    {
      "name": "7.2.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x7-2-2-algorithm",
      "html": "The algorithm takes as input an expanded JSON-LD document <var>element</var> and a reference to\n        a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>node map</var>. Furthermore it has the optional parameters\n        <var>active graph</var> (which defaults to <code>@default</code>), an <var>active subject</var>,\n        <var>active property</var>, and a reference to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>list</var>. If\n        not passed, <var>active subject</var>, <var>active property</var>, and <var>list</var> are\n        set to <code>null</code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>element</var> is an array, process each <var>item</var> in <var>element</var>\n          as follows and then return:",
          "rationale": "run",
          "steps": [
            {
              "html": "Run this algorithm recursively by passing <var>item</var> for <var>element</var>,\n              <var>node map</var>, <var>active graph</var>, <var>active subject</var>,\n              <var>active property</var>, and <var>list</var>."
            }
          ]
        },
        {
          "html": "Otherwise <var>element</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>. Reference the\n          <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> which is the value of the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-active-graph\" class=\"internalDFN\" data-link-type=\"dfn\">active graph</a>\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node map</var> using the variable <var>graph</var>. If the\n          <var>active subject</var> is <code>null</code>, set <var>node</var> to <code>null</code>\n          otherwise reference the <var>active subject</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>graph</var> using the\n          variable <var>subject node</var>."
        },
        {
          "html": "For each <var>item</var> in the <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>element</var>,\n          if any, or for the value of <code>@type</code>, if the value of <code>@type</code> exists and is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, replace it with a newly\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">generated blank node identifier</a>\n              passing <var>item</var> for <var>identifier</var>."
            }
          ]
        },
        {
          "html": "If <var>element</var> has an <code>@value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>list</var> is <code>null</code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>subject node</var> does not have an <var>active property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and initialize its value to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                  containing <var>element</var>."
                },
                {
                  "html": "Otherwise, compare <var>element</var> against every item in the\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> associated with the <var>active property</var>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>subject node</var>. If there is no item equivalent to <var>element</var>,\n                  append <var>element</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. Two\n                  <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a> are considered\n                  equal if they have equivalent <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\"> map entries</a>."
                }
              ]
            },
            {
              "html": "Otherwise, append <var>element</var> to the <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>list</var>."
            }
          ]
        },
        {
          "html": "Otherwise, if <var>element</var> has an <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, perform\n          the following steps:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize a new <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>result</var> consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              <code>@list</code> whose value is initialized to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
            },
            {
              "html": "Recursively call this algorithm passing the value of <var>element</var>'s\n              <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> for <var>element</var>, <var>node map</var>, <var>active graph</var>,\n              <var>active subject</var>, <var>active property</var>, and\n              <var>result</var> for <var>list</var>."
            },
            {
              "html": "If <var>list</var> is <code>null</code>,\n              append <var>result</var> to the value of the <var>active property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              of <var>subject node</var>."
            },
            {
              "html": "Otherwise, append <var>result</var> to the <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>list</var>."
            }
          ]
        },
        {
          "html": "Otherwise <var>element</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node object</a>, perform\n          the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>element</var> has an <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, set <var>id</var>\n              to its value and remove the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>element</var>. If <var>id</var>\n              is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, replace it with a newly\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">generated blank node identifier</a>\n              passing <var>id</var> for <var>identifier</var>."
            },
            {
              "html": "Otherwise, set <var>id</var> to the result of the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">Generate Blank Node Identifier algorithm</a>\n              passing <code>null</code> for <var>identifier</var>."
            },
            {
              "html": "If <var>graph</var> does not contain an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <var>id</var>, create one and initialize\n              its value to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> whose\n              value is <var>id</var>."
            },
            {
              "html": "Reference the value of the <var>id</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>graph</var> using the\n              variable <var>node</var>."
            },
            {
              "html": "If <var>active subject</var> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>, a reverse property relationship\n              is being processed. Perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>node</var> does not have a <var>active property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and initialize its value to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                  containing <var>active subject</var>."
                },
                {
                  "html": "Otherwise, compare <var>active subject</var> against every item in the\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> associated with the <var>active property</var>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var>. If there is no item equivalent to <var>active subject</var>,\n                  append <var>active subject</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. Two\n                  <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a> are considered\n                  equal if they have equivalent <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">map entries</a>."
                }
              ]
            },
            {
              "html": "Otherwise, if <var>active property</var> is not <code>null</code>, perform the following steps:",
              "rationale": "create",
              "steps": [
                {
                  "html": "Create a new <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>reference</var> consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                  <code>@id</code> whose value is <var>id</var>."
                },
                {
                  "html": "If <var>list</var> is <code>null</code>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>subject node</var> does not have an <var>active property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                      create one and initialize its value to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                      containing <var>reference</var>."
                    },
                    {
                      "html": "Otherwise, compare <var>reference</var> against every item in the\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> associated with the <var>active property</var>\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>subject node</var>. If there is no item equivalent to <var>reference</var>,\n                      append <var>reference</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. Two\n                      <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a> are considered\n                      equal if they have equivalent <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">map entries</a>."
                    }
                  ]
                },
                {
                  "html": "Otherwise, append <var class=\"changed\">reference</var> to the <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>list</var>."
                }
              ]
            },
            {
              "html": "If <var>element</var> has an <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, append\n              each item of its associated <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> to the\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> associated with the <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of\n              <var>node</var> unless it is already in that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. Finally\n              remove the <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>element</var>."
            },
            {
              "html": "If <var>element</var> has an <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, set the <code>@index</code>\n              <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var> to its value. If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-node\">node</a> already has an\n              <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> with a different value, a\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-conflicting-indexes\" class=\"internalDFN\" data-link-type=\"idl\"><code>conflicting indexes</code></a>\n              error has been detected and processing is aborted. Otherwise, continue by\n              removing the <code>@index</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>element</var>."
            },
            {
              "html": "If <var>element</var> has an <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "create",
              "steps": [
                {
                  "html": "Create a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>referenced node</var> with a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> whose\n                  value is <var>id</var>."
                },
                {
                  "html": "Initialize <var>reverse map</var> to the value of the <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of\n                  <var>element</var>."
                },
                {
                  "html": "For each key-value pair <var>property</var>-<var>values</var> in <var>reverse map</var>:",
                  "rationale": "for",
                  "steps": [
                    {
                      "html": "For each <var>value</var> of <var>values</var>:",
                      "ignored": [
                        "Recursively invoke this algorithm passing value for element, node map, active graph, referenced node for active subject, and property for active property. Passing a map for active subject indicates to the algorithm that a reverse property relationship is being processed."
                      ]
                    }
                  ]
                },
                {
                  "html": "Remove the <code>@reverse</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>element</var>."
                }
              ]
            },
            {
              "html": "If <var>element</var> has an <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, recursively invoke this\n              algorithm passing the value of the <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> for <var>element</var>,\n              <var>node map</var>, and <var>id</var> for <var>active graph</var> before removing\n              the <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>element</var>."
            },
            {
              "html": "If <var>element</var> has an <code>@included</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              recursively invoke this algorithm passing the value of the <code>@included</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> for <var>element</var>,\n              <var>node map</var>, and <var>active graph</var>\n              before removing the <code>@included</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>element</var>."
            },
            {
              "html": "Finally, for each key-value pair <var>property</var>-<var>value</var> in <var>element</var> ordered by\n              <var>property</var> perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>property</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, replace it with a newly\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">generated blank node identifier</a>\n                  passing <var>property</var> for <var>identifier</var>."
                },
                {
                  "html": "If <var>node</var> does not have a <var>property</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and initialize\n                  its value to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "Recursively invoke this algorithm passing <var>value</var> for <var>element</var>,\n                  <var>node map</var>, <var>active graph</var>, <var>id</var> for <var>active subject</var>,\n                  and <var>property</var> for <var>active property</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "7.3 Merge Node Maps",
      "href": "https://www.w3.org/TR/json-ld11-api/#x7-3-merge-node-maps",
      "html": "This algorithm creates a new map of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-subject\">subjects</a> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-node\">nodes</a> using all graphs\n      contained in the <var>graph map</var> created using the <a href=\"https://www.w3.org/TR/json-ld11-api/#node-map-generation\">Node Map Generation algorithm</a>\n      to create merged <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node objects</a> containing information defined for a given <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-subject\">subject</a>\n      in each graph contained in the <var>node map</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create <var>result</var> as an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>"
        },
        {
          "html": "For each <var>graph name</var> and <var>node map</var> in <var>graph map</var>\n        and for each <var>id</var> and <var>node</var> in <var>node map</var>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>merged node</var> to the value for <var>id</var> in <var>result</var>, initializing it\n            with a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> whose value is <var>id</var>, if it does not exist."
            },
            {
              "html": "For each <var>property</var> and <var>values</var> in <var>node</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>property</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a> <span class=\"changed\">other than <code>@type</code></span>, add <var>property</var> and values to <var>merged node</var>."
                },
                {
                  "html": "Otherwise, merge each element from <var>values</var> into the values for <var>property</var>\n                in <var>merged node</var>, initializing it to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> if necessary."
                }
              ]
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "7.4.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x7-4-2-algorithm",
      "html": "The algorithm takes a single input variable <var>identifier</var> which may\n        be <code>null</code>. The algorithm\n        maintains an <var>identifier map</var> to relabel existing\n        <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifiers</a> to new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifiers</a>,\n        <span class=\"changed\">which is reset when the invoking algorithm is initialized</span>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>identifier</var> is not <code>null</code> and has an entry in the\n          <var>identifier map</var>, return the mapped identifier."
        },
        {
          "html": "Otherwise, generate a new unique <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>."
        },
        {
          "html": "If <var>identifier</var> is not <code>null</code>, create a new entry\n          for <var>identifier</var> in <var>identifier map</var> and set its value\n          to the new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>."
        },
        {
          "html": "Return the new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>."
        }
      ]
    },
    {
      "name": "8.1.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x8-1-2-algorithm",
      "html": "The algorithm takes a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>node map</var>, which\n        is the result of the <a href=\"https://www.w3.org/TR/json-ld11-api/#node-map-generation\">Node Map Generation algorithm</a> and\n        an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-dataset\">RDF dataset</a> <var>dataset</var> into which new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph\">graphs</a> and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triples</a> are added.\n        It also takes two optional input variables <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-producegeneralizedrdf\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>produceGeneralizedRdf</code></code></a>\n        and <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a></span>.\n        Unless the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-producegeneralizedrdf\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>produceGeneralizedRdf</code></code></a> option\n        is set to <code>true</code>, <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triple</a>\n        containing a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node\">blank node</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-predicate\">predicate</a>\n        are excluded from output.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>graph name</var> and <var>graph</var> in <var>node map</var>\n          ordered by <var>graph name</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>graph name</var> is\n              <span class=\"changed\">not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a></span>, continue\n              with the next <var>graph name</var>-<var>graph</var> pair."
            },
            {
              "html": "If <var>graph name</var> is <code>@default</code>,\n              initialize <var>triples</var> to the value of the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfdataset-defaultgraph\" class=\"internalDFN\" data-link-type=\"idl\"><code>defaultGraph</code></a>\n              attribute of <var>dataset</var>.\n              Otherwise, initialize <var>triples</var> as an empty <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfgraph\" class=\"internalDFN\" data-link-type=\"idl\"><code>RdfGraph</code></a>\n              and add to <var>dataset</var> using its\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfdataset-add\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>add</code></code></a> method along with <var>graph name</var>\n              for <a data-lt=\"RdfDataset-add-graphName\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-rdfdataset-add-graphname\" class=\"internalDFN\" data-link-type=\"dfn\"><code>graphName</code></a>."
            },
            {
              "html": "For each <var>subject</var> and <var>node</var> in <var>graph</var> ordered\n              by <var>subject</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>subject</var> is\n                  <span class=\"changed\">not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a></span>, continue\n                  with the next <var>subject</var>-<var>node</var> pair."
                },
                {
                  "html": "For each <var>property</var> and <var>values</var> in <var>node</var>\n                  ordered by <var>property</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>property</var> is <code>@type</code>, then for each\n                      <var>type</var> in <var>values</var>,\n                      create a new <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdftriple\" class=\"internalDFN\" data-link-type=\"idl\"><code>RdfTriple</code></a>\n                      composed of <var>subject</var>, <code>rdf:type</code> for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdftriple-predicate\" class=\"internalDFN\" data-link-type=\"idl\"><code>predicate</code></a>,\n                      and <var>type</var> for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdftriple-object\" class=\"internalDFN\" data-link-type=\"idl\"><code>object</code></a>\n                      <span class=\"changed\">and add to <var>triples</var>\n                      using its <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfgraph-add\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>add</code></code></a> method,\n                      unless <var>type</var> is not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a></span>."
                    },
                    {
                      "html": "Otherwise, if <var>property</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-keyword\">keyword</a>\n                      continue with the next <var>property</var>-<var>values</var> pair."
                    },
                    {
                      "html": "Otherwise, if <var>property</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a> and\n                      the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-producegeneralizedrdf\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>produceGeneralizedRdf</code></code></a> option is not <code>true</code>,\n                      continue with the next <var>property</var>-<var>values</var> pair."
                    },
                    {
                      "html": "Otherwise, if <var>property</var> is\n                      <span class=\"changed\">not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a></span>,\n                      continue with the next <var>property</var>-<var>values</var> pair."
                    },
                    {
                      "html": "Otherwise, <var>property</var> is an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or\n                      <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>. For each <var>item</var>\n                      in <var>values</var>:",
                      "rationale": "initialize",
                      "steps": [
                        {
                          "html": "Initialize <var>list triples</var> as an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                        },
                        {
                          "html": "Add a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triple</a>\n                          composed of <var>subject</var>, <var>property</var>, and\n                          the result of using the\n                          <a href=\"https://www.w3.org/TR/json-ld11-api/#object-to-rdf-conversion\">Object to RDF Conversion algorithm</a>\n                          passing <var>item</var>\n                          <span class=\"changed\">and <var>list triples</var></span>\n                          to <var>triples</var> using its <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfgraph-add\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>add</code></code></a> method,\n                          unless the result is <code>null</code>,\n                          indicating a <span class=\"changed\">non-<a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-resource\">resource</a></span>\n                          that has to be ignored."
                        },
                        {
                          "html": "Add all <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdftriple\" class=\"internalDFN\" data-link-type=\"idl\"><code>RdfTriple</code></a> instances from\n                          <var>list triples</var> to <var>triples</var> using\n                          its <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfgraph-add\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>add</code></code></a> method."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "8.2.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x8-2-2-algorithm",
      "html": "The algorithm takes as two arguments <var>item</var> which <em class=\"rfc2119\" title=\"MUST\">MUST</em> be\n        either a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a>, <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>, or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node object</a>\n        and <var>list triples</var>, which is an empty array.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node object</a> and the value of\n          its <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> is\n          <span class=\"changed\">not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a></span>, return\n          <code>null</code>."
        },
        {
          "html": "If <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-node-object\">node object</a>, return the\n          <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a> associated\n          with its <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
        },
        {
          "html": "If <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-list-object\">list object</a>\n          return the result of the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#list-to-rdf-conversion\">List Conversion algorithm</a>, passing\n          the value associated with the <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from\n          <var>item</var> and <var>list triples</var>."
        },
        {
          "html": "Otherwise, <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a>. Initialize\n          <var>value</var> to the value associated with the <code>@value</code>\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>item</var>."
        },
        {
          "html": "Initialize <var>datatype</var> to the value associated with the\n          <code>@type</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>item</var> or <code>null</code> if\n          <var>item</var> does not have such an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
        },
        {
          "html": "If <var>datatype</var> is not <code>null</code>\n          and neither a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> nor <code>@json</code>,\n          return <code>null</code>."
        },
        {
          "html": "If <var>item</var> has an <code>@language</code>\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> which is not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a>, return <code>null</code>."
        },
        {
          "html": "If <var>datatype</var> is <code>@json</code>,\n          convert <var>value</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-canonical-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">canonical lexical form</a>\n          using the result of transforming the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a> of <var>value</var>\n          to JSON and set <var>datatype</var> to <code>rdf:JSON</code>."
        },
        {
          "html": "If <var>value</var> is <code>true</code> or\n          <code>false</code>, set <var>value</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>\n          <code>true</code> or <code>false</code> which is the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-canonical-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">canonical lexical form</a> as described in\n          <a class=\"sectionRef sec-ref\" href=\"https://www.w3.org/TR/json-ld11-api/#data-round-tripping\">§&nbsp;<bdi class=\"secno\">8.6 </bdi>Data Round Tripping</a>\n          If <var>datatype</var> is <code>null</code>,\n          set <var>datatype</var> to <code>xsd:boolean</code>."
        },
        {
          "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-terms-and-definitions-number-value\">number</a> with a non-zero fractional\n          part (the result of a modulo‑1 operation)\n          <span class=\"changed\">or an absolute value greater or equal to 10<sup>21</sup></span>,\n          or <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-terms-and-definitions-number-value\">number</a>\n          and <var>datatype</var> equals <code>xsd:double</code>, convert <var>value</var> to a\n          <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> in <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-canonical-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">canonical lexical form</a> of\n          an <a href=\"https://www.w3.org/TR/xmlschema11-2/#double\"><code>xsd:double</code></a> as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-xmlschema11-2\" title=\"W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes\">XMLSCHEMA11-2</a></cite>]\n          and described in\n          <a class=\"sectionRef sec-ref\" href=\"https://www.w3.org/TR/json-ld11-api/#data-round-tripping\">§&nbsp;<bdi class=\"secno\">8.6 </bdi>Data Round Tripping</a>.\n          If <var>datatype</var> is <code>null</code>,\n          set <var>datatype</var> to <code>xsd:double</code>."
        },
        {
          "html": "Otherwise, if <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-terms-and-definitions-number-value\">number</a>,\n          convert it to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> in <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-canonical-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">canonical lexical form</a> of\n          an <a href=\"https://www.w3.org/TR/xmlschema11-2/#integer\"><code>xsd:integer</code></a> as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-xmlschema11-2\" title=\"W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes\">XMLSCHEMA11-2</a></cite>]\n          and described in\n          <a class=\"sectionRef sec-ref\" href=\"https://www.w3.org/TR/json-ld11-api/#data-round-tripping\">§&nbsp;<bdi class=\"secno\">8.6 </bdi>Data Round Tripping</a>.\n          If <var>datatype</var> is <code>null</code>,\n          set <var>datatype</var> to <code>xsd:integer</code>."
        },
        {
          "html": "Otherwise, if <var>datatype</var> is <code>null</code>,\n          set <var>datatype</var> to <code>xsd:string</code> or <code>rdf:langString</code>,\n          depending on if item has an <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>."
        },
        {
          "html": "If <var>item</var> contains an <code>@direction</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n          and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a> is not <code>null</code>,\n          <var>item</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-value-object\">value object</a> which is serialized using special rules.",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>language</var> to the value of <code>@language</code> in <var>item</var>\n              normalized to lower case,\n              or the empty string (<code>\"\"</code>) if there is no such entry."
            },
            {
              "html": "If <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a> is <code>i18n-datatype</code>,\n              set <var>datatype</var> to the result of appending <var>language</var>\n              and the value of <code>@direction</code> in <var>item</var> separated by an underscore (<code>\"_\"</code>)\n              to <code>https://www.w3.org/ns/i18n#</code>.\n              Initialize <var>literal</var> as an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-literal\">RDF literal</a> using\n              <var>value</var> and <var>datatype</var>."
            },
            {
              "html": "Otherwise, if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a> is <code>compound-literal</code>:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>literal</var> as a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node\">blank node</a>."
                },
                {
                  "html": "Create a new triple using <var>literal</var> as the subject,\n                  <code>rdf:value</code> as the predicate, and the value of <code>@value</code> in <var>item</var>\n                  as the object, and add it to <var>list triples</var>."
                },
                {
                  "html": "If the <var>item</var> has an entry for <code>@language</code>,\n                  create a new triple using <var>literal</var> as the subject,\n                  <code>rdf:language</code> as the predicate, and <var>language</var>\n                  as the object, and add it to <var>list triples</var>."
                },
                {
                  "html": "Create a new triple using <var>literal</var> as the subject,\n                  <code>rdf:direction</code> as the predicate, and the value of <code>@direction</code> in <var>item</var>\n                  as the object, and add it to <var>list triples</var>."
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise, initialize <var>literal</var> as an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-literal\">RDF literal</a> using\n          <var>value</var> and <var>datatype</var>. If <var>item</var> has an\n          <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, add the value associated with the\n          <code>@language</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> as the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-language-tag\">language tag</a> of <var>literal</var>."
        },
        {
          "html": "Return <var>literal</var>."
        }
      ]
    },
    {
      "name": "8.3.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x8-3-2-algorithm",
      "html": "The algorithm takes two inputs: an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>list</var>\n        and an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>list triples</var> used for returning\n        the generated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triples</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>list</var> is empty, return <code>rdf:nil</code>."
        },
        {
          "html": "Otherwise, create an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>bnodes</var> composed of a\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#generate-blank-node-identifier\">newly generated blank node identifier</a>\n          for each entry in <var>list</var>."
        },
        {
          "html": "For each pair of <var>subject</var> from <var>bnodes</var> and <var>item</var> from <var>list</var>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>embedded triples</var> to a new empty array."
            },
            {
              "html": "Initialize <var>object</var> to the result of using the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#object-to-rdf-conversion\">Object to RDF Conversion algorithm</a>\n              passing <var>item</var>\n              <span class=\"changed\">and <var>embedded triples</var> for <var>list triples</var></span>."
            },
            {
              "html": "Unless <var>object</var> is <code>null</code>, append a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triple</a>\n              composed of <var>subject</var>, <code>rdf:first</code>, and <var>object</var>\n              to <var>list triples</var>."
            },
            {
              "html": "Initialize <var>rest</var> as the next entry in <var>bnodes</var>, or if that\n              does not exist, <code>rdf:nil</code>. Append a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triple</a> composed of <var>subject</var>,\n              <code>rdf:rest</code>, and <var>rest</var> to <var>list triples</var>."
            },
            {
              "html": "Append all values from <var>embedded triples</var> to <var>list triples</var>"
            }
          ]
        },
        {
          "html": "Return the first <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node\">blank node</a> from <var>bnodes</var> or\n          <code>rdf:nil</code> if <var>bnodes</var> is empty."
        }
      ]
    },
    {
      "name": "lexical form",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-lexical-form",
      "html": "In the RDF abstract syntax, <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-literal\">RDF literals</a> have a\n      <a href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form\"><dfn data-dfn-type=\"dfn\" id=\"dfn-lexical-form\">lexical form</dfn></a>, as defined\n      in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rdf11-concepts\" title=\"RDF 1.1 Concepts and Abstract Syntax\">RDF11-CONCEPTS</a></cite>]. The form of these literals is used when creating <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-json-ld-value\">JSON-LD values</a> based on these literals.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>default graph</var> to an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "Initialize <var>graph map</var> to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting\n          of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@default</code> whose value references\n          <var>default graph</var>."
        },
        {
          "html": "Initialize <var>referenced once</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "Initialize <var>compound literal subjects</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
        },
        {
          "html": "For each <var>graph</var> in  <var>dataset</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>graph</var> is the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-default-graph\">default graph</a>,\n              initialize <var>name</var> to <code>@default</code>, otherwise to the\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-graph-name\">graph name</a> associated with <var>graph</var>."
            },
            {
              "html": "If <var>graph map</var> has no <var>name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set\n              its value to an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
            },
            {
              "html": "If <var>compound literal subjects</var> has no <var>name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one and set\n              its value to an empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
            },
            {
              "html": "If <var>graph</var> is not the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-default-graph\">default graph</a> and\n              <var>default graph</var> does not have a <var>name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n              create such an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> and initialize its value to a new\n              <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code>\n              whose value is <var>name</var>."
            },
            {
              "html": "Reference the value of the <var>name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>graph map</var>\n              using the variable <var>node map</var>."
            },
            {
              "html": "Reference the value of the <var>name</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>compound literal subjects</var>\n              using the variable <var>compound map</var>."
            },
            {
              "html": "For each <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triple</a> in <var>graph</var>\n              consisting of <var>subject</var>, <var>predicate</var>, and <var>object</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>node map</var> does not have a <var>subject</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and initialize its value to a new <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n                  consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> whose value is\n                  set to <var>subject</var>."
                },
                {
                  "html": "Reference the value of the <var>subject</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> in <var>node map</var>\n                  using the variable <var>node</var>."
                },
                {
                  "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a> option\n                  is <code>compound-literal</code> and <var>predicate</var> is <code>rdf:direction</code>,\n                  add an entry in <var>compound map</var> for <var>subject</var> with the value <code>true</code>."
                },
                {
                  "html": "If <var>object</var> is an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,\n                  and <var>node map</var> does not have an <var>object</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                  create one and initialize its value to a new <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n                  consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> whose value is\n                  set to <var>object</var>."
                },
                {
                  "html": "If <var>predicate</var> equals <code>rdf:type</code>, the\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-userdftype\" class=\"internalDFN\" data-link-type=\"idl\"><code>useRdfType</code></a> flag is not <code>true</code>, and <var>object</var>\n                  is an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,\n                  append <var>object</var> to the value of the <code>@type</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var>; unless such an item already exists.\n                  If no such <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> exists, create one\n                  and initialize it to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> whose only item is\n                  <var>object</var>. Finally, continue to the next\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple\">triple</a>."
                },
                {
                  "html": "Initialize <var>value</var> to the result of using the\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#rdf-to-object-conversion\">RDF to Object Conversion algorithm</a>,\n                  passing <var>object</var>,\n                  <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a></span>,\n                  and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-usenativetypes\" class=\"internalDFN\" data-link-type=\"idl\"><code>useNativeTypes</code></a>."
                },
                {
                  "html": "If <var>node</var> does not have a <var>predicate</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, create one\n                  and initialize its value to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "If there is no item equivalent to <var>value</var> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>\n                  associated with the <var>predicate</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var>, append a\n                  reference to <var>value</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. Two <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a>\n                  are considered equal if they have equivalent <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">map entries</a>."
                },
                {
                  "html": "If <var>object</var> is <code>rdf:nil</code>, it represents\n                  the termination of an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf-schema/#ch_collectionvocab\">RDF collection</a>:",
                  "rationale": "reference",
                  "steps": [
                    {
                      "html": "Reference the <code>usages</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of the <var>object</var>\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node map</var> using the variable <var>usages</var>."
                    },
                    {
                      "html": "Append a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of three\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>, <code>node</code>, <code>property</code>, and <code>value</code>\n                      to the <var>usages</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. The <code>node</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                      is set to a reference to <var>node</var>, <code>property</code> to <var>predicate</var>,\n                      and <code>value</code> to a reference to <var>value</var>."
                    }
                  ]
                },
                {
                  "html": "Otherwise, if <var>referenced once</var> has an entry for <var>object</var>,\n                  set the <var>object</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>referenced once</var> to <code>false</code>."
                },
                {
                  "html": "Otherwise, if <var>object</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,\n                  it might represent a list node:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set the <var>object</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>referenced once</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> consisting of three\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>, <code>node</code>, <code>property</code>, and <code>value</code>\n                      to the <var>usages</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>. The <code>node</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                      is set to a reference to <var>node</var>, <code>property</code> to <var>predicate</var>,\n                      and <code>value</code> to a reference to <var>value</var>."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>name</var> and <var>graph object</var> in <var>graph map</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>compound literal subjects</var>\n              has an entry for <var>name</var>, then for each <var>cl</var>\n              which is a key in that entry:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>cl entry</var> to the value of <var>cl</var>\n                  in <var>referenced once</var>,\n                  continuing to the next <var>cl</var> if <var>cl entry</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
                },
                {
                  "html": "Initialize <var>node</var> to the value of <code>node</code> in <var>cl entry</var>."
                },
                {
                  "html": "Initialize <var>property</var> to value of <code>property</code> in <var>cl entry</var>."
                },
                {
                  "html": "Initialize <var>value</var> to value of <code>value</code> in <var>cl entry</var>."
                },
                {
                  "html": "Initialize <var>cl node</var> to the value of <var>cl</var>\n                  in <var>graph object</var>, and remove that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>graph object</var>,\n                  continuing to the next <var>cl</var> if <var>cl node</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
                },
                {
                  "html": "For each <var>cl reference</var> in the value of <var>property</var> in <var>node</var>\n                  where the value of <code>@id</code> in <var>cl reference</var> is <var>cl</var>:",
                  "rationale": "delete",
                  "steps": [
                    {
                      "html": "Delete the <code>@id</code> entry in <var>cl reference</var>."
                    },
                    {
                      "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>cl reference</var> for <code>@value</code> with the value taken\n                      from the <code>rdf:value</code> entry in <var>cl node</var>."
                    },
                    {
                      "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>cl reference</var> for <code>@language</code> with the value taken\n                      from the <code>rdf:language</code> entry in <var>cl node</var>, if any.\n                      If that value is not <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> according to\n                      <a href=\"https://tools.ietf.org/html/bcp47#section-2.2.9\">section 2.2.9</a> of [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-bcp47\" title=\"Tags for Identifying Languages\">BCP47</a></cite>],\n                      an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-language-tagged-string\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid language-tagged string</code></a>\n                      error has been detected and processing is aborted."
                    },
                    {
                      "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>cl reference</var> for <code>@direction</code> with the value taken\n                      from the <code>rdf:direction</code> entry in <var>cl node</var>, if any.\n                      If that value is not <code>\"ltr\"</code> or <code>\"rtl\"</code>, an\n                      <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-base-direction\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid base direction</code></a>\n                      error has been detected and processing is aborted."
                    }
                  ]
                }
              ]
            },
            {
              "html": "If <var>graph object</var> has no <code>rdf:nil</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, continue\n              with the next <var>name</var>-<var>graph object</var> pair as the graph does\n              not contain any lists that need to be converted."
            },
            {
              "html": "Initialize <var>nil</var> to the value of the <code>rdf:nil</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n              of <var>graph object</var>."
            },
            {
              "html": "For each item <var>usage</var> in the <code>usages</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of\n              <var>nil</var>, perform the following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "Initialize <var>node</var> to the value of the value of the\n                  <code>node</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>usage</var>, <var>property</var> to\n                  the value of the <code>property</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>usage</var>,\n                  and <var>head</var> to the value of the <code>value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                  of <var>usage</var>."
                },
                {
                  "html": "Initialize two empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">arrays</a> <var>list</var>\n                  and <var>list nodes</var>."
                },
                {
                  "html": "While <var>property</var> equals <code>rdf:rest</code>,\n                  <span class=\"changed\">the value of the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                    of <var>node</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,</span>\n                  the value of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>referenced once</var> associated with the <code>@id</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <code>node</code> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>,\n                  <var>node</var> has <code>rdf:first</code> and <code>rdf:rest</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a>,\n                  both of which have as value an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> consisting of a single element,\n                  and <var>node</var> has no other <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entries</a> apart from an optional <code>@type</code>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> whose value is an array with a single item equal to\n                  <code>rdf:List</code>,\n                  <var>node</var> represents a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-well-formed\" class=\"internalDFN\" data-link-type=\"dfn\">well-formed</a> list node.\n                  Perform the following steps to traverse the list backwards towards its head:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "Append the only item of <code>rdf:first</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of\n                      <var>node</var> to the <var>list</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                    },
                    {
                      "html": "Append the value of the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of\n                      <var>node</var> to the <var>list nodes</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                    },
                    {
                      "html": "Initialize <var>node usage</var> to the value of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>referenced once</var> associated with the <code>@id</code>\n                      <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <code>node</code>."
                    },
                    {
                      "html": "Set <var>node</var> to the value of the <code>node</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                      of <var>node usage</var>, <var>property</var> to the value of the\n                      <code>property</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node usage</var>, and\n                      <var>head</var> to the value of the <code>value</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                      of <var>node usage</var>."
                    },
                    {
                      "html": "If the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var> is an\n                      <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> instead of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>,\n                      exit the while loop."
                    }
                  ]
                },
                {
                  "html": "Remove the <code>@id</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>head</var>."
                },
                {
                  "html": "Reverse the order of the <var>list</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "Add an <code>@list</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>head</var> and initialize\n                  its value to the <var>list</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "For each item <var>node id</var> in <var>list nodes</var>, remove the\n                  <var>node id</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> from <var>graph object</var>."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> <var>result</var>."
        },
        {
          "html": "For each <var>subject</var> and <var>node</var> in <var>default graph</var>\n          ordered lexicographically by <var>subject</var>\n          <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>graph map</var> has a <var>subject</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>:",
              "rationale": "add",
              "steps": [
                {
                  "html": "Add an <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>node</var> and initialize\n                  its value to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
                },
                {
                  "html": "For each key-value pair <var>s</var>-<var>n</var> in the <var>subject</var>\n                  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>graph map</var> ordered lexicographically by <var>s</var>\n                  <span class=\"changed\">if <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> is <code>true</code></span>,\n                  append <var>n</var> to the <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>node</var> after\n                  removing its <code>usages</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, unless the only\n                  remaining <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of <var>n</var> is <code>@id</code>."
                }
              ]
            },
            {
              "html": "Append <var>node</var> to <var>result</var> after removing its\n              <code>usages</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>, unless the only remaining <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> of\n              <var>node</var> is <code>@id</code>."
            }
          ]
        },
        {
          "html": "Return <var>result</var>."
        }
      ]
    },
    {
      "name": "8.5.2 Algorithm",
      "href": "https://www.w3.org/TR/json-ld11-api/#x8-5-2-algorithm",
      "html": "This algorithm takes three required inputs:\n        a <var>value</var> to be converted to a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>,\n        <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a></span>,\n        and a flag <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-usenativetypes\" class=\"internalDFN\" data-link-type=\"idl\"><code>useNativeTypes</code></a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>value</var> is an <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> or a\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier\">blank node identifier</a>, return a new <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n          consisting of a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@id</code> whose value is set to\n          <var>value</var>."
        },
        {
          "html": "Otherwise <var>value</var> is an\n          <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-literal\">RDF literal</a>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize a new empty <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> result."
            },
            {
              "html": "Initialize <var>converted value</var> to <var>value</var>."
            },
            {
              "html": "Initialize <var>type</var> to <code>null</code>"
            },
            {
              "html": "If <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-usenativetypes\" class=\"internalDFN\" data-link-type=\"idl\"><code>useNativeTypes</code></a> is <code>true</code>",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri\">datatype <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>\n                  of <var>value</var> equals <code>xsd:string</code>, set\n                  <var>converted value</var> to the\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">lexical form</a>\n                  of <var>value</var>."
                },
                {
                  "html": "Otherwise, if the\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri\">datatype <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>\n                  of <var>value</var> equals <code>xsd:boolean</code>, set\n                  <var>converted value</var> to <code>true</code> if the\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">lexical form</a>\n                  of <var>value</var> matches <code>true</code>, or <code>false</code>\n                  if it matches <code>false</code>. If it matches neither,\n                  set <var>type</var> to <code>xsd:boolean</code>."
                },
                {
                  "html": "Otherwise, if the\n                  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri\">datatype <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>\n                  of <var>value</var> equals <code>xsd:integer</code> or\n                  <code>xsd:double</code> and its\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">lexical form</a>\n                  is a valid <code>xsd:integer</code> or <code>xsd:double</code>\n                  according [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-xmlschema11-2\" title=\"W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes\">XMLSCHEMA11-2</a></cite>], set <var>converted value</var>\n                  to the result of converting the\n                  <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">lexical form</a>\n                  to a JSON <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-terms-and-definitions-number-value\">number</a>."
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-processing-mode\">processing mode</a> is not <code>json-ld-1.0</code>,\n              and <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-json-literal\">JSON literal</a>,\n              set <var>converted value</var> to the result of\n              turning the lexical value of <var>value</var>\n              into the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">JSON-LD internal representation</a>, and set <var>type</var> to <code>@json</code>.\n              If the lexical value of <var>value</var> is not valid JSON according to\n              the <a href=\"https://tools.ietf.org/html/rfc8259#section-2\">JSON Grammar</a> [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc8259\" title=\"The JavaScript Object Notation (JSON) Data Interchange Format\">RFC8259</a></cite>],\n              an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-json-literal\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid JSON literal</code></a>\n              error has been detected and processing is aborted."
            },
            {
              "html": "Otherwise, if the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri\">datatype <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of <var>value</var> starts with <code>https://www.w3.org/ns/i18n#</code>,\n              and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-rdfdirection\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>rdfDirection</code></code></a> is <code>i18n-datatype</code>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var>converted value</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-lexical-form\" class=\"internalDFN\" data-link-type=\"dfn\">lexical form</a> of <var>value</var>."
                },
                {
                  "html": "If the string prefix of the <a href=\"https://tools.ietf.org/html/rfc3986#section-3.5\">fragment identifier</a>\n                  of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri\">datatype <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> up until the underscore (<code>\"_\"</code>) is not empty,\n                  add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@language</code> to <var>result</var> and set its value to that prefix."
                },
                {
                  "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@direction</code> to <var>result</var> and set its value to the substring of the\n                  <a href=\"https://tools.ietf.org/html/rfc3986#section-3.5\">fragment identifier</a> following\n                  the underscore (<code>\"_\"</code>)."
                }
              ]
            },
            {
              "html": "Otherwise, if <var>value</var> is a\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string\">language-tagged string</a>\n              add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@language</code> to <var>result</var> and set its value to the\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-language-tag\">language tag</a> of <var>value</var>."
            },
            {
              "html": "Otherwise, set <var>type</var> to the\n              <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri\">datatype <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>\n              of <var>value</var>, unless it equals <code>xsd:string</code> which is ignored."
            },
            {
              "html": "Add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@value</code> to <var>result</var> whose value\n              is set to <var>converted value</var>."
            },
            {
              "html": "If <var>type</var> is not <code>null</code>, add an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> <code>@type</code>\n              to <var>result</var> whose value is set to <var>type</var>."
            },
            {
              "html": "Return <var>result</var>."
            }
          ]
        }
      ]
    },
    {
      "name": "jsonldprocessor-compact-input",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input",
      "html": "The final output is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n          derived from <var>compacted output</var>.\n          If <var>compacted output</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, it is\n          included with an entry of (a possibly aliased) <code>@graph</code>\n          with the value of <var>compacted output</var>,\n          otherwise <var>compacted output</var> is used as the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> result.\n          If <a data-lt=\"jsonldprocessor-compact-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a> not <code>null</code>,\n          an <code>@context</code> entry is added to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> result.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create a new <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> <var>promise</var> and return it.\n            The following steps are then deferred."
        },
        {
          "html": "If the provided <a data-lt=\"jsonldprocessor-compact-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            is a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument\" class=\"internalDFN\" data-link-type=\"idl\"><code>RemoteDocument</code></a>,\n            initialize <var>remote document</var> to <a data-lt=\"jsonldprocessor-compact-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>."
        },
        {
          "html": "Otherwise, if the provided <a data-lt=\"jsonldprocessor-compact-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of a remote document, await and dereference it as <var>remote document</var>\n            using <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentcallback\" class=\"internalDFN\" data-link-type=\"idl\"><code>LoadDocumentCallback</code></a>, passing <a data-lt=\"jsonldprocessor-compact-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            for <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>,\n            and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>extractAllScripts</code></code></a> option from <a data-lt=\"jsonldprocessor-compact-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>\n            for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code>extractAllScripts</code></a>."
        },
        {
          "html": "Set <var>expanded input</var> to the result of\n            using the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldprocessor-expand\" class=\"internalDFN\" data-link-type=\"idl\"><code>expand()</code></a> method\n            using either <var>remote document</var>\n            or <a data-lt=\"jsonldprocessor-compact-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            if there is no <var>remote document</var>\n            for <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>,\n            and <a data-lt=\"jsonldprocessor-compact-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>,\n            <span class=\"changed\">with <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> set to <code>false</code></span>,\n            <span class=\"changed\">and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>extractAllScripts</code></code></a> defaulting to <code>false</code></span>."
        },
        {
          "html": "Set <var>context base</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-documenturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>documentUrl</code></code></a>\n            from <var>remote document</var>, if available, otherwise to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-base\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>base</code></code></a> option\n            from <a data-lt=\"jsonldprocessor-compact-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>."
        },
        {
          "html": "If <a data-lt=\"jsonldprocessor-compact-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>\n            having an <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n            set <var>context</var> to that <a data-lt=\"entry\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry's</a> value,\n            otherwise to <a data-lt=\"jsonldprocessor-compact-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a>."
        },
        {
          "html": "Initialize <var>active context</var>\n            to the result of the <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>\n            passing a new empty <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-context\">context</a> as <var>active context</var>\n            <var>context</var> as <var>local context</var>,\n            and <var>context base</var> as <var>base URL</var>."
        },
        {
          "html": "Set <a data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" class=\"internalDFN\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> in <var>active context</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-base\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>base</code></code></a> option from <a data-lt=\"jsonldprocessor-compact-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>, if set;\n            otherwise, if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compacttorelative\" class=\"internalDFN\" data-link-type=\"idl\"><code>compactToRelative</code></a> option is <strong>true</strong>,\n            to the <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> of the currently being processed document, if available;\n            otherwise to <code>null</code>."
        },
        {
          "html": "Set <var>compacted output</var> to the result of using the <a href=\"https://www.w3.org/TR/json-ld11-api/#compaction-algorithm\">Compaction algorithm</a>,\n            using <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-active-context\">active context</a>,\n            <code>null</code> for <var>active property</var>,\n            <var>expanded input</var> as <var>element</var>,\n            and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compactarrays\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>compactArrays</code></code></a>\n            <span class=\"changed\">and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a></span>\n            flags from <a data-lt=\"jsonldprocessor-compact-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>compacted output</var> is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n                replace it with a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>."
            },
            {
              "html": "Otherwise, if <var>compacted output</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n                replace it with a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> with a single <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>\n                whose key is the result of\n                <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-iri-compacting\" class=\"internalDFN\" data-link-type=\"dfn\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr> compacting</a> <code>@graph</code></span>\n                and value is <var>compacted output</var>."
            },
            {
              "html": "If <a data-lt=\"jsonldprocessor-compact-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a> was not <code>null</code>,\n                add an <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a> to <var>compacted output</var> and set its value\n                to the provided <var>context</var>."
            }
          ]
        },
        {
          "html": "Resolve the <var>promise</var> with <var>compacted output</var>\n            <span class=\"changed\">transforming <var>compacted output</var> from the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a> to a JSON serialization</span>."
        }
      ]
    },
    {
      "name": "jsonldprocessor-expand-input",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input",
      "html": "<a href=\"https://www.w3.org/TR/json-ld11-api/#expansion\">Expands</a> the given <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n          according to the steps in the <a href=\"https://www.w3.org/TR/json-ld11-api/#expansion-algorithm\">Expansion algorithm</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create a new <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> <var>promise</var> and return it.\n            The following steps are then deferred."
        },
        {
          "html": "If the provided <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            is a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument\" class=\"internalDFN\" data-link-type=\"idl\"><code>RemoteDocument</code></a>,\n            initialize <var>remote document</var> to <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>."
        },
        {
          "html": "Otherwise, if the provided <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of a remote document, await and dereference it as <var>remote document</var>\n            using <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentcallback\" class=\"internalDFN\" data-link-type=\"idl\"><code>LoadDocumentCallback</code></a>, passing <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            for <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>,\n            the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>extractAllScripts</code></code></a> option from <a data-lt=\"jsonldprocessor-expand-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>\n            for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code>extractAllScripts</code></a>."
        },
        {
          "html": "If <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-document\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>document</code></code></a>\n            from <var>remote document</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a>, transform into the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a>.\n            If <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-document\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>document</code></code></a> cannot be transformed to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a>,\n            reject <var>promise</var> passing a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-document-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading document failed</code></a> error."
        },
        {
          "html": "Initialize a new empty <var>active context</var>.\n            The <a data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" class=\"internalDFN\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> and <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-original-base-url\" class=\"internalDFN\" data-link-type=\"dfn\">original base URL</a> of the <var>active context</var> is set to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-documenturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>documentUrl</code></code></a>\n            from <var>remote document</var>, if available;\n            otherwise to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-base\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>base</code></code></a> option from <a data-lt=\"jsonldprocessor-expand-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>.\n            If set, the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-base\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>base</code></code></a> option from <a data-lt=\"jsonldprocessor-expand-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a> overrides the <a data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" class=\"internalDFN\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a>."
        },
        {
          "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-expandcontext\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>expandContext</code></code></a> option in <a data-lt=\"jsonldprocessor-expand-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a> is set, \n            update the <var>active context</var> using the <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n            passing the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-expandcontext\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>expandContext</code></code></a> as <var>local context</var>\n            and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-original-base-url\" class=\"internalDFN\" data-link-type=\"dfn\">original base URL</a> from <var>active context</var> as <var>base URL</var>.\n            If <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-expandcontext\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>expandContext</code></code></a> is a <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> having an <code>@context</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n            pass that <a data-lt=\"entry\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry's</a> value instead for <var>local context</var>."
        },
        {
          "html": "If <var>remote document</var> has a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-contexturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>contextUrl</code></code></a>,\n            update the <var>active context</var> using the <a href=\"https://www.w3.org/TR/json-ld11-api/#context-processing-algorithm\">Context Processing algorithm</a>,\n            passing the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-contexturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>contextUrl</code></code></a> as <var>local context</var>,\n            and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-contexturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>contextUrl</code></code></a> as <var>base URL</var>."
        },
        {
          "html": "Set <var>expanded output</var> to the result of using the <a href=\"https://www.w3.org/TR/json-ld11-api/#expansion-algorithm\">Expansion algorithm</a>,\n            passing the <var>active context</var>,\n            <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-document\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>document</code></code></a> from <var>remote document</var> or <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            if there is no <var>remote document</var> as <var>element</var>,\n            <code>null</code> as <var>active property</var>,\n            <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-documenturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>documentUrl</code></code></a> as <var>base URL</var>, if available,\n            otherwise to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-base\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>base</code></code></a> option\n            from <a data-lt=\"jsonldprocessor-expand-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>,\n            and the <span class=\"changed\"><a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-frameexpansion\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>frameExpansion</code></code></a></span>\n            and <span class=\"changed\">and <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a></span>\n            flags from <a data-lt=\"jsonldprocessor-expand-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>expanded output</var> is a\n                <a class=\"changed\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> that contains only an <code>@graph</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\">entry</a>,\n                set <var>expanded output</var> that value."
            },
            {
              "html": "If <var>expanded output</var> is <code>null</code>,\n                set <var>expanded output</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>."
            },
            {
              "html": "If <var>expanded output</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>,\n                set <var>expanded output</var> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> containing only <var>expanded output</var>."
            }
          ]
        },
        {
          "html": "Resolve the <var>promise</var> with <var>expanded output</var>\n            <span class=\"changed\">transforming <var>expanded output</var> from the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a> to a JSON serialization</span>."
        }
      ]
    },
    {
      "name": "jsonldprocessor-flatten-input",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input",
      "html": "<a href=\"https://www.w3.org/TR/json-ld11-api/#flattening\">Flattens</a> the given <a data-lt=\"jsonldprocessor-flatten-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n          and optionally <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-compact\" class=\"internalDFN\" data-link-type=\"dfn\">compacts</a> it using the provided <a data-lt=\"jsonldprocessor-flatten-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a>\n          according to the steps in the <a href=\"https://www.w3.org/TR/json-ld11-api/#flattening-algorithm\">Flattening algorithm</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create a new <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> <var>promise</var> and return it.\n            The following steps are then deferred."
        },
        {
          "html": "If the provided <a data-lt=\"jsonldprocessor-flatten-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            is a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument\" class=\"internalDFN\" data-link-type=\"idl\"><code>RemoteDocument</code></a>,\n            initialize <var>remote document</var> to <a data-lt=\"jsonldprocessor-flatten-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>."
        },
        {
          "html": "Otherwise, if the provided <a data-lt=\"jsonldprocessor-flatten-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#javascript-string\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc3987#section-2\"><abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> of a remote document, await and dereference it as <var>remote document</var>\n            using <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentcallback\" class=\"internalDFN\" data-link-type=\"idl\"><code>LoadDocumentCallback</code></a>, passing <a data-lt=\"jsonldprocessor-flatten-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            for <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>,\n            and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>extractAllScripts</code></code></a> option from <a data-lt=\"jsonldprocessor-flatten-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>\n            for <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code>extractAllScripts</code></a>."
        },
        {
          "html": "Set <var>expanded input</var> to the result of\n            using the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldprocessor-expand\" class=\"internalDFN\" data-link-type=\"idl\"><code>expand()</code></a> method\n            using either <var>remote document</var>\n            or <a data-lt=\"jsonldprocessor-flatten-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            if there is no <var>remote document</var>\n            for <a data-lt=\"jsonldprocessor-expand-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-expand-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>,\n            and <a data-lt=\"jsonldprocessor-flatten-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>\n            <span class=\"changed\">with <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> set to <code>false</code></span>."
        },
        {
          "html": "Initialize an empty <var>identifier map</var>."
        },
        {
          "html": "Set <var>flattened output</var> to the result of using the <a href=\"https://www.w3.org/TR/json-ld11-api/#flattening-algorithm\">Flattening algorithm</a>,\n            passing <var>expanded input</var> as <var>element</var>,\n            <span class=\"changed\">and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> flag\n              from <a data-lt=\"jsonldprocessor-flatten-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a></span>.",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-lt=\"jsonldprocessor-flatten-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a> is not <code>null</code>,\n                set <var>flattened output</var> to the result of\n                using the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldprocessor-compact\" class=\"internalDFN\" data-link-type=\"idl\"><code>compact()</code></a> method\n                using <var>flattened output</var> for <a data-lt=\"jsonldprocessor-compact-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-compact-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>,\n                <a data-lt=\"jsonldprocessor-flatten-context\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-context\" class=\"internalDFN\" data-link-type=\"dfn\">context</a>,\n                and <a data-lt=\"jsonldprocessor-flatten-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>.\n                Set the <a data-lt=\"context-base-iri\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-context-base-iri\" class=\"internalDFN\" data-link-type=\"dfn\">base <abbr title=\"Internationalized Resource Identifier\">IRI</abbr></a> in <var>active context</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-base\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>base</code></code></a> option\n                from <a data-lt=\"jsonldprocessor-flatten-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-flatten-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>, if set;\n                otherwise, if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-compacttorelative\" class=\"internalDFN\" data-link-type=\"idl\"><code>compactToRelative</code></a> option is <strong>true</strong>,\n                to the <abbr title=\"Internationalized Resource Identifier\">IRI</abbr> of the currently being processed document, if available;\n                otherwise to <code>null</code>."
            }
          ]
        },
        {
          "html": "Resolve the <var>promise</var> with <var>flattened output</var>\n            <span class=\"changed\">transforming <var>flattened output</var> from the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a> to a JSON serialization</span>,\n              if necessary."
        }
      ]
    },
    {
      "name": "jsonldprocessor-fromRdf-input",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-fromrdf-input",
      "html": "Transforms the given <a data-lt=\"jsonldprocessor-fromRdf-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-fromrdf-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n          into a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/json-ld11/#dfn-json-ld-document\">JSON-LD document</a> in <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-expanded-form\" class=\"internalDFN\" data-link-type=\"dfn\">expanded form</a>\n          according to the steps in the <a href=\"https://www.w3.org/TR/json-ld11-api/#serialize-rdf-as-json-ld-algorithm\">Serialize RDF as JSON-LD Algorithm</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create a new <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> <var>promise</var> and return it.\n            The following steps are then deferred."
        },
        {
          "html": "Set <var>expanded result</var> to the result of invoking the\n            <a href=\"https://www.w3.org/TR/json-ld11-api/#serialize-rdf-as-json-ld-algorithm\">Serialize RDF as JSON-LD Algorithm</a> method\n            using <a data-lt=\"jsonldprocessor-fromRdf-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-fromrdf-input\" class=\"internalDFN\" data-link-type=\"dfn\">dataset</a>\n            and <a data-lt=\"jsonldprocessor-fromRdf-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-fromrdf-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>."
        },
        {
          "html": "Resolve the <var>promise</var> with <var>expanded result</var>\n            <span class=\"changed\">transforming <var>expanded result</var> from the\n              <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a> to a JSON serialization</span>."
        }
      ]
    },
    {
      "name": "jsonldprocessor-toRdf-input",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-tordf-input",
      "html": "Transforms the given <a data-lt=\"jsonldprocessor-toRdf-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-tordf-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a> into an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfdataset\" class=\"internalDFN\" data-link-type=\"idl\"><code>RdfDataset</code></a>\n          according to the steps in the <a href=\"https://www.w3.org/TR/json-ld11-api/#deserialize-json-ld-to-rdf-algorithm\">Deserialize JSON-LD to RDF Algorithm</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create a new <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> <var>promise</var> and return it.\n            The following steps are then deferred."
        },
        {
          "html": "Set <var>expanded input</var> to the result of using the\n            <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldprocessor-expand\" class=\"internalDFN\" data-link-type=\"idl\"><code>expand()</code></a> method\n            using <a data-lt=\"jsonldprocessor-toRdf-input\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-tordf-input\" class=\"internalDFN\" data-link-type=\"dfn\">input</a>\n            and <a data-lt=\"jsonldprocessor-toRdf-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-tordf-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>\n            <span class=\"changed\">with <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-ordered\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>ordered</code></code></a> set to <code>false</code></span>."
        },
        {
          "html": "Create a new <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-rdfdataset\" class=\"internalDFN\" data-link-type=\"idl\"><code>RdfDataset</code></a> <var>dataset</var>."
        },
        {
          "html": "Create a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> <var>node map</var>."
        },
        {
          "html": "Invoke the <a href=\"https://www.w3.org/TR/json-ld11-api/#node-map-generation\">Node Map Generation algorithm</a>,\n            passing <var>expanded input</var> as <var>element</var>\n            and <var>node map</var>."
        },
        {
          "html": "Invoke the <a href=\"https://www.w3.org/TR/json-ld11-api/#deserialize-json-ld-to-rdf-algorithm\">Deserialize JSON-LD to RDF Algorithm</a>\n            passing <var>node map</var>, <var>dataset</var>,\n            and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonldoptions-producegeneralizedrdf\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>produceGeneralizedRdf</code></code></a> flag from <a data-lt=\"jsonldprocessor-toRdf-options\" href=\"https://www.w3.org/TR/json-ld11-api/#dfn-jsonldprocessor-tordf-options\" class=\"internalDFN\" data-link-type=\"dfn\">options</a>."
        },
        {
          "html": "Resolve the <var>promise</var> with <var>dataset</var>."
        }
      ]
    },
    {
      "name": "LoadDocumentCallback",
      "href": "https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentcallback",
      "html": "The <dfn data-dfn-type=\"callback\" data-export=\"\" id=\"dom-loaddocumentcallback\" data-idl=\"callback\" data-title=\"LoadDocumentCallback\" data-dfn-for=\"\"><code>LoadDocumentCallback</code></dfn> defines a callback that custom document loaders\n        have to implement to be used to retrieve remote documents and contexts.\n        The callback returns a <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> resolving to a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument\" class=\"internalDFN\" data-link-type=\"idl\"><code>RemoteDocument</code></a>.\n        On failure, the <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> having an appropriate error <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror-code\" class=\"internalDFN\" data-link-type=\"idl\"><code>code</code></a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Create a new <a data-type=\"interface\" href=\"https://heycam.github.io/webidl/#idl-promise\"><code>Promise</code></a> <var>promise</var> and return it.\n          The following steps are then deferred."
        },
        {
          "html": "Set <var>document</var> to the body retrieved from\n          the resource identified by <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>,\n          or by otherwise locating a resource associated with <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>.\n          When requesting remote documents the request <em class=\"rfc2119\" title=\"MUST\">MUST</em> prefer <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc2045#section-5\">Content-Type</a> <code>application/ld+json</code>\n          followed by <code>application/json</code>.\n\n          <p>If <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-requestprofile\" class=\"internalDFN\" data-link-type=\"idl\"><code>requestProfile</code></a> is set,\n            it <em class=\"rfc2119\" title=\"MUST\">MUST</em> be added as a profile on <code>application/ld+json</code>.</p>\n\n          <p>Processors <em class=\"rfc2119\" title=\"MAY\">MAY</em> include other media types using a <code>+json</code> suffix as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc6839\" title=\"Additional Media Type Structured Syntax Suffixes\">RFC6839</a></cite>].</p>"
        },
        {
          "html": "Set <var>documentUrl</var> to the location of the retrieved resource\n          considering redirections (exclusive of HTTP status <code>303</code> \"See Other\" redirects\n          as discussed in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-cooluris\" title=\"Cool URIs for the Semantic Web\">cooluris</a></cite>])."
        },
        {
          "html": "If the retrieved resource's <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc2045#section-5\">Content-Type</a> is not <code>application/json</code>\n          nor any media type with a <code>+json</code> suffix as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc6839\" title=\"Additional Media Type Structured Syntax Suffixes\">RFC6839</a></cite>],\n          and the response has an HTTP Link Header [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc8288\" title=\"Web Linking\">RFC8288</a></cite>] using the <code>alternate</code> link relation\n          with type <code>application/ld+json</code>,\n          set <var>url</var> to the associated <code>href</code> relative to the previous <var>url</var>\n          and restart the algorithm from <a href=\"https://www.w3.org/TR/json-ld11-api/#LoadDocumentCallback-step-2\">step 2</a>."
        },
        {
          "html": "If the retrieved resource's <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc2045#section-5\">Content-Type</a> is <code>application/json</code>\n          or any media type with a <code>+json</code> suffix as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc6839\" title=\"Additional Media Type Structured Syntax Suffixes\">RFC6839</a></cite>]\n          except <code>application/ld+json</code>,\n          and the response has an HTTP Link Header [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc8288\" title=\"Web Linking\">RFC8288</a></cite>] using the <code>http://www.w3.org/ns/json-ld#context</code> link relation,\n          set <var>contextUrl</var> to the associated <code>href</code>.\n          <p>If multiple HTTP Link Headers using the <code>http://www.w3.org/ns/json-ld#context</code> link relation are found,\n            the <var>promise</var> is rejected with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> whose <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror-code\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>code</code></code></a> is set to <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-multiple-context-link-headers\" class=\"internalDFN\" data-link-type=\"idl\"><code>multiple context link headers</code></a>\n            and processing is terminated.</p>\n          <p>Processors <em class=\"rfc2119\" title=\"MAY\">MAY</em> transform <var>document</var> to the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a>.</p>"
        },
        {
          "html": "Otherwise, the retrieved document's <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc2045#section-5\">Content-Type</a> is neither\n          <code>application/json</code>,\n          <code>application/ld+json</code>,\n          nor any other media type using a\n          <code>+json</code> suffix as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-rfc6839\" title=\"Additional Media Type Structured Syntax Suffixes\">RFC6839</a></cite>].\n          Reject the <var>promise</var> passing a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-document-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading document failed</code></a> error."
        },
        {
          "html": "Create a new <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument\" class=\"internalDFN\" data-link-type=\"idl\"><code>RemoteDocument</code></a> <var>remote document</var> using\n          <var>url</var> as <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-documenturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>documentUrl</code></code></a>,\n          <var>document</var> as <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-document\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>document</code></code></a>,\n          the returned <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc2045#section-5\">Content-Type</a> (without parameters) as <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-contenttype\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>contentType</code></code></a>,\n          any returned <code>profile</code> parameter, or <code>null</code> as <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-profile\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>profile</code></code></a>,\n          and <var>contextUrl</var>, or <code>null</code> as <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-remotedocument-contexturl\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>contextUrl</code></code></a>."
        },
        {
          "html": "Resolve the <var>promise</var> with <var>remote document</var>."
        }
      ]
    },
    {
      "html": "After <a href=\"https://www.w3.org/TR/json-ld11-api/#LoadDocumentCallback-step-5\">step 5</a>, add the following processing step:\n        Otherwise, if the retrieved resource's <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc2045#section-5\">Content-Type</a> is either <code>text/html</code>\n        or <code>application/xhtml+xml</code>:",
      "rationale": "set",
      "steps": [
        {
          "html": "Set <var>documentUrl</var> to the <a href=\"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#document-base-url\">Document Base URL</a>\n          of <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a>, as defined in [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-html\" title=\"HTML Standard\">HTML</a></cite>],\n          using the existing <var>documentUrl</var> as the document's URL."
        },
        {
          "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-url\" class=\"internalDFN\" data-link-type=\"dfn\">url</a> parameter\n          contains a <a href=\"https://tools.ietf.org/html/rfc3986#section-3.5\">fragment identifier</a>,\n          set <var>source</var> to the <a href=\"https://dom.spec.whatwg.org/#dom-node-textcontent\">textContent</a>\n          of the <a href=\"https://html.spec.whatwg.org/multipage/scripting.html#the-script-element\">script element</a> in <var>document</var>\n          having an <a href=\"https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute\">id attribute</a>\n          that matches the fragment identifier, after decoding <a href=\"https://tools.ietf.org/html/rfc3986#section-2.1\">percent encoded sequences</a>.\n          <p>If no such element is found,\n            or the located element is not a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-json-ld-script-element\" class=\"internalDFN\" data-link-type=\"dfn\">JSON-LD script element</a>,\n            the <var>promise</var> is rejected with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> whose <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror-code\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>code</code></code></a> is set to <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-document-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading document failed</code></a>\n            and processing is terminated.</p>"
        },
        {
          "html": "Otherwise, if the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-profile\" class=\"internalDFN\" data-link-type=\"idl\"><code>profile</code></a>\n          option is specified,\n          set <var>source</var> to the result of transforming the\n          <a href=\"https://dom.spec.whatwg.org/#dom-node-textcontent\">textContent</a>\n          of the first <a href=\"https://html.spec.whatwg.org/multipage/scripting.html#the-script-element\">script element</a> in <var>document</var>\n          having an <a href=\"https://html.spec.whatwg.org/multipage/semantics.html#attr-link-type\">type attribute</a>\n          of <code>application/ld+json</code> along with the value of the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-profile\" class=\"internalDFN\" data-link-type=\"idl\"><code>profile</code></a> option, if found."
        },
        {
          "html": "If <var>source</var> is still undefined and the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code>extractAllScripts</code></a> option is not present, or <code>false</code>,\n          set <var>source</var> to the <a href=\"https://dom.spec.whatwg.org/#dom-node-textcontent\">textContent</a>\n          of the first <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-json-ld-script-element\" class=\"internalDFN\" data-link-type=\"dfn\">JSON-LD script element</a> in <var>document</var>.\n          <p>If no such element is found,\n            or the located element is not a <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-json-ld-script-element\" class=\"internalDFN\" data-link-type=\"dfn\">JSON-LD script element</a>,\n            the <var>promise</var> is rejected with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> whose <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror-code\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>code</code></code></a> is set to <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-document-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading document failed</code></a>\n            and processing is terminated.</p>"
        },
        {
          "html": "If <var>source</var> is defined,\n          set <var>document</var> to the result of the\n          <a href=\"https://www.w3.org/TR/json-ld11-api/#extract-script-content\">Extract Script Content algorithm</a>,\n          using <var>source</var>, rejecting <var>promise</var>\n          with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> whose code set from the result, if an error is detected\n          and processing is terminated."
        },
        {
          "html": "Otherwise, <var>source</var> is undefined.",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code>extractAllScripts</code></a> option is not present, or <code>false</code>,\n              the <var>promise</var> is rejected with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> whose <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror-code\" class=\"internalDFN\" data-link-type=\"idl\"><code><code>code</code></code></a> is set to <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-loading-document-failed\" class=\"internalDFN\" data-link-type=\"idl\"><code>loading document failed</code></a>\n              and processing is terminated."
            },
            {
              "html": "Otherwise, the <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-loaddocumentoptions-extractallscripts\" class=\"internalDFN\" data-link-type=\"idl\"><code>extractAllScripts</code></a> option is <code>true</code>.\n              Set <var>document</var> to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>.\n              For each <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-json-ld-script-element\" class=\"internalDFN\" data-link-type=\"dfn\">JSON-LD script element</a> in <var>input</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var>source</var> to its <a href=\"https://dom.spec.whatwg.org/#dom-node-textcontent\">textContent</a>."
                },
                {
                  "html": "Set <var>script content</var> to the result of the <a href=\"https://www.w3.org/TR/json-ld11-api/#extract-script-content\">Extract Script Content algorithm</a>,\n                  using <var>source</var>, rejecting <var>promise</var>\n                  with a <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderror\" class=\"internalDFN\" data-link-type=\"idl\"><code>JsonLdError</code></a> whose code set from the result, if an error is detected\n                  and processing is terminated."
                },
                {
                  "html": "If <var>script content</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a>, merge it to the end of <var>document</var>."
                },
                {
                  "html": "Otherwise, append <var>script content</var> to <var>document</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "JSON-LD script element",
      "href": "https://www.w3.org/TR/json-ld11-api/#dfn-json-ld-script-element",
      "html": "The algorithm extracts the text content a\n        <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-json-ld-script-element\" class=\"internalDFN\" data-link-type=\"dfn\">JSON-LD script element</a> into a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a> or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">array</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">maps</a>.\n        A <dfn data-dfn-type=\"dfn\" data-plurals=\"json-ld script elements\" id=\"dfn-json-ld-script-element\">JSON-LD script element</dfn> is a <a href=\"https://html.spec.whatwg.org/multipage/scripting.html#the-script-element\">script element</a>\n        within an HTML [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/json-ld11-api/#bib-html\" title=\"HTML Standard\">HTML</a></cite>] document with the <a href=\"https://html.spec.whatwg.org/multipage/semantics.html#attr-link-type\">type attribute</a> set to\n        <code>application/ld+json</code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>source</var> is not a valid JSON document,\n        an <a href=\"https://www.w3.org/TR/json-ld11-api/#dom-jsonlderrorcode-invalid-script-element\" class=\"internalDFN\" data-link-type=\"idl\"><code>invalid script element</code></a> has been detected, and processing is aborted."
        },
        {
          "html": "Return the result of transforming <var>source</var> into the <a href=\"https://www.w3.org/TR/json-ld11-api/#dfn-internal-representation\" class=\"internalDFN\" data-link-type=\"dfn\">internal representation</a>."
        }
      ]
    }
  ]
}