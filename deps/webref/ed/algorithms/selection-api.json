{
  "spec": {
    "title": "Selection API",
    "url": "https://w3c.github.io/selection-api/"
  },
  "algorithms": [
    {
      "name": "Selection/addRange()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-addrange",
      "html": "The method must follow these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> of the <var>range</var>'s boundary points\n            are not the <a data-cite=\"dom#document\" data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\">document</a> associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>, abort these\n            steps."
        },
        {
          "html": "If <code>rangeCount</code> is not <code>0</code>, abort these\n            steps."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s range to <var>range</var> by a strong reference\n            (not by making a copy)."
        }
      ]
    },
    {
      "name": "Selection/getComposedRanges()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-getcomposedranges",
      "html": "",
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is <a href=\"https://w3c.github.io/selection-api/#dfn-empty\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-empty-9\">empty</a>, return an empty array."
        },
        {
          "html": "Otherwise, let <var>startNode</var> be <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start-node\" href=\"https://dom.spec.whatwg.org/#concept-range-start-node\">start node</a> of\n            the <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a> associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>, and let\n            <var>startOffset</var> be <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start-offset\" href=\"https://dom.spec.whatwg.org/#concept-range-start-offset\">start offset</a> of the <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>."
        },
        {
          "html": "While <var>startNode</var> is a <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-node\" href=\"https://dom.spec.whatwg.org/#concept-node\">node</a>,\n            <var>startNode</var>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> is a <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-root\" href=\"https://dom.spec.whatwg.org/#concept-shadow-root\">shadow root</a>, and\n            <var>startNode</var>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> is not a <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-including-inclusive-ancestor\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor\">shadow-including inclusive ancestor</a> of any of\n            <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"GetComposedRangesOptions\" data-xref-for=\"GetComposedRangesOptions\" href=\"https://w3c.github.io/selection-api/#dom-getcomposedrangesoptions-shadowroots\" class=\"internalDFN\" id=\"ref-for-dom-getcomposedrangesoptions-shadowroots-1\"><code>shadowRoots</code></a>\"],\n            repeat these steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var>startOffset</var> to <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-index\" href=\"https://dom.spec.whatwg.org/#concept-tree-index\">index</a> of\n                <var>startNode</var>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>'s <a data-link-type=\"dfn\" data-cite=\"url\" data-cite-path=\"\" data-cite-frag=\"concept-host\" href=\"https://url.spec.whatwg.org/#concept-host\">host</a>."
            },
            {
              "html": "Set <var>startNode</var> to <var>startNode</var>'s\n                <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>'s <a data-link-type=\"dfn\" data-cite=\"url\" data-cite-path=\"\" data-cite-frag=\"concept-host\" href=\"https://url.spec.whatwg.org/#concept-host\">host</a>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-parent\" href=\"https://dom.spec.whatwg.org/#concept-tree-parent\">parent</a>."
            }
          ]
        },
        {
          "html": "Let <var>endNode</var> be <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end-node\" href=\"https://dom.spec.whatwg.org/#concept-range-end-node\">end node</a> of the <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>\n            associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>, and let <var>endOffset</var> be\n            <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end-offset\" href=\"https://dom.spec.whatwg.org/#concept-range-end-offset\">end offset</a> of the <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>."
        },
        {
          "html": "While <var>endNode</var> is a <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-node\" href=\"https://dom.spec.whatwg.org/#concept-node\">node</a>, <var>endNode</var>'s\n            <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> is a <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-root\" href=\"https://dom.spec.whatwg.org/#concept-shadow-root\">shadow root</a>, and <var>endNode</var>'s\n            <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> is not a <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-including-inclusive-ancestor\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor\">shadow-including inclusive ancestor</a> of\n            any of\n            <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"GetComposedRangesOptions\" data-xref-for=\"GetComposedRangesOptions\" href=\"https://w3c.github.io/selection-api/#dom-getcomposedrangesoptions-shadowroots\" class=\"internalDFN\" id=\"ref-for-dom-getcomposedrangesoptions-shadowroots-2\"><code>shadowRoots</code></a>\"],\n            repeat these steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var>endOffset</var> to <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-index\" href=\"https://dom.spec.whatwg.org/#concept-tree-index\">index</a> of\n                <var>endNode</var>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>'s <a data-link-type=\"dfn\" data-cite=\"url\" data-cite-path=\"\" data-cite-frag=\"concept-host\" href=\"https://url.spec.whatwg.org/#concept-host\">host</a> plus 1."
            },
            {
              "html": "Set <var>endNode</var> to <var>endNode</var>'s\n                <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>'s <a data-link-type=\"dfn\" data-cite=\"url\" data-cite-path=\"\" data-cite-frag=\"concept-host\" href=\"https://url.spec.whatwg.org/#concept-host\">host</a>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-parent\" href=\"https://dom.spec.whatwg.org/#concept-tree-parent\">parent</a>."
            }
          ]
        },
        {
          "html": "Return an array consisting of new <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"StaticRange\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"staticrange\" href=\"https://dom.spec.whatwg.org/#staticrange\"><code>StaticRange</code></a> whose\n            <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start-node\" href=\"https://dom.spec.whatwg.org/#concept-range-start-node\">start node</a> is <var>startNode</var>, <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start-offset\" href=\"https://dom.spec.whatwg.org/#concept-range-start-offset\">start offset</a> is <var>startOffset</var>, <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end-node\" href=\"https://dom.spec.whatwg.org/#concept-range-end-node\">end node</a> is\n            <var>endNode</var>, and <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end-offset\" href=\"https://dom.spec.whatwg.org/#concept-range-end-offset\">end offset</a> is\n            <var>endOffset</var>."
        }
      ]
    },
    {
      "name": "Selection/collapse()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-collapse",
      "html": "The method must follow these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>node</var> is null, this method must behave identically\n            as <code>removeAllRanges()</code> and abort these steps."
        },
        {
          "html": "If <var>node</var> is a <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DocumentType\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"documenttype\" href=\"https://dom.spec.whatwg.org/#documenttype\"><code>DocumentType</code></a>, throw an\n            <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidNodeTypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidnodetypeerror\" href=\"https://webidl.spec.whatwg.org/#invalidnodetypeerror\"><code>InvalidNodeTypeError</code></a> exception and abort these steps."
        },
        {
          "html": "The method must throw an <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"IndexSizeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"indexsizeerror\" href=\"https://webidl.spec.whatwg.org/#indexsizeerror\"><code>IndexSizeError</code></a> exception if <var>\n              offset</var> is longer than <var>node</var>'s <a data-link-type=\"dfn\" data-link-for=\"Node\" data-xref-for=\"Node\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-node-length\" href=\"https://dom.spec.whatwg.org/#concept-node-length\">length</a> and\n              abort these steps."
        },
        {
          "html": "If <a data-cite=\"dom#document\" data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\">document</a> associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is not a\n            <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-including-inclusive-ancestor\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor\">shadow-including inclusive ancestor</a> of <var>node</var>, abort\n            these steps."
        },
        {
          "html": "Otherwise, let <var>newRange</var> be a new <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>."
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"Range\" data-xref-for=\"Range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-set\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-set\">Set the start</a> the <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start\" href=\"https://dom.spec.whatwg.org/#concept-range-start\">start</a> and the\n            <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end\" href=\"https://dom.spec.whatwg.org/#concept-range-end\">end</a> of <var>newRange</var> to (<var>node</var>,\n            <var>offset</var>)."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a> to <var>newRange</var>."
        }
      ]
    },
    {
      "name": "Selection/extend()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-extend",
      "html": "The method must follow these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-cite=\"dom#document\" data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\">document</a> associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is not a\n            <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-including-inclusive-ancestor\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor\">shadow-including inclusive ancestor</a> of <var>node</var>, abort\n            these steps."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is <a href=\"https://w3c.github.io/selection-api/#dfn-empty\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-empty-12\">empty</a>, throw an <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\n            exception and abort these steps."
        },
        {
          "html": "Let <var>oldAnchor</var> and <var>oldFocus</var> be the\n            <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-anchor\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-anchor-14\">anchor</a> and <a href=\"https://w3c.github.io/selection-api/#dfn-focus\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-focus-14\">focus</a>, and let\n            <var>newFocus</var> be the <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range-bp\">boundary point</a> (<var>node</var>,\n            <var>offset</var>)."
        },
        {
          "html": "Let <var>newRange</var> be a new <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>."
        },
        {
          "html": "If <var>node</var>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> is not the same as the\n            <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a>, <a data-link-type=\"dfn\" data-link-for=\"Range\" data-xref-for=\"Range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-set\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-set\">set the start</a>\n            <var>newRange</var>'s <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start\" href=\"https://dom.spec.whatwg.org/#concept-range-start\">start</a> and <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end\" href=\"https://dom.spec.whatwg.org/#concept-range-end\">end</a> to\n            <var>newFocus</var>."
        },
        {
          "html": "Otherwise, if <var>oldAnchor</var> is <a data-link-type=\"dfn\" data-link-for=\"boundary point\" data-xref-for=\"boundary point\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-before\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-before\">before</a>\n            or equal to <var>newFocus</var>, <a data-link-type=\"dfn\" data-link-for=\"Range\" data-xref-for=\"Range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-set\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-set\">set the start</a>\n            <var>newRange</var>'s <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start\" href=\"https://dom.spec.whatwg.org/#concept-range-start\">start</a> to <var>oldAnchor</var>, then\n            set its <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end\" href=\"https://dom.spec.whatwg.org/#concept-range-end\">end</a> to <var>newFocus</var>."
        },
        {
          "html": "Otherwise, <a data-link-type=\"dfn\" data-link-for=\"Range\" data-xref-for=\"Range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-set\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-set\">set the start</a> <var>newRange</var>'s\n            <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start\" href=\"https://dom.spec.whatwg.org/#concept-range-start\">start</a> to <var>newFocus</var>, then set its <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end\" href=\"https://dom.spec.whatwg.org/#concept-range-end\">end</a>\n            to <var>oldAnchor</var>."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a> to <var>newRange</var>."
        },
        {
          "html": "If <var>newFocus</var> is <a data-link-type=\"dfn\" data-link-for=\"boundary point\" data-xref-for=\"boundary point\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-before\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-before\">before</a>\n            <var>oldAnchor</var>, set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-direction\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-direction-3\">direction</a> to\n            <a href=\"https://w3c.github.io/selection-api/#dfn-backwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-backwards-3\">backwards</a>. Otherwise, set it to <a href=\"https://w3c.github.io/selection-api/#dfn-forwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-forwards-4\">forwards</a>."
        }
      ]
    },
    {
      "name": "Selection/setBaseAndExtent()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-setbaseandextent",
      "html": "The method must follow these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>anchorOffset</var> is longer than\n            <var>anchorNode</var>'s <a data-link-type=\"dfn\" data-link-for=\"Node\" data-xref-for=\"Node\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-node-length\" href=\"https://dom.spec.whatwg.org/#concept-node-length\">length</a> or if\n            <var>focusOffset</var> is longer than <var>focusNode</var>'s\n            <a data-link-type=\"dfn\" data-link-for=\"Node\" data-xref-for=\"Node\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-node-length\" href=\"https://dom.spec.whatwg.org/#concept-node-length\">length</a>, throw an <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"IndexSizeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"indexsizeerror\" href=\"https://webidl.spec.whatwg.org/#indexsizeerror\"><code>IndexSizeError</code></a> exception and abort\n            these steps."
        },
        {
          "html": "If <a data-cite=\"dom#document\" data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\">document</a> associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is not a\n            <a data-link-type=\"dfn\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-shadow-including-inclusive-ancestor\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor\">shadow-including inclusive ancestor</a> of <var>anchorNode</var> or\n            <var>focusNode</var>, abort these steps."
        },
        {
          "html": "Let <var>anchor</var> be the <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range-bp\">boundary point</a>\n            (<var>anchorNode</var>, <var>anchorOffset</var>) and let\n            <var>focus</var> be the <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range-bp\">boundary point</a>\n            (<var>focusNode</var>, <var>focusOffset</var>)."
        },
        {
          "html": "Let <var>newRange</var> be a new <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a>."
        },
        {
          "html": "If <var>anchor</var> is <a data-link-type=\"dfn\" data-link-for=\"boundary point\" data-xref-for=\"boundary point\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-before\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-before\">before</a>\n            <var>focus</var>, <a data-link-type=\"dfn\" data-link-for=\"Range\" data-xref-for=\"Range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-set\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-set\">set the start</a> the <var>newRange</var>'s\n            <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start\" href=\"https://dom.spec.whatwg.org/#concept-range-start\">start</a> to <var>anchor</var> and its <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end\" href=\"https://dom.spec.whatwg.org/#concept-range-end\">end</a> to <var>\n              focus</var>. Otherwise, <a data-link-type=\"dfn\" data-link-for=\"Range\" data-xref-for=\"Range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-set\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-set\">set the start</a> them to\n              <var>focus</var> and <var>anchor</var> respectively."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a> to <var>newRange</var>."
        },
        {
          "html": "If <var>focus</var> is <a data-link-type=\"dfn\" data-link-for=\"boundary point\" data-xref-for=\"boundary point\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-bp-before\" href=\"https://dom.spec.whatwg.org/#concept-range-bp-before\">before</a>\n            <var>anchor</var>, set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-direction\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-direction-4\">direction</a> to\n            <a href=\"https://w3c.github.io/selection-api/#dfn-backwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-backwards-4\">backwards</a>. Otherwise, set it to <a href=\"https://w3c.github.io/selection-api/#dfn-forwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-forwards-5\">forwards</a>"
        }
      ]
    },
    {
      "name": "Selection/selectAllChildren()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-selectallchildren",
      "html": "The method must follow these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>node</var> is a <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DocumentType\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"documenttype\" href=\"https://dom.spec.whatwg.org/#documenttype\"><code>DocumentType</code></a>, throw an\n            <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidNodeTypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidnodetypeerror\" href=\"https://webidl.spec.whatwg.org/#invalidnodetypeerror\"><code>InvalidNodeTypeError</code></a> exception and abort these steps."
        },
        {
          "html": "If <var>node</var>'s <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-root\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\">root</a> is not the <a data-cite=\"dom#document\" data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\">document</a>\n            associated with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>, abort these steps."
        },
        {
          "html": "Let <var>newRange</var> be a new <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a> and\n            <var>childCount</var> be the number of <a data-link-type=\"dfn\" data-link-for=\"tree\" data-xref-for=\"tree\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-tree-child\" href=\"https://dom.spec.whatwg.org/#concept-tree-child\">children</a> of\n            <var>node</var>."
        },
        {
          "html": "Set <var>newRange</var>'s <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-start\" href=\"https://dom.spec.whatwg.org/#concept-range-start\">start</a> to (<var>node</var>,\n            <code>0</code>)."
        },
        {
          "html": "Set <var>newRange</var>'s <a data-link-type=\"dfn\" data-link-for=\"range\" data-xref-for=\"range\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range-end\" href=\"https://dom.spec.whatwg.org/#concept-range-end\">end</a> to (<var>node</var>,\n            <var>childCount</var>)."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-range\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-range\">range</a> to <var>newRange</var>."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-direction\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-direction-5\">direction</a> to <var>forwards</var>."
        }
      ]
    },
    {
      "name": "Selection/modify()",
      "href": "https://w3c.github.io/selection-api/#dom-selection-modify",
      "html": "The method must follow these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>alter</var> is not <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a> match\n            with \"extend\" or \"move\", abort these steps."
        },
        {
          "html": "If <var>direction</var> is not <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a>\n            match with \"forward\", \"backward\", \"left\", or \"right\", abort these\n            steps."
        },
        {
          "html": "If <var>granularity</var> is not <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a>\n            match with \"character\", \"word\", \"sentence\", \"line\", \"paragraph\",\n            \"lineboundary\", \"sentenceboundary\", \"paragraphboundary\",\n            \"documentboundary\", abort these steps."
        },
        {
          "html": "If <a data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> <a href=\"https://w3c.github.io/selection-api/#dfn-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selection-25\">selection</a> is empty, abort these steps."
        },
        {
          "html": "Let <var>effectiveDirection</var> be <a href=\"https://w3c.github.io/selection-api/#dfn-backwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-backwards-5\">backwards</a>."
        },
        {
          "html": "If <var>direction</var> is <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a> match\n            with \"forward\", set <var>effectiveDirection</var> to\n            <a href=\"https://w3c.github.io/selection-api/#dfn-forwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-forwards-6\">forwards</a>."
        },
        {
          "html": "If <var>direction</var> is <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a> match\n            with \"right\" and <a data-link-type=\"dfn\" data-cite=\"css-writing-modes-4\" data-cite-path=\"\" data-cite-frag=\"inline-base-direction\" href=\"https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction\">inline base direction</a> of <a data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>\n            <a href=\"https://w3c.github.io/selection-api/#dfn-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selection-26\">selection</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-focus\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-focus-15\">focus</a> is <a data-xref-type=\"css-value\" data-xref-for=\"direction\" data-cite=\"css-writing-modes-4\" data-cite-path=\"\" data-cite-frag=\"valdef-direction-ltr\" data-link-type=\"css-value\" data-link-for=\"direction\" href=\"https://www.w3.org/TR/css-writing-modes-4/#valdef-direction-ltr\">ltr</a>, set\n            <var>effectiveDirection</var> to <a href=\"https://w3c.github.io/selection-api/#dfn-forwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-forwards-7\">forwards</a>."
        },
        {
          "html": "If <var>direction</var> is <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a> match\n            with \"left\" and <a data-link-type=\"dfn\" data-cite=\"css-writing-modes-4\" data-cite-path=\"\" data-cite-frag=\"inline-base-direction\" href=\"https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction\">inline base direction</a> of <a data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>\n            <a href=\"https://w3c.github.io/selection-api/#dfn-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selection-27\">selection</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-focus\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-focus-16\">focus</a> is <a data-xref-type=\"css-value\" data-xref-for=\"direction\" data-cite=\"css-writing-modes-4\" data-cite-path=\"\" data-cite-frag=\"valdef-direction-rtl\" data-link-type=\"css-value\" data-link-for=\"direction\" href=\"https://www.w3.org/TR/css-writing-modes-4/#valdef-direction-rtl\">rtl</a>, set\n            <var>effectiveDirection</var> to <a href=\"https://w3c.github.io/selection-api/#dfn-forwards\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-forwards-8\">forwards</a>."
        },
        {
          "html": "Set <a data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> <a href=\"https://w3c.github.io/selection-api/#dfn-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selection-28\">selection</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-direction\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-direction-6\">direction</a> to\n            <var>effectiveDirection</var>."
        },
        {
          "html": "If <var>alter</var> is <a data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"ascii-case-insensitive\" data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\">ASCII case-insensitive</a> match with\n            \"extend\", set <a data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> <a href=\"https://w3c.github.io/selection-api/#dfn-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selection-29\">selection</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-focus\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-focus-17\">focus</a> to the\n            location as if the user had requested to extend selection by <var>\n              granularity</var>."
        },
        {
          "html": "Otherwise, set <a data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> <a href=\"https://w3c.github.io/selection-api/#dfn-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selection-30\">selection</a>'s <a href=\"https://w3c.github.io/selection-api/#dfn-focus\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-focus-18\">focus</a> and\n            <a href=\"https://w3c.github.io/selection-api/#dfn-anchor\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-anchor-15\">anchor</a> to the location as if the user had requested to move\n            selection by <var>granularity</var>."
        }
      ]
    },
    {
      "name": "schedule a selectionchange event",
      "href": "https://w3c.github.io/selection-api/#dfn-schedule-a-selectionchange-event",
      "html": "To <dfn id=\"dfn-schedule-a-selectionchange-event\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">schedule a selectionchange event</dfn> on a node\n            <var>target</var>, run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>target</var>'s <a href=\"https://w3c.github.io/selection-api/#dfn-has-scheduled-selectionchange-event\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-has-scheduled-selectionchange-event-1\">has scheduled selectionchange\n            event</a> is true, abort these steps."
        },
        {
          "html": "<a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-task\" data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"user-interaction-task-source\" data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\">user interaction task source</a> to\n              <a href=\"https://w3c.github.io/selection-api/#dfn-fire-a-selectionchange-event\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-fire-a-selectionchange-event-1\">fire a selectionchange event</a> on <var>target</var>."
        }
      ]
    },
    {
      "name": "fire a selectionchange event",
      "href": "https://w3c.github.io/selection-api/#dfn-fire-a-selectionchange-event",
      "html": "To <dfn id=\"dfn-fire-a-selectionchange-event\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">fire a selectionchange event</dfn> on a node\n            <var>target</var>, run these steps:",
      "rationale": "set",
      "steps": [
        {
          "html": "Set <var>target</var>'s <a href=\"https://w3c.github.io/selection-api/#dfn-has-scheduled-selectionchange-event\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-has-scheduled-selectionchange-event-2\">has scheduled selectionchange\n            event</a> to false."
        },
        {
          "html": "If <var>target</var> is an element, <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-event-fire\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named\n            <code>selectionchange</code>, which bubbles and not cancelable, at\n            <var>target</var>."
        },
        {
          "html": "Otherwise, if <var>target</var> is a document, <a data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"concept-event-fire\" data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an\n            event</a> named <code>selectionchange</code>, which does not bubble\n            and not cancelable, at <var>target</var>."
        }
      ]
    }
  ]
}