{
  "spec": {
    "title": "Navigational-Tracking Mitigations",
    "url": "https://privacycg.github.io/nav-tracking-mitigations/"
  },
  "algorithms": [
    {
      "name": "record a user activation",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#record-a-user-activation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"record-a-user-activation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">record a user activation</dfn> given a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document\">Document</a> <var>document</var>, perform\nthe following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable\">node navigable</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is null, then abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document\">active document</a>.</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be <var>topDocument</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>origin</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque\">opaque origin</a> then abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>site</var> be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site\">obtain a site</a> given <var>origin</var>.</p>"
        },
        {
          "html": "<p>Let <var>host</var> be <var>site</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①⓪\">host</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove\">Remove</a> <var>host</var> from the <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map②\">bounce tracking map</a>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#user-activation-map\" id=\"ref-for-user-activation-map①\">user activation map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time\" id=\"ref-for-dfn-eso-current-wall-time\">current wall time</a>.</p>"
        }
      ]
    },
    {
      "html": "Append the following steps to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#activation-notification\" id=\"ref-for-activation-notification\">activation notification</a> steps in the <a href=\"https://html.spec.whatwg.org/multipage/interaction.html#user-activation-processing-model\">user activation processing\nmodel</a>:",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#record-a-user-activation\" id=\"ref-for-record-a-user-activation\">record a user activation</a> given <var>document</var>.</p>"
        }
      ]
    },
    {
      "html": "Insert the following steps in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot\" id=\"ref-for-dom-publickeycredential-discoverfromexternalsource-slot①\">[[DiscoverFromExternalSource]]()</a></code> algorithm\n    in step 17, under \"If any authenticator indicates success\":",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#process-a-web-authentication-assertion-for-bounce-tracking-mitigations\" id=\"ref-for-process-a-web-authentication-assertion-for-bounce-tracking-mitigations\">process a Web Authentication assertion for bounce tracking mitigations</a> given <var>callerOrigin</var> and <var>browsingContext</var>.</p>"
        }
      ]
    },
    {
      "name": "process a Web Authentication assertion for bounce tracking mitigations",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#process-a-web-authentication-assertion-for-bounce-tracking-mitigations",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-a-web-authentication-assertion-for-bounce-tracking-mitigations\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a Web Authentication assertion for bounce tracking mitigations</dfn> given\n    a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context\" id=\"ref-for-browsing-context\">browsing context</a> <var>browsingContext</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>browsingContext</var> is null, then abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>topDocument</var> be <var>browsingContext</var>’s active document.</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be <var>topDocument</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>origin</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque①\">opaque origin</a> then abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>site</var> be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site①\">obtain a site</a> given <var>origin</var>.</p>"
        },
        {
          "html": "<p>Let <var>host</var> be <var>site</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①①\">host</a>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#user-activation-map\" id=\"ref-for-user-activation-map②\">user activation map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time\" id=\"ref-for-dfn-eso-current-wall-time①\">current wall time</a>.</p>"
        }
      ]
    },
    {
      "html": "Insert the following steps in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate\">navigate</a> algorithm before step 8,\n\"Navigate to a fragment given navigable, url, historyHandling, and navigationId.\"",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#process-navigation-start-for-bounce-tracking\" id=\"ref-for-process-navigation-start-for-bounce-tracking\">process navigation start for bounce tracking</a> given <var>navigable</var>, <var>sourceDocument</var>, and <var>sourceSnapshotParams</var>.</p>"
        }
      ]
    },
    {
      "name": "process navigation start for bounce tracking",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#process-navigation-start-for-bounce-tracking",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-navigation-start-for-bounce-tracking\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process navigation start for bounce tracking</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable\">navigable</a> <var>navigable</var>, <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document①\">Document</a> <var>sourceDocument</var>, and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params\" id=\"ref-for-source-snapshot-params\">source snapshot params</a> <var>sourceSnapshotParams</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③\">top-level traversable</a>, then abort these steps.</p>"
        },
        {
          "html": "<p>Remove any queued global tasks to <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#record-bounces-for-bounce-tracking\" id=\"ref-for-record-bounces-for-bounce-tracking\">record bounces for bounce tracking</a> from the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source\">networking task source</a>.</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be <var>sourceDocument</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin②\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>origin</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque②\">opaque origin</a>, set <var>initialHost</var> to <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#empty-host\" id=\"ref-for-empty-host\">empty host</a>.</p>"
        },
        {
          "html": "Otherwise,",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>site</var> be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site②\">obtain a site</a> given <var>origin</var>.</p>"
            },
            {
              "html": "<p>Set <var>initialHost</var> to <var>site</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①②\">host</a>.</p>"
            }
          ]
        },
        {
          "html": "If <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record\">bounce tracking record</a> is null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①\">bounce tracking record</a> to a new <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record\" id=\"ref-for-bounce-tracking-record③\">bounce tracking record</a> with <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-initial-host\" id=\"ref-for-bounce-tracking-record-initial-host\">initial host</a> set to <var>initialHost</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise,",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation\" id=\"ref-for-source-snapshot-params-activation\">has transient activation</a> is true:",
              "rationale": "run",
              "steps": [
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#record-bounces-for-bounce-tracking\" id=\"ref-for-record-bounces-for-bounce-tracking①\">record bounces for bounce tracking</a> given <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>.</p>"
                },
                {
                  "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record②\">bounce tracking record</a> to a new <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record\" id=\"ref-for-bounce-tracking-record⑤\">bounce tracking record</a> with <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-initial-host\" id=\"ref-for-bounce-tracking-record-initial-host③\">initial host</a> set to <var>initialHost</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, add <var>initialHost</var> to <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record③\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-bounce-set\" id=\"ref-for-bounce-tracking-record-bounce-set\">bounce set</a>.</p>"
            }
          ]
        },
        {
          "html": "If <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation\" id=\"ref-for-source-snapshot-params-activation①\">has transient activation</a> is true:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>initialHost</var> to <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record④\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-user-activation-set\" id=\"ref-for-bounce-tracking-record-user-activation-set\">user activation set</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "Insert the following steps in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-fetch\" id=\"ref-for-concept-http-network-fetch\">HTTP-network fetch</a> algorithm after step 15,\n\"... run the \"set-cookie-string\" parsing algorithm (see section 5.2 of <a data-link-type=\"biblio\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>) ...\":",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If cookies were stored in the cookie store in the previous step, then\nrun <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#process-a-fetch-storage-access-for-bounce-tracking-mitigations\" id=\"ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations\">process a fetch storage access for bounce tracking mitigations</a> given <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "process a fetch storage access for bounce tracking mitigations",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#process-a-fetch-storage-access-for-bounce-tracking-mitigations",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-a-fetch-storage-access-for-bounce-tracking-mitigations\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a fetch storage access for bounce tracking mitigations</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request\">request</a> <var>request</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>origin</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>origin</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque③\">opaque origin</a>, then abort these steps.</p>"
        },
        {
          "html": "If <var>request</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#subresource-request\" id=\"ref-for-subresource-request\">subresource request</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">client</a> is null, or <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context\" id=\"ref-for-concept-environment-target-browsing-context①\">target browsing context</a> is null, then abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>topLevelTraversable</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context\" id=\"ref-for-concept-environment-target-browsing-context②\">target browsing context</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable\" id=\"ref-for-bc-traversable\">top-level traversable</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise,",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client\">reserved client</a> is null, or <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client①\">reserved client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context\" id=\"ref-for-concept-environment-target-browsing-context③\">target browsing context</a> is null, then abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>topLevelTraversable</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client②\">reserved client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context\" id=\"ref-for-concept-environment-target-browsing-context④\">target browsing context</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#bc-traversable\" id=\"ref-for-bc-traversable①\">top-level traversable</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>topLevelTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record⑤\">bounce tracking record</a> is null, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>site</var> be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site③\">obtain a site</a> given <var>origin</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>site</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①③\">host</a> to <var>topLevelTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record⑥\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-user-activation-set\" id=\"ref-for-bounce-tracking-record-user-activation-set①\">user activation set</a>.</p>"
        }
      ]
    },
    {
      "html": "Insert the following steps in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/ServiceWorker/#handle-fetch\" id=\"ref-for-handle-fetch\">Handle Fetch</a> algorithm after step 23,\n\"If the result of running the Run Service Worker algorithm...\":",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#process-a-fetch-storage-access-for-bounce-tracking-mitigations\" id=\"ref-for-process-a-fetch-storage-access-for-bounce-tracking-mitigations①\">process a fetch storage access for bounce tracking mitigations</a> given <var>request</var>.</p>"
        }
      ]
    },
    {
      "html": "Insert the following steps in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\" id=\"ref-for-create-navigation-params-by-fetching\">create navigation params by fetching</a> algorithm, after Step 19.7,\n\"Wait until either response is non-null...\", which is the point that <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url-list\" id=\"ref-for-concept-response-url-list\">url list</a> becomes available.",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#process-response-received-for-bounce-tracking\" id=\"ref-for-process-response-received-for-bounce-tracking\">process response received for bounce tracking</a> given <var>navigable</var> and <var>response</var>’s <var>URL list</var>.</p>"
        }
      ]
    },
    {
      "name": "process response received for bounce tracking",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#process-response-received-for-bounce-tracking",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-response-received-for-bounce-tracking\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process response received for bounce tracking</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable①\">navigable</a> <var>navigable</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①\">URLs</a> <var>URLs</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑥\">top-level traversable</a>, then abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record⑦\">bounce tracking record</a> is not null.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document②\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout\" id=\"ref-for-run-steps-after-a-timeout\">Run steps after a timeout</a> given:</p>\n      <dl>\n       <dt><var>global</var>\n       </dt><dd><var>global</var>\n       </dd><dt><var>milliseconds</var>\n       </dt><dd><a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#client-bounce-detection-timer-period\" id=\"ref-for-client-bounce-detection-timer-period①\">client bounce detection timer period</a>\n       </dd><dt><var>completionSteps</var>\n       </dt><dd><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source①\">networking task source</a> with <var>global</var> to <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#record-bounces-for-bounce-tracking\" id=\"ref-for-record-bounces-for-bounce-tracking②\">record bounces for bounce tracking</a> given <var>global</var>\n      </dd></dl>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>URL</var> in <var>URLs</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>site</var> be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site④\">obtain a site</a> given <var>URL</var>.</p>"
            },
            {
              "html": "<p>Let <var>host</var> be the <var>site</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①④\">host</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-insert\" id=\"ref-for-concept-node-insert\">Insert</a> <var>host</var> to the <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record⑧\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-bounce-set\" id=\"ref-for-bounce-tracking-record-bounce-set②\">bounce set</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "Insert the following steps in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#loading-a-document\" id=\"ref-for-loading-a-document\">load a document</a> algorithm,\nbefore Step 5, \"Return null\", which is the point that the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document②\">document</a> is loaded.",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#process-document-load-for-bounce-tracking\" id=\"ref-for-process-document-load-for-bounce-tracking\">process document load for bounce tracking</a> given <var>navigable</var> and <var>response</var>’s <var>URL list</var>.</p>"
        }
      ]
    },
    {
      "name": "process document load for bounce tracking",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#process-document-load-for-bounce-tracking",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-document-load-for-bounce-tracking\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process document load for bounce tracking</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable②\">navigable</a> <var>navigable</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a> of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">URLs</a> <var>URLs</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑦\">top-level traversable</a>, then abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record⑨\">bounce tracking record</a> is not null.</p>"
        },
        {
          "html": "<p>If <var>URLs</var> is empty, then abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>finalSite</var> be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site⑤\">obtain a site</a> given the last entry in <var>URLs</var>.</p>"
        },
        {
          "html": "<p>Set the <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①⓪\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-final-host\" id=\"ref-for-bounce-tracking-record-final-host③\">final host</a> to the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①⑥\">host</a> of <var>finalSite</var>.</p>"
        }
      ]
    },
    {
      "name": "bounce tracking timer",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-timer",
      "html": "To run the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"bounce-tracking-timer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">bounce tracking timer</dfn> algorithm given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment④\">moment</a> on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-wall-clock\" id=\"ref-for-dfn-wall-clock③\">wall clock</a> <var>now</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>host</var> -&gt; <var>activationTime</var> of <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#user-activation-map\" id=\"ref-for-user-activation-map④\">user activation map</a>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a> that <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map③\">bounce tracking map</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">contain</a> <var>host</var>.</p>"
            },
            {
              "html": "<p>If <var>activationTime</var> + <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-activation-lifetime\" id=\"ref-for-bounce-tracking-activation-lifetime①\">bounce tracking activation lifetime</a> is before <var>now</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①\">remove</a> <var>host</var> from <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#user-activation-map\" id=\"ref-for-user-activation-map⑤\">user activation map</a>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①\">For each</a> <var>host</var> -&gt; <var>bounceTime</var> of <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map④\">bounce tracking map</a>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a> that <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#user-activation-map\" id=\"ref-for-user-activation-map⑥\">user activation map</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">contain</a> <var>host</var>.</p>"
            },
            {
              "html": "<p>If <var>bounceTime</var> + <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-grace-period\" id=\"ref-for-bounce-tracking-grace-period①\">bounce tracking grace period</a> is after <var>now</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑧\">top-level traversable</a> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document③\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin③\">origin</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site⑥\">site</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①⑦\">host</a> equals <var>host</var>,\nthen <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove②\">Remove</a> <var>host</var> from <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map⑤\">bounce tracking map</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#clear-cookies-for-host\" id=\"ref-for-clear-cookies-for-host\">Clear cookies for host</a> given <var>host</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#clear-non-cookie-storage-for-host\" id=\"ref-for-clear-non-cookie-storage-for-host\">Clear non-cookie storage for host</a> given <var>host</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#clear-cache-for-host\" id=\"ref-for-clear-cache-for-host\">Clear cache for host</a> given <var>host</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "record bounces for bounce tracking",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#record-bounces-for-bounce-tracking",
      "html": "To run the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"record-bounces-for-bounce-tracking\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">record bounces for bounce tracking</dfn> algorithm\ngiven a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object\">global object</a> <var>global</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①\">node navigable</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is null, abort these steps.\nThis ensures that the global has not been detached from the navigable.</p>"
        },
        {
          "html": "<p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document④\">active document</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: <var>topDocument</var> is the same as <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated document</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①①\">bounce tracking record</a> is not null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>host</var> in <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①②\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-bounce-set\" id=\"ref-for-bounce-tracking-record-bounce-set③\">bounce set</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>host</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-equals\" id=\"ref-for-concept-host-equals\">equals</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①③\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-initial-host\" id=\"ref-for-bounce-tracking-record-initial-host④\">initial host</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>host</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-equals\" id=\"ref-for-concept-host-equals①\">equals</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①④\">bounce tracking record</a>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-record-final-host\" id=\"ref-for-bounce-tracking-record-final-host④\">final host</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#user-activation-map\" id=\"ref-for-user-activation-map⑦\">user activation map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">contains</a> <var>host</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map⑥\">bounce tracking map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">contains</a> <var>host</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>. (Only the first bounce time since the\nlast execution of the <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-timer\" id=\"ref-for-bounce-tracking-timer④\">bounce tracking timer</a> is tracked in the map.)</p>"
            },
            {
              "html": "<p>Let <var>topDocument</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑤\">active document</a>.</p>"
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map⑦\">bounce tracking map</a>[<var>host</var>] to <var>topDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object②\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time\" id=\"ref-for-dfn-eso-current-wall-time②\">current wall time</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#top-level-traversable-bounce-tracking-record\" id=\"ref-for-top-level-traversable-bounce-tracking-record①⑤\">bounce tracking record</a> to null.</p>"
        }
      ]
    },
    {
      "name": "clear cookies for host",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#clear-cookies-for-host",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clear-cookies-for-host\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clear cookies for host</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①⑧\">host</a> <var>host</var>, perform the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: <var>host</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①\">registrable domain</a> is <var>host</var> or null.</p>"
        },
        {
          "html": "<p>Let <var>cookieList</var> be a set of cookies, initially empty.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> cookie <var>cookie</var> in the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc6265/#section-5.3\" id=\"ref-for-section-5.3\">cookie store</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>cookie</var> is not <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1\" id=\"ref-for-section-2.1\">partitioned</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>cookie</var>’s <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc6265/#section-5.2.3\" id=\"ref-for-section-5.2.3\">domain attribute</a> is a <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc6265/#section-5.1.3\" id=\"ref-for-section-5.1.3\">domain-match</a> with <var>host</var>, add <var>cookie</var> to <var>cookieList</var>; otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
                }
              ]
            },
            {
              "html": "If <var>cookie</var> is <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.1\" id=\"ref-for-section-2.1①\">partitioned</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If the top-level <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①⓪\">site</a> in <var>cookie</var>’s <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2\" id=\"ref-for-section-2.2\">partition key</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site\">same site</a> with the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①①\">site</a> (\"http\", <var>host</var>), add <var>cookie</var> to <var>cookieList</var>.</p>"
                },
                {
                  "html": "<p>If the top-level <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①②\">site</a> in <var>cookie</var>’s <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/draft-cutler-httpbis-partitioned-cookies#section-2.2\" id=\"ref-for-section-2.2①\">partition key</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site①\">same site</a> with the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①③\">site</a> (\"https\", <var>host</var>), add <var>cookie</var> to <var>cookieList</var>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>cookie</var> in <var>cookieList</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p>Remove <var>cookie</var> from the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc6265/#section-5.3\" id=\"ref-for-section-5.3①\">cookie store</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "clear non-cookie storage for host",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#clear-non-cookie-storage-for-host",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clear-non-cookie-storage-for-host\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clear non-cookie storage for host</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①⑨\">host</a> <var>host</var>, perform\nthe following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://storage.spec.whatwg.org/#storage-shed\" id=\"ref-for-storage-shed\">storage shed</a> <var>shed</var> held by the user agent or a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable\">traversable navigable</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②\">For each</a> <var>storageKey</var> -&gt; <var>storageShelf</var> of <var>shed</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>topLevelSite</var> be <var>storageKey</var>’s top-level site.</p>"
                },
                {
                  "html": "<p>If <var>topLevelSite</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque④\">opaque origin</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑧\">continue</a>.</p>"
                },
                {
                  "html": "<p>If <var>topLevelSite</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host②⓪\">host</a> does not equal <var>host</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑨\">continue</a>.</p>"
                },
                {
                  "html": "<p>Delete all data stored in <var>storageShelf</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove③\">Remove</a> <var>storageKey</var> from <var>shed</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "clear cache for host",
      "href": "https://privacycg.github.io/nav-tracking-mitigations/#clear-cache-for-host",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clear-cache-for-host\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clear cache for host</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host②①\">host</a> <var>host</var>, perform the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>cacheList</var> be the set of entries from the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc9111/#section-2\" id=\"ref-for-section-2\">network cache</a> whose\ntarget URI <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host②②\">host</a> equals <var>host</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>entry</var> in <var>cacheList</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p>Remove <var>entry</var> from the <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc9111/#section-2\" id=\"ref-for-section-2①\">network cache</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If no Bounce Tracking Mitigation Service is currently running, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map⑧\">bounce tracking map</a> contains a malformed host, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unknown-error\" id=\"ref-for-dfn-unknown-error\">unknown error</a>.</p>"
        },
        {
          "html": "<p>Let <var>list</var> be a new list of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#site\" id=\"ref-for-site①④\">site</a> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host②③\">hosts</a> in the <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-map\" id=\"ref-for-bounce-tracking-map⑨\">bounce tracking map</a>.</p>"
        },
        {
          "html": "<p>Let <var>temp</var> be <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-grace-period\" id=\"ref-for-bounce-tracking-grace-period②\">bounce tracking grace period</a>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-grace-period\" id=\"ref-for-bounce-tracking-grace-period③\">bounce tracking grace period</a> to 0 seconds.</p>"
        },
        {
          "html": "<p>Run the <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-timer\" id=\"ref-for-bounce-tracking-timer⑤\">bounce tracking timer</a> algorithm.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/nav-tracking-mitigations/#bounce-tracking-grace-period\" id=\"ref-for-bounce-tracking-grace-period④\">bounce tracking grace period</a> to <var>temp</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success\">success</a> with data <var>list</var>.</p>"
        }
      ]
    }
  ]
}