{
  "spec": {
    "title": "WebXR Layers API Level 1",
    "url": "https://immersive-web.github.io/layers/"
  },
  "algorithms": [
    {
      "name": "redrawLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#the-underlying-resources-of-a-layer-are-lost",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"the-underlying-resources-of-a-layer-are-lost\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">the underlying resources of a layer are lost</dfn> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer④\">XRCompositionLayer</a></code> <var>layer</var>,\nthe user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw①\">needsRedraw</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>layer</var> is not an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer③\">XRProjectionLayer</a></code>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#eventdef-xrquadlayer-redraw\" id=\"ref-for-eventdef-xrquadlayer-redraw\">redraw</a></code> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrlayerevent\" id=\"ref-for-xrlayerevent\">XRLayerEvent</a></code> on <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "intialization of a composition layer",
      "href": "https://immersive-web.github.io/layers/#intialize-a-composition-layer",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"intialize-a-composition-layer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">intialize a composition layer</dfn> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①\">XRSession</a></code> <var>session</var> and an optional instance of a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext\" id=\"ref-for-WebGLRenderingContext\">WebGLRenderingContext</a></code> or a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#WebGL2RenderingContext\" id=\"ref-for-WebGL2RenderingContext\">WebGL2RenderingContext</a></code> <var>context</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session\">session</a> to <var>session</var>.</p>"
        },
        {
          "html": "<p>If <var>context</var> is defined, set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context\">context</a> to <var>context</var>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-blendtexturesourcealpha\" id=\"ref-for-dom-xrcompositionlayer-blendtexturesourcealpha①\">blendTextureSourceAlpha</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-opacity\" id=\"ref-for-dom-xrcompositionlayer-opacity③\">opacity</a></code> to <code>1.0</code>.</p>"
        }
      ]
    },
    {
      "name": "calling destroy on a layer",
      "html": "When calling <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-destroy\" id=\"ref-for-dom-xrcompositionlayer-destroy①\">destroy()</a></code>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures\">colorTextures</a> array to an empty array.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures\">depthStencilTextures</a> array to an empty array.</p>"
        },
        {
          "html": "<p>Destroy the underlying GL attachments.</p>"
        }
      ]
    },
    {
      "name": "setting the space on a layer",
      "href": "https://immersive-web.github.io/layers/#setting-the-space-on-a-layer",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"setting-the-space-on-a-layer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">setting the space on a layer</dfn> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrspace\" id=\"ref-for-xrspace\">XRSpace</a></code> <var>space</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer⑦\">XRCompositionLayer</a></code> <var>layer</var>, the user agent MUST run the following steps to validate if the <var>space</var> is valid:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>space</var> is <code>null</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>space</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrspace-session\" id=\"ref-for-xrspace-session\">session</a> is not equal to the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session①\">session</a>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code> and abort these steps.</p>"
        }
      ]
    },
    {
      "name": "initQuadLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#initialize-a-quad-layer",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"initialize a quad layer\" data-noexport=\"\" id=\"initialize-a-quad-layer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initializing an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrquadlayer\" id=\"ref-for-xrquadlayer①\">XRQuadLayer</a></code> <var>layer</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dictdef-xrquadlayerinit\" id=\"ref-for-dictdef-xrquadlayerinit\">XRQuadLayerInit</a></code> <var>init</var></dfn>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayer-width\" id=\"ref-for-dom-xrquadlayer-width①\">width</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayerinit-width\" id=\"ref-for-dom-xrquadlayerinit-width\">width</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayer-height\" id=\"ref-for-dom-xrquadlayer-height①\">height</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayerinit-height\" id=\"ref-for-dom-xrquadlayerinit-height\">height</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayer-space\" id=\"ref-for-dom-xrquadlayer-space③\">space</a></code> be the <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space\">space</a></code>.</p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayer-transform\" id=\"ref-for-dom-xrquadlayer-transform②\">transform</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If init’s transform is set",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayer-transform\" id=\"ref-for-dom-xrquadlayer-transform③\">transform</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform②\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant realm</a> of <var>layer</var> initialized with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position\">position</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation\">orientation</a></code> of <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayerinit-transform\" id=\"ref-for-dom-xrquadlayerinit-transform①\">transform</a></code>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayer-transform\" id=\"ref-for-dom-xrquadlayer-transform④\">transform</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform③\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant realm</a> of <var>layer</var> initialized with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#dictdef-dompointinit\" id=\"ref-for-dictdef-dompointinit\">DOMPointInit</a></code> position of <code>{ x: 0.0, y: 0.0, z: 0.0, w: 1.0 }</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-isstatic\" id=\"ref-for-xrcompositionlayer-isstatic①\">isStatic</a> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-isstatic\" id=\"ref-for-dom-xrlayerinit-isstatic\">isStatic</a></code></p>"
        }
      ]
    },
    {
      "name": "initCylinderLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#initialize-a-cylinder-layer",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"initialize a cylinder layer\" data-noexport=\"\" id=\"initialize-a-cylinder-layer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initializing an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcylinderlayer\" id=\"ref-for-xrcylinderlayer①\">XRCylinderLayer</a></code> <var>layer</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dictdef-xrcylinderlayerinit\" id=\"ref-for-dictdef-xrcylinderlayerinit\">XRCylinderLayerInit</a></code> <var>init</var></dfn>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-radius\" id=\"ref-for-dom-xrcylinderlayer-radius②\">radius</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-radius\" id=\"ref-for-dom-xrcylinderlayerinit-radius\">radius</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-centralangle\" id=\"ref-for-dom-xrcylinderlayer-centralangle②\">centralAngle</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-centralangle\" id=\"ref-for-dom-xrcylinderlayerinit-centralangle\">centralAngle</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-aspectratio\" id=\"ref-for-dom-xrcylinderlayer-aspectratio①\">aspectRatio</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-aspectratio\" id=\"ref-for-dom-xrcylinderlayerinit-aspectratio\">aspectRatio</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-space\" id=\"ref-for-dom-xrcylinderlayer-space③\">space</a></code> be the <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space①\">space</a></code>.</p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-transform\" id=\"ref-for-dom-xrcylinderlayer-transform②\">transform</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If init’s transform is set",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-transform\" id=\"ref-for-dom-xrcylinderlayer-transform③\">transform</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform⑤\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a> of <var>layer</var> initialized with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position①\">position</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation①\">orientation</a></code> of <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-transform\" id=\"ref-for-dom-xrcylinderlayerinit-transform①\">transform</a></code>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayer-transform\" id=\"ref-for-dom-xrcylinderlayer-transform④\">transform</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform⑥\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant realm</a> of <var>layer</var> initialized with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#dictdef-dompointinit\" id=\"ref-for-dictdef-dompointinit①\">DOMPointInit</a></code> position of <code>{ x: 0.0, y: 0.0, z: 0.0, w: 1.0 }</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-isstatic\" id=\"ref-for-xrcompositionlayer-isstatic②\">isStatic</a> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-isstatic\" id=\"ref-for-dom-xrlayerinit-isstatic①\">isStatic</a></code></p>"
        }
      ]
    },
    {
      "name": "setting the space on an equirect layer",
      "html": "When <var>setting the space on an equirect layer</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrspace\" id=\"ref-for-xrspace⑤\">XRSpace</a></code> <var>space</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrequirectlayer\" id=\"ref-for-xrequirectlayer①\">XREquirectLayer</a></code> <var>layer</var>, the user agent MUST run the following steps to validate if the <var>space</var> is valid:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space②\">space</a></code> is not an instance of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace\">XRReferenceSpace</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space③\">space</a></code> has a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type\">type</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-viewer\" id=\"ref-for-dom-xrreferencespacetype-viewer\">\"viewer\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#setting-the-space-on-a-layer\" id=\"ref-for-setting-the-space-on-a-layer②\">setting the space on a layer</a> with <var>space</var> and <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "initEquirectLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#initialize-a-equirect-layer",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"initialize a equirect layer\" data-noexport=\"\" id=\"initialize-a-equirect-layer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initializing an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrequirectlayer\" id=\"ref-for-xrequirectlayer②\">XREquirectLayer</a></code> <var>layer</var> with an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dictdef-xrequirectlayerinit\" id=\"ref-for-dictdef-xrequirectlayerinit\">XREquirectLayerInit</a></code> <var>init</var></dfn>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-radius\" id=\"ref-for-dom-xrequirectlayer-radius②\">radius</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayerinit-radius\" id=\"ref-for-dom-xrequirectlayerinit-radius\">radius</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-centralhorizontalangle\" id=\"ref-for-dom-xrequirectlayer-centralhorizontalangle②\">centralHorizontalAngle</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayerinit-centralhorizontalangle\" id=\"ref-for-dom-xrequirectlayerinit-centralhorizontalangle\">centralHorizontalAngle</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-upperverticalangle\" id=\"ref-for-dom-xrequirectlayer-upperverticalangle②\">upperVerticalAngle</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayerinit-upperverticalangle\" id=\"ref-for-dom-xrequirectlayerinit-upperverticalangle\">upperVerticalAngle</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-lowerverticalangle\" id=\"ref-for-dom-xrequirectlayer-lowerverticalangle②\">lowerVerticalAngle</a></code> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayerinit-lowerverticalangle\" id=\"ref-for-dom-xrequirectlayerinit-lowerverticalangle\">lowerVerticalAngle</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-space\" id=\"ref-for-dom-xrequirectlayer-space③\">space</a></code> be the <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space④\">space</a></code>.</p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-transform\" id=\"ref-for-dom-xrequirectlayer-transform②\">transform</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If init’s transform is set",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-transform\" id=\"ref-for-dom-xrequirectlayer-transform③\">transform</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform⑧\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a> of <var>layer</var> initialized with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-position\" id=\"ref-for-dom-xrrigidtransform-position②\">position</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrigidtransform-orientation\" id=\"ref-for-dom-xrrigidtransform-orientation②\">orientation</a></code> of <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayerinit-transform\" id=\"ref-for-dom-xrequirectlayerinit-transform①\">transform</a></code>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrequirectlayer-transform\" id=\"ref-for-dom-xrequirectlayer-transform④\">transform</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrigidtransform\" id=\"ref-for-xrrigidtransform⑨\">XRRigidTransform</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant realm</a> of <var>layer</var>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-isstatic\" id=\"ref-for-xrcompositionlayer-isstatic③\">isStatic</a> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-isstatic\" id=\"ref-for-dom-xrlayerinit-isstatic②\">isStatic</a></code></p>"
        }
      ]
    },
    {
      "name": "setting the space on a cube layer",
      "html": "When <var>setting the space on an cube layer</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrspace\" id=\"ref-for-xrspace⑧\">XRSpace</a></code> <var>space</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer②\">XRCubeLayer</a></code> <var>layer</var>, the user agent MUST run the following steps to validate if the <var>space</var> is valid:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space⑤\">space</a></code> is not an instance of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace①\">XRReferenceSpace</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space⑥\">space</a></code> has a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type①\">type</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-viewer\" id=\"ref-for-dom-xrreferencespacetype-viewer①\">\"viewer\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑤\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#setting-the-space-on-a-layer\" id=\"ref-for-setting-the-space-on-a-layer③\">setting the space on a layer</a> with <var>space</var> and <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "construct-webgl-layer",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-xrwebglbinding",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"XRWebGLBinding(session, context)|constructor(session, context)\" id=\"dom-xrwebglbinding-xrwebglbinding\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>XRWebGLBinding(<var>session</var>, <var>context</var>)</code></dfn> constructor\nMUST perform the following steps when invoked:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>binding</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding①⑦\">XRWebGLBinding</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end\">ended</a> value is <code>true</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var> is not an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#immersive-session\" id=\"ref-for-immersive-session\">immersive session</a>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compatible\" id=\"ref-for-xr-compatible\">XR compatible</a> boolean is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Initialize <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context①\">context</a> to <var>context</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session①\">session</a> to <var>session</var>.</p>"
        },
        {
          "html": "<p>Add <var>binding</var> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrsession-bindings\" id=\"ref-for-xrsession-bindings\">bindings</a>.</p>"
        },
        {
          "html": "<p>Return <var>binding</var>.</p>"
        }
      ]
    },
    {
      "name": "determine the layout attribute",
      "href": "https://immersive-web.github.io/layers/#determine-the-layout-attribute",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-the-layout-attribute\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the layout attribute</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype⑤\">XRTextureType</a></code> <var>textureType</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#typedefdef-xrwebglrenderingcontext\" id=\"ref-for-typedefdef-xrwebglrenderingcontext②\">XRWebGLRenderingContext</a></code> <var>context</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrlayerlayout\" id=\"ref-for-enumdef-xrlayerlayout④\">XRLayerLayout</a></code> <var>layout</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>context</var> is not an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#WebGL2RenderingContext\" id=\"ref-for-WebGL2RenderingContext⑤\">WebGL2RenderingContext</a></code> and <var>textureType</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrtexturetype-texture-array\" id=\"ref-for-dom-xrtexturetype-texture-array④\">\"texture-array\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑥\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>textureType</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrtexturetype-texture-array\" id=\"ref-for-dom-xrtexturetype-texture-array⑤\">\"texture-array\"</a></code> and not all of the session’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view\">views</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①\">list of views</a> have the same <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution\">recommended WebGL color texture resolution</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono②\">\"mono\"</a></code>, return <var>layout</var> and abort these steps.</p>"
        },
        {
          "html": "If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default③\">\"default\"</a></code>, run the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the size of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views②\">list of views</a> is <code>1</code>, return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono③\">\"mono\"</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If <var>textureType</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrtexturetype-texture-array\" id=\"ref-for-dom-xrtexturetype-texture-array⑥\">\"texture-array\"</a></code>, return <var>layout</var> and abort these steps.</p>"
            }
          ]
        },
        {
          "html": "If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default④\">\"default\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo\" id=\"ref-for-dom-xrlayerlayout-stereo④\">\"stereo\"</a></code> and <var>textureType</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrtexturetype-texture\" id=\"ref-for-dom-xrtexturetype-texture①\">\"texture\"</a></code>, run the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the user agent prefers <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right③\">\"stereo-left-right\"</a></code> layout, return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right④\">\"stereo-left-right\"</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If the user agent prefers <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom②\">\"stereo-top-bottom\"</a></code> layout, return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom③\">\"stereo-top-bottom\"</a></code> and abort these steps.</p>"
            }
          ]
        },
        {
          "html": "<p>return <var>layout</var>.</p>"
        }
      ]
    },
    {
      "name": "determine the maximum scalefactor",
      "href": "https://immersive-web.github.io/layers/#determine-the-maximum-scalefactor",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-the-maximum-scalefactor\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the maximum scalefactor</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⓪\">XRSession</a></code> <var>session</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#typedefdef-xrwebglrenderingcontext\" id=\"ref-for-typedefdef-xrwebglrenderingcontext③\">XRWebGLRenderingContext</a></code> <var>context</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrlayerlayout\" id=\"ref-for-enumdef-xrlayerlayout⑤\">XRLayerLayout</a></code> <var>layout</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>largest width</var> be the largest width of the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution①\">recommended WebGL color texture resolution</a> from the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views③\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①\">secondary views</a>.</p>"
        },
        {
          "html": "<p>Let <var>largest height</var> be the largest height of the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution②\">recommended WebGL color texture resolution</a> from the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views④\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view②\">secondary views</a>.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right⑤\">\"stereo-left-right\"</a></code> layout, multiply <var>largest width</var> by <code>2</code>.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom④\">\"stereo-top-bottom\"</a></code> layout, multiply <var>largest height</var> by <code>2</code>.</p>"
        },
        {
          "html": "<p>Let <var>largest view dimension</var> be the largest of <var>largest width</var> or <var>largest height</var>.</p>"
        },
        {
          "html": "<p>Let <var>largest texture dimension</var> be the largest dimension of a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture\" id=\"ref-for-WebGLTexture⑤\">WebGLTexture</a></code> created by <var>context</var>.</p>"
        },
        {
          "html": "<p>return <var>largest texture dimension</var> divided by <var>largest view dimension</var>.</p>"
        }
      ]
    },
    {
      "name": "allocate color textures for projection layers",
      "href": "https://immersive-web.github.io/layers/#allocate-color-textures-for-projection-layers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-color-textures-for-projection-layers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate color textures for projection layers</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer①⑤\">XRProjectionLayer</a></code> <var>layer</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype⑥\">XRTextureType</a></code> <var>textureType</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.1\" id=\"ref-for-5.1⑤\">GLenum</a></code> <var>textureFormat</var> and a float <var>scaleFactor</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑦\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context①\">context</a>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session②\">session</a>.</p>"
        },
        {
          "html": "<p>Let <var>numViews</var> be the number of the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑤\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view③\">secondary views</a>.</p>"
        },
        {
          "html": "<p>Let <var>view</var> be the first entry in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑥\">list of views</a> that is not a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view④\">secondary views</a>.</p>"
        },
        {
          "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution③\">recommended WebGL color texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
        },
        {
          "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution④\">recommended WebGL color texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
        },
        {
          "html": "<p>If <var>textureFormat</var> is not in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#list-of-color-formats-for-projection-layers\" id=\"ref-for-list-of-color-formats-for-projection-layers\">list of color formats for projection layers</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono④\">\"mono\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default⑤\">\"default\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "If the session’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view①\">views</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑦\">list of views</a> don’t all have the same <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution⑤\">recommended WebGL color texture resolution</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view⑤\">secondary views</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror②\">NotSupportedError</a></code> and abort these steps."
                },
                {
                  "case": "Otherwise",
                  "html": "For each <var>view</var> in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑧\">list of views</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>view</var> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view⑥\">secondary view</a>, continue.</p>"
                    },
                    {
                      "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution⑥\">recommended WebGL color texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution⑦\">recommended WebGL color texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑨\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture①⑨\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑨\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①①\">TEXTURE_2D</a></code> texture with <var>context</var>, <var>textureFormat</var>, <var>width</var> and <var>height</var>.</p>"
                    },
                    {
                      "html": "<p>Append <var>texture</var> to <var>array</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If the session’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view②\">views</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views⑨\">list of views</a> don’t all have the same <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution⑧\">recommended WebGL color texture resolution</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view⑦\">secondary views</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right⑥\">stereo-left-right</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⓪\">new</a> instance of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②⓪\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⓪\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var> , <var>textureFormat</var>, <var>numViews</var> multiplied by <var>width</var> and <var>height</var>.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout③\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom⑤\">stereo-top-bottom</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①①\">new</a> instance of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②①\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①①\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var> , <var>textureFormat</var>, <var>width</var> and <var>numViews</var> multiplied by <var>height</var>.</p>"
        },
        {
          "html": "<p>return <var>array</var>.</p>"
        }
      ]
    },
    {
      "name": "allocate depth textures for projection layers",
      "href": "https://immersive-web.github.io/layers/#allocate-depth-textures-for-projection-layers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-depth-textures-for-projection-layers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate depth textures for projection layers</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer①⑥\">XRProjectionLayer</a></code> <var>layer</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype⑦\">XRTextureType</a></code> <var>textureType</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.1\" id=\"ref-for-5.1⑥\">GLenum</a></code> <var>textureFormat</var> and a float <var>scaleFactor</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①②\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①②\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context②\">context</a>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session③\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>textureFormat</var> is <code>0</code>, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext\" id=\"ref-for-WebGLRenderingContext⑧\">WebGLRenderingContext</a></code> and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/#webgl_depth_texture\" id=\"ref-for-webgl_depth_texture②\">WEBGL_depth_texture</a></code> <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14.14\" id=\"ref-for-5.14.14⑨\">extension</a> is not enabled in <var>context</var>, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>textureFormat</var> is not in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#list-of-depth-formats-for-projection-layers\" id=\"ref-for-list-of-depth-formats-for-projection-layers\">list of depth formats for projection layers</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror④\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>let <var>numViews</var> be the number of the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①⓪\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view⑧\">secondary views</a>.</p>"
        },
        {
          "html": "<p>Let <var>view</var> be the first entry in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①①\">list of views</a> that is not a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view⑨\">secondary view</a>.</p>"
        },
        {
          "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-depth-texture-resolution\" id=\"ref-for-recommended-webgl-depth-texture-resolution\">recommended WebGL depth texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
        },
        {
          "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-depth-texture-resolution\" id=\"ref-for-recommended-webgl-depth-texture-resolution①\">recommended WebGL depth texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout④\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono⑤\">\"mono\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default⑥\">\"default\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①③\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②②\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①③\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7①⑥\">TEXTURE_2D_ARRAY</a></code> texture with <var>numViews</var> layers using <var>context</var>, <var>textureFormat</var>, <var>stencil</var>, <var>width</var> and <var>height</var>."
                },
                {
                  "case": "Otherwise",
                  "html": "For each <var>view</var> in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①②\">list of views</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>view</var> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①⓪\">secondary view</a>, continue.</p>"
                    },
                    {
                      "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-depth-texture-resolution\" id=\"ref-for-recommended-webgl-depth-texture-resolution②\">recommended WebGL depth texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-depth-texture-resolution\" id=\"ref-for-recommended-webgl-depth-texture-resolution③\">recommended WebGL depth texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①④\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②③\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①④\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①②\">TEXTURE_2D</a></code> texture with <var>context</var>, <var>textureFormat</var>, <var>stencil</var>, <var>width</var> and <var>height</var>.</p>"
                    },
                    {
                      "html": "<p>Append <var>texture</var> to <var>array</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If the session’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view③\">views</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①③\">list of views</a> don’t all have the same <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution⑨\">recommended WebGL color texture resolution</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①①\">secondary views</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑤\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout⑤\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right⑦\">stereo-left-right</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑤\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②④\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑤\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var>, <var>textureFormat</var>, <var>stencil</var>, <var>numViews</var> multiplied by <var>width</var> and <var>height</var>.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout⑥\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom⑥\">stereo-top-bottom</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑥\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②⑤\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑥\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var>, <var>textureFormat</var>, <var>stencil</var>, <var>width</var> and <var>numViews</var> multiplied by <var>height</var>.</p>"
        },
        {
          "html": "<p>return <var>array</var>.</p>"
        }
      ]
    },
    {
      "name": "allocate motion vector textures for projection layers",
      "href": "https://immersive-web.github.io/layers/#allocate-motion-vector-textures-for-projection-layers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-motion-vector-textures-for-projection-layers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate motion vector textures for projection layers</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer①⑦\">XRProjectionLayer</a></code> <var>layer</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑦\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑦\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context③\">context</a>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session④\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with the \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-space-warp\" id=\"ref-for-feature-descriptor-space-warp③\">space-warp</a>\" <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#feature-descriptor\" id=\"ref-for-feature-descriptor⑦\">feature descriptor</a>, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext\" id=\"ref-for-WebGLRenderingContext⑨\">WebGLRenderingContext</a></code> and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/#webgl_depth_texture\" id=\"ref-for-webgl_depth_texture③\">WEBGL_depth_texture</a></code> <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14.14\" id=\"ref-for-5.14.14①⓪\">extension</a> is not enabled in <var>context</var>, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>let <var>numViews</var> be the number of the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①④\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①②\">secondary views</a>.</p>"
        },
        {
          "html": "<p>Let <var>view</var> be the first entry in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①⑤\">list of views</a> that is not a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①③\">secondary view</a>.</p>"
        },
        {
          "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-motion-vector-texture-resolution\" id=\"ref-for-recommended-motion-vector-texture-resolution\">recommended motion vector texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
        },
        {
          "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-motion-vector-texture-resolution\" id=\"ref-for-recommended-motion-vector-texture-resolution①\">recommended motion vector texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout⑦\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono⑥\">\"mono\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default⑦\">\"default\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑧\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②⑥\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑧\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7①⑦\">TEXTURE_2D_ARRAY</a></code> texture with <var>numViews</var> layers using <var>context</var>, <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"39e862ab\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7①⑧\">RGBA16F</a></code>, <var>width</var> and <var>height</var>."
                },
                {
                  "case": "Otherwise",
                  "html": "For each <var>view</var> in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①⑥\">list of views</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>view</var> is a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①④\">secondary view</a>, continue.</p>"
                    },
                    {
                      "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-motion-vector-texture-resolution\" id=\"ref-for-recommended-motion-vector-texture-resolution②\">recommended motion vector texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-motion-vector-texture-resolution\" id=\"ref-for-recommended-motion-vector-texture-resolution③\">recommended motion vector texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
                    },
                    {
                      "html": "<p>let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⑨\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②⑦\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑨\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①③\">TEXTURE_2D</a></code> texture with <var>context</var>, <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"39e862ab\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7①⑨\">RGBA16F</a></code>, <var>width</var> and <var>height</var>.</p>"
                    },
                    {
                      "html": "<p>Append <var>texture</var> to <var>array</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If the session’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view④\">views</a> in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①⑦\">list of views</a> don’t all have the same <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-motion-vector-texture-resolution\" id=\"ref-for-recommended-motion-vector-texture-resolution④\">recommended motion vector texture resolution</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①⑤\">secondary views</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout⑧\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right⑧\">stereo-left-right</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⓪\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②⑧\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⓪\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var>, <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"39e862ab\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②⓪\">RGBA16F</a></code>, <var>numViews</var> multiplied by <var>width</var> and <var>height</var>.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout⑨\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom⑦\">stereo-top-bottom</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②①\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture②⑨\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②①\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var>, <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"39e862ab\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②①\">RGBA16F</a></code>, <var>width</var> and <var>numViews</var> multiplied by <var>height</var>.</p>"
        },
        {
          "html": "<p>return <var>array</var>.</p>"
        }
      ]
    },
    {
      "name": "allocate color textures for the secondary views",
      "href": "https://immersive-web.github.io/layers/#allocate-the-color-textures-for-the-secondary-views",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-the-color-textures-for-the-secondary-views\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate the color textures for the secondary views</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer①⑧\">XRProjectionLayer</a></code> <var>layer</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype⑧\">XRTextureType</a></code> <var>textureType</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.1\" id=\"ref-for-5.1⑦\">GLenum</a></code> <var>textureFormat</var> and a float <var>scaleFactor</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context④\">context</a>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session⑤\">session</a>.</p>"
        },
        {
          "html": "<p>Let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②②\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②②\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>If <var>textureFormat</var> is not in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#list-of-color-formats-for-projection-layers\" id=\"ref-for-list-of-color-formats-for-projection-layers①\">list of color formats for projection layers</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑦\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "For each <var>view</var> in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①⑧\">list of views</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>view</var> is not a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①⑥\">secondary view</a>, continue.</p>"
            },
            {
              "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution①⓪\">recommended WebGL color texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
            },
            {
              "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-color-texture-resolution\" id=\"ref-for-recommended-webgl-color-texture-resolution①①\">recommended WebGL color texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
            },
            {
              "html": "Initialize <var>texture</var> as follows:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If textureType is \"texture-array\":",
                      "html": "Let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②③\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③⓪\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②③\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②②\">TEXTURE_2D_ARRAY</a></code> texture with <var>context</var>, <var>textureFormat</var>, <var>width</var> and <var>height</var>."
                    },
                    {
                      "case": "Otherwise",
                      "html": "Let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②④\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③①\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②④\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①④\">TEXTURE_2D</a></code> texture with <var>context</var>, <var>textureFormat</var>, <var>width</var> and <var>height</var>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Append <var>texture</var> to <var>array</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>array</var> and abort these steps.</p>"
        }
      ]
    },
    {
      "name": "allocate depth textures for the secondary views",
      "href": "https://immersive-web.github.io/layers/#allocate-the-depth-textures-for-the-secondary-views",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-the-depth-textures-for-the-secondary-views\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate the depth textures for the secondary views</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer①⑨\">XRProjectionLayer</a></code> <var>layer</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype⑨\">XRTextureType</a></code> <var>textureType</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.1\" id=\"ref-for-5.1⑧\">GLenum</a></code> <var>textureFormat</var> and a float <var>scaleFactor</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context⑤\">context</a>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session⑥\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>textureFormat</var> is <code>0</code>, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLRenderingContext\" id=\"ref-for-WebGLRenderingContext①⓪\">WebGLRenderingContext</a></code> and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/#webgl_depth_texture\" id=\"ref-for-webgl_depth_texture④\">WEBGL_depth_texture</a></code> <a data-link-type=\"dfn\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14.14\" id=\"ref-for-5.14.14①①\">extension</a> is not enabled in <var>context</var>, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>textureFormat</var> is not in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#list-of-depth-formats-for-projection-layers\" id=\"ref-for-list-of-depth-formats-for-projection-layers①\">list of depth formats for projection layers</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑧\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑤\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑤\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "For each <var>view</var> in the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views①⑨\">list of views</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>view</var> is not a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①⑦\">secondary view</a>, continue.</p>"
            },
            {
              "html": "<p>Let <var>width</var> be the width of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-depth-texture-resolution\" id=\"ref-for-recommended-webgl-depth-texture-resolution④\">recommended WebGL depth texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
            },
            {
              "html": "<p>Let <var>height</var> be the height of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#recommended-webgl-depth-texture-resolution\" id=\"ref-for-recommended-webgl-depth-texture-resolution⑤\">recommended WebGL depth texture resolution</a> multiplied by <var>scaleFactor</var>.</p>"
            },
            {
              "html": "Initialize <var>texture</var> as follows:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If textureType is \"texture-array\":",
                      "html": "Let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑥\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③②\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑥\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②③\">TEXTURE_2D_ARRAY</a></code> texture with <var>context</var>, <var>textureFormat</var>, <var>stencil</var>, <var>width</var> and <var>height</var>."
                    },
                    {
                      "case": "Otherwise",
                      "html": "Let <var>texture</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑦\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③③\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑦\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①⑤\">TEXTURE_2D</a></code> texture with <var>context</var>, <var>textureFormat</var>, <var>stencil</var>, <var>width</var> and <var>height</var>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Append <var>texture</var> to <var>array</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>array</var> and abort these steps.</p>"
        }
      ]
    },
    {
      "name": "allocate color textures",
      "href": "https://immersive-web.github.io/layers/#allocate-color-textures",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-color-textures\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate color textures</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer②②\">XRCompositionLayer</a></code> <var>layer</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype①⓪\">XRTextureType</a></code> <var>textureType</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dictdef-xrlayerinit\" id=\"ref-for-dictdef-xrlayerinit⑥\">XRLayerInit</a></code> <var>init</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑧\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑧\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context⑥\">context</a>.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat③\">colorFormat</a></code> is not in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#list-of-color-formats-for-non-projection-layers\" id=\"ref-for-list-of-color-formats-for-non-projection-layers\">list of color formats for non-projection layers</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑨\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels⑤\">mipLevels</a></code> is smaller than <code>1</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels⑥\">mipLevels</a></code> is larger than <code>1</code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①\">viewPixelHeight</a></code> are not powers of <code>2</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code> and abort these steps</p>"
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①⓪\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono⑦\">\"mono\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②⑨\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③④\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②⑨\">relevant realm</a> of this <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②④\">TEXTURE_2D_ARRAY</a></code> texture with 1 internal texture using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat④\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels⑦\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth②\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight②\">viewPixelHeight</a></code> values."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⓪\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③⑤\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⓪\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①⑥\">TEXTURE_2D</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat⑤\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels⑧\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth③\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight③\">viewPixelHeight</a></code> values."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①①\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo\" id=\"ref-for-dom-xrlayerlayout-stereo⑤\">\"stereo\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③①\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③⑥\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③①\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②⑤\">TEXTURE_2D_ARRAY</a></code> texture with 2 layers using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat⑥\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels⑨\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth④\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight④\">viewPixelHeight</a></code> values."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>array</var> with 2 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③②\">new</a> instances of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③⑦\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③②\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①⑦\">TEXTURE_2D</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat⑦\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①⓪\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth⑤\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight⑤\">viewPixelHeight</a></code> values."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①②\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right⑨\">stereo-left-right</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③③\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③⑧\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③③\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat⑧\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①①\">mipLevels</a></code>, double of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth⑥\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight⑥\">viewPixelHeight</a></code> values.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①③\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom⑧\">stereo-top-bottom</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③④\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture③⑨\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③④\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat⑨\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①②\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth⑦\">viewPixelWidth</a></code> and double of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight⑦\">viewPixelHeight</a></code> values.</p>"
        },
        {
          "html": "<p>return <var>array</var>.</p>"
        }
      ]
    },
    {
      "name": "allocate depth textures",
      "href": "https://immersive-web.github.io/layers/#allocate-depth-textures",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-depth-textures\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate depth textures</dfn> using an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer②③\">XRCompositionLayer</a></code> <var>layer</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrtexturetype\" id=\"ref-for-enumdef-xrtexturetype①①\">XRTextureType</a></code> <var>textureType</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dictdef-xrlayerinit\" id=\"ref-for-dictdef-xrlayerinit⑦\">XRLayerInit</a></code> <var>init</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>let <var>array</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⑤\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⑤\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>let <var>context</var> be <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context⑦\">context</a>.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat②\">depthFormat</a></code> is not set, return <var>array</var> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat③\">depthFormat</a></code> is not in the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#list-of-depth-formats-for-non-projection-layers\" id=\"ref-for-list-of-depth-formats-for-non-projection-layers\">list of depth formats for non-projection layers</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①⓪\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①③\">mipLevels</a></code> is smaller than <code>1</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑥\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①④\">mipLevels</a></code> is larger than <code>1</code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth⑧\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight⑧\">viewPixelHeight</a></code> are not powers of <code>2</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑦\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①④\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-mono\" id=\"ref-for-dom-xrlayerlayout-mono⑧\">\"mono\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⑥\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④⓪\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⑥\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②⑥\">TEXTURE_2D_ARRAY</a></code> texture with 1 internal texture using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat④\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①⑤\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth⑨\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight⑨\">viewPixelHeight</a></code> values."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⑦\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④①\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⑦\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①⑧\">TEXTURE_2D</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat⑤\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①⑥\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①⓪\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①⓪\">viewPixelHeight</a></code> values."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①⑤\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo\" id=\"ref-for-dom-xrlayerlayout-stereo⑥\">\"stereo\"</a></code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If textureType is \"texture-array\":",
                  "html": "Initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⑧\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④②\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⑧\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②⑦\">TEXTURE_2D_ARRAY</a></code> texture with 2 layers using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat⑥\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①⑦\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①①\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①①\">viewPixelHeight</a></code> values."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>array</var> with 2 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③⑨\">new</a> instances of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④③\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③⑨\">relevant realm</a> of <var>context</var> created as a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14①⑨\">TEXTURE_2D</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat⑦\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①⑧\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①②\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①②\">viewPixelHeight</a></code> values."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①⑥\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right①⓪\">stereo-left-right</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④⓪\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④④\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④⓪\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat⑧\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels①⑨\">mipLevels</a></code>, double of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①③\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①③\">viewPixelHeight</a></code> values.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①⑦\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom⑨\">stereo-top-bottom</a></code>, initialize <var>array</var> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④①\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④⑤\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④①\">relevant realm</a> of <var>context</var> created as a <var>textureType</var> texture using <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat⑨\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-miplevels\" id=\"ref-for-dom-xrlayerinit-miplevels②⓪\">mipLevels</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①④\">viewPixelWidth</a></code> and double of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①④\">viewPixelHeight</a></code> values.</p>"
        },
        {
          "html": "<p>return <var>array</var>.</p>"
        }
      ]
    },
    {
      "name": "createProjectionLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-createprojectionlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createProjectionLayer(init)|createProjectionLayer()\" id=\"dom-xrwebglbinding-createprojectionlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createProjectionLayer(optional XRProjectionLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer②⓪\">XRProjectionLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session②\">session</a>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context②\">context</a>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer②①\">XRProjectionLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④②\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end①\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑧\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑨\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer\">intialize a composition layer</a> on <var>layer</var> with <var>session</var> and <var>context</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-isstatic\" id=\"ref-for-xrcompositionlayer-isstatic④\">isStatic</a> to <code>false</code>.</p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayer-ignoredepthvalues\" id=\"ref-for-dom-xrprojectionlayer-ignoredepthvalues①\">ignoreDepthValues</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If init’s depthFormat is false and the XR Compositor will make use of depth values",
                  "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayer-ignoredepthvalues\" id=\"ref-for-dom-xrprojectionlayer-ignoredepthvalues②\">ignoreDepthValues</a></code> to <code>false</code>"
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayer-ignoredepthvalues\" id=\"ref-for-dom-xrprojectionlayer-ignoredepthvalues③\">ignoreDepthValues</a></code> to <code>true</code>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayer-fixedfoveation\" id=\"ref-for-dom-xrprojectionlayer-fixedfoveation③\">fixedFoveation</a></code> to <code>0</code>.</p>"
        },
        {
          "html": "<p>let <var>layout</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#determine-the-layout-attribute\" id=\"ref-for-determine-the-layout-attribute\">determining the layout attribute</a> with <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-texturetype\" id=\"ref-for-dom-xrprojectionlayerinit-texturetype②\">textureType</a></code>, <var>context</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default⑧\">\"default\"</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>maximum scalefactor</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#determine-the-maximum-scalefactor\" id=\"ref-for-determine-the-maximum-scalefactor\">determining the maximum scalefactor</a> with <var>session</var>, <var>context</var> and <var>layout</var>.</p>"
        },
        {
          "html": "<p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor①\">scaleFactor</a></code> is larger than <var>maximum scalefactor</var>, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor②\">scaleFactor</a></code> to <var>maximum scalefactor</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①⑧\">layout</a></code> to <var>layout</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw③\">needsRedraw</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures⑦\">colorTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-color-textures-for-projection-layers\" id=\"ref-for-allocate-color-textures-for-projection-layers\">allocating color textures for projection layers</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-texturetype\" id=\"ref-for-dom-xrprojectionlayerinit-texturetype③\">textureType</a></code>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-colorformat\" id=\"ref-for-dom-xrprojectionlayerinit-colorformat①\">colorFormat</a></code> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor③\">scaleFactor</a></code>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures①\">depthStencilTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-depth-textures-for-projection-layers\" id=\"ref-for-allocate-depth-textures-for-projection-layers\">allocating depth textures for projection layers</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-texturetype\" id=\"ref-for-dom-xrprojectionlayerinit-texturetype④\">textureType</a></code>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-depthformat\" id=\"ref-for-dom-xrprojectionlayerinit-depthformat③\">depthFormat</a></code> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor④\">scaleFactor</a></code>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures\">motionVectorTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-motion-vector-textures-for-projection-layers\" id=\"ref-for-allocate-motion-vector-textures-for-projection-layers\">allocating motion vector textures for projection layers</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-depthformat\" id=\"ref-for-dom-xrprojectionlayerinit-depthformat④\">depthFormat</a></code> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor⑤\">scaleFactor</a></code>.</p>"
        },
        {
          "html": "Initialize the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-colortextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-colortextures-for-secondary-views\">colortextures for secondary views</a> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the session was created with \"secondary-views\" enabled",
                  "html": "Let <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-colortextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-colortextures-for-secondary-views①\">colortextures for secondary views</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-the-color-textures-for-the-secondary-views\" id=\"ref-for-allocate-the-color-textures-for-the-secondary-views\">allocate the color textures for the secondary views</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-texturetype\" id=\"ref-for-dom-xrprojectionlayerinit-texturetype⑤\">textureType</a></code>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-colorformat\" id=\"ref-for-dom-xrprojectionlayerinit-colorformat②\">colorFormat</a></code> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor⑥\">scaleFactor</a></code>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-colortextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-colortextures-for-secondary-views②\">colortextures for secondary views</a> be <code>null</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-depthstenciltextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-depthstenciltextures-for-secondary-views\">depthstenciltextures for secondary views</a> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the session was created with \"secondary-views\" enabled",
                  "html": "Let <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-depthstenciltextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-depthstenciltextures-for-secondary-views①\">depthstenciltextures for secondary views</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-the-depth-textures-for-the-secondary-views\" id=\"ref-for-allocate-the-depth-textures-for-the-secondary-views\">allocate the depth textures for the secondary views</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-texturetype\" id=\"ref-for-dom-xrprojectionlayerinit-texturetype⑥\">textureType</a></code>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-depthformat\" id=\"ref-for-dom-xrprojectionlayerinit-depthformat⑤\">depthFormat</a></code> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayerinit-scalefactor\" id=\"ref-for-dom-xrprojectionlayerinit-scalefactor⑦\">scaleFactor</a></code>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-depthstenciltextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-depthstenciltextures-for-secondary-views②\">depthstenciltextures for secondary views</a> be <code>null</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③①\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "createQuadLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-createquadlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createQuadLayer(init)|createQuadLayer()\" id=\"dom-xrwebglbinding-createquadlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createQuadLayer(XRQuadLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrquadlayer\" id=\"ref-for-xrquadlayer⑨\">XRQuadLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session③\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers②\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①①\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context③\">context</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end②\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⓪\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①①\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default⑨\">\"default\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑦\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrquadlayer\" id=\"ref-for-xrquadlayer①⓪\">XRQuadLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④③\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer①\">intialize a composition layer</a> on <var>layer</var> with <var>session</var> and <var>context</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-a-quad-layer\" id=\"ref-for-initialize-a-quad-layer\">initialize a quad layer</a> with <var>layer</var> and <var>init</var>.</p>"
        },
        {
          "html": "<p>let <var>layout</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#determine-the-layout-attribute\" id=\"ref-for-determine-the-layout-attribute①\">determining the layout attribute</a> with <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayerinit-texturetype\" id=\"ref-for-dom-xrquadlayerinit-texturetype\">textureType</a></code>, <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-layout\" id=\"ref-for-dom-xrlayerinit-layout①\">layout</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout①⑨\">layout</a></code> to <var>layout</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw④\">needsRedraw</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures⑧\">colorTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-color-textures\" id=\"ref-for-allocate-color-textures①\">allocating color textures</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayerinit-texturetype\" id=\"ref-for-dom-xrquadlayerinit-texturetype①\">textureType</a></code> and <var>init</var>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures②\">depthStencilTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-depth-textures\" id=\"ref-for-allocate-depth-textures①\">allocating depth textures</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrquadlayerinit-texturetype\" id=\"ref-for-dom-xrquadlayerinit-texturetype②\">textureType</a></code> and <var>init</var>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures①\">motionVectorTextures</a> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④④\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④④\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③②\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror①\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "createCylinderLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-createcylinderlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createCylinderLayer(init)|createCylinderLayer()\" id=\"dom-xrwebglbinding-createcylinderlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createCylinderLayer(XRCylinderLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcylinderlayer\" id=\"ref-for-xrcylinderlayer⑧\">XRCylinderLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session④\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers③\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①②\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context④\">context</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end③\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①②\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①③\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①⓪\">\"default\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑧\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcylinderlayer\" id=\"ref-for-xrcylinderlayer⑨\">XRCylinderLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④⑤\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer②\">intialize a composition layer</a> on <var>layer</var> with <var>session</var> and <var>context</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-a-cylinder-layer\" id=\"ref-for-initialize-a-cylinder-layer\">initialize a cylinder layer</a> with <var>layer</var> and <var>init</var>.</p>"
        },
        {
          "html": "<p>let <var>layout</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#determine-the-layout-attribute\" id=\"ref-for-determine-the-layout-attribute②\">determining the layout attribute</a> with <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-texturetype\" id=\"ref-for-dom-xrcylinderlayerinit-texturetype\">textureType</a></code>, <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-layout\" id=\"ref-for-dom-xrlayerinit-layout②\">layout</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②⓪\">layout</a></code> to <var>layout</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw⑤\">needsRedraw</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures⑨\">colorTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-color-textures\" id=\"ref-for-allocate-color-textures②\">allocating color textures</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-texturetype\" id=\"ref-for-dom-xrcylinderlayerinit-texturetype①\">textureType</a></code> and <var>init</var>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures③\">depthStencilTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-depth-textures\" id=\"ref-for-allocate-depth-textures②\">allocating depth textures</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-texturetype\" id=\"ref-for-dom-xrcylinderlayerinit-texturetype②\">textureType</a></code> and <var>init</var>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures②\">motionVectorTextures</a> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④⑥\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④⑥\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③③\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror②\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "createEquirectLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-createequirectlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createEquirectLayer(init)|createEquirectLayer()\" id=\"dom-xrwebglbinding-createequirectlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createEquirectLayer(XREquirectLayerLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrequirectlayer\" id=\"ref-for-xrequirectlayer⑧\">XREquirectLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session⑤\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers④\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①③\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context⑤\">context</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end④\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①④\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑤\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①①\">\"default\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑨\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space⑧\">space</a></code> is not an instance of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace③\">XRReferenceSpace</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⓪\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space⑨\">space</a></code> has a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type②\">type</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-viewer\" id=\"ref-for-dom-xrreferencespacetype-viewer⑤\">\"viewer\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①①\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④⑦\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrequirectlayer\" id=\"ref-for-xrequirectlayer⑨\">XREquirectLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④⑦\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer③\">intialize a composition layer</a> on <var>layer</var> with <var>session</var> and <var>context</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-a-equirect-layer\" id=\"ref-for-initialize-a-equirect-layer\">initialize a equirect layer</a> with <var>layer</var> and <var>init</var>.</p>"
        },
        {
          "html": "<p>let <var>layout</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#determine-the-layout-attribute\" id=\"ref-for-determine-the-layout-attribute③\">determining the layout attribute</a> with <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-texturetype\" id=\"ref-for-dom-xrcylinderlayerinit-texturetype③\">textureType</a></code>, <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-layout\" id=\"ref-for-dom-xrlayerinit-layout③\">layout</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②①\">layout</a></code> to <var>layout</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw⑥\">needsRedraw</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①⓪\">colorTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-color-textures\" id=\"ref-for-allocate-color-textures③\">allocating color textures</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-texturetype\" id=\"ref-for-dom-xrcylinderlayerinit-texturetype④\">textureType</a></code> and <var>init</var>.</p>"
        },
        {
          "html": "<p>let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures④\">depthStencilTextures</a> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#allocate-depth-textures\" id=\"ref-for-allocate-depth-textures③\">allocating depth textures</a> with <var>layer</var>, <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcylinderlayerinit-texturetype\" id=\"ref-for-dom-xrcylinderlayerinit-texturetype⑤\">textureType</a></code> and <var>init</var>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures③\">motionVectorTextures</a> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④⑧\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④⑧\">relevant realm</a> of <var>context</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③④\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror③\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "createCubeLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-createcubelayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createCubeLayer(init)|createCubeLayer()\" id=\"dom-xrwebglbinding-createcubelayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createCubeLayer(XRCubeLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer⑧\">XRCubeLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session⑥\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers⑤\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①④\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context⑥\">context</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end⑤\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑥\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#WebGL2RenderingContext\" id=\"ref-for-WebGL2RenderingContext⑥\">WebGL2RenderingContext</a></code> context, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑦\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>context</var> is lost, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑧\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space①⓪\">space</a></code> is not an instance of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace④\">XRReferenceSpace</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①②\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space①①\">space</a></code> has a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type③\">type</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-viewer\" id=\"ref-for-dom-xrreferencespacetype-viewer⑥\">\"viewer\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①③\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④⑨\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer⑨\">XRCubeLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④⑨\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer④\">intialize a composition layer</a> on <var>layer</var> with <var>session</var> and <var>context</var>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcubelayer-space\" id=\"ref-for-dom-xrcubelayer-space④\">space</a></code> be the <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space①②\">space</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-isstatic\" id=\"ref-for-xrcompositionlayer-isstatic⑤\">isStatic</a> to <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-isstatic\" id=\"ref-for-dom-xrlayerinit-isstatic③\">isStatic</a></code></p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcubelayer-orientation\" id=\"ref-for-dom-xrcubelayer-orientation②\">orientation</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If init’s orientation is set",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcubelayer-orientation\" id=\"ref-for-dom-xrcubelayer-orientation③\">orientation</a></code> be the result of running <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-frompoint\" id=\"ref-for-dom-dompointreadonly-frompoint\">fromPoint</a></code> with <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcubelayerinit-orientation\" id=\"ref-for-dom-xrcubelayerinit-orientation①\">orientation</a></code>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcubelayer-orientation\" id=\"ref-for-dom-xrcubelayer-orientation④\">orientation</a></code> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤⓪\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#dompointreadonly\" id=\"ref-for-dompointreadonly②\">DOMPointReadOnly</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤⓪\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>let <var>layout</var> be <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-layout\" id=\"ref-for-dom-xrlayerinit-layout④\">layout</a></code>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw⑦\">needsRedraw</a></code> to <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①②\">\"default\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right①①\">\"stereo-left-right\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom①⓪\">\"stereo-top-bottom\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①④\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①①\">colorTextures</a> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤①\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤①\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①⓪\">XRCubeLayer</a></code>.</p>"
        },
        {
          "html": "Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①②\">colorTextures</a> as follows, based on the value of <var>layout</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"mono\":",
                  "html": "Initialize <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①③\">colorTextures</a> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤②\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④⑥\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤②\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①①\">XRCubeLayer</a></code> created as a <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"9f1b0b77\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14②⓪\">TEXTURE_CUBE_MAP</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat①⓪\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①⑤\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①⑤\">viewPixelHeight</a></code> values."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①④\">colorTextures</a> with 2 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤③\">new</a> instances of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④⑦\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤③\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①②\">XRCubeLayer</a></code> created as a <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"9f1b0b77\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14②①\">TEXTURE_CUBE_MAP</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-colorformat\" id=\"ref-for-dom-xrlayerinit-colorformat①①\">colorFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①⑥\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①⑥\">viewPixelHeight</a></code> values."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures⑤\">depthStencilTextures</a> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤④\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤④\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①③\">XRCubeLayer</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures④\">motionVectorTextures</a> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤⑤\">new</a> array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤⑤\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①④\">XRCubeLayer</a></code>.</p>"
        },
        {
          "html": "If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat①⓪\">depthFormat</a></code> is set, initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures⑥\">depthStencilTextures</a> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If context is not a WebGL2RenderingContext and the WEBGL_depth_texture extension is not enabled in context",
                  "html": "Throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑤\">TypeError</a></code> and abort these steps."
                },
                {
                  "case": "Else if layout is \"mono\"",
                  "html": "Initialize <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures⑦\">depthStencilTextures</a> with 1 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤⑥\">new</a> instance of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④⑧\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤⑥\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①⑤\">XRCubeLayer</a></code> created as a <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"9f1b0b77\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14②②\">TEXTURE_CUBE_MAP</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat①①\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①⑦\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①⑦\">viewPixelHeight</a></code> values."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures⑧\">depthStencilTextures</a> with 2 <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤⑦\">new</a> instances of an <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture④⑨\">opaque texture</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤⑦\">relevant realm</a> of this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcubelayer\" id=\"ref-for-xrcubelayer①⑥\">XRCubeLayer</a></code> created as a <code class=\"idl\"><a data-link-type=\"idl\" data-refhint-key=\"9f1b0b77\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14②③\">TEXTURE_CUBE_MAP</a></code> texture with <var>context</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-depthformat\" id=\"ref-for-dom-xrlayerinit-depthformat①②\">depthFormat</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelwidth\" id=\"ref-for-dom-xrlayerinit-viewpixelwidth①⑧\">viewPixelWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-viewpixelheight\" id=\"ref-for-dom-xrlayerinit-viewpixelheight①⑧\">viewPixelHeight</a></code> values."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③⑤\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror④\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "validate the state of the XRWebGLSubImage creation function",
      "href": "https://immersive-web.github.io/layers/#validate-the-state-of-the-xrwebglsubimage-creation-function",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-the-state-of-the-xrwebglsubimage-creation-function\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate the state of the XRWebGLSubImage creation function</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding①⑧\">XRWebGLBinding</a></code> <var>binding</var> with parameters of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer②④\">XRCompositionLayer</a></code> <var>layer</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrframe\" id=\"ref-for-xrframe⑥\">XRFrame</a></code> <var>frame</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>frame</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrframe-session\" id=\"ref-for-dom-xrframe-session\">session</a></code> is not equal to <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session⑦\">session</a>, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrframe-active\" id=\"ref-for-xrframe-active\">active</a> boolean is <code>false</code>, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#animationframe\" id=\"ref-for-animationframe\">animationFrame</a> boolean is <code>false</code>, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session⑦\">session</a> is not equal to <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session⑧\">session</a>, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context⑦\">context</a> is not equal to <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-context\" id=\"ref-for-xrcompositionlayer-context⑧\">context</a>, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①⑤\">colorTextures</a> array is empty or missing, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-isstatic\" id=\"ref-for-xrcompositionlayer-isstatic⑥\">isStatic</a> is <code>true</code> and <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw⑧\">needsRedraw</a></code> is <code>false</code>, return <code>false</code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "initialize the viewport",
      "href": "https://immersive-web.github.io/layers/#initialize-the-viewport",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-viewport\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the viewport</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrviewport\" id=\"ref-for-xrviewport②\">XRViewport</a></code> <var>viewport</var> with a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#opaque-texture\" id=\"ref-for-opaque-texture⑤⓪\">opaque texture</a> <var>texture</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrlayerlayout\" id=\"ref-for-enumdef-xrlayerlayout⑥\">XRLayerLayout</a></code> <var>layout</var>, an integer <var>offset</var> and a integer <var>num</var>, the user agent MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-x\" id=\"ref-for-dom-xrviewport-x\">x</a></code> to <code>0</code>.</p>"
        },
        {
          "html": "<p>Set <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-y\" id=\"ref-for-dom-xrviewport-y\">y</a></code> to <code>0</code>.</p>"
        },
        {
          "html": "<p>Set <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-width\" id=\"ref-for-dom-xrviewport-width\">width</a></code> to the pixel width of <var>texture</var>.</p>"
        },
        {
          "html": "<p>Set <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-height\" id=\"ref-for-dom-xrviewport-height\">height</a></code> to the pixelh eight of <var>texture</var>.</p>"
        },
        {
          "html": "Update <var>viewport</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If layout is \"stereo-left-right\"",
                  "html": "Set <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-x\" id=\"ref-for-dom-xrviewport-x①\">x</a></code> to the pixel width of <var>texture</var> multiplied by <var>offset</var> and divided by <var>num</var>."
                },
                {
                  "case": "Else if layout is \"stereo-top-bottom\"",
                  "html": "Set <var>viewport</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrviewport-y\" id=\"ref-for-dom-xrviewport-y①\">y</a></code> to the pixel height of <var>texture</var> multiplied by <var>offset</var> and divided by <var>num</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getSubImageAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-getsubimage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"getSubImage(layer, frame, eye)|getSubImage(layer, frame)\" id=\"dom-xrwebglbinding-getsubimage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getSubImage(XRCompositionLayer <var>layer</var>, XRFrame <var>frame</var>, optional XREye <var>eye</var> = <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xreye-none\" id=\"ref-for-dom-xreye-none\">\"none\"</a></code>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglsubimage\" id=\"ref-for-xrwebglsubimage⑥\">XRWebGLSubImage</a></code>. \n    <p>When this method is invoked on an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding①⑨\">XRWebGLBinding</a></code> <var>binding</var>, it MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>subimage</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If getSubImage() was called previously with the same binding, layer and eye, the user agent MAY",
                  "html": "Let <var>subimage</var> be the same <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglsubimage\" id=\"ref-for-xrwebglsubimage⑦\">XRWebGLSubImage</a></code> object as returned by an earlier call with the same arguments."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>subimage</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤⑧\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglsubimage\" id=\"ref-for-xrwebglsubimage⑧\">XRWebGLSubImage</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤⑧\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session⑧\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>layer</var> is not in the <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers\">layers</a></code> array, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑥\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s type is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer\" id=\"ref-for-xrprojectionlayer②②\">XRProjectionLayer</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑦\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②②\">layout</a></code> attribute is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①③\">\"default\"</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑧\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>index</var> be <code>0</code>.</p>"
        },
        {
          "html": "If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②③\">layout</a></code> attribute is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo\" id=\"ref-for-dom-xrlayerlayout-stereo⑦\">\"stereo\"</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>eye</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xreye-none\" id=\"ref-for-dom-xreye-none①\">\"none\"</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑨\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If <var>eye</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xreye-right\" id=\"ref-for-dom-xreye-right\">\"right\"</a></code>, set <var>index</var> to <code>1</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#validate-the-state-of-the-xrwebglsubimage-creation-function\" id=\"ref-for-validate-the-state-of-the-xrwebglsubimage-creation-function\">validate the state of the XRWebGLSubImage creation function</a> with <var>layer</var> and <var>frame</var> is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⑨\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-imageindex\" id=\"ref-for-dom-xrwebglsubimage-imageindex①\">imageIndex</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the layer was created with a textureType of \"texture-array\"",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-imageindex\" id=\"ref-for-dom-xrwebglsubimage-imageindex②\">imageIndex</a></code> with <var>index</var>."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-imageindex\" id=\"ref-for-dom-xrwebglsubimage-imageindex③\">imageIndex</a></code> with <code>0</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture②\">colorTexture</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the layer was created with a textureType of \"texture\"",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture③\">colorTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①⑥\">colorTextures</a> array."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture④\">colorTexture</a></code> with the first element of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①⑦\">colorTextures</a> array."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①\">depthStencilTexture</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the layer’s depthStencilTextures is an empty array",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture②\">depthStencilTexture</a></code> with <code>null</code>."
                },
                {
                  "case": "Else the layer was created with a textureType of \"texture\"",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture③\">depthStencilTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures①⓪\">depthStencilTextures</a> array."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture④\">depthStencilTexture</a></code> with the first element of <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures①①\">depthStencilTextures</a> array."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture①\">motionVectorTexture</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexturewidth\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexturewidth①\">motionVectorTextureWidth</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortextureheight\" id=\"ref-for-dom-xrwebglsubimage-motionvectortextureheight①\">motionVectorTextureHeight</a></code> with <code>null</code>.</p>"
        },
        {
          "html": "<p>Set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexturewidth\" id=\"ref-for-dom-xrwebglsubimage-colortexturewidth①\">colorTextureWidth</a></code> to the pixel width of <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture⑤\">colorTexture</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortextureheight\" id=\"ref-for-dom-xrwebglsubimage-colortextureheight①\">colorTextureHeight</a></code> to the pixel height of <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture⑥\">colorTexture</a></code>.</p>"
        },
        {
          "html": "<p>If <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture⑤\">depthStencilTexture</a></code> is not <code>null</code>, set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexturewidth\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexturewidth①\">depthStencilTextureWidth</a></code> to the pixel width of the first texture in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture⑥\">depthStencilTexture</a></code> array.</p>"
        },
        {
          "html": "<p>If <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture⑦\">depthStencilTexture</a></code> is not <code>null</code>, set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltextureheight\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltextureheight①\">depthStencilTextureHeight</a></code> to the pixel height of the first texture in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture⑧\">depthStencilTexture</a></code> array.</p>"
        },
        {
          "html": "<p>Let <var>viewsPerTexture</var> be <code>1</code>.</p>"
        },
        {
          "html": "<p>If <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②④\">layout</a></code> attribute is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right①③\">\"stereo-left-right\"</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom①②\">\"stereo-top-bottom\"</a></code>, set <var>viewsPerTexture</var> to <code>2</code>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-the-viewport\" id=\"ref-for-initialize-the-viewport\">initialize the viewport</a> on <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrsubimage-viewport\" id=\"ref-for-dom-xrsubimage-viewport②\">viewport</a></code> with <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture⑦\">colorTexture</a></code>, <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②⑤\">layout</a></code>, <var>index</var> and <var>viewsPerTexture</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①\">Queue a task</a> to set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw⑨\">needsRedraw</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>return <var>subimage</var>.</p>"
        }
      ]
    },
    {
      "name": "getViewSubImageAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrwebglbinding-getviewsubimage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRWebGLBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"getViewSubImage(layer, view)\" id=\"dom-xrwebglbinding-getviewsubimage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getViewSubImage(XRProjectionLayer <var>layer</var>, XRView <var>view</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglsubimage\" id=\"ref-for-xrwebglsubimage⑨\">XRWebGLSubImage</a></code>. \n    <p>When this method is invoked on an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding②⓪\">XRWebGLBinding</a></code> <var>binding</var>, it MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Initialize <var>subimage</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If getViewSubImage() was called previously with the same binding, layer and view, the user agent MAY",
                  "html": "Let <var>subimage</var> be the same <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglsubimage\" id=\"ref-for-xrwebglsubimage①⓪\">XRWebGLSubImage</a></code> object as returned by an earlier call with the same arguments."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>subimage</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥⓪\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglsubimage\" id=\"ref-for-xrwebglsubimage①①\">XRWebGLSubImage</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥⓪\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>frame</var> be <var>view</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglbinding-getsubimage-layer-frame-eye-frame\" id=\"ref-for-dom-xrwebglbinding-getsubimage-layer-frame-eye-frame\">frame</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-session\" id=\"ref-for-xrwebglbinding-session⑨\">session</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#validate-the-state-of-the-xrwebglsubimage-creation-function\" id=\"ref-for-validate-the-state-of-the-xrwebglsubimage-creation-function①\">validate the state of the XRWebGLSubImage creation function</a> with <var>layer</var> and <var>frame</var> is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⓪\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>layer</var> is not in the <var>session</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers①\">layers</a></code> array, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⓪\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view-active\" id=\"ref-for-view-active\">active</a> flag is <code>false</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②①\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "Initialize <var>index</var> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If view is a secondary view from session’s list of views",
                  "html": "Let <var>index</var> be the offset of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view⑤\">view</a> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views②①\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#primary-view\" id=\"ref-for-primary-view\">primary views</a>."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var>index</var> be the offset of <var>view</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#view\" id=\"ref-for-view⑥\">view</a> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views②②\">list of views</a> excluding the <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#secondary-view\" id=\"ref-for-secondary-view①⑨\">secondary views</a>."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-imageindex\" id=\"ref-for-dom-xrwebglsubimage-imageindex④\">imageIndex</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the layer was created with a textureType of \"texture-array\":",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-imageindex\" id=\"ref-for-dom-xrwebglsubimage-imageindex⑤\">imageIndex</a></code> with <var>index</var>."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-imageindex\" id=\"ref-for-dom-xrwebglsubimage-imageindex⑥\">imageIndex</a></code> to <code>0</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture⑧\">colorTexture</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If view is a secondary view from session’s list of views",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture⑨\">colorTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-colortextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-colortextures-for-secondary-views③\">colorTextures for secondary views</a>."
                },
                {
                  "case": "Else if the layer’s layout is \"default\" and the layer was created with a textureType of \"texture\"",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture①⓪\">colorTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①⑧\">colorTextures</a> array."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture①①\">colorTexture</a></code> with the first element of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#colortextures\" id=\"ref-for-colortextures①⑨\">colorTextures</a> array."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture⑨\">depthStencilTexture</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the layer’s depthStencilTextures is an empty array",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①⓪\">depthStencilTexture</a></code> with <code>null</code>."
                },
                {
                  "case": "Else if view is a secondary view from session’s list of views",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture①②\">colorTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrprojectionlayer-depthstenciltextures-for-secondary-views\" id=\"ref-for-xrprojectionlayer-depthstenciltextures-for-secondary-views③\">depthStencilTextures for secondary views</a>."
                },
                {
                  "case": "Else if the layer’s layout is \"default\" and the layer was created with a textureType of \"texture\"",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①①\">depthStencilTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures①③\">depthStencilTextures</a> array."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①②\">depthStencilTexture</a></code> with the first element of <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#depthstenciltextures\" id=\"ref-for-depthstenciltextures①④\">depthStencilTextures</a> array."
                }
              ]
            }
          ]
        },
        {
          "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture②\">motionVectorTexture</a></code> as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the layer’s motionVectorTextures is an empty array or view is a secondary view from session’s list of views",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture③\">motionVectorTexture</a></code> with <code>null</code>."
                },
                {
                  "case": "Else the layer was created with a textureType of \"texture\"",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture④\">motionVectorTexture</a></code> with the element at offset <var>index</var> of the <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures⑥\">motionVectorTextures</a> array."
                },
                {
                  "case": "Otherwise",
                  "html": "Initialize <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture⑤\">motionVectorTexture</a></code> with the first element of <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#motionvectortextures\" id=\"ref-for-motionvectortextures⑦\">motionVectorTextures</a> array."
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexturewidth\" id=\"ref-for-dom-xrwebglsubimage-colortexturewidth②\">colorTextureWidth</a></code> to the pixel width of <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture①③\">colorTexture</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortextureheight\" id=\"ref-for-dom-xrwebglsubimage-colortextureheight②\">colorTextureHeight</a></code> to the pixel height of <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture①④\">colorTexture</a></code>.</p>"
        },
        {
          "html": "<p>If <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①③\">depthStencilTexture</a></code> is not <code>null</code>, set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexturewidth\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexturewidth②\">depthStencilTextureWidth</a></code> to the pixel width of the first texture in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①④\">depthStencilTexture</a></code> array.</p>"
        },
        {
          "html": "<p>If <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①⑤\">depthStencilTexture</a></code> is not <code>null</code>, set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltextureheight\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltextureheight②\">depthStencilTextureHeight</a></code> to the pixel height of the first texture in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-depthstenciltexture\" id=\"ref-for-dom-xrwebglsubimage-depthstenciltexture①⑥\">depthStencilTexture</a></code> array.</p>"
        },
        {
          "html": "<p>If <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture⑥\">motionVectorTexture</a></code> is not <code>null</code>, set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexturewidth\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexturewidth②\">motionVectorTextureWidth</a></code> to the pixel width of the first texture in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture⑦\">motionVectorTexture</a></code> array.</p>"
        },
        {
          "html": "<p>If <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture⑧\">motionVectorTexture</a></code> is not <code>null</code>, set <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortextureheight\" id=\"ref-for-dom-xrwebglsubimage-motionvectortextureheight②\">motionVectorTextureHeight</a></code> to the pixel height of the first texture in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-motionvectortexture\" id=\"ref-for-dom-xrwebglsubimage-motionvectortexture⑨\">motionVectorTexture</a></code> array.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-the-viewport\" id=\"ref-for-initialize-the-viewport①\">initialize the viewport</a> on <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrsubimage-viewport\" id=\"ref-for-dom-xrsubimage-viewport④\">viewport</a></code> with <var>subimage</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrwebglsubimage-colortexture\" id=\"ref-for-dom-xrwebglsubimage-colortexture①⑤\">colorTexture</a></code>, <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-layout\" id=\"ref-for-dom-xrcompositionlayer-layout②⑧\">layout</a></code>, <var>index</var> and the number of the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrsession-list-of-views\" id=\"ref-for-xrsession-list-of-views②⑥\">list of views</a>.</p>"
        },
        {
          "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw①⓪\">needsRedraw</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>return <var>subimage</var></p>"
        }
      ]
    },
    {
      "html": "When this method is invoked on an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding②①\">XRWebGLBinding</a></code> <var>binding</var>, it MUST run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>target</var> is not of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14\" id=\"ref-for-5.14②④\">TEXTURE_2D</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7\" id=\"ref-for-3.7②⑧\">TEXTURE_2D_ARRAY</a></code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②②\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If the user agent or device does not support foveation, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>fixed_foveation</var> is less than <code>0</code>, set it to <code>0</code>.</p>"
        },
        {
          "html": "<p>If <var>fixed_foveation</var> is more than <code>1</code>, set it to <code>1</code>.</p>"
        },
        {
          "html": "<p>If no texture is bound to <var>target</var> in <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context⑧\">context</a>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②③\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Apply <var>fixed_foveation</var> to <var>target</var> using <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context⑨\">context</a> using the same algortihm as <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrprojectionlayer-fixedfoveation\" id=\"ref-for-dom-xrprojectionlayer-fixedfoveation④\">fixedFoveation</a></code>.</p>"
        },
        {
          "html": "<p>Add the texture bound to <var>target</var> using <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-context\" id=\"ref-for-xrwebglbinding-context①⓪\">context</a> to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-foveatedtextures\" id=\"ref-for-xrwebglbinding-foveatedtextures\">foveatedTextures</a>.</p>"
        }
      ]
    },
    {
      "name": "render-media-layer",
      "html": "When an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer②⑧\">XRCompositionLayer</a></code> <var>layer</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement\" id=\"ref-for-htmlvideoelement⑥\">HTMLVideoElement</a></code> <var>media</var> needs to be rendered, the user agent\nMUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>usability</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#check-the-usability-of-the-image-argument\" id=\"ref-for-check-the-usability-of-the-image-argument\">checking the usability of</a> <var>media</var>.</p>"
        },
        {
          "html": "<p>If <var>usability</var> is <code>bad</code>, then fill the <var>layer</var> with transparent black and abort these steps.</p>"
        },
        {
          "html": "<p>Fill the <var>layer</var> with the content of the <var>media</var> element.</p>"
        }
      ]
    },
    {
      "name": "construct-media-binding",
      "href": "https://immersive-web.github.io/layers/#dom-xrmediabinding-xrmediabinding",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRMediaBinding\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"XRMediaBinding(session)|constructor(session)\" id=\"dom-xrmediabinding-xrmediabinding\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>XRMediaBinding(XRSession <var>session</var>)</code></dfn> constructor\nMUST perform the following steps when invoked:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end⑥\">ended</a> value is <code>true</code>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②④\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var> is not an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#immersive-session\" id=\"ref-for-immersive-session①\">immersive session</a>, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⑤\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>binding</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrmediabinding\" id=\"ref-for-xrmediabinding⑥\">XRMediaBinding</a></code>in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥②\">relevant realm</a> of <var>session</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrmediabinding-session\" id=\"ref-for-xrmediabinding-session\">session</a> to <var>session</var>.</p>"
        },
        {
          "html": "<p>Return <var>binding</var>.</p>"
        }
      ]
    },
    {
      "name": "calculateaspectratio",
      "href": "https://immersive-web.github.io/layers/#calculate-the-aspect-ratio",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"calculate-the-aspect-ratio\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">calculate the aspect ratio</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement\" id=\"ref-for-htmlvideoelement⑦\">HTMLVideoElement</a></code> <var>video</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#enumdef-xrlayerlayout\" id=\"ref-for-enumdef-xrlayerlayout⑧\">XRLayerLayout</a></code> <var>layout</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>width</var> be the <var>video</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-video-videowidth\" id=\"ref-for-dom-video-videowidth\">videoWidth</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>height</var> be the <var>video</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-video-videoheight\" id=\"ref-for-dom-video-videoheight\">videoHeight</a></code>.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-left-right\" id=\"ref-for-dom-xrlayerlayout-stereo-left-right①④\">\"stereo-left-right\"</a></code>, divide <var>width</var> by <code>2</code>.</p>"
        },
        {
          "html": "<p>If <var>layout</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-stereo-top-bottom\" id=\"ref-for-dom-xrlayerlayout-stereo-top-bottom①③\">\"stereo-top-bottom\"</a></code>, divide <var>height</var> by <code>2</code>.</p>"
        },
        {
          "html": "<p>Return <var>width</var> divided by <var>height</var>.</p>"
        }
      ]
    },
    {
      "name": "createMediaQuadLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrmediabinding-createquadlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRMediaBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createQuadLayer(video, init)|createQuadLayer(video)\" id=\"dom-xrmediabinding-createquadlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createQuadLayer(HTMLVideoElement <var>video</var>, XRMediaQuadLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrquadlayer\" id=\"ref-for-xrquadlayer①③\">XRQuadLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑧\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrmediabinding-session\" id=\"ref-for-xrmediabinding-session①\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers⑥\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①⑤\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end⑦\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⑥\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmedialayerinit-layout\" id=\"ref-for-dom-xrmedialayerinit-layout①\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①⑥\">\"default\"</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②①\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrquadlayer\" id=\"ref-for-xrquadlayer①④\">XRQuadLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥③\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑨\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer⑤\">intialize a composition layer</a> on <var>layer</var> with <var>session</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-media\" id=\"ref-for-xrcompositionlayer-media①\">media</a> to <var>video</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw①①\">needsRedraw</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>Let <var>aspectRatio</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#calculate-the-aspect-ratio\" id=\"ref-for-calculate-the-aspect-ratio\">calculate the aspect ratio</a> with <var>video</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmedialayerinit-layout\" id=\"ref-for-dom-xrmedialayerinit-layout②\">layout</a></code>.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-width\" id=\"ref-for-dom-xrmediaquadlayerinit-width\">width</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-height\" id=\"ref-for-dom-xrmediaquadlayerinit-height\">height</a></code> are <code>undefined</code>, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-width\" id=\"ref-for-dom-xrmediaquadlayerinit-width①\">width</a></code> to <code>1</code>.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-height\" id=\"ref-for-dom-xrmediaquadlayerinit-height①\">height</a></code> is <code>undefined</code>, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-height\" id=\"ref-for-dom-xrmediaquadlayerinit-height②\">height</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-width\" id=\"ref-for-dom-xrmediaquadlayerinit-width②\">width</a></code> divided by <var>aspectRatio</var>.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-width\" id=\"ref-for-dom-xrmediaquadlayerinit-width③\">width</a></code> is <code>undefined</code>, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-width\" id=\"ref-for-dom-xrmediaquadlayerinit-width④\">width</a></code> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediaquadlayerinit-height\" id=\"ref-for-dom-xrmediaquadlayerinit-height③\">height</a></code> multiplied by <var>aspectRatio</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-a-quad-layer\" id=\"ref-for-initialize-a-quad-layer①\">initialize a quad layer</a> with <var>layer</var> and <var>init</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③⑥\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror⑤\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "createMediaCylinderLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrmediabinding-createcylinderlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRMediaBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createCylinderLayer(video, init)|createCylinderLayer(video)\" id=\"dom-xrmediabinding-createcylinderlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createCylinderLayer(HTMLVideoElement <var>video</var>, XRMediaCylinderLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcylinderlayer\" id=\"ref-for-xrcylinderlayer①②\">XRCylinderLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⓪\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrmediabinding-session\" id=\"ref-for-xrmediabinding-session②\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers⑦\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①⑥\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end⑧\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⑦\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmedialayerinit-layout\" id=\"ref-for-dom-xrmedialayerinit-layout③\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①⑦\">\"default\"</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②②\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcylinderlayer\" id=\"ref-for-xrcylinderlayer①③\">XRCylinderLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥④\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③①\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer⑥\">intialize a composition layer</a> on <var>layer</var> with <var>session</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-media\" id=\"ref-for-xrcompositionlayer-media②\">media</a> to <var>video</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw①②\">needsRedraw</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>Let <var>aspectRatio</var> be the result of <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#calculate-the-aspect-ratio\" id=\"ref-for-calculate-the-aspect-ratio①\">calculate the aspect ratio</a> with <var>video</var> and <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmedialayerinit-layout\" id=\"ref-for-dom-xrmedialayerinit-layout④\">layout</a></code>.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediacylinderlayerinit-aspectratio\" id=\"ref-for-dom-xrmediacylinderlayerinit-aspectratio\">aspectRatio</a></code> is <code>undefined</code>, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmediacylinderlayerinit-aspectratio\" id=\"ref-for-dom-xrmediacylinderlayerinit-aspectratio①\">aspectRatio</a></code> to <var>aspectRatio</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-a-cylinder-layer\" id=\"ref-for-initialize-a-cylinder-layer①\">initialize a cylinder layer</a> with <var>layer</var> and <var>init</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③⑦\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror⑥\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "createMediaEquirectLayerAlgo",
      "href": "https://immersive-web.github.io/layers/#dom-xrmediabinding-createequirectlayer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"XRMediaBinding\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"createEquirectLayer(video, init)|createEquirectLayer(video)\" id=\"dom-xrmediabinding-createequirectlayer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createEquirectLayer(HTMLVideoElement <var>video</var>, XRMediaEquirectLayerInit <var>init</var>)</code></dfn> method creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrequirectlayer\" id=\"ref-for-xrequirectlayer①②\">XREquirectLayer</a></code> <var>layer</var>. \n    <p>When this method is invoked, the user agent MUST run the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③②\">this</a> <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrmediabinding-session\" id=\"ref-for-xrmediabinding-session③\">session</a>.</p>"
        },
        {
          "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers⑧\">layers</a>\" enabled, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①⑦\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-writing-modes-4/#css-end\" id=\"ref-for-css-end⑨\">ended</a> value is <code>true</code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⑧\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrmedialayerinit-layout\" id=\"ref-for-dom-xrmedialayerinit-layout⑤\">layout</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerlayout-default\" id=\"ref-for-dom-xrlayerlayout-default①⑧\">\"default\"</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②③\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space①③\">space</a></code> is not an instance of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace\" id=\"ref-for-xrreferencespace⑤\">XRReferenceSpace</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②⑨\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>init</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrlayerinit-space\" id=\"ref-for-dom-xrlayerinit-space①④\">space</a></code> has a <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrreferencespace-type\" id=\"ref-for-xrreferencespace-type④\">type</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrreferencespacetype-viewer\" id=\"ref-for-dom-xrreferencespacetype-viewer⑦\">\"viewer\"</a></code>, throw <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③⓪\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>layer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrequirectlayer\" id=\"ref-for-xrequirectlayer①③\">XREquirectLayer</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥⑤\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③③\">this</a>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#intialize-a-composition-layer\" id=\"ref-for-intialize-a-composition-layer⑦\">intialize a composition layer</a> on <var>layer</var> with <var>session</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-media\" id=\"ref-for-xrcompositionlayer-media③\">media</a> to <var>video</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>layer</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrcompositionlayer-needsredraw\" id=\"ref-for-dom-xrcompositionlayer-needsredraw①③\">needsRedraw</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#initialize-a-equirect-layer\" id=\"ref-for-initialize-a-equirect-layer①\">initialize a equirect layer</a> with <var>layer</var> and <var>init</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xr-compositor\" id=\"ref-for-xr-compositor③⑧\">XR Compositor</a> knows that it will be unable to create the resources for the <var>layer</var> for any reason, throw an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror⑦\">OperationError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>return <var>layer</var>.</p>"
        }
      ]
    },
    {
      "name": "initialize-renderstate-for-layers",
      "href": "https://immersive-web.github.io/layers/#layers-initialize-the-render-state",
      "html": "This module replaces the steps given by <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#layers-initialize-the-render-state\" id=\"ref-for-layers-initialize-the-render-state\">initialize the render state</a>. Instead when an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrrenderstate\" id=\"ref-for-xrrenderstate②\">XRRenderState</a></code> object <var>state</var> is created for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⑤\">XRSession</a></code> <var>session</var>, the user agent MUST <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"layers\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"layers-initialize-the-render-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the render state</dfn> by running the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Initialize <var>state</var> by running the original steps to <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#layers-initialize-the-render-state\" id=\"ref-for-layers-initialize-the-render-state①\">initialize the render state</a>.</p>"
        },
        {
          "html": "<p>Initialize <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers⑤\">layers</a></code> with a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥⑥\">new</a> empty array in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥⑥\">relevant realm</a> of <var>session</var>.</p>"
        }
      ]
    },
    {
      "name": "update-layers-state-for-layers",
      "href": "https://immersive-web.github.io/layers/#layers-update-the-pending-layers-state",
      "html": "This module replaces the steps given by \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#layers-update-the-pending-layers-state\" id=\"ref-for-layers-update-the-pending-layers-state\">update the pending layers state</a>\" from the WebXR specification. Instead when the user agent will <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"layers\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"layers-update-the-pending-layers-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update the pending layers state</dfn> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⑥\">XRSession</a></code> <var>session</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dictdef-xrrenderstateinit\" id=\"ref-for-dictdef-xrrenderstateinit②\">XRRenderStateInit</a></code> <var>newState</var>, it must run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If both <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-baselayer\" id=\"ref-for-dom-xrrenderstateinit-baselayer\">baseLayer</a></code> and <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers④\">layers</a></code> are set, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①⑧\">NotSupportedError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>activeState</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#active-render-state\" id=\"ref-for-active-render-state\">active render state</a>.</p>"
        },
        {
          "html": "If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-baselayer\" id=\"ref-for-dom-xrrenderstateinit-baselayer①\">baseLayer</a></code> is set:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state\">pending render state</a> is <code>null</code>, set it to a copy of <var>activeState</var>.</p>"
            },
            {
              "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state①\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers⑥\">layers</a></code> to <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers⑤\">layers</a></code> is set:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>session</var> was not created with \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#feature-descriptor-layers\" id=\"ref-for-feature-descriptor-layers⑨\">layers</a>\" enabled and <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers⑥\">layers</a></code> contains more than <code>1</code> instance, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①⑨\">NotSupportedError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state②\">pending render state</a> is <code>null</code>, set it to a copy of <var>activeState</var>.</p>"
            },
            {
              "html": "<p>If <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers⑦\">layers</a></code> contains duplicate instances, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②④\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "For each <var>layer</var> in <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers⑧\">layers</a></code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>layer</var> is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer\" id=\"ref-for-xrcompositionlayer②⑨\">XRCompositionLayer</a></code> and <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrcompositionlayer-session\" id=\"ref-for-xrcompositionlayer-session⑨\">session</a> is different from <var>session</var>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑤\">TypeError</a></code> and abort these steps.</p>"
                },
                {
                  "html": "<p>If <var>layer</var> is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer\" id=\"ref-for-xrwebgllayer④\">XRWebGLLayer</a></code> and <var>layer</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#xrwebgllayer-session\" id=\"ref-for-xrwebgllayer-session\">session</a> is different from <var>session</var>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑥\">TypeError</a></code> and abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state③\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer\">baseLayer</a></code> to <code>null</code>.</p>"
            },
            {
              "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/webxr/#pending-render-state\" id=\"ref-for-pending-render-state④\">pending render state</a>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#dom-xrrenderstate-layers\" id=\"ref-for-dom-xrrenderstate-layers⑦\">layers</a></code> to <var>newState</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers⑨\">layers</a></code>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "update-check-layers-state",
      "href": "https://immersive-web.github.io/layers/#check-the-layers-state",
      "html": "This module replaces the steps given by \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#check-the-layers-state\" id=\"ref-for-check-the-layers-state\">check the layers state</a>\" from the WebXR specification. Instead to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-the-layers-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check the layers state</dfn> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate①\">renderState</a></code> <var>state</var>, the user agent MUST run the following steps: \n    \n    <h3 class=\"heading settled\" data-level=\"11.6\" id=\"xrsessionchanges\"><span class=\"secno\">11.6. </span><span class=\"content\">XRSession changes</span><a class=\"self-link\" href=\"https://immersive-web.github.io/layers/#xrsessionchanges\"></a></h3>\n     This module adds the following to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xrsession-interface\" id=\"ref-for-xrsession-interface\">XRSession interface</a>: \n    <p>Each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⑧\">XRSession</a></code> has an internal <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-weakset-objects\" id=\"ref-for-sec-weakset-objects①\">WeakSet</a> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xrsession-bindings\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">bindings</dfn> that holds weak references to each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding②②\">XRWebGLBinding</a></code> that was created with that session.</p>\n    <p>This module adds a step to the \"<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#shut-down-the-session\" id=\"ref-for-shut-down-the-session\">shut down the session</a>\" from the WebXR specification.\nAdd the following to the list:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstate-baselayer\" id=\"ref-for-dom-xrrenderstate-baselayer①\">baseLayer</a></code> is not <code>null</code>, return <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>state</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrrenderstateinit-layers\" id=\"ref-for-dom-xrrenderstateinit-layers①⓪\">layers</a></code> is not empty, return <code>true</code>.</p>"
        },
        {
          "html": "<p>return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "update-check-layers-state",
      "href": "https://immersive-web.github.io/layers/#check-the-layers-state",
      "html": "This module replaces the steps given by \"<a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#check-the-layers-state\" id=\"ref-for-check-the-layers-state\">check the layers state</a>\" from the WebXR specification. Instead to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-the-layers-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check the layers state</dfn> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#dom-xrsession-renderstate\" id=\"ref-for-dom-xrsession-renderstate①\">renderState</a></code> <var>state</var>, the user agent MUST run the following steps: \n    \n    <h3 class=\"heading settled\" data-level=\"11.6\" id=\"xrsessionchanges\"><span class=\"secno\">11.6. </span><span class=\"content\">XRSession changes</span><a class=\"self-link\" href=\"https://immersive-web.github.io/layers/#xrsessionchanges\"></a></h3>\n     This module adds the following to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#xrsession-interface\" id=\"ref-for-xrsession-interface\">XRSession interface</a>: \n    <p>Each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/webxr/#xrsession\" id=\"ref-for-xrsession①⑧\">XRSession</a></code> has an internal <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-weakset-objects\" id=\"ref-for-sec-weakset-objects①\">WeakSet</a> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"XRSession\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"xrsession-bindings\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">bindings</dfn> that holds weak references to each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding\" id=\"ref-for-xrwebglbinding②②\">XRWebGLBinding</a></code> that was created with that session.</p>\n    <p>This module adds a step to the \"<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/webxr/#shut-down-the-session\" id=\"ref-for-shut-down-the-session\">shut down the session</a>\" from the WebXR specification.\nAdd the following to the list:</p>",
      "rationale": "for",
      "steps": [
        {
          "html": "For each <var>binding</var> in <var>session|</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrsession-bindings\" id=\"ref-for-xrsession-bindings①\">bindings</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For each <var>texture</var> in <var>binding</var>’s <a data-link-type=\"dfn\" href=\"https://immersive-web.github.io/layers/#xrwebglbinding-foveatedtextures\" id=\"ref-for-xrwebglbinding-foveatedtextures①\">foveatedTextures</a>:</p>"
            },
            {
              "html": "<p>Remove the foveation from <var>texture</var>.</p>"
            }
          ]
        }
      ]
    }
  ]
}