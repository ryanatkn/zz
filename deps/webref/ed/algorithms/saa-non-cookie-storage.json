{
  "spec": {
    "title": "Extending Storage Access API (SAA) to non-cookie storage",
    "url": "https://privacycg.github.io/saa-non-cookie-storage/"
  },
  "algorithms": [
    {
      "name": "Document/hasUnpartitionedCookieAccess()",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-document-hasunpartitionedcookieaccess",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document③\">Document</a></code> <var>doc</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Document\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-document-hasunpartitionedcookieaccess\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>hasUnpartitionedCookieAccess()</code></dfn> method must run these steps:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return the result of running <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/storage-access/#dom-document-hasstorageaccess\" id=\"ref-for-dom-document-hasstorageaccess\">hasStorageAccess()</a></code> on <var>doc</var>.</p>"
        }
      ]
    },
    {
      "name": "Document/requestStorageAccess(types)",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-document-requeststorageaccess",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document④\">Document</a></code> <var>doc</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Document\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"requestStorageAccess(types)|requestStorageAccess()\" id=\"dom-document-requeststorageaccess\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>requestStorageAccess(types)</code></dfn> method must run these steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>.</p>"
        },
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-cookies\" id=\"ref-for-dom-storageaccesstypes-cookies\">cookies</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-sessionstorage\" id=\"ref-for-dom-storageaccesstypes-sessionstorage\">sessionStorage</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-localstorage\" id=\"ref-for-dom-storageaccesstypes-localstorage\">localStorage</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-indexeddb\" id=\"ref-for-dom-storageaccesstypes-indexeddb\">indexedDB</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-locks\" id=\"ref-for-dom-storageaccesstypes-locks\">locks</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-caches\" id=\"ref-for-dom-storageaccesstypes-caches\">caches</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-getdirectory\" id=\"ref-for-dom-storageaccesstypes-getdirectory\">getDirectory</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-estimate\" id=\"ref-for-dom-storageaccesstypes-estimate\">estimate</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-createobjecturl\" id=\"ref-for-dom-storageaccesstypes-createobjecturl\">createObjectURL</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-revokeobjecturl\" id=\"ref-for-dom-storageaccesstypes-revokeobjecturl\">revokeObjectURL</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-broadcastchannel\" id=\"ref-for-dom-storageaccesstypes-broadcastchannel\">BroadcastChannel</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-sharedworker\" id=\"ref-for-dom-storageaccesstypes-sharedworker\">SharedWorker</a></code> is <code>false</code>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">Reject</a> <var>p</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Return <var>p</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>requestUnpartitionedCookieAccess</var> be <code>true</code> if <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all①\">all</a></code> is <code>true</code> or <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-cookies\" id=\"ref-for-dom-storageaccesstypes-cookies①\">cookies</a></code> is <code>true</code>, and <code>false</code> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>accessPromise</var> be the result of running <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#request-storage-access\" id=\"ref-for-request-storage-access\">request storage access</a> with <var>doc</var> with <var>requestUnpartitionedCookieAccess</var>.</p>"
        },
        {
          "html": "If <var>accessPromise</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">rejects</a> with <code>reason</code> <var>r</var>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">Reject</a> <var>p</var> with <var>r</var>.</p>"
            }
          ]
        },
        {
          "html": "Else:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>handle</var> be a new object of type <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle③\">StorageAccessHandle</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>handle</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle-types\" id=\"ref-for-storageaccesshandle-types\">types</a> to <var>types</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>p</var> with <var>handle</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "html": "Redefine <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-document-requeststorageaccess\" id=\"ref-for-dom-document-requeststorageaccess⑧\">requestStorageAccess()</a></code> to:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#request-storage-access\" id=\"ref-for-request-storage-access①\">request storage access</a> with <var>doc</var> and <var>requestUnpartitionedCookieAccess</var> being <code>true</code>.</p>"
        }
      ]
    },
    {
      "html": "Modify <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-document-requeststorageaccess\" id=\"ref-for-dom-document-requeststorageaccess①⓪\">requestStorageAccess()</a></code> at step 14.1.1.1.1 to read:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>requestUnpartitionedCookieAccess</var> is <code>true</code>, then set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/storage-access/#environment-has-storage-access\" id=\"ref-for-environment-has-storage-access\">has storage access</a> to true.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/sessionStorage",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-sessionstorage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-storageaccesshandle-sessionstorage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>sessionStorage</code></dfn> getter steps are:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all②\">all</a></code> is <code>false</code> and <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-sessionstorage\" id=\"ref-for-dom-storageaccesstypes-sessionstorage①\">sessionStorage</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#dom-sessionstorage\" id=\"ref-for-dom-sessionstorage\">sessionStorage</a>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/localStorage",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-localstorage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-storageaccesshandle-localstorage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>localStorage</code></dfn> getter steps are:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all③\">all</a></code> is <code>false</code> and <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-localstorage\" id=\"ref-for-dom-storageaccesstypes-localstorage①\">localStorage</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#dom-localstorage\" id=\"ref-for-dom-localstorage\">localStorage</a>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/indexedDB",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-indexeddb",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-storageaccesshandle-indexeddb\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>indexedDB</code></dfn> getter steps are:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all④\">all</a></code> is <code>false</code> and <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-indexeddb\" id=\"ref-for-dom-storageaccesstypes-indexeddb①\">indexedDB</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/IndexedDB/#dom-windoworworkerglobalscope-indexeddb\" id=\"ref-for-dom-windoworworkerglobalscope-indexeddb\">indexedDB</a></code>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/locks",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-locks",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-storageaccesshandle-locks\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>locks</code></dfn> getter steps are:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all⑤\">all</a></code> is <code>false</code> and <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-locks\" id=\"ref-for-dom-storageaccesstypes-locks①\">locks</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-locks/#dom-navigatorlocks-locks\" id=\"ref-for-dom-navigatorlocks-locks\">locks</a> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#navigator\" id=\"ref-for-navigator\">Navigator</a></code>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/caches",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-caches",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-storageaccesshandle-caches\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>caches</code></dfn> getter steps are:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all⑥\">all</a></code> is <code>false</code> and <var>this</var>’s <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-caches\" id=\"ref-for-dom-storageaccesstypes-caches①\">caches</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://w3c.github.io/ServiceWorker/#global-caches-attribute\" id=\"ref-for-global-caches-attribute\">caches</a>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/getDirectory()",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-getdirectory",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle④\">StorageAccessHandle</a></code> <var>handle</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-storageaccesstypes\" id=\"ref-for-dictdef-storageaccesstypes②\">StorageAccessTypes</a></code> <var>types</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-storageaccesshandle-getdirectory\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getDirectory()</code></dfn> method must run these steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a>.</p>"
        },
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all⑦\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-getdirectory\" id=\"ref-for-dom-storageaccesstypes-getdirectory①\">getDirectory</a></code> is <code>false</code>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">Reject</a> <var>p</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑥\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>directoryPromise</var> be the result of running <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fs.spec.whatwg.org/#dom-storagemanager-getdirectory\" id=\"ref-for-dom-storagemanager-getdirectory\">getDirectory()</a></code> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#navigator\" id=\"ref-for-navigator①\">Navigator</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://storage.spec.whatwg.org/#dom-navigatorstorage-storage\" id=\"ref-for-dom-navigatorstorage-storage\">storage</a></code>.</p>"
        },
        {
          "html": "If <var>directoryPromise</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">rejects</a> with <code>reason</code> <var>r</var>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">Reject</a> <var>p</var> with <var>r</var>.</p>"
            }
          ]
        },
        {
          "html": "Else if <var>directoryPromise</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolves</a> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fs.spec.whatwg.org/#filesystemdirectoryhandle\" id=\"ref-for-filesystemdirectoryhandle①\">FileSystemDirectoryHandle</a></code> <var>f</var>:",
          "rationale": "resolve",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>p</var> with <var>f</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/estimate()",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-estimate",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle⑤\">StorageAccessHandle</a></code> <var>handle</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-storageaccesstypes\" id=\"ref-for-dictdef-storageaccesstypes③\">StorageAccessTypes</a></code> <var>types</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-storageaccesshandle-estimate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>estimate()</code></dfn> method must run these steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a>.</p>"
        },
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all⑧\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-estimate\" id=\"ref-for-dom-storageaccesstypes-estimate①\">estimate</a></code> is <code>false</code>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">Reject</a> <var>p</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑦\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>estimatePromise</var> be the result of running <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://storage.spec.whatwg.org/#dom-storagemanager-estimate\" id=\"ref-for-dom-storagemanager-estimate\">estimate()</a></code> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#navigator\" id=\"ref-for-navigator②\">Navigator</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://storage.spec.whatwg.org/#dom-navigatorstorage-storage\" id=\"ref-for-dom-navigatorstorage-storage①\">storage</a></code>.</p>"
        },
        {
          "html": "If <var>estimatePromise</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">rejects</a> with <code>reason</code> <var>r</var>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">Reject</a> <var>p</var> with <var>r</var>.</p>"
            }
          ]
        },
        {
          "html": "Else if <var>estimatePromise</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">resolves</a> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://storage.spec.whatwg.org/#dictdef-storageestimate\" id=\"ref-for-dictdef-storageestimate①\">StorageEstimate</a></code> <var>e</var>:",
          "rationale": "resolve",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve④\">Resolve</a> <var>p</var> with <var>e</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/createObjectURL(obj)",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-createobjecturl",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle⑥\">StorageAccessHandle</a></code> <var>handle</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-storageaccesstypes\" id=\"ref-for-dictdef-storageaccesstypes④\">StorageAccessTypes</a></code> <var>types</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob①\">Blob</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" id=\"ref-for-dom-mediasource①\">MediaSource</a></code> <var>obj</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-storageaccesshandle-createobjecturl\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createObjectURL(obj)</code></dfn> method must run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all⑨\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-createobjecturl\" id=\"ref-for-dom-storageaccesstypes-createobjecturl①\">createObjectURL</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑧\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/FileAPI/#dfn-createObjectURL\" id=\"ref-for-dfn-createObjectURL\">createObjectURL</a> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://url.spec.whatwg.org/#url\" id=\"ref-for-url\">URL</a></code> with <var>obj</var>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/revokeObjectURL(url)",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-revokeobjecturl",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle⑦\">StorageAccessHandle</a></code> <var>handle</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-storageaccesstypes\" id=\"ref-for-dictdef-storageaccesstypes⑤\">StorageAccessTypes</a></code> <var>types</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString④\">DOMString</a></code> <var>url</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-storageaccesshandle-revokeobjecturl\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>revokeObjectURL(url)</code></dfn> method must run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all①⓪\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-revokeobjecturl\" id=\"ref-for-dom-storageaccesstypes-revokeobjecturl①\">revokeObjectURL</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑨\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/FileAPI/#dfn-revokeObjectURL\" id=\"ref-for-dfn-revokeObjectURL\">revokeObjectURL</a> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://url.spec.whatwg.org/#url\" id=\"ref-for-url①\">URL</a></code> with <var>url</var>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/BroadcastChannel(name)",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-broadcastchannel",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle⑧\">StorageAccessHandle</a></code> <var>handle</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-storageaccesstypes\" id=\"ref-for-dictdef-storageaccesstypes⑥\">StorageAccessTypes</a></code> <var>types</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑤\">DOMString</a></code> <var>name</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-storageaccesshandle-broadcastchannel\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>BroadcastChannel(name)</code></dfn> method must run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all①①\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-broadcastchannel\" id=\"ref-for-dom-storageaccesstypes-broadcastchannel①\">BroadcastChannel</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①⓪\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#dom-broadcastchannel\" id=\"ref-for-dom-broadcastchannel\">new BroadcastChannel</a> with <var>name</var>.</p>"
        }
      ]
    },
    {
      "html": "Modify <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#dom-sharedworker\" id=\"ref-for-dom-sharedworker①\">new SharedWorker</a> to add a new step below step 1 as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-sharedworkeroptions-samesitecookies\" id=\"ref-for-dom-sharedworkeroptions-samesitecookies①\">sameSiteCookies</a></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-samesitecookiestype-all\" id=\"ref-for-dom-samesitecookiestype-all①\">all</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated document</a> is not <a data-link-type=\"dfn\" href=\"https://privacycg.github.io/storage-access/#first-party-site-context\" id=\"ref-for-first-party-site-context③\">first-party-site context</a>, then:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "Modify <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#worker-processing-model\" id=\"ref-for-worker-processing-model\">Processing Model</a> to add a new step below step 10.4 as follows:",
      "rationale": "set",
      "steps": [
        {
          "html": "<p>Set <var>worker global scope</var>’s <var>sameSiteCookies</var> to <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-sharedworkeroptions-samesitecookies\" id=\"ref-for-dom-sharedworkeroptions-samesitecookies③\">sameSiteCookies</a></code>.</p>"
        }
      ]
    },
    {
      "name": "StorageAccessHandle/SharedWorker(scriptURL, options)",
      "href": "https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesshandle-sharedworker",
      "html": "When invoked on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#storageaccesshandle\" id=\"ref-for-storageaccesshandle⑨\">StorageAccessHandle</a></code> <var>handle</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-storageaccesstypes\" id=\"ref-for-dictdef-storageaccesstypes⑦\">StorageAccessTypes</a></code> <var>types</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString①\">USVString</a></code> <var>scriptURL</var>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑥\">DOMString</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dictdef-sharedworkeroptions\" id=\"ref-for-dictdef-sharedworkeroptions②\">SharedWorkerOptions</a></code> <var>options</var>, the <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"StorageAccessHandle\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"SharedWorker(scriptURL, options)|SharedWorker(scriptURL)\" id=\"dom-storageaccesshandle-sharedworker\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>SharedWorker(scriptURL, options)</code></dfn> method must run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-all\" id=\"ref-for-dom-storageaccesstypes-all①②\">all</a></code> is <code>false</code> and <var>types</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://privacycg.github.io/saa-non-cookie-storage/#dom-storageaccesstypes-sharedworker\" id=\"ref-for-dom-storageaccesstypes-sharedworker①\">SharedWorker</a></code> is <code>false</code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#dom-sharedworker\" id=\"ref-for-dom-sharedworker③\">new SharedWorker</a> with <var>scriptURL</var> and <var>options</var>.</p>"
        }
      ]
    }
  ]
}